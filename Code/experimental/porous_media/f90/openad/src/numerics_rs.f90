
MODULE oad_intrinsics
use OAD_active
use w2f__types
IMPLICIT NONE
SAVE
!
!     **** Statements ****
!
END MODULE

MODULE parameters
use OAD_active
use w2f__types
IMPLICIT NONE
SAVE
!
!     **** Global Variables & Derived Type Definitions ****
!
REAL(w2f__8) HX
REAL(w2f__8) HY
REAL(w2f__8) HZ
REAL(w2f__8) IR
REAL(w2f__8) PERM(:, :, :, :)
ALLOCATABLE PERM
REAL(w2f__8) POR(:)
ALLOCATABLE POR
INTEGER(w2f__i4) SCENARIO_ID
INTEGER(w2f__i4) SOLVER_INNER
INTEGER(w2f__i4) SOLVER_OUTER
REAL(w2f__8) SOR
REAL(w2f__8) SWC
LOGICAL(w2f__i4) VERBOSE
REAL(w2f__8) VO
REAL(w2f__8) VOL
REAL(w2f__8) VW
!
!     **** Statements ****
!
END MODULE

MODULE mathutil
use OAD_active
use w2f__types
use oad_intrinsics
IMPLICIT NONE
SAVE
!
!     **** Statements ****
!
CONTAINS
!#########################################################
! This file is part of OpenAD released under the LGPL.   #
! The full COPYRIGHT notice can be found in the top      #
! level directory of the OpenAD distribution             #
!#########################################################

  SUBROUTINE SCALAR_MAX(SCALARIN1, SCALARIN2, SCALAROUT)
    use OAD_tape
    use OAD_rev

! original arguments get inserted before version
!         ! and declared here together with all local variables
!         ! generated by xaifBooster

  use w2f__types
  IMPLICIT NONE
!
!       **** Global Variables & Derived Type Definitions ****
!
  INTEGER(w2f__i8) OpenAD_Symbol_0
  INTEGER(w2f__i8) OpenAD_Symbol_1
  INTEGER(w2f__i8) OpenAD_Symbol_2
  INTEGER(w2f__i8) OpenAD_Symbol_3
  INTEGER(w2f__i8) OpenAD_Symbol_4
  INTEGER(w2f__i8) OpenAD_Symbol_5
!
!       **** Parameters and Result ****
!
  REAL(w2f__8) SCALARIN1
  REAL(w2f__8) SCALARIN2
  REAL(w2f__8) SCALAROUT


    integer iaddr
    external iaddr
!
!       **** Statements ****
!

   if (our_rev_mode%plain) then
! original function
  IF(SCALARIN1 .GE. SCALARIN2) THEN
    SCALAROUT = SCALARIN1
  ELSE
    SCALAROUT = SCALARIN2
  ENDIF
    end if
    if (our_rev_mode%tape) then
! taping
  IF(SCALARIN1 .GE. SCALARIN2) THEN
    SCALAROUT = SCALARIN1
    OpenAD_Symbol_1 = 1_w2f__i8
    integer_tape(integer_tape_pointer) = OpenAD_Symbol_1
    integer_tape_pointer = integer_tape_pointer+1
  ELSE
    SCALAROUT = SCALARIN2
    OpenAD_Symbol_2 = 0_w2f__i8
    integer_tape(integer_tape_pointer) = OpenAD_Symbol_2
    integer_tape_pointer = integer_tape_pointer+1
  ENDIF
    end if
    if (our_rev_mode%adjoint) then
! adjoint
  integer_tape_pointer = integer_tape_pointer-1
  OpenAD_Symbol_0 = integer_tape(integer_tape_pointer)
  IF(OpenAD_Symbol_0 .ne. 0) THEN
  ENDIF
    end if
  end subroutine SCALAR_MAX
!#########################################################
! This file is part of OpenAD released under the LGPL.   #
! The full COPYRIGHT notice can be found in the top      #
! level directory of the OpenAD distribution             #
!#########################################################

  SUBROUTINE DNRM2(V, LEN_V, N)
    use OAD_tape
    use OAD_rev

! original arguments get inserted before version
!         ! and declared here together with all local variables
!         ! generated by xaifBooster

  use w2f__types
  IMPLICIT NONE
!
!       **** Global Variables & Derived Type Definitions ****
!
  INTEGER(w2f__i8) OpenAD_Symbol_10
  INTEGER(w2f__i8) OpenAD_Symbol_11
  INTEGER(w2f__i8) OpenAD_Symbol_12
  INTEGER(w2f__i8) OpenAD_Symbol_13
  INTEGER(w2f__i8) OpenAD_Symbol_14
  INTEGER(w2f__i8) OpenAD_Symbol_15
  INTEGER(w2f__i8) OpenAD_Symbol_16
  INTEGER(w2f__i8) OpenAD_Symbol_17
  INTEGER(w2f__i8) OpenAD_Symbol_18
  INTEGER(w2f__i8) OpenAD_Symbol_19
  INTEGER(w2f__i8) OpenAD_Symbol_20
  INTEGER(w2f__i8) OpenAD_Symbol_21
  INTEGER(w2f__i8) OpenAD_Symbol_22
  INTEGER(w2f__i8) OpenAD_Symbol_23
  INTEGER(w2f__i8) OpenAD_Symbol_6
  INTEGER(w2f__i8) OpenAD_Symbol_7
  INTEGER(w2f__i8) OpenAD_Symbol_8
  INTEGER(w2f__i8) OpenAD_Symbol_9
!
!       **** Parameters and Result ****
!
  INTEGER(w2f__i4) LEN_V
  REAL(w2f__8) N
  REAL(w2f__8) V(1 : LEN_V)
!
!       **** Local Variables and Functions ****
!
  INTEGER(w2f__i4) I
  REAL(w2f__8) OAD_CTMP0
  REAL(w2f__8) SCALEIN
  REAL(w2f__8) SCALEOUT


    integer iaddr
    external iaddr
!
!       **** Statements ****
!

   if (our_rev_mode%plain) then
! original function
  N = 0.0D00
  SCALEIN = 0.0D00
  SCALEOUT = 0.0D00
  DO I = 1, LEN_V, 1
    OAD_CTMP0 = ABS(V(I))
    CALL SCALAR_MAX(SCALEIN,OAD_CTMP0,SCALEOUT)
    SCALEIN = SCALEOUT
  END DO
  IF(SCALEOUT .eq. 0.0D00) THEN
    N = 0.0D00
  ELSE
    DO I = 1, LEN_V, 1
      N = (N +((V(I) / SCALEOUT) ** 2))
    END DO
    N = (SCALEOUT * SQRT(N))
  ENDIF
    end if
    if (our_rev_mode%tape) then
! taping
  N = 0.0D00
  SCALEIN = 0.0D00
  SCALEOUT = 0.0D00
  OpenAD_Symbol_11 = 0_w2f__i8
  DO I = 1, LEN_V, 1
    OAD_CTMP0 = ABS(V(I))
    CALL SCALAR_MAX(SCALEIN,OAD_CTMP0,SCALEOUT)
    SCALEIN = SCALEOUT
    OpenAD_Symbol_11 = (INT(OpenAD_Symbol_11) + INT(1_w2f__i8))
  END DO
  integer_tape(integer_tape_pointer) = OpenAD_Symbol_11
  integer_tape_pointer = integer_tape_pointer+1
  IF(SCALEOUT .eq. 0.0D00) THEN
    N = 0.0D00
    OpenAD_Symbol_13 = 1_w2f__i8
    integer_tape(integer_tape_pointer) = OpenAD_Symbol_13
    integer_tape_pointer = integer_tape_pointer+1
  ELSE
    OpenAD_Symbol_12 = 0_w2f__i8
    DO I = 1, LEN_V, 1
      N = (N +((V(I) / SCALEOUT) ** 2))
      OpenAD_Symbol_12 = (INT(OpenAD_Symbol_12) + INT(1_w2f__i8))
    END DO
    integer_tape(integer_tape_pointer) = OpenAD_Symbol_12
    integer_tape_pointer = integer_tape_pointer+1
    N = (SCALEOUT * SQRT(N))
    OpenAD_Symbol_14 = 0_w2f__i8
    integer_tape(integer_tape_pointer) = OpenAD_Symbol_14
    integer_tape_pointer = integer_tape_pointer+1
  ENDIF
    end if
    if (our_rev_mode%adjoint) then
! adjoint
  integer_tape_pointer = integer_tape_pointer-1
  OpenAD_Symbol_6 = integer_tape(integer_tape_pointer)
  IF(OpenAD_Symbol_6 .ne. 0) THEN
  ELSE
    integer_tape_pointer = integer_tape_pointer-1
    OpenAD_Symbol_7 = integer_tape(integer_tape_pointer)
    OpenAD_Symbol_8 = 1
    DO WHILE(INT(OpenAD_Symbol_8) .LE. INT(OpenAD_Symbol_7))
      OpenAD_Symbol_8 = INT(OpenAD_Symbol_8) + 1
    END DO
  ENDIF
  integer_tape_pointer = integer_tape_pointer-1
  OpenAD_Symbol_9 = integer_tape(integer_tape_pointer)
  OpenAD_Symbol_10 = 1
  DO WHILE(INT(OpenAD_Symbol_10) .LE. INT(OpenAD_Symbol_9))
    CALL SCALAR_MAX(SCALEIN,OAD_CTMP0,SCALEOUT)
    OpenAD_Symbol_10 = INT(OpenAD_Symbol_10) + 1
  END DO
    end if
  end subroutine DNRM2
END

MODULE matrix
use OAD_active
use w2f__types
use oad_intrinsics
use parameters
IMPLICIT NONE
SAVE
!
!     **** Top Level Pragmas ****
!
interface ADD_X
  module procedure ADDX_DIAGONAL
  module procedure ADDX_ELEM
end interface
interface MYMAX
  module procedure MYMAX_1_1_DOUBLE
  module procedure MYMAX_1_0_DOUBLE
  module procedure MYMAX_0_0_DOUBLE
end interface
interface MYMIN
  module procedure MYMIN_1_1_DOUBLE
  module procedure MYMIN_1_0_DOUBLE
  module procedure MYMIN_0_0_DOUBLE
end interface
interface MYRESHAPE
  module procedure MYRESHAPE_4_1
  module procedure MYRESHAPE_1_4
  module procedure MYRESHAPE_3_1
  module procedure MYRESHAPE_1_3
  module procedure MYRESHAPE_2_1
  module procedure MYRESHAPE_1_2
end interface
interface SPMAT_MULTIPLY
  module procedure SCALAR_MULTIPLY_SPMAT
  module procedure SPMAT_MULTIPLY_VECTOR
  module procedure SPMAT_MULTIPLY_DIAGONAL
end interface

!
!     **** Statements ****
!
CONTAINS
!#########################################################
! This file is part of OpenAD released under the LGPL.   #
! The full COPYRIGHT notice can be found in the top      #
! level directory of the OpenAD distribution             #
!#########################################################

  SUBROUTINE ADDX_ELEM(N, INNZ, IROW_INDEX, IROW_COMPRESSED, ICOL_INDEX, IVALUES&
     &, X, ROW, COL)

    use OAD_tape
    use OAD_rev

! original arguments get inserted before version
!         ! and declared here together with all local variables
!         ! generated by xaifBooster

  use w2f__types
  IMPLICIT NONE
!
!       **** Global Variables & Derived Type Definitions ****
!
  INTEGER(w2f__i8) OpenAD_Symbol_24
  INTEGER(w2f__i8) OpenAD_Symbol_25
  INTEGER(w2f__i8) OpenAD_Symbol_26
  INTEGER(w2f__i8) OpenAD_Symbol_27
  INTEGER(w2f__i8) OpenAD_Symbol_28
  INTEGER(w2f__i8) OpenAD_Symbol_30
  INTEGER(w2f__i8) OpenAD_Symbol_31
  INTEGER(w2f__i8) OpenAD_Symbol_32
  INTEGER(w2f__i8) OpenAD_Symbol_33
  INTEGER(w2f__i8) OpenAD_Symbol_34
!
!       **** Parameters and Result ****
!
  INTEGER(w2f__i4) N
  INTEGER(w2f__i4) INNZ
  INTEGER(w2f__i4) IROW_INDEX(1 : INT((N * 7)))
  INTEGER(w2f__i4) IROW_COMPRESSED(1 : INT((N + 1)))
  INTEGER(w2f__i4) ICOL_INDEX(1 : INT((N * 7)))
  REAL(w2f__8) IVALUES(1 : INT((N * 7)))
  REAL(w2f__8) X
  INTEGER(w2f__i4) ROW
  INTEGER(w2f__i4) COL
!
!       **** Local Variables and Functions ****
!
  INTEGER(w2f__i4) I
  INTEGER(w2f__i8) OpenAD_Symbol_29
  INTEGER(w2f__i8) OpenAD_Symbol_35


    integer iaddr
    external iaddr
!
!       **** Statements ****
!

   if (our_rev_mode%plain) then
! original function
 2      CONTINUE
  GO TO 3
 3      CONTINUE
  GO TO 4
 4      CONTINUE
  I = 1
  GO TO 13
 5      CONTINUE
  I = I + 1
 13     CONTINUE
  IF(I .LE. INNZ) THEN
    GO TO 6
  ELSE
    GO TO 11
  ENDIF
 6      CONTINUE
  IF((IROW_INDEX(I) .eq. ROW) .AND.(ICOL_INDEX(I) .eq. COL)) THEN
    GO TO 10
  ELSE
    GO TO 7
  ENDIF
 7      CONTINUE
  GO TO 8
 8      CONTINUE
  GO TO 9
 9      CONTINUE
  GO TO 5
 10     CONTINUE
  IVALUES(INT(I)) = (IVALUES(I) + X)
  GO TO 11
 11     CONTINUE
  GO TO 12
 12     CONTINUE
  GO TO 1
 1      CONTINUE
    end if
    if (our_rev_mode%tape) then
! taping
 15     CONTINUE
  GO TO 16
 16     CONTINUE
  OpenAD_Symbol_24 = 0_w2f__i8
  integer_tape(integer_tape_pointer) = OpenAD_Symbol_24
  integer_tape_pointer = integer_tape_pointer+1
  GO TO 17
 17     CONTINUE
  GO TO 18
 18     CONTINUE
  OpenAD_Symbol_25 = 1_w2f__i8
  integer_tape(integer_tape_pointer) = OpenAD_Symbol_25
  integer_tape_pointer = integer_tape_pointer+1
  GO TO 19
 19     CONTINUE
  I = 1
  GO TO 31
 20     CONTINUE
  I = I + 1
 31     CONTINUE
  IF(I .LE. INNZ) THEN
    GO TO 21
  ELSE
    GO TO 28
  ENDIF
 21     CONTINUE
  IF((IROW_INDEX(I) .eq. ROW) .AND.(ICOL_INDEX(I) .eq. COL)) THEN
    GO TO 26
  ELSE
    GO TO 22
  ENDIF
 22     CONTINUE
  GO TO 23
 23     CONTINUE
  OpenAD_Symbol_28 = 4_w2f__i8
  integer_tape(integer_tape_pointer) = OpenAD_Symbol_28
  integer_tape_pointer = integer_tape_pointer+1
  GO TO 24
 24     CONTINUE
  GO TO 25
 25     CONTINUE
  GO TO 20
 26     CONTINUE
  IVALUES(INT(I)) = (IVALUES(I) + X)
  GO TO 27
 27     CONTINUE
  OpenAD_Symbol_26 = 2_w2f__i8
  integer_tape(integer_tape_pointer) = OpenAD_Symbol_26
  integer_tape_pointer = integer_tape_pointer+1
  GO TO 28
 28     CONTINUE
  GO TO 29
 29     CONTINUE
  OpenAD_Symbol_27 = 3_w2f__i8
  integer_tape(integer_tape_pointer) = OpenAD_Symbol_27
  integer_tape_pointer = integer_tape_pointer+1
  GO TO 30
 30     CONTINUE
  GO TO 14
 14     CONTINUE
    end if
    if (our_rev_mode%adjoint) then
! adjoint
  integer_tape_pointer = integer_tape_pointer-1
  OpenAD_Symbol_29 = integer_tape(integer_tape_pointer)
  DO WHILE(INT(OpenAD_Symbol_29) .ne. INT(0_w2f__i8))
    IF ( OpenAD_Symbol_29 .EQ. 1) GO TO 52
    IF ( OpenAD_Symbol_29 .EQ. 2) GO TO 53
    IF ( OpenAD_Symbol_29 .EQ. 3) GO TO 54
    IF ( OpenAD_Symbol_29 .EQ. 4) GO TO 55
 52       CONTINUE
    GO TO 49
 53       CONTINUE
    GO TO 49
 54       CONTINUE
    GO TO 49
 55       CONTINUE
    GO TO 49
 49       CONTINUE
    integer_tape_pointer = integer_tape_pointer-1
    OpenAD_Symbol_29 = integer_tape(integer_tape_pointer)
  END DO
    end if
  end subroutine ADDX_ELEM
!#########################################################
! This file is part of OpenAD released under the LGPL.   #
! The full COPYRIGHT notice can be found in the top      #
! level directory of the OpenAD distribution             #
!#########################################################

  SUBROUTINE ADDX_DIAGONAL(N, INNZ, IROW_INDEX, IROW_COMPRESSED, ICOL_INDEX, IVA&
     &LUES, X, DIAG)

    use OAD_tape
    use OAD_rev

! original arguments get inserted before version
!         ! and declared here together with all local variables
!         ! generated by xaifBooster

  use w2f__types
  IMPLICIT NONE
!
!       **** Global Variables & Derived Type Definitions ****
!
  INTEGER(w2f__i8) OpenAD_Symbol_36
  INTEGER(w2f__i8) OpenAD_Symbol_37
  INTEGER(w2f__i8) OpenAD_Symbol_38
  INTEGER(w2f__i8) OpenAD_Symbol_39
  INTEGER(w2f__i8) OpenAD_Symbol_40
  INTEGER(w2f__i8) OpenAD_Symbol_41
  INTEGER(w2f__i8) OpenAD_Symbol_42
  INTEGER(w2f__i8) OpenAD_Symbol_43
  INTEGER(w2f__i8) OpenAD_Symbol_44
  INTEGER(w2f__i8) OpenAD_Symbol_45
  INTEGER(w2f__i8) OpenAD_Symbol_46
  INTEGER(w2f__i8) OpenAD_Symbol_47
!
!       **** Parameters and Result ****
!
  INTEGER(w2f__i4) N
  INTEGER(w2f__i4) INNZ
  INTEGER(w2f__i4) IROW_INDEX(1 : INT((N * 7)))
  INTEGER(w2f__i4) IROW_COMPRESSED(1 : INT((N + 1)))
  INTEGER(w2f__i4) ICOL_INDEX(1 : INT((N * 7)))
  type(active) :: IVALUES(1:INT((N*7)))
  REAL(w2f__8) X
  INTEGER(w2f__i4) DIAG
!
!       **** Local Variables and Functions ****
!
  INTEGER(w2f__i4) I
  INTEGER(w2f__i4) OpenAD_Symbol_900
  type(active) :: OpenAD_prp_0


    integer iaddr
    external iaddr
!
!       **** Statements ****
!

   if (our_rev_mode%plain) then
! original function
  DO I = 1, INNZ, 1
    IF(DIAG .eq.(ICOL_INDEX(I) - IROW_INDEX(I))) THEN
      IVALUES(INT(I))%v = (IVALUES(I)%v+X)
    ENDIF
  END DO
    end if
    if (our_rev_mode%tape) then
! taping
  OpenAD_Symbol_39 = 0_w2f__i8
  DO I = 1,INNZ,1
    IF (DIAG.eq.(ICOL_INDEX(I)-IROW_INDEX(I))) THEN
      IVALUES(INT(I))%v = (IVALUES(I)%v+X)
      integer_tape(integer_tape_pointer) = I
      integer_tape_pointer = integer_tape_pointer+1
      OpenAD_Symbol_40 = 1_w2f__i8
      integer_tape(integer_tape_pointer) = OpenAD_Symbol_40
      integer_tape_pointer = integer_tape_pointer+1
    ELSE
      OpenAD_Symbol_41 = 0_w2f__i8
      integer_tape(integer_tape_pointer) = OpenAD_Symbol_41
      integer_tape_pointer = integer_tape_pointer+1
    ENDIF
    OpenAD_Symbol_39 = (INT(OpenAD_Symbol_39)+INT(1_w2f__i8))
  END DO
  integer_tape(integer_tape_pointer) = OpenAD_Symbol_39
  integer_tape_pointer = integer_tape_pointer+1
    end if
    if (our_rev_mode%adjoint) then
! adjoint
  integer_tape_pointer = integer_tape_pointer-1
  OpenAD_Symbol_36 = integer_tape(integer_tape_pointer)
  OpenAD_Symbol_37 = 1
  do while (INT(OpenAD_Symbol_37).LE.INT(OpenAD_Symbol_36))
    integer_tape_pointer = integer_tape_pointer-1
    OpenAD_Symbol_38 = integer_tape(integer_tape_pointer)
    IF (OpenAD_Symbol_38.ne.0) THEN
      integer_tape_pointer = integer_tape_pointer-1
      OpenAD_Symbol_900 = integer_tape(integer_tape_pointer)
      OpenAD_prp_0%d = OpenAD_prp_0%d+IVALUES(OpenAD_Symbol_900)%d
      IVALUES(OpenAD_Symbol_900)%d = 0.0d0
      IVALUES(OpenAD_Symbol_900)%d = IVALUES(OpenAD_Symbol_900)%d+OpenAD_prp_0%d
      OpenAD_prp_0%d = 0.0d0
    ENDIF
    OpenAD_Symbol_37 = INT(OpenAD_Symbol_37)+1
  END DO
    end if
  end subroutine ADDX_DIAGONAL
!#########################################################
! This file is part of OpenAD released under the LGPL.   #
! The full COPYRIGHT notice can be found in the top      #
! level directory of the OpenAD distribution             #
!#########################################################

  SUBROUTINE GETDIAG(ROW, COL, DIAG)
    use OAD_tape
    use OAD_rev

! original arguments get inserted before version
!         ! and declared here together with all local variables
!         ! generated by xaifBooster

  use w2f__types
  IMPLICIT NONE
!
!       **** Parameters and Result ****
!
  INTEGER(w2f__i4) ROW
  INTEGER(w2f__i4) COL
  INTEGER(w2f__i4) DIAG


    integer iaddr
    external iaddr
!
!       **** Statements ****
!

   if (our_rev_mode%plain) then
! original function
  DIAG = (COL - ROW)
    end if
    if (our_rev_mode%tape) then
! taping
  DIAG = (COL - ROW)
    end if
    if (our_rev_mode%adjoint) then
! adjoint
    end if
  end subroutine GETDIAG
!#########################################################
! This file is part of OpenAD released under the LGPL.   #
! The full COPYRIGHT notice can be found in the top      #
! level directory of the OpenAD distribution             #
!#########################################################

  SUBROUTINE FIRSTELM(DIAG, ROW, COL)
    use OAD_tape
    use OAD_rev

! original arguments get inserted before version
!         ! and declared here together with all local variables
!         ! generated by xaifBooster

  use w2f__types
  IMPLICIT NONE
!
!       **** Global Variables & Derived Type Definitions ****
!
  INTEGER(w2f__i8) OpenAD_Symbol_48
  INTEGER(w2f__i8) OpenAD_Symbol_49
  INTEGER(w2f__i8) OpenAD_Symbol_50
  INTEGER(w2f__i8) OpenAD_Symbol_51
  INTEGER(w2f__i8) OpenAD_Symbol_52
  INTEGER(w2f__i8) OpenAD_Symbol_53
  INTEGER(w2f__i8) OpenAD_Symbol_54
  INTEGER(w2f__i8) OpenAD_Symbol_55
  INTEGER(w2f__i8) OpenAD_Symbol_56
  INTEGER(w2f__i8) OpenAD_Symbol_57
  INTEGER(w2f__i8) OpenAD_Symbol_58
  INTEGER(w2f__i8) OpenAD_Symbol_59
!
!       **** Parameters and Result ****
!
  INTEGER(w2f__i4) DIAG
  INTEGER(w2f__i4) ROW
  INTEGER(w2f__i4) COL


    integer iaddr
    external iaddr
!
!       **** Statements ****
!

   if (our_rev_mode%plain) then
! original function
  IF(DIAG .LT. 0) THEN
    ROW = (1 - DIAG)
    COL = 1
  ELSE
    IF(DIAG .eq. 0) THEN
      ROW = 1
      COL = 1
    ELSE
      ROW = 1
      COL = (DIAG + 1)
    ENDIF
  ENDIF
    end if
    if (our_rev_mode%tape) then
! taping
  IF(DIAG .LT. 0) THEN
    ROW = (1 - DIAG)
    COL = 1
    OpenAD_Symbol_52 = 1_w2f__i8
    integer_tape(integer_tape_pointer) = OpenAD_Symbol_52
    integer_tape_pointer = integer_tape_pointer+1
  ELSE
    IF(DIAG .eq. 0) THEN
      ROW = 1
      COL = 1
      OpenAD_Symbol_50 = 1_w2f__i8
      integer_tape(integer_tape_pointer) = OpenAD_Symbol_50
      integer_tape_pointer = integer_tape_pointer+1
    ELSE
      ROW = 1
      COL = (DIAG + 1)
      OpenAD_Symbol_51 = 0_w2f__i8
      integer_tape(integer_tape_pointer) = OpenAD_Symbol_51
      integer_tape_pointer = integer_tape_pointer+1
    ENDIF
    OpenAD_Symbol_53 = 0_w2f__i8
    integer_tape(integer_tape_pointer) = OpenAD_Symbol_53
    integer_tape_pointer = integer_tape_pointer+1
  ENDIF
    end if
    if (our_rev_mode%adjoint) then
! adjoint
  integer_tape_pointer = integer_tape_pointer-1
  OpenAD_Symbol_48 = integer_tape(integer_tape_pointer)
  IF(OpenAD_Symbol_48 .ne. 0) THEN
  ELSE
    integer_tape_pointer = integer_tape_pointer-1
    OpenAD_Symbol_49 = integer_tape(integer_tape_pointer)
    IF(OpenAD_Symbol_49 .ne. 0) THEN
    ENDIF
  ENDIF
    end if
  end subroutine FIRSTELM
!#########################################################
! This file is part of OpenAD released under the LGPL.   #
! The full COPYRIGHT notice can be found in the top      #
! level directory of the OpenAD distribution             #
!#########################################################

  SUBROUTINE NOELEMS(DIAG, OROWS, OCOLS, N)
    use OAD_tape
    use OAD_rev

! original arguments get inserted before version
!         ! and declared here together with all local variables
!         ! generated by xaifBooster

  use w2f__types
  IMPLICIT NONE
!
!       **** Global Variables & Derived Type Definitions ****
!
  INTEGER(w2f__i8) OpenAD_Symbol_60
  INTEGER(w2f__i8) OpenAD_Symbol_61
  INTEGER(w2f__i8) OpenAD_Symbol_62
  INTEGER(w2f__i8) OpenAD_Symbol_63
  INTEGER(w2f__i8) OpenAD_Symbol_64
  INTEGER(w2f__i8) OpenAD_Symbol_65
  INTEGER(w2f__i8) OpenAD_Symbol_66
  INTEGER(w2f__i8) OpenAD_Symbol_67
  INTEGER(w2f__i8) OpenAD_Symbol_68
  INTEGER(w2f__i8) OpenAD_Symbol_69
  INTEGER(w2f__i8) OpenAD_Symbol_70
  INTEGER(w2f__i8) OpenAD_Symbol_71
!
!       **** Parameters and Result ****
!
  INTEGER(w2f__i4) DIAG
  INTEGER(w2f__i4) OROWS
  INTEGER(w2f__i4) OCOLS
  INTEGER(w2f__i4) N
!
!       **** Local Variables and Functions ****
!
  INTEGER(w2f__i4) COL
  INTEGER(w2f__i4) ROW


    integer iaddr
    external iaddr
!
!       **** Statements ****
!

   if (our_rev_mode%plain) then
! original function
  CALL FIRSTELM(DIAG,ROW,COL)
  IF(DIAG .LT. 0) THEN
    N = (OROWS - ROW + 1)
  ELSE
    IF(DIAG .eq. 0) THEN
      N = MIN(OROWS, OCOLS)
    ELSE
      N = (OCOLS - COL + 1)
    ENDIF
  ENDIF
    end if
    if (our_rev_mode%tape) then
! taping
  CALL FIRSTELM(DIAG,ROW,COL)
  IF(DIAG .LT. 0) THEN
    N = (OROWS - ROW + 1)
    OpenAD_Symbol_64 = 1_w2f__i8
    integer_tape(integer_tape_pointer) = OpenAD_Symbol_64
    integer_tape_pointer = integer_tape_pointer+1
  ELSE
    IF(DIAG .eq. 0) THEN
      N = MIN(OROWS, OCOLS)
      OpenAD_Symbol_62 = 1_w2f__i8
      integer_tape(integer_tape_pointer) = OpenAD_Symbol_62
      integer_tape_pointer = integer_tape_pointer+1
    ELSE
      N = (OCOLS - COL + 1)
      OpenAD_Symbol_63 = 0_w2f__i8
      integer_tape(integer_tape_pointer) = OpenAD_Symbol_63
      integer_tape_pointer = integer_tape_pointer+1
    ENDIF
    OpenAD_Symbol_65 = 0_w2f__i8
    integer_tape(integer_tape_pointer) = OpenAD_Symbol_65
    integer_tape_pointer = integer_tape_pointer+1
  ENDIF
    end if
    if (our_rev_mode%adjoint) then
! adjoint
  integer_tape_pointer = integer_tape_pointer-1
  OpenAD_Symbol_60 = integer_tape(integer_tape_pointer)
  IF(OpenAD_Symbol_60 .ne. 0) THEN
  ELSE
    integer_tape_pointer = integer_tape_pointer-1
    OpenAD_Symbol_61 = integer_tape(integer_tape_pointer)
    IF(OpenAD_Symbol_61 .ne. 0) THEN
    ENDIF
  ENDIF
  CALL FIRSTELM(DIAG,ROW,COL)
    end if
  end subroutine NOELEMS
!#########################################################
! This file is part of OpenAD released under the LGPL.   #
! The full COPYRIGHT notice can be found in the top      #
! level directory of the OpenAD distribution             #
!#########################################################

  SUBROUTINE MYRESHAPE_2_1(AMATRIX, BMATRIX)
    use OAD_tape
    use OAD_rev

! original arguments get inserted before version
!         ! and declared here together with all local variables
!         ! generated by xaifBooster

  use w2f__types
  IMPLICIT NONE
!
!       **** Global Variables & Derived Type Definitions ****
!
  INTEGER(w2f__i8) OpenAD_Symbol_72
  INTEGER(w2f__i8) OpenAD_Symbol_73
  INTEGER(w2f__i8) OpenAD_Symbol_74
  INTEGER(w2f__i8) OpenAD_Symbol_75
  INTEGER(w2f__i8) OpenAD_Symbol_76
  INTEGER(w2f__i8) OpenAD_Symbol_77
  INTEGER(w2f__i8) OpenAD_Symbol_78
  INTEGER(w2f__i8) OpenAD_Symbol_79
  INTEGER(w2f__i8) OpenAD_Symbol_80
  INTEGER(w2f__i8) OpenAD_Symbol_81
  INTEGER(w2f__i8) OpenAD_Symbol_82
  INTEGER(w2f__i8) OpenAD_Symbol_83
!
!       **** Parameters and Result ****
!
  REAL(w2f__8) AMATRIX(1 :, 1 :)
  REAL(w2f__8) BMATRIX(1 :)
!
!       **** Local Variables and Functions ****
!
  INTEGER(w2f__i4) I
  INTEGER(w2f__i4) J
  INTEGER(w2f__i4) K


    integer iaddr
    external iaddr
!
!       **** Statements ****
!

   if (our_rev_mode%plain) then
! original function
  K = 0
  DO J = 1, SIZE(AMATRIX, 2), 1
    DO I = 1, SIZE(AMATRIX, 1), 1
      K = (K + 1)
      BMATRIX(INT(K)) = AMATRIX(I, J)
    END DO
  END DO
    end if
    if (our_rev_mode%tape) then
! taping
  K = 0
  OpenAD_Symbol_76 = 0_w2f__i8
  DO J = 1, SIZE(AMATRIX, 2), 1
    OpenAD_Symbol_77 = 0_w2f__i8
    DO I = 1, SIZE(AMATRIX, 1), 1
      K = (K + 1)
      BMATRIX(INT(K)) = AMATRIX(I, J)
      OpenAD_Symbol_77 = (INT(OpenAD_Symbol_77) + INT(1_w2f__i8))
    END DO
    integer_tape(integer_tape_pointer) = OpenAD_Symbol_77
    integer_tape_pointer = integer_tape_pointer+1
    OpenAD_Symbol_76 = (INT(OpenAD_Symbol_76) + INT(1_w2f__i8))
  END DO
  integer_tape(integer_tape_pointer) = OpenAD_Symbol_76
  integer_tape_pointer = integer_tape_pointer+1
    end if
    if (our_rev_mode%adjoint) then
! adjoint
  integer_tape_pointer = integer_tape_pointer-1
  OpenAD_Symbol_72 = integer_tape(integer_tape_pointer)
  OpenAD_Symbol_73 = 1
  DO WHILE(INT(OpenAD_Symbol_73) .LE. INT(OpenAD_Symbol_72))
    integer_tape_pointer = integer_tape_pointer-1
    OpenAD_Symbol_74 = integer_tape(integer_tape_pointer)
    OpenAD_Symbol_75 = 1
    DO WHILE(INT(OpenAD_Symbol_75) .LE. INT(OpenAD_Symbol_74))
      OpenAD_Symbol_75 = INT(OpenAD_Symbol_75) + 1
    END DO
    OpenAD_Symbol_73 = INT(OpenAD_Symbol_73) + 1
  END DO
    end if
  end subroutine MYRESHAPE_2_1
!#########################################################
! This file is part of OpenAD released under the LGPL.   #
! The full COPYRIGHT notice can be found in the top      #
! level directory of the OpenAD distribution             #
!#########################################################

  SUBROUTINE MYRESHAPE_1_2(AMATRIX, BMATRIX)
    use OAD_tape
    use OAD_rev

! original arguments get inserted before version
!         ! and declared here together with all local variables
!         ! generated by xaifBooster

  use w2f__types
  IMPLICIT NONE
!
!       **** Global Variables & Derived Type Definitions ****
!
  INTEGER(w2f__i8) OpenAD_Symbol_84
  INTEGER(w2f__i8) OpenAD_Symbol_85
  INTEGER(w2f__i8) OpenAD_Symbol_86
  INTEGER(w2f__i8) OpenAD_Symbol_87
  INTEGER(w2f__i8) OpenAD_Symbol_88
  INTEGER(w2f__i8) OpenAD_Symbol_89
  INTEGER(w2f__i8) OpenAD_Symbol_90
  INTEGER(w2f__i8) OpenAD_Symbol_91
  INTEGER(w2f__i8) OpenAD_Symbol_92
  INTEGER(w2f__i8) OpenAD_Symbol_93
  INTEGER(w2f__i8) OpenAD_Symbol_94
  INTEGER(w2f__i8) OpenAD_Symbol_95
!
!       **** Parameters and Result ****
!
  REAL(w2f__8) AMATRIX(1 :)
  REAL(w2f__8) BMATRIX(1 :, 1 :)
!
!       **** Local Variables and Functions ****
!
  INTEGER(w2f__i4) I
  INTEGER(w2f__i4) J
  INTEGER(w2f__i4) K


    integer iaddr
    external iaddr
!
!       **** Statements ****
!

   if (our_rev_mode%plain) then
! original function
  K = 0
  DO J = 1, SIZE(BMATRIX, 2), 1
    DO I = 1, SIZE(BMATRIX, 1), 1
      K = (K + 1)
      BMATRIX(INT(I), INT(J)) = AMATRIX(K)
    END DO
  END DO
    end if
    if (our_rev_mode%tape) then
! taping
  K = 0
  OpenAD_Symbol_88 = 0_w2f__i8
  DO J = 1, SIZE(BMATRIX, 2), 1
    OpenAD_Symbol_89 = 0_w2f__i8
    DO I = 1, SIZE(BMATRIX, 1), 1
      K = (K + 1)
      BMATRIX(INT(I), INT(J)) = AMATRIX(K)
      OpenAD_Symbol_89 = (INT(OpenAD_Symbol_89) + INT(1_w2f__i8))
    END DO
    integer_tape(integer_tape_pointer) = OpenAD_Symbol_89
    integer_tape_pointer = integer_tape_pointer+1
    OpenAD_Symbol_88 = (INT(OpenAD_Symbol_88) + INT(1_w2f__i8))
  END DO
  integer_tape(integer_tape_pointer) = OpenAD_Symbol_88
  integer_tape_pointer = integer_tape_pointer+1
    end if
    if (our_rev_mode%adjoint) then
! adjoint
  integer_tape_pointer = integer_tape_pointer-1
  OpenAD_Symbol_84 = integer_tape(integer_tape_pointer)
  OpenAD_Symbol_85 = 1
  DO WHILE(INT(OpenAD_Symbol_85) .LE. INT(OpenAD_Symbol_84))
    integer_tape_pointer = integer_tape_pointer-1
    OpenAD_Symbol_86 = integer_tape(integer_tape_pointer)
    OpenAD_Symbol_87 = 1
    DO WHILE(INT(OpenAD_Symbol_87) .LE. INT(OpenAD_Symbol_86))
      OpenAD_Symbol_87 = INT(OpenAD_Symbol_87) + 1
    END DO
    OpenAD_Symbol_85 = INT(OpenAD_Symbol_85) + 1
  END DO
    end if
  end subroutine MYRESHAPE_1_2
!#########################################################
! This file is part of OpenAD released under the LGPL.   #
! The full COPYRIGHT notice can be found in the top      #
! level directory of the OpenAD distribution             #
!#########################################################

  SUBROUTINE MYRESHAPE_3_1(AMATRIX, BMATRIX)
    use OAD_tape
    use OAD_rev

! original arguments get inserted before version
!         ! and declared here together with all local variables
!         ! generated by xaifBooster

  use w2f__types
  IMPLICIT NONE
!
!       **** Global Variables & Derived Type Definitions ****
!
  INTEGER(w2f__i8) OpenAD_Symbol_100
  INTEGER(w2f__i8) OpenAD_Symbol_101
  INTEGER(w2f__i8) OpenAD_Symbol_102
  INTEGER(w2f__i8) OpenAD_Symbol_103
  INTEGER(w2f__i8) OpenAD_Symbol_104
  INTEGER(w2f__i8) OpenAD_Symbol_105
  INTEGER(w2f__i8) OpenAD_Symbol_106
  INTEGER(w2f__i8) OpenAD_Symbol_107
  INTEGER(w2f__i8) OpenAD_Symbol_108
  INTEGER(w2f__i8) OpenAD_Symbol_109
  INTEGER(w2f__i8) OpenAD_Symbol_110
  INTEGER(w2f__i8) OpenAD_Symbol_111
  INTEGER(w2f__i8) OpenAD_Symbol_112
  INTEGER(w2f__i8) OpenAD_Symbol_113
  INTEGER(w2f__i8) OpenAD_Symbol_96
  INTEGER(w2f__i8) OpenAD_Symbol_97
  INTEGER(w2f__i8) OpenAD_Symbol_98
  INTEGER(w2f__i8) OpenAD_Symbol_99
!
!       **** Parameters and Result ****
!
  type(active) :: AMATRIX(1:,1:,1:)
  type(active) :: BMATRIX(1:)
!
!       **** Local Variables and Functions ****
!
  INTEGER(w2f__i4) I
  INTEGER(w2f__i4) J
  INTEGER(w2f__i4) K
  INTEGER(w2f__i4) L
  INTEGER(w2f__i4) OpenAD_Symbol_901
  INTEGER(w2f__i4) OpenAD_Symbol_902
  INTEGER(w2f__i4) OpenAD_Symbol_903
  INTEGER(w2f__i4) OpenAD_Symbol_904


    integer iaddr
    external iaddr
!
!       **** Statements ****
!

   if (our_rev_mode%plain) then
! original function
  L = 0
  DO K = 1, SIZE(AMATRIX, 3), 1
    DO J = 1, SIZE(AMATRIX, 2), 1
      DO I = 1, SIZE(AMATRIX, 1), 1
        L = (L + 1)
        BMATRIX(INT(L))%v = AMATRIX(I,J,K)%v
      END DO
    END DO
  END DO
    end if
    if (our_rev_mode%tape) then
! taping
  L = 0
  OpenAD_Symbol_102 = 0_w2f__i8
  DO K = 1,SIZE(AMATRIX,3),1
    OpenAD_Symbol_103 = 0_w2f__i8
    DO J = 1,SIZE(AMATRIX,2),1
      OpenAD_Symbol_104 = 0_w2f__i8
      DO I = 1,SIZE(AMATRIX,1),1
        L = (L+1)
        BMATRIX(INT(L))%v = AMATRIX(I,J,K)%v
        integer_tape(integer_tape_pointer) = I
        integer_tape_pointer = integer_tape_pointer+1
        integer_tape(integer_tape_pointer) = J
        integer_tape_pointer = integer_tape_pointer+1
        integer_tape(integer_tape_pointer) = K
        integer_tape_pointer = integer_tape_pointer+1
        integer_tape(integer_tape_pointer) = L
        integer_tape_pointer = integer_tape_pointer+1
        OpenAD_Symbol_104 = (INT(OpenAD_Symbol_104)+INT(1_w2f__i8))
      END DO
      integer_tape(integer_tape_pointer) = OpenAD_Symbol_104
      integer_tape_pointer = integer_tape_pointer+1
      OpenAD_Symbol_103 = (INT(OpenAD_Symbol_103)+INT(1_w2f__i8))
    END DO
    integer_tape(integer_tape_pointer) = OpenAD_Symbol_103
    integer_tape_pointer = integer_tape_pointer+1
    OpenAD_Symbol_102 = (INT(OpenAD_Symbol_102)+INT(1_w2f__i8))
  END DO
  integer_tape(integer_tape_pointer) = OpenAD_Symbol_102
  integer_tape_pointer = integer_tape_pointer+1
    end if
    if (our_rev_mode%adjoint) then
! adjoint
  integer_tape_pointer = integer_tape_pointer-1
  OpenAD_Symbol_96 = integer_tape(integer_tape_pointer)
  OpenAD_Symbol_97 = 1
  do while (INT(OpenAD_Symbol_97).LE.INT(OpenAD_Symbol_96))
    integer_tape_pointer = integer_tape_pointer-1
    OpenAD_Symbol_98 = integer_tape(integer_tape_pointer)
    OpenAD_Symbol_99 = 1
    do while (INT(OpenAD_Symbol_99).LE.INT(OpenAD_Symbol_98))
      integer_tape_pointer = integer_tape_pointer-1
      OpenAD_Symbol_100 = integer_tape(integer_tape_pointer)
      OpenAD_Symbol_101 = 1
      do while (INT(OpenAD_Symbol_101).LE.INT(OpenAD_Symbol_100))
        integer_tape_pointer = integer_tape_pointer-1
        OpenAD_Symbol_901 = integer_tape(integer_tape_pointer)
        integer_tape_pointer = integer_tape_pointer-1
        OpenAD_Symbol_902 = integer_tape(integer_tape_pointer)
        integer_tape_pointer = integer_tape_pointer-1
        OpenAD_Symbol_903 = integer_tape(integer_tape_pointer)
        integer_tape_pointer = integer_tape_pointer-1
        OpenAD_Symbol_904 = integer_tape(integer_tape_pointer)
        AMATRIX(OpenAD_Symbol_904,OpenAD_Symbol_903,OpenAD_Symbol_902)%d = AMATR&
     &IX(OpenAD_Symbol_904,OpenAD_Symbol_903,OpenAD_Symbol_902)%d+BMATRIX(OpenAD&
     &_Symbol_901)%d

        BMATRIX(OpenAD_Symbol_901)%d = 0.0d0
        OpenAD_Symbol_101 = INT(OpenAD_Symbol_101)+1
      END DO
      OpenAD_Symbol_99 = INT(OpenAD_Symbol_99)+1
    END DO
    OpenAD_Symbol_97 = INT(OpenAD_Symbol_97)+1
  END DO
    end if
  end subroutine MYRESHAPE_3_1
!#########################################################
! This file is part of OpenAD released under the LGPL.   #
! The full COPYRIGHT notice can be found in the top      #
! level directory of the OpenAD distribution             #
!#########################################################

  SUBROUTINE MYRESHAPE_1_3(AMATRIX, BMATRIX)
    use OAD_tape
    use OAD_rev

! original arguments get inserted before version
!         ! and declared here together with all local variables
!         ! generated by xaifBooster

  use w2f__types
  IMPLICIT NONE
!
!       **** Global Variables & Derived Type Definitions ****
!
  INTEGER(w2f__i8) OpenAD_Symbol_114
  INTEGER(w2f__i8) OpenAD_Symbol_115
  INTEGER(w2f__i8) OpenAD_Symbol_116
  INTEGER(w2f__i8) OpenAD_Symbol_117
  INTEGER(w2f__i8) OpenAD_Symbol_118
  INTEGER(w2f__i8) OpenAD_Symbol_119
  INTEGER(w2f__i8) OpenAD_Symbol_120
  INTEGER(w2f__i8) OpenAD_Symbol_121
  INTEGER(w2f__i8) OpenAD_Symbol_122
  INTEGER(w2f__i8) OpenAD_Symbol_123
  INTEGER(w2f__i8) OpenAD_Symbol_124
  INTEGER(w2f__i8) OpenAD_Symbol_125
  INTEGER(w2f__i8) OpenAD_Symbol_126
  INTEGER(w2f__i8) OpenAD_Symbol_127
  INTEGER(w2f__i8) OpenAD_Symbol_128
  INTEGER(w2f__i8) OpenAD_Symbol_129
  INTEGER(w2f__i8) OpenAD_Symbol_130
  INTEGER(w2f__i8) OpenAD_Symbol_131
!
!       **** Parameters and Result ****
!
  type(active) :: AMATRIX(1:)
  type(active) :: BMATRIX(1:,1:,1:)
!
!       **** Local Variables and Functions ****
!
  INTEGER(w2f__i4) I
  INTEGER(w2f__i4) J
  INTEGER(w2f__i4) K
  INTEGER(w2f__i4) L
  INTEGER(w2f__i4) OpenAD_Symbol_905
  INTEGER(w2f__i4) OpenAD_Symbol_906
  INTEGER(w2f__i4) OpenAD_Symbol_907
  INTEGER(w2f__i4) OpenAD_Symbol_908


    integer iaddr
    external iaddr
!
!       **** Statements ****
!

   if (our_rev_mode%plain) then
! original function
  L = 0
  DO K = 1, SIZE(BMATRIX, 3), 1
    DO J = 1, SIZE(BMATRIX, 2), 1
      DO I = 1, SIZE(BMATRIX, 1), 1
        L = (L + 1)
        BMATRIX(INT(I),INT(J),INT(K))%v = AMATRIX(L)%v
      END DO
    END DO
  END DO
    end if
    if (our_rev_mode%tape) then
! taping
  L = 0
  OpenAD_Symbol_120 = 0_w2f__i8
  DO K = 1,SIZE(BMATRIX,3),1
    OpenAD_Symbol_121 = 0_w2f__i8
    DO J = 1,SIZE(BMATRIX,2),1
      OpenAD_Symbol_122 = 0_w2f__i8
      DO I = 1,SIZE(BMATRIX,1),1
        L = (L+1)
        BMATRIX(INT(I),INT(J),INT(K))%v = AMATRIX(L)%v
        integer_tape(integer_tape_pointer) = L
        integer_tape_pointer = integer_tape_pointer+1
        integer_tape(integer_tape_pointer) = I
        integer_tape_pointer = integer_tape_pointer+1
        integer_tape(integer_tape_pointer) = J
        integer_tape_pointer = integer_tape_pointer+1
        integer_tape(integer_tape_pointer) = K
        integer_tape_pointer = integer_tape_pointer+1
        OpenAD_Symbol_122 = (INT(OpenAD_Symbol_122)+INT(1_w2f__i8))
      END DO
      integer_tape(integer_tape_pointer) = OpenAD_Symbol_122
      integer_tape_pointer = integer_tape_pointer+1
      OpenAD_Symbol_121 = (INT(OpenAD_Symbol_121)+INT(1_w2f__i8))
    END DO
    integer_tape(integer_tape_pointer) = OpenAD_Symbol_121
    integer_tape_pointer = integer_tape_pointer+1
    OpenAD_Symbol_120 = (INT(OpenAD_Symbol_120)+INT(1_w2f__i8))
  END DO
  integer_tape(integer_tape_pointer) = OpenAD_Symbol_120
  integer_tape_pointer = integer_tape_pointer+1
    end if
    if (our_rev_mode%adjoint) then
! adjoint
  integer_tape_pointer = integer_tape_pointer-1
  OpenAD_Symbol_114 = integer_tape(integer_tape_pointer)
  OpenAD_Symbol_115 = 1
  do while (INT(OpenAD_Symbol_115).LE.INT(OpenAD_Symbol_114))
    integer_tape_pointer = integer_tape_pointer-1
    OpenAD_Symbol_116 = integer_tape(integer_tape_pointer)
    OpenAD_Symbol_117 = 1
    do while (INT(OpenAD_Symbol_117).LE.INT(OpenAD_Symbol_116))
      integer_tape_pointer = integer_tape_pointer-1
      OpenAD_Symbol_118 = integer_tape(integer_tape_pointer)
      OpenAD_Symbol_119 = 1
      do while (INT(OpenAD_Symbol_119).LE.INT(OpenAD_Symbol_118))
        integer_tape_pointer = integer_tape_pointer-1
        OpenAD_Symbol_905 = integer_tape(integer_tape_pointer)
        integer_tape_pointer = integer_tape_pointer-1
        OpenAD_Symbol_906 = integer_tape(integer_tape_pointer)
        integer_tape_pointer = integer_tape_pointer-1
        OpenAD_Symbol_907 = integer_tape(integer_tape_pointer)
        integer_tape_pointer = integer_tape_pointer-1
        OpenAD_Symbol_908 = integer_tape(integer_tape_pointer)
        AMATRIX(OpenAD_Symbol_908)%d = AMATRIX(OpenAD_Symbol_908)%d+BMATRIX(Open&
     &AD_Symbol_907,OpenAD_Symbol_906,OpenAD_Symbol_905)%d

        BMATRIX(OpenAD_Symbol_907,OpenAD_Symbol_906,OpenAD_Symbol_905)%d = 0.0d0
        OpenAD_Symbol_119 = INT(OpenAD_Symbol_119)+1
      END DO
      OpenAD_Symbol_117 = INT(OpenAD_Symbol_117)+1
    END DO
    OpenAD_Symbol_115 = INT(OpenAD_Symbol_115)+1
  END DO
    end if
  end subroutine MYRESHAPE_1_3
!#########################################################
! This file is part of OpenAD released under the LGPL.   #
! The full COPYRIGHT notice can be found in the top      #
! level directory of the OpenAD distribution             #
!#########################################################

  SUBROUTINE MYRESHAPE_4_1(AMATRIX, BMATRIX)
    use OAD_tape
    use OAD_rev

! original arguments get inserted before version
!         ! and declared here together with all local variables
!         ! generated by xaifBooster

  use w2f__types
  IMPLICIT NONE
!
!       **** Global Variables & Derived Type Definitions ****
!
  INTEGER(w2f__i8) OpenAD_Symbol_132
  INTEGER(w2f__i8) OpenAD_Symbol_133
  INTEGER(w2f__i8) OpenAD_Symbol_134
  INTEGER(w2f__i8) OpenAD_Symbol_135
  INTEGER(w2f__i8) OpenAD_Symbol_136
  INTEGER(w2f__i8) OpenAD_Symbol_137
  INTEGER(w2f__i8) OpenAD_Symbol_138
  INTEGER(w2f__i8) OpenAD_Symbol_139
  INTEGER(w2f__i8) OpenAD_Symbol_140
  INTEGER(w2f__i8) OpenAD_Symbol_141
  INTEGER(w2f__i8) OpenAD_Symbol_142
  INTEGER(w2f__i8) OpenAD_Symbol_143
  INTEGER(w2f__i8) OpenAD_Symbol_144
  INTEGER(w2f__i8) OpenAD_Symbol_145
  INTEGER(w2f__i8) OpenAD_Symbol_146
  INTEGER(w2f__i8) OpenAD_Symbol_147
  INTEGER(w2f__i8) OpenAD_Symbol_148
  INTEGER(w2f__i8) OpenAD_Symbol_149
  INTEGER(w2f__i8) OpenAD_Symbol_150
  INTEGER(w2f__i8) OpenAD_Symbol_151
  INTEGER(w2f__i8) OpenAD_Symbol_152
  INTEGER(w2f__i8) OpenAD_Symbol_153
  INTEGER(w2f__i8) OpenAD_Symbol_154
  INTEGER(w2f__i8) OpenAD_Symbol_155
!
!       **** Parameters and Result ****
!
  REAL(w2f__8) AMATRIX(1 :, 1 :, 1 :, 1 :)
  REAL(w2f__8) BMATRIX(1 :)
!
!       **** Local Variables and Functions ****
!
  INTEGER(w2f__i4) I
  INTEGER(w2f__i4) J
  INTEGER(w2f__i4) K
  INTEGER(w2f__i4) L
  INTEGER(w2f__i4) M


    integer iaddr
    external iaddr
!
!       **** Statements ****
!

   if (our_rev_mode%plain) then
! original function
  M = 0
  DO L = 1, SIZE(AMATRIX, 4), 1
    DO K = 1, SIZE(AMATRIX, 3), 1
      DO J = 1, SIZE(AMATRIX, 2), 1
        DO I = 1, SIZE(AMATRIX, 1), 1
          M = (M + 1)
          BMATRIX(INT(M)) = AMATRIX(I, J, K, L)
        END DO
      END DO
    END DO
  END DO
    end if
    if (our_rev_mode%tape) then
! taping
  M = 0
  OpenAD_Symbol_140 = 0_w2f__i8
  DO L = 1, SIZE(AMATRIX, 4), 1
    OpenAD_Symbol_141 = 0_w2f__i8
    DO K = 1, SIZE(AMATRIX, 3), 1
      OpenAD_Symbol_142 = 0_w2f__i8
      DO J = 1, SIZE(AMATRIX, 2), 1
        OpenAD_Symbol_143 = 0_w2f__i8
        DO I = 1, SIZE(AMATRIX, 1), 1
          M = (M + 1)
          BMATRIX(INT(M)) = AMATRIX(I, J, K, L)
          OpenAD_Symbol_143 = (INT(OpenAD_Symbol_143) + INT( 1_w2f__i8))
        END DO
        integer_tape(integer_tape_pointer) = OpenAD_Symbol_143
        integer_tape_pointer = integer_tape_pointer+1
        OpenAD_Symbol_142 = (INT(OpenAD_Symbol_142) + INT( 1_w2f__i8))
      END DO
      integer_tape(integer_tape_pointer) = OpenAD_Symbol_142
      integer_tape_pointer = integer_tape_pointer+1
      OpenAD_Symbol_141 = (INT(OpenAD_Symbol_141) + INT(1_w2f__i8 ))
    END DO
    integer_tape(integer_tape_pointer) = OpenAD_Symbol_141
    integer_tape_pointer = integer_tape_pointer+1
    OpenAD_Symbol_140 = (INT(OpenAD_Symbol_140) + INT(1_w2f__i8))
  END DO
  integer_tape(integer_tape_pointer) = OpenAD_Symbol_140
  integer_tape_pointer = integer_tape_pointer+1
    end if
    if (our_rev_mode%adjoint) then
! adjoint
  integer_tape_pointer = integer_tape_pointer-1
  OpenAD_Symbol_132 = integer_tape(integer_tape_pointer)
  OpenAD_Symbol_133 = 1
  DO WHILE(INT(OpenAD_Symbol_133) .LE. INT(OpenAD_Symbol_132))
    integer_tape_pointer = integer_tape_pointer-1
    OpenAD_Symbol_134 = integer_tape(integer_tape_pointer)
    OpenAD_Symbol_135 = 1
    DO WHILE(INT(OpenAD_Symbol_135) .LE. INT(OpenAD_Symbol_134))
      integer_tape_pointer = integer_tape_pointer-1
      OpenAD_Symbol_136 = integer_tape(integer_tape_pointer)
      OpenAD_Symbol_137 = 1
      DO WHILE(INT(OpenAD_Symbol_137) .LE. INT(OpenAD_Symbol_136) )
        integer_tape_pointer = integer_tape_pointer-1
        OpenAD_Symbol_138 = integer_tape(integer_tape_pointer)
        OpenAD_Symbol_139 = 1
        DO WHILE(INT(OpenAD_Symbol_139) .LE. INT( OpenAD_Symbol_138))
          OpenAD_Symbol_139 = INT(OpenAD_Symbol_139) + 1
        END DO
        OpenAD_Symbol_137 = INT(OpenAD_Symbol_137) + 1
      END DO
      OpenAD_Symbol_135 = INT(OpenAD_Symbol_135) + 1
    END DO
    OpenAD_Symbol_133 = INT(OpenAD_Symbol_133) + 1
  END DO
    end if
  end subroutine MYRESHAPE_4_1
!#########################################################
! This file is part of OpenAD released under the LGPL.   #
! The full COPYRIGHT notice can be found in the top      #
! level directory of the OpenAD distribution             #
!#########################################################

  SUBROUTINE MYRESHAPE_1_4(AMATRIX, BMATRIX)
    use OAD_tape
    use OAD_rev

! original arguments get inserted before version
!         ! and declared here together with all local variables
!         ! generated by xaifBooster

  use w2f__types
  IMPLICIT NONE
!
!       **** Global Variables & Derived Type Definitions ****
!
  INTEGER(w2f__i8) OpenAD_Symbol_156
  INTEGER(w2f__i8) OpenAD_Symbol_157
  INTEGER(w2f__i8) OpenAD_Symbol_158
  INTEGER(w2f__i8) OpenAD_Symbol_159
  INTEGER(w2f__i8) OpenAD_Symbol_160
  INTEGER(w2f__i8) OpenAD_Symbol_161
  INTEGER(w2f__i8) OpenAD_Symbol_162
  INTEGER(w2f__i8) OpenAD_Symbol_163
  INTEGER(w2f__i8) OpenAD_Symbol_164
  INTEGER(w2f__i8) OpenAD_Symbol_165
  INTEGER(w2f__i8) OpenAD_Symbol_166
  INTEGER(w2f__i8) OpenAD_Symbol_167
  INTEGER(w2f__i8) OpenAD_Symbol_168
  INTEGER(w2f__i8) OpenAD_Symbol_169
  INTEGER(w2f__i8) OpenAD_Symbol_170
  INTEGER(w2f__i8) OpenAD_Symbol_171
  INTEGER(w2f__i8) OpenAD_Symbol_172
  INTEGER(w2f__i8) OpenAD_Symbol_173
  INTEGER(w2f__i8) OpenAD_Symbol_174
  INTEGER(w2f__i8) OpenAD_Symbol_175
  INTEGER(w2f__i8) OpenAD_Symbol_176
  INTEGER(w2f__i8) OpenAD_Symbol_177
  INTEGER(w2f__i8) OpenAD_Symbol_178
  INTEGER(w2f__i8) OpenAD_Symbol_179
!
!       **** Parameters and Result ****
!
  type(active) :: AMATRIX(1:)
  type(active) :: BMATRIX(1:,1:,1:,1:)
!
!       **** Local Variables and Functions ****
!
  INTEGER(w2f__i4) I
  INTEGER(w2f__i4) J
  INTEGER(w2f__i4) K
  INTEGER(w2f__i4) L
  INTEGER(w2f__i4) M
  INTEGER(w2f__i4) OpenAD_Symbol_909
  INTEGER(w2f__i4) OpenAD_Symbol_910
  INTEGER(w2f__i4) OpenAD_Symbol_911
  INTEGER(w2f__i4) OpenAD_Symbol_912
  INTEGER(w2f__i4) OpenAD_Symbol_913


    integer iaddr
    external iaddr
!
!       **** Statements ****
!

   if (our_rev_mode%plain) then
! original function
  M = 0
  DO L = 1, SIZE(BMATRIX, 4), 1
    DO K = 1, SIZE(BMATRIX, 3), 1
      DO J = 1, SIZE(BMATRIX, 2), 1
        DO I = 1, SIZE(BMATRIX, 1), 1
          M = (M + 1)
          BMATRIX(INT(I),INT(J),INT(K),INT(L))%v = AMATRIX(M)%v
        END DO
      END DO
    END DO
  END DO
    end if
    if (our_rev_mode%tape) then
! taping
  M = 0
  OpenAD_Symbol_164 = 0_w2f__i8
  DO L = 1,SIZE(BMATRIX,4),1
    OpenAD_Symbol_165 = 0_w2f__i8
    DO K = 1,SIZE(BMATRIX,3),1
      OpenAD_Symbol_166 = 0_w2f__i8
      DO J = 1,SIZE(BMATRIX,2),1
        OpenAD_Symbol_167 = 0_w2f__i8
        DO I = 1,SIZE(BMATRIX,1),1
          M = (M+1)
          BMATRIX(INT(I),INT(J),INT(K),INT(L))%v = AMATRIX(M)%v
          integer_tape(integer_tape_pointer) = M
          integer_tape_pointer = integer_tape_pointer+1
          integer_tape(integer_tape_pointer) = I
          integer_tape_pointer = integer_tape_pointer+1
          integer_tape(integer_tape_pointer) = J
          integer_tape_pointer = integer_tape_pointer+1
          integer_tape(integer_tape_pointer) = K
          integer_tape_pointer = integer_tape_pointer+1
          integer_tape(integer_tape_pointer) = L
          integer_tape_pointer = integer_tape_pointer+1
          OpenAD_Symbol_167 = (INT(OpenAD_Symbol_167)+INT(1_w2f__i8))
        END DO
        integer_tape(integer_tape_pointer) = OpenAD_Symbol_167
        integer_tape_pointer = integer_tape_pointer+1
        OpenAD_Symbol_166 = (INT(OpenAD_Symbol_166)+INT(1_w2f__i8))
      END DO
      integer_tape(integer_tape_pointer) = OpenAD_Symbol_166
      integer_tape_pointer = integer_tape_pointer+1
      OpenAD_Symbol_165 = (INT(OpenAD_Symbol_165)+INT(1_w2f__i8))
    END DO
    integer_tape(integer_tape_pointer) = OpenAD_Symbol_165
    integer_tape_pointer = integer_tape_pointer+1
    OpenAD_Symbol_164 = (INT(OpenAD_Symbol_164)+INT(1_w2f__i8))
  END DO
  integer_tape(integer_tape_pointer) = OpenAD_Symbol_164
  integer_tape_pointer = integer_tape_pointer+1
    end if
    if (our_rev_mode%adjoint) then
! adjoint
  integer_tape_pointer = integer_tape_pointer-1
  OpenAD_Symbol_156 = integer_tape(integer_tape_pointer)
  OpenAD_Symbol_157 = 1
  do while (INT(OpenAD_Symbol_157).LE.INT(OpenAD_Symbol_156))
    integer_tape_pointer = integer_tape_pointer-1
    OpenAD_Symbol_158 = integer_tape(integer_tape_pointer)
    OpenAD_Symbol_159 = 1
    do while (INT(OpenAD_Symbol_159).LE.INT(OpenAD_Symbol_158))
      integer_tape_pointer = integer_tape_pointer-1
      OpenAD_Symbol_160 = integer_tape(integer_tape_pointer)
      OpenAD_Symbol_161 = 1
      do while (INT(OpenAD_Symbol_161).LE.INT(OpenAD_Symbol_160))
        integer_tape_pointer = integer_tape_pointer-1
        OpenAD_Symbol_162 = integer_tape(integer_tape_pointer)
        OpenAD_Symbol_163 = 1
        do while (INT(OpenAD_Symbol_163).LE.INT(OpenAD_Symbol_162))
          integer_tape_pointer = integer_tape_pointer-1
          OpenAD_Symbol_909 = integer_tape(integer_tape_pointer)
          integer_tape_pointer = integer_tape_pointer-1
          OpenAD_Symbol_910 = integer_tape(integer_tape_pointer)
          integer_tape_pointer = integer_tape_pointer-1
          OpenAD_Symbol_911 = integer_tape(integer_tape_pointer)
          integer_tape_pointer = integer_tape_pointer-1
          OpenAD_Symbol_912 = integer_tape(integer_tape_pointer)
          integer_tape_pointer = integer_tape_pointer-1
          OpenAD_Symbol_913 = integer_tape(integer_tape_pointer)
          AMATRIX(OpenAD_Symbol_913)%d = AMATRIX(OpenAD_Symbol_913)%d+BMATRIX(Op&
     &enAD_Symbol_912,OpenAD_Symbol_911,OpenAD_Symbol_910,OpenAD_Symbol_909)%d

          BMATRIX(OpenAD_Symbol_912,OpenAD_Symbol_911,OpenAD_Symbol_910,OpenAD_S&
     &ymbol_909)%d = 0.0d0

          OpenAD_Symbol_163 = INT(OpenAD_Symbol_163)+1
        END DO
        OpenAD_Symbol_161 = INT(OpenAD_Symbol_161)+1
      END DO
      OpenAD_Symbol_159 = INT(OpenAD_Symbol_159)+1
    END DO
    OpenAD_Symbol_157 = INT(OpenAD_Symbol_157)+1
  END DO
    end if
  end subroutine MYRESHAPE_1_4
!#########################################################
! This file is part of OpenAD released under the LGPL.   #
! The full COPYRIGHT notice can be found in the top      #
! level directory of the OpenAD distribution             #
!#########################################################

  SUBROUTINE SPMAT_MULTIPLY_DIAGONAL(N, ANNZ, AROW_INDEX, AROW_COMPRESSED, ACOL_&
     &INDEX, AVALUES, DMATRIX, RNNZ, RROW_INDEX , RROW_COMPRESSED, RCOL_INDEX, R&
     &VALUES, ORDER)

    use OAD_tape
    use OAD_rev

! original arguments get inserted before version
!         ! and declared here together with all local variables
!         ! generated by xaifBooster

  use w2f__types
  IMPLICIT NONE
!
!       **** Global Variables & Derived Type Definitions ****
!
  INTEGER(w2f__i8) OpenAD_Symbol_180
  INTEGER(w2f__i8) OpenAD_Symbol_181
  INTEGER(w2f__i8) OpenAD_Symbol_182
  INTEGER(w2f__i8) OpenAD_Symbol_183
  INTEGER(w2f__i8) OpenAD_Symbol_184
  INTEGER(w2f__i8) OpenAD_Symbol_185
  INTEGER(w2f__i8) OpenAD_Symbol_186
  INTEGER(w2f__i8) OpenAD_Symbol_187
  INTEGER(w2f__i8) OpenAD_Symbol_188
  INTEGER(w2f__i8) OpenAD_Symbol_189
  INTEGER(w2f__i8) OpenAD_Symbol_190
  INTEGER(w2f__i8) OpenAD_Symbol_191
  INTEGER(w2f__i8) OpenAD_Symbol_192
  INTEGER(w2f__i8) OpenAD_Symbol_193
  INTEGER(w2f__i8) OpenAD_Symbol_194
  INTEGER(w2f__i8) OpenAD_Symbol_195
  INTEGER(w2f__i8) OpenAD_Symbol_196
  INTEGER(w2f__i8) OpenAD_Symbol_197
  INTEGER(w2f__i8) OpenAD_Symbol_198
  INTEGER(w2f__i8) OpenAD_Symbol_199
  INTEGER(w2f__i8) OpenAD_Symbol_200
  INTEGER(w2f__i8) OpenAD_Symbol_201
  INTEGER(w2f__i8) OpenAD_Symbol_202
  INTEGER(w2f__i8) OpenAD_Symbol_203
!
!       **** Parameters and Result ****
!
  INTEGER(w2f__i4) N
  INTEGER(w2f__i4) ANNZ
  INTEGER(w2f__i4) AROW_INDEX(1 : INT((N * 7)))
  INTEGER(w2f__i4) AROW_COMPRESSED(1 : INT((N + 1)))
  INTEGER(w2f__i4) ACOL_INDEX(1 : INT((N * 7)))
  type(active) :: AVALUES(1:INT((N*7)))
  type(active) :: DMATRIX(1:N)
  INTEGER(w2f__i4) RNNZ
  INTEGER(w2f__i4) RROW_INDEX(1 : INT((N * 7)))
  INTEGER(w2f__i4) RROW_COMPRESSED(1 : INT((N + 1)))
  INTEGER(w2f__i4) RCOL_INDEX(1 : INT((N * 7)))
  type(active) :: RVALUES(1:INT((N*7)))
  CHARACTER(3) ORDER
!
!       **** Local Variables and Functions ****
!
  INTEGER(w2f__i4) I
  INTEGER(w2f__i4) OpenAD_Symbol_914
  INTEGER(w2f__i4) OpenAD_Symbol_915
  REAL(w2f__8) OpenAD_Symbol_916
  REAL(w2f__8) OpenAD_Symbol_917
  INTEGER(w2f__i4) OpenAD_Symbol_918
  INTEGER(w2f__i4) OpenAD_Symbol_919
  REAL(w2f__8) OpenAD_Symbol_920
  REAL(w2f__8) OpenAD_Symbol_921
  REAL(w2f__8) OpenAD_lin_0
  REAL(w2f__8) OpenAD_lin_1
  REAL(w2f__8) OpenAD_lin_2
  REAL(w2f__8) OpenAD_lin_3
  type(active) :: OpenAD_prp_1
  type(active) :: OpenAD_prp_2


    integer iaddr
    external iaddr
!
!       **** Statements ****
!

   if (our_rev_mode%plain) then
! original function
  RNNZ = ANNZ
  RROW_COMPRESSED(1 : INT(N + 1)) = AROW_COMPRESSED(1 : INT(N + 1 ))
  IF(ORDER .EQ. 'PRE') THEN
    DO I = 1, ANNZ, 1
      RROW_INDEX(I) = AROW_INDEX(I)
      RCOL_INDEX(I) = ACOL_INDEX(I)
      RVALUES(INT(I))%v = (AVALUES(I)%v*DMATRIX(ACOL_INDEX(I))%v)
    END DO
  ELSE
    IF (ORDER.EQ.'POS') THEN
      DO I = 1,ANNZ,1
        RROW_INDEX(I) = AROW_INDEX(I)
        RCOL_INDEX(I) = ACOL_INDEX(I)
        RVALUES(INT(I))%v = (AVALUES(I)%v*DMATRIX(AROW_INDEX(I))%v)
      END DO
    ENDIF
  ENDIF
    end if
    if (our_rev_mode%tape) then
! taping
  RNNZ = ANNZ
  RROW_COMPRESSED(1:INT(N+1)) = AROW_COMPRESSED(1:INT(N+1))
  IF (ORDER.EQ.'PRE') THEN
    OpenAD_Symbol_186 = 0_w2f__i8
    DO I = 1,ANNZ,1
      RROW_INDEX(I) = AROW_INDEX(I)
      RCOL_INDEX(I) = ACOL_INDEX(I)
      OpenAD_lin_0 = DMATRIX(ACOL_INDEX(I))%v
      OpenAD_lin_1 = AVALUES(I)%v
      RVALUES(INT(I))%v = (AVALUES(I)%v*DMATRIX(ACOL_INDEX(I))%v)
      double_tape(double_tape_pointer) = OpenAD_lin_0
      double_tape_pointer = double_tape_pointer+1
      double_tape(double_tape_pointer) = OpenAD_lin_1
      double_tape_pointer = double_tape_pointer+1
      integer_tape(integer_tape_pointer) = I
      integer_tape_pointer = integer_tape_pointer+1
      integer_tape(integer_tape_pointer) = ACOL_INDEX(I)
      integer_tape_pointer = integer_tape_pointer+1
      OpenAD_Symbol_186 = (INT(OpenAD_Symbol_186)+INT(1_w2f__i8))
    END DO
    integer_tape(integer_tape_pointer) = OpenAD_Symbol_186
    integer_tape_pointer = integer_tape_pointer+1
    OpenAD_Symbol_190 = 1_w2f__i8
    integer_tape(integer_tape_pointer) = OpenAD_Symbol_190
    integer_tape_pointer = integer_tape_pointer+1
  ELSE
    IF (ORDER.EQ.'POS') THEN
      OpenAD_Symbol_187 = 0_w2f__i8
      DO I = 1,ANNZ,1
        RROW_INDEX(I) = AROW_INDEX(I)
        RCOL_INDEX(I) = ACOL_INDEX(I)
        OpenAD_lin_2 = DMATRIX(AROW_INDEX(I))%v
        OpenAD_lin_3 = AVALUES(I)%v
        RVALUES(INT(I))%v = (AVALUES(I)%v*DMATRIX(AROW_INDEX(I))%v)
        double_tape(double_tape_pointer) = OpenAD_lin_2
        double_tape_pointer = double_tape_pointer+1
        double_tape(double_tape_pointer) = OpenAD_lin_3
        double_tape_pointer = double_tape_pointer+1
        integer_tape(integer_tape_pointer) = I
        integer_tape_pointer = integer_tape_pointer+1
        integer_tape(integer_tape_pointer) = AROW_INDEX(I)
        integer_tape_pointer = integer_tape_pointer+1
        OpenAD_Symbol_187 = (INT(OpenAD_Symbol_187)+INT(1_w2f__i8))
      END DO
      integer_tape(integer_tape_pointer) = OpenAD_Symbol_187
      integer_tape_pointer = integer_tape_pointer+1
      OpenAD_Symbol_189 = 1_w2f__i8
      integer_tape(integer_tape_pointer) = OpenAD_Symbol_189
      integer_tape_pointer = integer_tape_pointer+1
    ELSE
      OpenAD_Symbol_188 = 0_w2f__i8
      integer_tape(integer_tape_pointer) = OpenAD_Symbol_188
      integer_tape_pointer = integer_tape_pointer+1
    ENDIF
    OpenAD_Symbol_191 = 0_w2f__i8
    integer_tape(integer_tape_pointer) = OpenAD_Symbol_191
    integer_tape_pointer = integer_tape_pointer+1
  ENDIF
    end if
    if (our_rev_mode%adjoint) then
! adjoint
  integer_tape_pointer = integer_tape_pointer-1
  OpenAD_Symbol_180 = integer_tape(integer_tape_pointer)
  IF (OpenAD_Symbol_180.ne.0) THEN
    integer_tape_pointer = integer_tape_pointer-1
    OpenAD_Symbol_184 = integer_tape(integer_tape_pointer)
    OpenAD_Symbol_185 = 1
    do while (INT(OpenAD_Symbol_185).LE.INT(OpenAD_Symbol_184))
      integer_tape_pointer = integer_tape_pointer-1
      OpenAD_Symbol_914 = integer_tape(integer_tape_pointer)
      integer_tape_pointer = integer_tape_pointer-1
      OpenAD_Symbol_915 = integer_tape(integer_tape_pointer)
      double_tape_pointer = double_tape_pointer-1
      OpenAD_Symbol_916 = double_tape(double_tape_pointer)
      double_tape_pointer = double_tape_pointer-1
      OpenAD_Symbol_917 = double_tape(double_tape_pointer)
      DMATRIX(OpenAD_Symbol_914)%d = DMATRIX(OpenAD_Symbol_914)%d+RVALUES(OpenAD&
     &_Symbol_915)%d*(OpenAD_Symbol_916)

      OpenAD_prp_1%d = OpenAD_prp_1%d+RVALUES(OpenAD_Symbol_915)%d*(OpenAD_Symbo&
     &l_917)

      RVALUES(OpenAD_Symbol_915)%d = 0.0d0
      AVALUES(OpenAD_Symbol_915)%d = AVALUES(OpenAD_Symbol_915)%d+OpenAD_prp_1%d
      OpenAD_prp_1%d = 0.0d0
      OpenAD_Symbol_185 = INT(OpenAD_Symbol_185)+1
    END DO
  ELSE
    integer_tape_pointer = integer_tape_pointer-1
    OpenAD_Symbol_181 = integer_tape(integer_tape_pointer)
    IF (OpenAD_Symbol_181.ne.0) THEN
      integer_tape_pointer = integer_tape_pointer-1
      OpenAD_Symbol_182 = integer_tape(integer_tape_pointer)
      OpenAD_Symbol_183 = 1
      do while (INT(OpenAD_Symbol_183).LE.INT(OpenAD_Symbol_182))
        integer_tape_pointer = integer_tape_pointer-1
        OpenAD_Symbol_918 = integer_tape(integer_tape_pointer)
        integer_tape_pointer = integer_tape_pointer-1
        OpenAD_Symbol_919 = integer_tape(integer_tape_pointer)
        double_tape_pointer = double_tape_pointer-1
        OpenAD_Symbol_920 = double_tape(double_tape_pointer)
        double_tape_pointer = double_tape_pointer-1
        OpenAD_Symbol_921 = double_tape(double_tape_pointer)
        DMATRIX(OpenAD_Symbol_918)%d = DMATRIX(OpenAD_Symbol_918)%d+RVALUES(Open&
     &AD_Symbol_919)%d*(OpenAD_Symbol_920)

        OpenAD_prp_2%d = OpenAD_prp_2%d+RVALUES(OpenAD_Symbol_919)%d*(OpenAD_Sym&
     &bol_921)

        RVALUES(OpenAD_Symbol_919)%d = 0.0d0
        AVALUES(OpenAD_Symbol_919)%d = AVALUES(OpenAD_Symbol_919)%d+OpenAD_prp_2&
     &%d

        OpenAD_prp_2%d = 0.0d0
        OpenAD_Symbol_183 = INT(OpenAD_Symbol_183)+1
      END DO
    ENDIF
  ENDIF
    end if
  end subroutine SPMAT_MULTIPLY_DIAGONAL
!#########################################################
! This file is part of OpenAD released under the LGPL.   #
! The full COPYRIGHT notice can be found in the top      #
! level directory of the OpenAD distribution             #
!#########################################################

  SUBROUTINE SPMAT_MULTIPLY_VECTOR(N, ANNZ, AROW_INDEX, AROW_COMPRESSED, ACOL_IN&
     &DEX, AVALUES, BVECTOR, CVECTOR, ORDER)

    use OAD_tape
    use OAD_rev

! original arguments get inserted before version
!         ! and declared here together with all local variables
!         ! generated by xaifBooster

  use w2f__types
  IMPLICIT NONE
!
!       **** Global Variables & Derived Type Definitions ****
!
  INTEGER(w2f__i8) OpenAD_Symbol_204
  INTEGER(w2f__i8) OpenAD_Symbol_205
  INTEGER(w2f__i8) OpenAD_Symbol_206
  INTEGER(w2f__i8) OpenAD_Symbol_207
  INTEGER(w2f__i8) OpenAD_Symbol_208
  INTEGER(w2f__i8) OpenAD_Symbol_209
  INTEGER(w2f__i8) OpenAD_Symbol_210
  INTEGER(w2f__i8) OpenAD_Symbol_211
  INTEGER(w2f__i8) OpenAD_Symbol_212
  INTEGER(w2f__i8) OpenAD_Symbol_213
  INTEGER(w2f__i8) OpenAD_Symbol_214
  INTEGER(w2f__i8) OpenAD_Symbol_215
  INTEGER(w2f__i8) OpenAD_Symbol_216
  INTEGER(w2f__i8) OpenAD_Symbol_217
  INTEGER(w2f__i8) OpenAD_Symbol_218
  INTEGER(w2f__i8) OpenAD_Symbol_219
  INTEGER(w2f__i8) OpenAD_Symbol_220
  INTEGER(w2f__i8) OpenAD_Symbol_221
  INTEGER(w2f__i8) OpenAD_Symbol_222
  INTEGER(w2f__i8) OpenAD_Symbol_223
  INTEGER(w2f__i8) OpenAD_Symbol_224
  INTEGER(w2f__i8) OpenAD_Symbol_225
  INTEGER(w2f__i8) OpenAD_Symbol_226
  INTEGER(w2f__i8) OpenAD_Symbol_227
!
!       **** Parameters and Result ****
!
  INTEGER(w2f__i4) N
  INTEGER(w2f__i4) ANNZ
  INTEGER(w2f__i4) AROW_INDEX(1 : INT((N * 7)))
  INTEGER(w2f__i4) AROW_COMPRESSED(1 : INT((N + 1)))
  INTEGER(w2f__i4) ACOL_INDEX(1 : INT((N * 7)))
  type(active) :: AVALUES(1:INT((N*7)))
  type(active) :: BVECTOR(1:N)
  type(active) :: CVECTOR(1:N)
  CHARACTER(3) ORDER
!
!       **** Local Variables and Functions ****
!
  INTEGER(w2f__i4) I
  INTEGER(w2f__i4) OpenAD_Symbol_922
  INTEGER(w2f__i4) OpenAD_Symbol_923
  INTEGER(w2f__i4) OpenAD_Symbol_924
  INTEGER(w2f__i4) OpenAD_Symbol_925
  INTEGER(w2f__i4) OpenAD_Symbol_926
  INTEGER(w2f__i4) OpenAD_Symbol_927
  INTEGER(w2f__i4) OpenAD_Symbol_928
  REAL(w2f__8) OpenAD_Symbol_929
  REAL(w2f__8) OpenAD_Symbol_930
  INTEGER(w2f__i4) OpenAD_Symbol_931
  INTEGER(w2f__i4) OpenAD_Symbol_932
  INTEGER(w2f__i4) OpenAD_Symbol_933
  INTEGER(w2f__i4) OpenAD_Symbol_934
  INTEGER(w2f__i4) OpenAD_Symbol_935
  INTEGER(w2f__i4) OpenAD_Symbol_936
  REAL(w2f__8) OpenAD_Symbol_937
  REAL(w2f__8) OpenAD_Symbol_938
  REAL(w2f__8) OpenAD_lin_4
  REAL(w2f__8) OpenAD_lin_5
  REAL(w2f__8) OpenAD_lin_6
  REAL(w2f__8) OpenAD_lin_7
  type(active) :: OpenAD_prp_3
  type(active) :: OpenAD_prp_4
!
!       **** Statements ****
!


    integer iaddr
    external iaddr

   if (our_rev_mode%plain) then
! original function
  CVECTOR(1:INT(N))%v = 0.0D00
  IF (ORDER.EQ.'PRE') THEN
    DO I = 1,ANNZ,1
      CVECTOR(AROW_INDEX(INT(I)))%v = (CVECTOR(AROW_INDEX(I))%v+AVALUES(I)%v*BVE&
     &CTOR(ACOL_INDEX(I))%v)

    END DO
  ELSE
    IF (ORDER.EQ.'POS') THEN
      DO I = 1,ANNZ,1
        CVECTOR(ACOL_INDEX(INT(I)))%v = (CVECTOR(ACOL_INDEX(I))%v+AVALUES(I)%v*B&
     &VECTOR(AROW_INDEX(I))%v)

      END DO
    ENDIF
  ENDIF
    end if
    if (our_rev_mode%tape) then
! taping
  CVECTOR(1:INT(N))%v = 0.0D00
  integer_tape(integer_tape_pointer) = N
  integer_tape_pointer = integer_tape_pointer+1
  IF (ORDER.EQ.'PRE') THEN
    OpenAD_Symbol_210 = 0_w2f__i8
    DO I = 1,ANNZ,1
      OpenAD_lin_4 = BVECTOR(ACOL_INDEX(I))%v
      OpenAD_lin_5 = AVALUES(I)%v
      CVECTOR(AROW_INDEX(INT(I)))%v = (CVECTOR(AROW_INDEX(I))%v+AVALUES(I)%v*BVE&
     &CTOR(ACOL_INDEX(I))%v)

      double_tape(double_tape_pointer) = OpenAD_lin_4
      double_tape_pointer = double_tape_pointer+1
      double_tape(double_tape_pointer) = OpenAD_lin_5
      double_tape_pointer = double_tape_pointer+1
      integer_tape(integer_tape_pointer) = AROW_INDEX(I)
      integer_tape_pointer = integer_tape_pointer+1
      integer_tape(integer_tape_pointer) = AROW_INDEX(I)
      integer_tape_pointer = integer_tape_pointer+1
      integer_tape(integer_tape_pointer) = I
      integer_tape_pointer = integer_tape_pointer+1
      integer_tape(integer_tape_pointer) = AROW_INDEX(I)
      integer_tape_pointer = integer_tape_pointer+1
      integer_tape(integer_tape_pointer) = ACOL_INDEX(I)
      integer_tape_pointer = integer_tape_pointer+1
      integer_tape(integer_tape_pointer) = AROW_INDEX(I)
      integer_tape_pointer = integer_tape_pointer+1
      OpenAD_Symbol_210 = (INT(OpenAD_Symbol_210)+INT(1_w2f__i8))
    END DO
    integer_tape(integer_tape_pointer) = OpenAD_Symbol_210
    integer_tape_pointer = integer_tape_pointer+1
    OpenAD_Symbol_214 = 1_w2f__i8
    integer_tape(integer_tape_pointer) = OpenAD_Symbol_214
    integer_tape_pointer = integer_tape_pointer+1
  ELSE
    IF (ORDER.EQ.'POS') THEN
      OpenAD_Symbol_211 = 0_w2f__i8
      DO I = 1,ANNZ,1
        OpenAD_lin_6 = BVECTOR(AROW_INDEX(I))%v
        OpenAD_lin_7 = AVALUES(I)%v
        CVECTOR(ACOL_INDEX(INT(I)))%v = (CVECTOR(ACOL_INDEX(I))%v+AVALUES(I)%v*B&
     &VECTOR(AROW_INDEX(I))%v)

        double_tape(double_tape_pointer) = OpenAD_lin_6
        double_tape_pointer = double_tape_pointer+1
        double_tape(double_tape_pointer) = OpenAD_lin_7
        double_tape_pointer = double_tape_pointer+1
        integer_tape(integer_tape_pointer) = ACOL_INDEX(I)
        integer_tape_pointer = integer_tape_pointer+1
        integer_tape(integer_tape_pointer) = ACOL_INDEX(I)
        integer_tape_pointer = integer_tape_pointer+1
        integer_tape(integer_tape_pointer) = I
        integer_tape_pointer = integer_tape_pointer+1
        integer_tape(integer_tape_pointer) = ACOL_INDEX(I)
        integer_tape_pointer = integer_tape_pointer+1
        integer_tape(integer_tape_pointer) = AROW_INDEX(I)
        integer_tape_pointer = integer_tape_pointer+1
        integer_tape(integer_tape_pointer) = ACOL_INDEX(I)
        integer_tape_pointer = integer_tape_pointer+1
        OpenAD_Symbol_211 = (INT(OpenAD_Symbol_211)+INT(1_w2f__i8))
      END DO
      integer_tape(integer_tape_pointer) = OpenAD_Symbol_211
      integer_tape_pointer = integer_tape_pointer+1
      OpenAD_Symbol_213 = 1_w2f__i8
      integer_tape(integer_tape_pointer) = OpenAD_Symbol_213
      integer_tape_pointer = integer_tape_pointer+1
    ELSE
      OpenAD_Symbol_212 = 0_w2f__i8
      integer_tape(integer_tape_pointer) = OpenAD_Symbol_212
      integer_tape_pointer = integer_tape_pointer+1
    ENDIF
    OpenAD_Symbol_215 = 0_w2f__i8
    integer_tape(integer_tape_pointer) = OpenAD_Symbol_215
    integer_tape_pointer = integer_tape_pointer+1
  ENDIF
    end if
    if (our_rev_mode%adjoint) then
! adjoint
  integer_tape_pointer = integer_tape_pointer-1
  OpenAD_Symbol_204 = integer_tape(integer_tape_pointer)
  IF (OpenAD_Symbol_204.ne.0) THEN
    integer_tape_pointer = integer_tape_pointer-1
    OpenAD_Symbol_208 = integer_tape(integer_tape_pointer)
    OpenAD_Symbol_209 = 1
    do while (INT(OpenAD_Symbol_209).LE.INT(OpenAD_Symbol_208))
      integer_tape_pointer = integer_tape_pointer-1
      OpenAD_Symbol_923 = integer_tape(integer_tape_pointer)
      integer_tape_pointer = integer_tape_pointer-1
      OpenAD_Symbol_924 = integer_tape(integer_tape_pointer)
      integer_tape_pointer = integer_tape_pointer-1
      OpenAD_Symbol_925 = integer_tape(integer_tape_pointer)
      integer_tape_pointer = integer_tape_pointer-1
      OpenAD_Symbol_926 = integer_tape(integer_tape_pointer)
      integer_tape_pointer = integer_tape_pointer-1
      OpenAD_Symbol_927 = integer_tape(integer_tape_pointer)
      integer_tape_pointer = integer_tape_pointer-1
      OpenAD_Symbol_928 = integer_tape(integer_tape_pointer)
      double_tape_pointer = double_tape_pointer-1
      OpenAD_Symbol_929 = double_tape(double_tape_pointer)
      double_tape_pointer = double_tape_pointer-1
      OpenAD_Symbol_930 = double_tape(double_tape_pointer)
      BVECTOR(OpenAD_Symbol_924)%d = BVECTOR(OpenAD_Symbol_924)%d+CVECTOR(OpenAD&
     &_Symbol_923)%d*(OpenAD_Symbol_929)

      AVALUES(OpenAD_Symbol_926)%d = AVALUES(OpenAD_Symbol_926)%d+CVECTOR(OpenAD&
     &_Symbol_925)%d*(OpenAD_Symbol_930)

      OpenAD_prp_3%d = OpenAD_prp_3%d+CVECTOR(OpenAD_Symbol_927)%d
      CVECTOR(OpenAD_Symbol_927)%d = 0.0d0
      CVECTOR(OpenAD_Symbol_928)%d = CVECTOR(OpenAD_Symbol_928)%d+OpenAD_prp_3%d
      OpenAD_prp_3%d = 0.0d0
      OpenAD_Symbol_209 = INT(OpenAD_Symbol_209)+1
    END DO
  ELSE
    integer_tape_pointer = integer_tape_pointer-1
    OpenAD_Symbol_205 = integer_tape(integer_tape_pointer)
    IF (OpenAD_Symbol_205.ne.0) THEN
      integer_tape_pointer = integer_tape_pointer-1
      OpenAD_Symbol_206 = integer_tape(integer_tape_pointer)
      OpenAD_Symbol_207 = 1
      do while (INT(OpenAD_Symbol_207).LE.INT(OpenAD_Symbol_206))
        integer_tape_pointer = integer_tape_pointer-1
        OpenAD_Symbol_931 = integer_tape(integer_tape_pointer)
        integer_tape_pointer = integer_tape_pointer-1
        OpenAD_Symbol_932 = integer_tape(integer_tape_pointer)
        integer_tape_pointer = integer_tape_pointer-1
        OpenAD_Symbol_933 = integer_tape(integer_tape_pointer)
        integer_tape_pointer = integer_tape_pointer-1
        OpenAD_Symbol_934 = integer_tape(integer_tape_pointer)
        integer_tape_pointer = integer_tape_pointer-1
        OpenAD_Symbol_935 = integer_tape(integer_tape_pointer)
        integer_tape_pointer = integer_tape_pointer-1
        OpenAD_Symbol_936 = integer_tape(integer_tape_pointer)
        double_tape_pointer = double_tape_pointer-1
        OpenAD_Symbol_937 = double_tape(double_tape_pointer)
        double_tape_pointer = double_tape_pointer-1
        OpenAD_Symbol_938 = double_tape(double_tape_pointer)
        BVECTOR(OpenAD_Symbol_932)%d = BVECTOR(OpenAD_Symbol_932)%d+CVECTOR(Open&
     &AD_Symbol_931)%d*(OpenAD_Symbol_937)

        AVALUES(OpenAD_Symbol_934)%d = AVALUES(OpenAD_Symbol_934)%d+CVECTOR(Open&
     &AD_Symbol_933)%d*(OpenAD_Symbol_938)

        OpenAD_prp_4%d = OpenAD_prp_4%d+CVECTOR(OpenAD_Symbol_935)%d
        CVECTOR(OpenAD_Symbol_935)%d = 0.0d0
        CVECTOR(OpenAD_Symbol_936)%d = CVECTOR(OpenAD_Symbol_936)%d+OpenAD_prp_4&
     &%d

        OpenAD_prp_4%d = 0.0d0
        OpenAD_Symbol_207 = INT(OpenAD_Symbol_207)+1
      END DO
    ENDIF
  ENDIF
  integer_tape_pointer = integer_tape_pointer-1
  OpenAD_Symbol_922 = integer_tape(integer_tape_pointer)
  CVECTOR(1:OpenAD_Symbol_922)%d = 0.0d0
    end if
  end subroutine SPMAT_MULTIPLY_VECTOR
!#########################################################
! This file is part of OpenAD released under the LGPL.   #
! The full COPYRIGHT notice can be found in the top      #
! level directory of the OpenAD distribution             #
!#########################################################

  SUBROUTINE SCALAR_MULTIPLY_SPMAT(N, ANNZ, AROW_INDEX, AROW_COMPRESSED, ACOL_IN&
     &DEX, AVALUES, SCALAR, RNNZ, RROW_INDEX, RROW_COMPRESSED, RCOL_INDEX, RVALU&
     &ES)

    use OAD_tape
    use OAD_rev

! original arguments get inserted before version
!         ! and declared here together with all local variables
!         ! generated by xaifBooster

  use w2f__types
  IMPLICIT NONE
!
!       **** Global Variables & Derived Type Definitions ****
!
  INTEGER(w2f__i8) OpenAD_Symbol_228
  INTEGER(w2f__i8) OpenAD_Symbol_229
  INTEGER(w2f__i8) OpenAD_Symbol_230
  INTEGER(w2f__i8) OpenAD_Symbol_231
  INTEGER(w2f__i8) OpenAD_Symbol_232
  INTEGER(w2f__i8) OpenAD_Symbol_233
!
!       **** Parameters and Result ****
!
  INTEGER(w2f__i4) N
  INTEGER(w2f__i4) ANNZ
  INTEGER(w2f__i4) AROW_INDEX(1 : INT((N * 7)))
  INTEGER(w2f__i4) AROW_COMPRESSED(1 : INT((N + 1)))
  INTEGER(w2f__i4) ACOL_INDEX(1 : INT((N * 7)))
  REAL(w2f__8) AVALUES(1 : INT((N * 7)))
  REAL(w2f__8) SCALAR
  INTEGER(w2f__i4) RNNZ
  INTEGER(w2f__i4) RROW_INDEX(1 : INT((N * 7)))
  INTEGER(w2f__i4) RROW_COMPRESSED(1 : INT((N + 1)))
  INTEGER(w2f__i4) RCOL_INDEX(1 : INT((N * 7)))
  REAL(w2f__8) RVALUES(1 : INT((N * 7)))
!
!       **** Local Variables and Functions ****
!
  INTEGER(w2f__i4) I


    integer iaddr
    external iaddr
!
!       **** Statements ****
!

   if (our_rev_mode%plain) then
! original function
  RNNZ = ANNZ
  RROW_COMPRESSED(1 : INT(N + 1)) = AROW_COMPRESSED(1 : INT(N + 1 ))
  DO I = 1, ANNZ, 1
    RROW_INDEX(I) = AROW_INDEX(I)
    RCOL_INDEX(I) = ACOL_INDEX(I)
    RVALUES(INT(I)) = (AVALUES(I) * SCALAR)
  END DO
    end if
    if (our_rev_mode%tape) then
! taping
  RNNZ = ANNZ
  RROW_COMPRESSED(1 : INT(N + 1)) = AROW_COMPRESSED(1 : INT(N + 1 ))
  OpenAD_Symbol_230 = 0_w2f__i8
  DO I = 1, ANNZ, 1
    RROW_INDEX(I) = AROW_INDEX(I)
    RCOL_INDEX(I) = ACOL_INDEX(I)
    RVALUES(INT(I)) = (AVALUES(I) * SCALAR)
    OpenAD_Symbol_230 = (INT(OpenAD_Symbol_230) + INT(1_w2f__i8))
  END DO
  integer_tape(integer_tape_pointer) = OpenAD_Symbol_230
  integer_tape_pointer = integer_tape_pointer+1
    end if
    if (our_rev_mode%adjoint) then
! adjoint
  integer_tape_pointer = integer_tape_pointer-1
  OpenAD_Symbol_228 = integer_tape(integer_tape_pointer)
  OpenAD_Symbol_229 = 1
  DO WHILE(INT(OpenAD_Symbol_229) .LE. INT(OpenAD_Symbol_228))
    OpenAD_Symbol_229 = INT(OpenAD_Symbol_229) + 1
  END DO
    end if
  end subroutine SCALAR_MULTIPLY_SPMAT
!#########################################################
! This file is part of OpenAD released under the LGPL.   #
! The full COPYRIGHT notice can be found in the top      #
! level directory of the OpenAD distribution             #
!#########################################################

  SUBROUTINE MYMIN_0_0_DOUBLE(SCALARIN1, SCALARIN2, SCALAROUT)
    use OAD_tape
    use OAD_rev

! original arguments get inserted before version
!         ! and declared here together with all local variables
!         ! generated by xaifBooster

  use w2f__types
  IMPLICIT NONE
!
!       **** Global Variables & Derived Type Definitions ****
!
  INTEGER(w2f__i8) OpenAD_Symbol_234
  INTEGER(w2f__i8) OpenAD_Symbol_235
  INTEGER(w2f__i8) OpenAD_Symbol_236
  INTEGER(w2f__i8) OpenAD_Symbol_237
  INTEGER(w2f__i8) OpenAD_Symbol_238
  INTEGER(w2f__i8) OpenAD_Symbol_239
!
!       **** Parameters and Result ****
!
  REAL(w2f__8) SCALARIN1
  REAL(w2f__8) SCALARIN2
  REAL(w2f__8) SCALAROUT


    integer iaddr
    external iaddr
!
!       **** Statements ****
!

   if (our_rev_mode%plain) then
! original function
  IF(SCALARIN1 .LE. SCALARIN2) THEN
    SCALAROUT = SCALARIN1
  ELSE
    SCALAROUT = SCALARIN2
  ENDIF
    end if
    if (our_rev_mode%tape) then
! taping
  IF(SCALARIN1 .LE. SCALARIN2) THEN
    SCALAROUT = SCALARIN1
    OpenAD_Symbol_235 = 1_w2f__i8
    integer_tape(integer_tape_pointer) = OpenAD_Symbol_235
    integer_tape_pointer = integer_tape_pointer+1
  ELSE
    SCALAROUT = SCALARIN2
    OpenAD_Symbol_236 = 0_w2f__i8
    integer_tape(integer_tape_pointer) = OpenAD_Symbol_236
    integer_tape_pointer = integer_tape_pointer+1
  ENDIF
    end if
    if (our_rev_mode%adjoint) then
! adjoint
  integer_tape_pointer = integer_tape_pointer-1
  OpenAD_Symbol_234 = integer_tape(integer_tape_pointer)
  IF(OpenAD_Symbol_234 .ne. 0) THEN
  ENDIF
    end if
  end subroutine MYMIN_0_0_DOUBLE
!#########################################################
! This file is part of OpenAD released under the LGPL.   #
! The full COPYRIGHT notice can be found in the top      #
! level directory of the OpenAD distribution             #
!#########################################################

  SUBROUTINE MYMIN_1_0_DOUBLE(VECTORIN, SCALARIN, VECTOROUT)
    use OAD_tape
    use OAD_rev

! original arguments get inserted before version
!         ! and declared here together with all local variables
!         ! generated by xaifBooster

  use w2f__types
  IMPLICIT NONE
!
!       **** Global Variables & Derived Type Definitions ****
!
  INTEGER(w2f__i8) OpenAD_Symbol_240
  INTEGER(w2f__i8) OpenAD_Symbol_241
  INTEGER(w2f__i8) OpenAD_Symbol_242
  INTEGER(w2f__i8) OpenAD_Symbol_243
  INTEGER(w2f__i8) OpenAD_Symbol_244
  INTEGER(w2f__i8) OpenAD_Symbol_245
  INTEGER(w2f__i8) OpenAD_Symbol_246
  INTEGER(w2f__i8) OpenAD_Symbol_247
  INTEGER(w2f__i8) OpenAD_Symbol_248
  INTEGER(w2f__i8) OpenAD_Symbol_249
  INTEGER(w2f__i8) OpenAD_Symbol_250
  INTEGER(w2f__i8) OpenAD_Symbol_251
!
!       **** Parameters and Result ****
!
  type(active) :: VECTORIN(1:)
  REAL(w2f__8) SCALARIN
  type(active) :: VECTOROUT(1:)
!
!       **** Local Variables and Functions ****
!
  INTEGER(w2f__i4) I
  INTEGER(w2f__i4) OpenAD_Symbol_939
  INTEGER(w2f__i4) OpenAD_Symbol_940


    integer iaddr
    external iaddr
!
!       **** Statements ****
!

   if (our_rev_mode%plain) then
! original function
  DO I = 1, SIZE(VECTORIN, 1), 1
    IF (VECTORIN(I)%v.GE.SCALARIN) THEN
      VECTOROUT(INT(I))%v = SCALARIN
    ELSE
      VECTOROUT(INT(I))%v = VECTORIN(I)%v
    ENDIF
  END DO
    end if
    if (our_rev_mode%tape) then
! taping
  OpenAD_Symbol_243 = 0_w2f__i8
  DO I = 1,SIZE(VECTORIN,1),1
    IF (VECTORIN(I)%v.GE.SCALARIN) THEN
      VECTOROUT(INT(I))%v = SCALARIN
      integer_tape(integer_tape_pointer) = I
      integer_tape_pointer = integer_tape_pointer+1
      OpenAD_Symbol_244 = 1_w2f__i8
      integer_tape(integer_tape_pointer) = OpenAD_Symbol_244
      integer_tape_pointer = integer_tape_pointer+1
    ELSE
      VECTOROUT(INT(I))%v = VECTORIN(I)%v
      integer_tape(integer_tape_pointer) = I
      integer_tape_pointer = integer_tape_pointer+1
      OpenAD_Symbol_245 = 0_w2f__i8
      integer_tape(integer_tape_pointer) = OpenAD_Symbol_245
      integer_tape_pointer = integer_tape_pointer+1
    ENDIF
    OpenAD_Symbol_243 = (INT(OpenAD_Symbol_243)+INT(1_w2f__i8))
  END DO
  integer_tape(integer_tape_pointer) = OpenAD_Symbol_243
  integer_tape_pointer = integer_tape_pointer+1
    end if
    if (our_rev_mode%adjoint) then
! adjoint
  integer_tape_pointer = integer_tape_pointer-1
  OpenAD_Symbol_240 = integer_tape(integer_tape_pointer)
  OpenAD_Symbol_241 = 1
  do while (INT(OpenAD_Symbol_241).LE.INT(OpenAD_Symbol_240))
    integer_tape_pointer = integer_tape_pointer-1
    OpenAD_Symbol_242 = integer_tape(integer_tape_pointer)
    IF (OpenAD_Symbol_242.ne.0) THEN
      integer_tape_pointer = integer_tape_pointer-1
      OpenAD_Symbol_939 = integer_tape(integer_tape_pointer)
      VECTOROUT(OpenAD_Symbol_939)%d = 0.0d0
    ELSE
      integer_tape_pointer = integer_tape_pointer-1
      OpenAD_Symbol_940 = integer_tape(integer_tape_pointer)
      VECTORIN(OpenAD_Symbol_940)%d = VECTORIN(OpenAD_Symbol_940)%d+VECTOROUT(Op&
     &enAD_Symbol_940)%d

      VECTOROUT(OpenAD_Symbol_940)%d = 0.0d0
    ENDIF
    OpenAD_Symbol_241 = INT(OpenAD_Symbol_241)+1
  END DO
    end if
  end subroutine MYMIN_1_0_DOUBLE
!#########################################################
! This file is part of OpenAD released under the LGPL.   #
! The full COPYRIGHT notice can be found in the top      #
! level directory of the OpenAD distribution             #
!#########################################################

  SUBROUTINE MYMIN_1_1_DOUBLE(VECTORIN1, VECTORIN2, VECTOROUT)
    use OAD_tape
    use OAD_rev

! original arguments get inserted before version
!         ! and declared here together with all local variables
!         ! generated by xaifBooster

  use w2f__types
  IMPLICIT NONE
!
!       **** Global Variables & Derived Type Definitions ****
!
  INTEGER(w2f__i8) OpenAD_Symbol_252
  INTEGER(w2f__i8) OpenAD_Symbol_253
  INTEGER(w2f__i8) OpenAD_Symbol_254
  INTEGER(w2f__i8) OpenAD_Symbol_255
  INTEGER(w2f__i8) OpenAD_Symbol_256
  INTEGER(w2f__i8) OpenAD_Symbol_257
  INTEGER(w2f__i8) OpenAD_Symbol_258
  INTEGER(w2f__i8) OpenAD_Symbol_259
  INTEGER(w2f__i8) OpenAD_Symbol_260
  INTEGER(w2f__i8) OpenAD_Symbol_261
  INTEGER(w2f__i8) OpenAD_Symbol_262
  INTEGER(w2f__i8) OpenAD_Symbol_263
!
!       **** Parameters and Result ****
!
  REAL(w2f__8) VECTORIN1(1 :)
  REAL(w2f__8) VECTORIN2(1 :)
  REAL(w2f__8) VECTOROUT(1 :)
!
!       **** Local Variables and Functions ****
!
  INTEGER(w2f__i4) I


    integer iaddr
    external iaddr
!
!       **** Statements ****
!

   if (our_rev_mode%plain) then
! original function
  DO I = 1, SIZE(VECTORIN1, 1), 1
    IF(VECTORIN1(I) .GE. VECTORIN2(I)) THEN
      VECTOROUT(INT(I)) = VECTORIN2(I)
    ELSE
      VECTOROUT(INT(I)) = VECTORIN1(I)
    ENDIF
  END DO
    end if
    if (our_rev_mode%tape) then
! taping
  OpenAD_Symbol_255 = 0_w2f__i8
  DO I = 1, SIZE(VECTORIN1, 1), 1
    IF(VECTORIN1(I) .GE. VECTORIN2(I)) THEN
      VECTOROUT(INT(I)) = VECTORIN2(I)
      OpenAD_Symbol_256 = 1_w2f__i8
      integer_tape(integer_tape_pointer) = OpenAD_Symbol_256
      integer_tape_pointer = integer_tape_pointer+1
    ELSE
      VECTOROUT(INT(I)) = VECTORIN1(I)
      OpenAD_Symbol_257 = 0_w2f__i8
      integer_tape(integer_tape_pointer) = OpenAD_Symbol_257
      integer_tape_pointer = integer_tape_pointer+1
    ENDIF
    OpenAD_Symbol_255 = (INT(OpenAD_Symbol_255) + INT(1_w2f__i8))
  END DO
  integer_tape(integer_tape_pointer) = OpenAD_Symbol_255
  integer_tape_pointer = integer_tape_pointer+1
    end if
    if (our_rev_mode%adjoint) then
! adjoint
  integer_tape_pointer = integer_tape_pointer-1
  OpenAD_Symbol_252 = integer_tape(integer_tape_pointer)
  OpenAD_Symbol_253 = 1
  DO WHILE(INT(OpenAD_Symbol_253) .LE. INT(OpenAD_Symbol_252))
    integer_tape_pointer = integer_tape_pointer-1
    OpenAD_Symbol_254 = integer_tape(integer_tape_pointer)
    IF(OpenAD_Symbol_254 .ne. 0) THEN
    ENDIF
    OpenAD_Symbol_253 = INT(OpenAD_Symbol_253) + 1
  END DO
    end if
  end subroutine MYMIN_1_1_DOUBLE
!#########################################################
! This file is part of OpenAD released under the LGPL.   #
! The full COPYRIGHT notice can be found in the top      #
! level directory of the OpenAD distribution             #
!#########################################################

  SUBROUTINE MYMAX_0_0_DOUBLE(SCALARIN1, SCALARIN2, SCALAROUT)
    use OAD_tape
    use OAD_rev

! original arguments get inserted before version
!         ! and declared here together with all local variables
!         ! generated by xaifBooster

  use w2f__types
  IMPLICIT NONE
!
!       **** Global Variables & Derived Type Definitions ****
!
  INTEGER(w2f__i8) OpenAD_Symbol_264
  INTEGER(w2f__i8) OpenAD_Symbol_265
  INTEGER(w2f__i8) OpenAD_Symbol_266
  INTEGER(w2f__i8) OpenAD_Symbol_267
  INTEGER(w2f__i8) OpenAD_Symbol_268
  INTEGER(w2f__i8) OpenAD_Symbol_269
!
!       **** Parameters and Result ****
!
  REAL(w2f__8) SCALARIN1
  REAL(w2f__8) SCALARIN2
  REAL(w2f__8) SCALAROUT


    integer iaddr
    external iaddr
!
!       **** Statements ****
!

   if (our_rev_mode%plain) then
! original function
  IF(SCALARIN1 .GE. SCALARIN2) THEN
    SCALAROUT = SCALARIN1
  ELSE
    SCALAROUT = SCALARIN2
  ENDIF
    end if
    if (our_rev_mode%tape) then
! taping
  IF(SCALARIN1 .GE. SCALARIN2) THEN
    SCALAROUT = SCALARIN1
    OpenAD_Symbol_265 = 1_w2f__i8
    integer_tape(integer_tape_pointer) = OpenAD_Symbol_265
    integer_tape_pointer = integer_tape_pointer+1
  ELSE
    SCALAROUT = SCALARIN2
    OpenAD_Symbol_266 = 0_w2f__i8
    integer_tape(integer_tape_pointer) = OpenAD_Symbol_266
    integer_tape_pointer = integer_tape_pointer+1
  ENDIF
    end if
    if (our_rev_mode%adjoint) then
! adjoint
  integer_tape_pointer = integer_tape_pointer-1
  OpenAD_Symbol_264 = integer_tape(integer_tape_pointer)
  IF(OpenAD_Symbol_264 .ne. 0) THEN
  ENDIF
    end if
  end subroutine MYMAX_0_0_DOUBLE
!#########################################################
! This file is part of OpenAD released under the LGPL.   #
! The full COPYRIGHT notice can be found in the top      #
! level directory of the OpenAD distribution             #
!#########################################################

  SUBROUTINE MYMAX_1_0_DOUBLE(VECTORIN, SCALARIN, VECTOROUT)
    use OAD_tape
    use OAD_rev

! original arguments get inserted before version
!         ! and declared here together with all local variables
!         ! generated by xaifBooster

  use w2f__types
  IMPLICIT NONE
!
!       **** Global Variables & Derived Type Definitions ****
!
  INTEGER(w2f__i8) OpenAD_Symbol_270
  INTEGER(w2f__i8) OpenAD_Symbol_271
  INTEGER(w2f__i8) OpenAD_Symbol_272
  INTEGER(w2f__i8) OpenAD_Symbol_273
  INTEGER(w2f__i8) OpenAD_Symbol_274
  INTEGER(w2f__i8) OpenAD_Symbol_275
  INTEGER(w2f__i8) OpenAD_Symbol_276
  INTEGER(w2f__i8) OpenAD_Symbol_277
  INTEGER(w2f__i8) OpenAD_Symbol_278
  INTEGER(w2f__i8) OpenAD_Symbol_279
  INTEGER(w2f__i8) OpenAD_Symbol_280
  INTEGER(w2f__i8) OpenAD_Symbol_281
!
!       **** Parameters and Result ****
!
  type(active) :: VECTORIN(1:)
  REAL(w2f__8) SCALARIN
  type(active) :: VECTOROUT(1:)
!
!       **** Local Variables and Functions ****
!
  INTEGER(w2f__i4) I
  INTEGER(w2f__i4) OpenAD_Symbol_941
  INTEGER(w2f__i4) OpenAD_Symbol_942


    integer iaddr
    external iaddr
!
!       **** Statements ****
!

   if (our_rev_mode%plain) then
! original function
  DO I = 1, SIZE(VECTORIN, 1), 1
    IF (VECTORIN(I)%v.LE.SCALARIN) THEN
      VECTOROUT(INT(I))%v = SCALARIN
    ELSE
      VECTOROUT(INT(I))%v = VECTORIN(I)%v
    ENDIF
  END DO
    end if
    if (our_rev_mode%tape) then
! taping
  OpenAD_Symbol_273 = 0_w2f__i8
  DO I = 1,SIZE(VECTORIN,1),1
    IF (VECTORIN(I)%v.LE.SCALARIN) THEN
      VECTOROUT(INT(I))%v = SCALARIN
      integer_tape(integer_tape_pointer) = I
      integer_tape_pointer = integer_tape_pointer+1
      OpenAD_Symbol_274 = 1_w2f__i8
      integer_tape(integer_tape_pointer) = OpenAD_Symbol_274
      integer_tape_pointer = integer_tape_pointer+1
    ELSE
      VECTOROUT(INT(I))%v = VECTORIN(I)%v
      integer_tape(integer_tape_pointer) = I
      integer_tape_pointer = integer_tape_pointer+1
      OpenAD_Symbol_275 = 0_w2f__i8
      integer_tape(integer_tape_pointer) = OpenAD_Symbol_275
      integer_tape_pointer = integer_tape_pointer+1
    ENDIF
    OpenAD_Symbol_273 = (INT(OpenAD_Symbol_273)+INT(1_w2f__i8))
  END DO
  integer_tape(integer_tape_pointer) = OpenAD_Symbol_273
  integer_tape_pointer = integer_tape_pointer+1
    end if
    if (our_rev_mode%adjoint) then
! adjoint
  integer_tape_pointer = integer_tape_pointer-1
  OpenAD_Symbol_270 = integer_tape(integer_tape_pointer)
  OpenAD_Symbol_271 = 1
  do while (INT(OpenAD_Symbol_271).LE.INT(OpenAD_Symbol_270))
    integer_tape_pointer = integer_tape_pointer-1
    OpenAD_Symbol_272 = integer_tape(integer_tape_pointer)
    IF (OpenAD_Symbol_272.ne.0) THEN
      integer_tape_pointer = integer_tape_pointer-1
      OpenAD_Symbol_941 = integer_tape(integer_tape_pointer)
      VECTOROUT(OpenAD_Symbol_941)%d = 0.0d0
    ELSE
      integer_tape_pointer = integer_tape_pointer-1
      OpenAD_Symbol_942 = integer_tape(integer_tape_pointer)
      VECTORIN(OpenAD_Symbol_942)%d = VECTORIN(OpenAD_Symbol_942)%d+VECTOROUT(Op&
     &enAD_Symbol_942)%d

      VECTOROUT(OpenAD_Symbol_942)%d = 0.0d0
    ENDIF
    OpenAD_Symbol_271 = INT(OpenAD_Symbol_271)+1
  END DO
    end if
  end subroutine MYMAX_1_0_DOUBLE
!#########################################################
! This file is part of OpenAD released under the LGPL.   #
! The full COPYRIGHT notice can be found in the top      #
! level directory of the OpenAD distribution             #
!#########################################################

  SUBROUTINE MYMAX_1_1_DOUBLE(VECTORIN1, VECTORIN2, VECTOROUT)
    use OAD_tape
    use OAD_rev

! original arguments get inserted before version
!         ! and declared here together with all local variables
!         ! generated by xaifBooster

  use w2f__types
  IMPLICIT NONE
!
!       **** Global Variables & Derived Type Definitions ****
!
  INTEGER(w2f__i8) OpenAD_Symbol_282
  INTEGER(w2f__i8) OpenAD_Symbol_283
  INTEGER(w2f__i8) OpenAD_Symbol_284
  INTEGER(w2f__i8) OpenAD_Symbol_285
  INTEGER(w2f__i8) OpenAD_Symbol_286
  INTEGER(w2f__i8) OpenAD_Symbol_287
  INTEGER(w2f__i8) OpenAD_Symbol_288
  INTEGER(w2f__i8) OpenAD_Symbol_289
  INTEGER(w2f__i8) OpenAD_Symbol_290
  INTEGER(w2f__i8) OpenAD_Symbol_291
  INTEGER(w2f__i8) OpenAD_Symbol_292
  INTEGER(w2f__i8) OpenAD_Symbol_293
!
!       **** Parameters and Result ****
!
  REAL(w2f__8) VECTORIN1(1 :)
  REAL(w2f__8) VECTORIN2(1 :)
  REAL(w2f__8) VECTOROUT(1 :)
!
!       **** Local Variables and Functions ****
!
  INTEGER(w2f__i4) I


    integer iaddr
    external iaddr
!
!       **** Statements ****
!

   if (our_rev_mode%plain) then
! original function
  DO I = 1, SIZE(VECTORIN1, 1), 1
    IF(VECTORIN1(I) .LE. VECTORIN2(I)) THEN
      VECTOROUT(INT(I)) = VECTORIN2(I)
    ELSE
      VECTOROUT(INT(I)) = VECTORIN1(I)
    ENDIF
  END DO
    end if
    if (our_rev_mode%tape) then
! taping
  OpenAD_Symbol_285 = 0_w2f__i8
  DO I = 1, SIZE(VECTORIN1, 1), 1
    IF(VECTORIN1(I) .LE. VECTORIN2(I)) THEN
      VECTOROUT(INT(I)) = VECTORIN2(I)
      OpenAD_Symbol_286 = 1_w2f__i8
      integer_tape(integer_tape_pointer) = OpenAD_Symbol_286
      integer_tape_pointer = integer_tape_pointer+1
    ELSE
      VECTOROUT(INT(I)) = VECTORIN1(I)
      OpenAD_Symbol_287 = 0_w2f__i8
      integer_tape(integer_tape_pointer) = OpenAD_Symbol_287
      integer_tape_pointer = integer_tape_pointer+1
    ENDIF
    OpenAD_Symbol_285 = (INT(OpenAD_Symbol_285) + INT(1_w2f__i8))
  END DO
  integer_tape(integer_tape_pointer) = OpenAD_Symbol_285
  integer_tape_pointer = integer_tape_pointer+1
    end if
    if (our_rev_mode%adjoint) then
! adjoint
  integer_tape_pointer = integer_tape_pointer-1
  OpenAD_Symbol_282 = integer_tape(integer_tape_pointer)
  OpenAD_Symbol_283 = 1
  DO WHILE(INT(OpenAD_Symbol_283) .LE. INT(OpenAD_Symbol_282))
    integer_tape_pointer = integer_tape_pointer-1
    OpenAD_Symbol_284 = integer_tape(integer_tape_pointer)
    IF(OpenAD_Symbol_284 .ne. 0) THEN
    ENDIF
    OpenAD_Symbol_283 = INT(OpenAD_Symbol_283) + 1
  END DO
    end if
  end subroutine MYMAX_1_1_DOUBLE
END

MODULE linsolve
use OAD_active
use w2f__types
use oad_intrinsics
use parameters
use mathutil
use matrix
IMPLICIT NONE
SAVE
!
!     **** Top Level Pragmas ****
!
interface SOLVE
  module procedure SPARSE_SOLVE
end interface

!
!     **** Statements ****
!
CONTAINS
!#########################################################
! This file is part of OpenAD released under the LGPL.   #
! The full COPYRIGHT notice can be found in the top      #
! level directory of the OpenAD distribution             #
!#########################################################

  SUBROUTINE SPARSE_SOLVE(N, ANNZ, AROW_INDEX, AROW_COMPRESSED, ACOL_INDEX, AVAL&
     &UES, B, X)

    use OAD_tape
    use OAD_rev

! original arguments get inserted before version
!         ! and declared here together with all local variables
!         ! generated by xaifBooster

  use w2f__types
  IMPLICIT NONE
!
!       **** Parameters and Result ****
!
  INTEGER(w2f__i4) N
  INTEGER(w2f__i4) ANNZ
  INTEGER(w2f__i4) AROW_INDEX(1 : INT((N * 7)))
  INTEGER(w2f__i4) AROW_COMPRESSED(1 : INT((N + 1)))
  INTEGER(w2f__i4) ACOL_INDEX(1 : INT((N * 7)))
  type(active) :: AVALUES(1:INT((N*7)))
  type(active) :: B(1:N)
  type(active) :: X(1:N)
!
!       **** Local Variables and Functions ****
!
  INTEGER(w2f__i4) OAD_CTMP0


    integer iaddr
    external iaddr
!
!       **** Statements ****
!

   if (our_rev_mode%plain) then
! original function
  OAD_CTMP0 = (N * 7)
  CALL SPARSE_DUMMY_METHOD(N,ANNZ,OAD_CTMP0,AROW_INDEX,AROW_COMPRESSED,ACOL_INDE&
     &X,AVALUES,B,X,SOLVER_INNER,SOLVER_OUTER,VERBOSE)

    end if
    if (our_rev_mode%tape) then
! taping
  OAD_CTMP0 = (N*7)
  CALL SPARSE_DUMMY_METHOD(N,ANNZ,OAD_CTMP0,AROW_INDEX,AROW_COMPRESSED,ACOL_INDE&
     &X,AVALUES,B,X,SOLVER_INNER,SOLVER_OUTER,VERBOSE)

  integer_tape(integer_tape_pointer) = N
  integer_tape_pointer = integer_tape_pointer+1
  integer_tape(integer_tape_pointer) = OAD_CTMP0
  integer_tape_pointer = integer_tape_pointer+1
    end if
    if (our_rev_mode%adjoint) then
! adjoint
  integer_tape_pointer = integer_tape_pointer-1
  OAD_CTMP0 = integer_tape(integer_tape_pointer)
  integer_tape_pointer = integer_tape_pointer-1
  N = integer_tape(integer_tape_pointer)
  CALL SPARSE_DUMMY_METHOD(N,ANNZ,OAD_CTMP0,AROW_INDEX,AROW_COMPRESSED,ACOL_INDE&
     &X,AVALUES,B,X,SOLVER_INNER,SOLVER_OUTER,VERBOSE)

    end if
  end subroutine SPARSE_SOLVE
!#########################################################
! This file is part of OpenAD released under the LGPL.   #
! The full COPYRIGHT notice can be found in the top      #
! level directory of the OpenAD distribution             #
!#########################################################

  SUBROUTINE SPARSE_DUMMY_METHOD(N, ANNZ, ALEN, AROW_INDEX, AROW_COMPRESSED, ACO&
     &L_INDEX, AVALUES, B, X, SOLVER_INNER, SOLVER_OUTER, VERBOSE)

    use OAD_tape
    use OAD_rev

! original arguments get inserted before version
!         ! and declared here together with all local variables
!         ! generated by xaifBooster

  use w2f__types
  IMPLICIT NONE
!
!       **** Parameters and Result ****
!
  INTEGER(w2f__i4) N
  INTEGER(w2f__i4) ANNZ
  INTEGER(w2f__i4) ALEN
  INTEGER(w2f__i4) AROW_INDEX(1 : ALEN)
  INTEGER(w2f__i4) AROW_COMPRESSED(1 : INT((N + 1)))
  INTEGER(w2f__i4) ACOL_INDEX(1 : ALEN)
  type(active) :: AVALUES(1:ALEN)
  type(active) :: B(1:N)
  type(active) :: X(1:N)
  INTEGER(w2f__i4) SOLVER_INNER
  INTEGER(w2f__i4) SOLVER_OUTER
  LOGICAL(w2f__i4) VERBOSE


    integer iaddr
    external iaddr
!
!       **** Statements ****
!

   if (our_rev_mode%plain) then
! original function
  CALL SPMAT_MULTIPLY_VECTOR(N,ANNZ,AROW_INDEX,AROW_COMPRESSED,ACOL_INDEX,AVALUE&
     &S,B,X,'PRE')

    end if
    if (our_rev_mode%tape) then
! taping
  CALL SPMAT_MULTIPLY_VECTOR(N,ANNZ,AROW_INDEX,AROW_COMPRESSED,ACOL_INDEX,AVALUE&
     &S,B,X,'PRE')

  integer_tape(integer_tape_pointer) = N
  integer_tape_pointer = integer_tape_pointer+1
    end if
    if (our_rev_mode%adjoint) then
! adjoint
  integer_tape_pointer = integer_tape_pointer-1
  N = integer_tape(integer_tape_pointer)
  CALL SPMAT_MULTIPLY_VECTOR(N,ANNZ,AROW_INDEX,AROW_COMPRESSED,ACOL_INDEX,AVALUE&
     &S,B,X,'PRE')

    end if
  end subroutine SPARSE_DUMMY_METHOD
END

MODULE finitevolume
use OAD_active
use w2f__types
use oad_intrinsics
use parameters
use mathutil
use matrix
use linsolve
IMPLICIT NONE
SAVE
!
!     **** Top Level Pragmas ****
!
interface RELPERM
  module procedure RELPERM_VECTOR
  module procedure RELPERM_SCALAR
end interface

!
!     **** Statements ****
!
CONTAINS
!#########################################################
! This file is part of OpenAD released under the LGPL.   #
! The full COPYRIGHT notice can be found in the top      #
! level directory of the OpenAD distribution             #
!#########################################################

  SUBROUTINE NEWTRAPH(NX, NY, NZ, ND, PT, ST, Q, V, S)
    use OAD_tape
    use OAD_rev

! original arguments get inserted before version
!         ! and declared here together with all local variables
!         ! generated by xaifBooster

  use w2f__types
  IMPLICIT NONE
!
!       **** Global Variables & Derived Type Definitions ****
!
  INTEGER(w2f__i8) OpenAD_Symbol_294
  INTEGER(w2f__i8) OpenAD_Symbol_295
  INTEGER(w2f__i8) OpenAD_Symbol_296
  INTEGER(w2f__i8) OpenAD_Symbol_297
  INTEGER(w2f__i8) OpenAD_Symbol_298
  INTEGER(w2f__i8) OpenAD_Symbol_299
  INTEGER(w2f__i8) OpenAD_Symbol_300
  INTEGER(w2f__i8) OpenAD_Symbol_301
  INTEGER(w2f__i8) OpenAD_Symbol_302
  INTEGER(w2f__i8) OpenAD_Symbol_303
  INTEGER(w2f__i8) OpenAD_Symbol_304
  INTEGER(w2f__i8) OpenAD_Symbol_305
  INTEGER(w2f__i8) OpenAD_Symbol_306
  INTEGER(w2f__i8) OpenAD_Symbol_307
  INTEGER(w2f__i8) OpenAD_Symbol_308
  INTEGER(w2f__i8) OpenAD_Symbol_309
  INTEGER(w2f__i8) OpenAD_Symbol_310
  INTEGER(w2f__i8) OpenAD_Symbol_311
  INTEGER(w2f__i8) OpenAD_Symbol_312
  INTEGER(w2f__i8) OpenAD_Symbol_313
  INTEGER(w2f__i8) OpenAD_Symbol_314
  INTEGER(w2f__i8) OpenAD_Symbol_315
  INTEGER(w2f__i8) OpenAD_Symbol_316
  INTEGER(w2f__i8) OpenAD_Symbol_317
  INTEGER(w2f__i8) OpenAD_Symbol_318
  INTEGER(w2f__i8) OpenAD_Symbol_319
  INTEGER(w2f__i8) OpenAD_Symbol_320
  INTEGER(w2f__i8) OpenAD_Symbol_321
  INTEGER(w2f__i8) OpenAD_Symbol_322
  INTEGER(w2f__i8) OpenAD_Symbol_323
!
!       **** Parameters and Result ****
!
  INTEGER(w2f__i4) NX
  INTEGER(w2f__i4) NY
  INTEGER(w2f__i4) NZ
  INTEGER(w2f__i4) ND
  INTEGER(w2f__i4) PT
  INTEGER(w2f__i4) ST
  type(active) :: Q(1:INT((NZ*NX*NY)))
  type(active) :: V(1:3,1:INT((NX+1)),1:INT((NY+1)),1:INT((NZ+1)))
  type(active) :: S(1:INT((NZ*NX*NY)))
!
!       **** Local Variables and Functions ****
!
  INTEGER(w2f__i4) ACOL_INDEX(1 : INT((NZ * NX * NY * 7)))
  INTEGER(w2f__i4) ANNZ
  INTEGER(w2f__i4) AROW_COMPRESSED(1 : INT((NZ * NX * NY + 1)))
  INTEGER(w2f__i4) AROW_INDEX(1 : INT((NZ * NX * NY * 7)))
  type(active) :: AVALUES(1:INT((NZ*NX*NY*7)))
  INTEGER(w2f__i4) BCOL_INDEX(1 : INT((NZ * NX * NY * 7)))
  type(active) :: BFW(1:INT((NZ*NX*NY)))
  INTEGER(w2f__i4) BNNZ
  INTEGER(w2f__i4) BROW_COMPRESSED(1 : INT((NZ * NX * NY + 1)))
  INTEGER(w2f__i4) BROW_INDEX(1 : INT((NZ * NX * NY * 7)))
  type(active) :: BVALUES(1:INT((NZ*NX*NY*7)))
  LOGICAL(w2f__i4) CONVERGED
  type(active) :: DF(1:INT((NZ*NX*NY)))
  INTEGER(w2f__i4) DGCOL_INDEX(1 : INT((NZ * NX * NY * 7)))
  INTEGER(w2f__i4) DGNNZ
  INTEGER(w2f__i4) DGROW_COMPRESSED(1 : INT((NZ * NX * NY + 1)))
  INTEGER(w2f__i4) DGROW_INDEX(1 : INT((NZ * NX * NY * 7)))
  type(active) :: DGVALUES(1:INT((NZ*NX*NY*7)))
  type(active) :: DMO(1:INT((NZ*NX*NY)))
  type(active) :: DMW(1:INT((NZ*NX*NY)))
  type(active) :: DS(1:INT((NZ*NX*NY)))
  REAL(w2f__8) DSN
  REAL(w2f__8) DT
  REAL(w2f__8) DTX(1 : INT((NZ * NX * NY)))
  type(active) :: FI(1:INT((NZ*NX*NY)))
  type(active) :: FW(1:INT((NZ*NX*NY)))
  type(active) :: G(1:INT((NZ*NX*NY)))
  INTEGER(w2f__i4) I
  INTEGER(w2f__i4) IT
  INTEGER(w2f__i4) J
  type(active) :: MO(1:INT((NZ*NX*NY)))
  type(active) :: MW(1:INT((NZ*NX*NY)))
  INTEGER(w2f__i4) N
  REAL(w2f__8) OAD_CTMP0
  REAL(w2f__8) OAD_CTMP1
  INTEGER(w2f__i4) OAD_CTMP2
  type(active) :: S_COPY(1:INT((NZ*NX*NY)))
  type(active) :: S_ITER_COPY(1:INT((NZ*NX*NY)))
  INTEGER(w2f__i4) OpenAD_Symbol_1000
  INTEGER(w2f__i4) OpenAD_Symbol_1001
  INTEGER(w2f__i4) OpenAD_Symbol_1002
  INTEGER(w2f__i4) OpenAD_Symbol_1003
  INTEGER(w2f__i4) OpenAD_Symbol_1004
  INTEGER(w2f__i4) OpenAD_Symbol_324
  INTEGER(w2f__i4) OpenAD_Symbol_325
  INTEGER(w2f__i4) OpenAD_Symbol_326
  INTEGER(w2f__i8) OpenAD_Symbol_327
  INTEGER(w2f__i4) OpenAD_Symbol_329
  INTEGER(w2f__i4) OpenAD_Symbol_330
  INTEGER(w2f__i4) OpenAD_Symbol_331
  INTEGER(w2f__i4) OpenAD_Symbol_332
  INTEGER(w2f__i4) OpenAD_Symbol_333
  INTEGER(w2f__i4) OpenAD_Symbol_334
  INTEGER(w2f__i4) OpenAD_Symbol_335
  INTEGER(w2f__i4) OpenAD_Symbol_336
  INTEGER(w2f__i4) OpenAD_Symbol_337
  INTEGER(w2f__i8) OpenAD_Symbol_338
  INTEGER(w2f__i4) OpenAD_Symbol_340
  INTEGER(w2f__i4) OpenAD_Symbol_341
  INTEGER(w2f__i8) OpenAD_Symbol_342
  INTEGER(w2f__i4) OpenAD_Symbol_344
  INTEGER(w2f__i8) OpenAD_Symbol_345
  INTEGER(w2f__i4) OpenAD_Symbol_347
  INTEGER(w2f__i8) OpenAD_Symbol_348
  INTEGER(w2f__i4) OpenAD_Symbol_350
  INTEGER(w2f__i4) OpenAD_Symbol_351
  INTEGER(w2f__i8) OpenAD_Symbol_352
  INTEGER(w2f__i4) OpenAD_Symbol_354
  INTEGER(w2f__i4) OpenAD_Symbol_355
  INTEGER(w2f__i4) OpenAD_Symbol_356
  INTEGER(w2f__i8) OpenAD_Symbol_357
  INTEGER(w2f__i4) OpenAD_Symbol_359
  INTEGER(w2f__i4) OpenAD_Symbol_360
  INTEGER(w2f__i8) OpenAD_Symbol_361
  INTEGER(w2f__i4) OpenAD_Symbol_363
  INTEGER(w2f__i4) OpenAD_Symbol_364
  INTEGER(w2f__i4) OpenAD_Symbol_365
  INTEGER(w2f__i4) OpenAD_Symbol_366
  INTEGER(w2f__i4) OpenAD_Symbol_367
  INTEGER(w2f__i4) OpenAD_Symbol_368
  INTEGER(w2f__i4) OpenAD_Symbol_369
  INTEGER(w2f__i4) OpenAD_Symbol_370
  INTEGER(w2f__i4) OpenAD_Symbol_371
  INTEGER(w2f__i4) OpenAD_Symbol_372
  INTEGER(w2f__i4) OpenAD_Symbol_373
  INTEGER(w2f__i4) OpenAD_Symbol_374
  INTEGER(w2f__i4) OpenAD_Symbol_375
  INTEGER(w2f__i4) OpenAD_Symbol_376
  INTEGER(w2f__i4) OpenAD_Symbol_377
  INTEGER(w2f__i4) OpenAD_Symbol_943
  INTEGER(w2f__i4) OpenAD_Symbol_944
  REAL(w2f__8) OpenAD_Symbol_945(:)
  ALLOCATABLE OpenAD_Symbol_945
  INTEGER(w2f__i8) OpenAD_Symbol_946
  INTEGER(w2f__i4) OpenAD_Symbol_948
  INTEGER(w2f__i4) OpenAD_Symbol_949
  INTEGER(w2f__i4) OpenAD_Symbol_950
  INTEGER(w2f__i4) OpenAD_Symbol_951
  INTEGER(w2f__i4) OpenAD_Symbol_952
  INTEGER(w2f__i4) OpenAD_Symbol_953
  INTEGER(w2f__i4) OpenAD_Symbol_954
  INTEGER(w2f__i4) OpenAD_Symbol_955
  INTEGER(w2f__i4) OpenAD_Symbol_956
  INTEGER(w2f__i4) OpenAD_Symbol_957
  INTEGER(w2f__i4) OpenAD_Symbol_958
  INTEGER(w2f__i4) OpenAD_Symbol_959
  INTEGER(w2f__i4) OpenAD_Symbol_960
  INTEGER(w2f__i4) OpenAD_Symbol_961
  INTEGER(w2f__i4) OpenAD_Symbol_962
  INTEGER(w2f__i4) OpenAD_Symbol_963
  REAL(w2f__8) OpenAD_Symbol_964(:)
  ALLOCATABLE OpenAD_Symbol_964
  INTEGER(w2f__i8) OpenAD_Symbol_965
  REAL(w2f__8) OpenAD_Symbol_967(:)
  ALLOCATABLE OpenAD_Symbol_967
  INTEGER(w2f__i8) OpenAD_Symbol_968
  INTEGER(w2f__i4) OpenAD_Symbol_970
  INTEGER(w2f__i4) OpenAD_Symbol_971
  INTEGER(w2f__i4) OpenAD_Symbol_972
  INTEGER(w2f__i4) OpenAD_Symbol_973
  INTEGER(w2f__i4) OpenAD_Symbol_974
  REAL(w2f__8) OpenAD_Symbol_975(:)
  ALLOCATABLE OpenAD_Symbol_975
  INTEGER(w2f__i8) OpenAD_Symbol_976
  REAL(w2f__8) OpenAD_Symbol_978(:)
  ALLOCATABLE OpenAD_Symbol_978
  INTEGER(w2f__i8) OpenAD_Symbol_979
  REAL(w2f__8) OpenAD_Symbol_981(:)
  ALLOCATABLE OpenAD_Symbol_981
  INTEGER(w2f__i8) OpenAD_Symbol_982
  REAL(w2f__8) OpenAD_Symbol_984(:)
  ALLOCATABLE OpenAD_Symbol_984
  INTEGER(w2f__i8) OpenAD_Symbol_985
  REAL(w2f__8) OpenAD_Symbol_987(:)
  ALLOCATABLE OpenAD_Symbol_987
  INTEGER(w2f__i8) OpenAD_Symbol_988
  INTEGER(w2f__i4) OpenAD_Symbol_990
  INTEGER(w2f__i4) OpenAD_Symbol_991
  INTEGER(w2f__i4) OpenAD_Symbol_992
  INTEGER(w2f__i4) OpenAD_Symbol_993
  INTEGER(w2f__i4) OpenAD_Symbol_994
  INTEGER(w2f__i4) OpenAD_Symbol_995
  INTEGER(w2f__i4) OpenAD_Symbol_996
  INTEGER(w2f__i4) OpenAD_Symbol_997
  INTEGER(w2f__i4) OpenAD_Symbol_998
  INTEGER(w2f__i4) OpenAD_Symbol_999
  REAL(w2f__8) OpenAD_acc_0(:)
  ALLOCATABLE OpenAD_acc_0
  REAL(w2f__8) OpenAD_acc_1(:)
  ALLOCATABLE OpenAD_acc_1
  REAL(w2f__8) OpenAD_acc_2(:)
  ALLOCATABLE OpenAD_acc_2
  REAL(w2f__8) OpenAD_aux_0(:)
  ALLOCATABLE OpenAD_aux_0
  REAL(w2f__8) OpenAD_aux_1(:)
  ALLOCATABLE OpenAD_aux_1
  REAL(w2f__8) OpenAD_aux_2(:)
  ALLOCATABLE OpenAD_aux_2
  REAL(w2f__8) OpenAD_aux_3(:)
  ALLOCATABLE OpenAD_aux_3
  REAL(w2f__8) OpenAD_aux_4(:)
  ALLOCATABLE OpenAD_aux_4
  REAL(w2f__8) OpenAD_aux_5(:)
  ALLOCATABLE OpenAD_aux_5
  REAL(w2f__8) OpenAD_lin_10(:)
  ALLOCATABLE OpenAD_lin_10
  REAL(w2f__8) OpenAD_lin_11(:)
  ALLOCATABLE OpenAD_lin_11
  REAL(w2f__8) OpenAD_lin_12(:)
  ALLOCATABLE OpenAD_lin_12
  REAL(w2f__8) OpenAD_lin_13(:)
  ALLOCATABLE OpenAD_lin_13
  REAL(w2f__8) OpenAD_lin_14(:)
  ALLOCATABLE OpenAD_lin_14
  REAL(w2f__8) OpenAD_lin_15(:)
  ALLOCATABLE OpenAD_lin_15
  REAL(w2f__8) OpenAD_lin_16(:)
  ALLOCATABLE OpenAD_lin_16
  REAL(w2f__8) OpenAD_lin_17(:)
  ALLOCATABLE OpenAD_lin_17
  REAL(w2f__8) OpenAD_lin_8(:)
  ALLOCATABLE OpenAD_lin_8
  REAL(w2f__8) OpenAD_lin_9(:)
  ALLOCATABLE OpenAD_lin_9
  type(active) :: OpenAD_prp_10(:)
  ALLOCATABLE OpenAD_prp_10
  type(active) :: OpenAD_prp_5(:)
  ALLOCATABLE OpenAD_prp_5
  type(active) :: OpenAD_prp_6(:)
  ALLOCATABLE OpenAD_prp_6
  type(active) :: OpenAD_prp_7(:)
  ALLOCATABLE OpenAD_prp_7
  type(active) :: OpenAD_prp_8(:)
  ALLOCATABLE OpenAD_prp_8
  type(active) :: OpenAD_prp_9(:)
  ALLOCATABLE OpenAD_prp_9
  type(active) :: OpenAD_tyc_0(:)
  ALLOCATABLE OpenAD_tyc_0
  REAL(w2f__8) OpenAD_tyc_1(:)
  ALLOCATABLE OpenAD_tyc_1
  type(active) :: OpenAD_tyc_5(:)
  ALLOCATABLE OpenAD_tyc_5
  REAL(w2f__8) OpenAD_tyc_7(:)
  ALLOCATABLE OpenAD_tyc_7


    integer iaddr
    external iaddr
!
!       **** Statements ****
!

   if (our_rev_mode%plain) then
! original function
  CONVERGED = .FALSE.
  N = (NZ * NX * NY)
  CALL GENA(NX,NY,NZ,V,Q,ANNZ,AROW_INDEX,AROW_COMPRESSED,ACOL_INDEX,AVALUES)
  S_COPY(1:NZ*NX*NY)%v = S(1:NZ*NX*NY)%v
  IT = 0
  do while (.not. CONVERGED)
    DT = (ST/(2**IT))
    DTX(1:NZ*NX*NY) = (DT/(POR(:)*VOL))
    OAD_CTMP0 = 0.0D00
    CALL MYMAX_1_0_DOUBLE(Q,OAD_CTMP0,FI)
    FI(1:NZ*NX*NY)%v = (DTX(1:NZ*NX*NY)*FI(1:NZ*NX*NY)%v)
!!! requested inline of 'oad_AllocateMatching' has no defn
    CALL oad_AllocateMatching(OpenAD_tyc_0,DTX)
!!! requested inline of 'oad_convert' has no defn
    CALL oad_convert(OpenAD_tyc_0,DTX)
    CALL SPMAT_MULTIPLY_DIAGONAL(N,ANNZ,AROW_INDEX,AROW_COMPRESSED,ACOL_INDEX,AV&
     &ALUES,OpenAD_tyc_0,BNNZ,BROW_INDEX,BROW_COMPRESSED,BCOL_INDEX,BVALUES,'POS&
     &')

!!! requested inline of 'oad_ShapeTest' has no defn
    CALL oad_ShapeTest(OpenAD_tyc_0,DTX)
!!! requested inline of 'oad_convert' has no defn
    CALL oad_convert(DTX,OpenAD_tyc_0)
    I = 0
    do while (I.LT.(2**IT))
      J = 0
      I = (I+1)
      DSN = 1.0D00
      S_ITER_COPY(1:NZ*NX*NY)%v = S(1:NZ*NX*NY)%v
      do while ((J.LT.10).AND.(DSN.GT.1.00000000000000002082D-03))
        CALL RELPERM_VECTOR(NX,NY,NZ,S,MW,MO,DMW,DMO)
        DF(1:NZ*NX*NY)%v = ((DMW(1:NZ*NX*NY)%v/(MO(1:NZ*NX*NY)%v+MW(1:NZ*NX*NY)%&
     &v))-(MW(1:NZ*NX*NY)%v/((MO(1:NZ*NX*NY)%v+MW(1:NZ*NX*NY)%v)**2))*(DMO(1:NZ*&
     &NX*NY)%v+DMW(1:NZ*NX*NY)%v))

        CALL SPMAT_MULTIPLY_DIAGONAL(N,BNNZ,BROW_INDEX,BROW_COMPRESSED,BCOL_INDE&
     &X,BVALUES,DF,DGNNZ,DGROW_INDEX,DGROW_COMPRESSED,DGCOL_INDEX,DGVALUES,'PRE'&
     &)

        OAD_CTMP1 = (-1.0D00)
        OAD_CTMP2 = 0
        CALL ADDX_DIAGONAL(N,DGNNZ,DGROW_INDEX,DGROW_COMPRESSED,DGCOL_INDEX,DGVA&
     &LUES,OAD_CTMP1,OAD_CTMP2)

        FW(1:NZ*NX*NY)%v = (MW(1:NZ*NX*NY)%v/(MO(1:NZ*NX*NY)%v+MW(1:NZ*NX*NY)%v)&
     &)

        CALL SPMAT_MULTIPLY_VECTOR(N,BNNZ,BROW_INDEX,BROW_COMPRESSED,BCOL_INDEX,&
     &BVALUES,FW,BFW,'PRE')

        G(1:NZ*NX*NY)%v = (S(1:NZ*NX*NY)%v-S_ITER_COPY(1:NZ*NX*NY)%v-BFW(1:NZ*NX&
     &*NY)%v-FI(1:NZ*NX*NY)%v)

        CALL SPARSE_SOLVE(N,DGNNZ,DGROW_INDEX,DGROW_COMPRESSED,DGCOL_INDEX,DGVAL&
     &UES,G,DS)

        S(1:NZ*NX*NY)%v = (S(1:NZ*NX*NY)%v+DS(1:NZ*NX*NY)%v)
!!! requested inline of 'oad_AllocateMatching' has no defn
        CALL oad_AllocateMatching(OpenAD_tyc_1,DS)
!!! requested inline of 'oad_convert' has no defn
        CALL oad_convert(OpenAD_tyc_1,DS)
        CALL DNRM2(OpenAD_tyc_1,N,DSN)
!!! requested inline of 'oad_ShapeTest' has no defn
        CALL oad_ShapeTest(OpenAD_tyc_1,DS)
!!! requested inline of 'oad_convert' has no defn
        CALL oad_convert(DS,OpenAD_tyc_1)
        J = (J+1)
      END DO
      IF (DSN.GT.1.00000000000000002082D-03) THEN
        I = (2**IT)
        S(1:NZ*NX*NY)%v = S_COPY(1:NZ*NX*NY)%v
      ENDIF
    END DO
    IF (DSN.LT.1.00000000000000002082D-03) THEN
      CONVERGED = .TRUE.
    ELSE
      IT = (IT+1)
    ENDIF
  END DO
    end if
    if (our_rev_mode%tape) then
! taping
  CONVERGED = .FALSE.
  N = (NZ*NX*NY)
  CALL GENA(NX,NY,NZ,V,Q,ANNZ,AROW_INDEX,AROW_COMPRESSED,ACOL_INDEX,AVALUES)
  integer_tape(integer_tape_pointer) = NX
  integer_tape_pointer = integer_tape_pointer+1
  integer_tape(integer_tape_pointer) = NY
  integer_tape_pointer = integer_tape_pointer+1
  integer_tape(integer_tape_pointer) = NZ
  integer_tape_pointer = integer_tape_pointer+1
  S_COPY(1:NZ*NX*NY)%v = S(1:NZ*NX*NY)%v
  IT = 0
  OpenAD_Symbol_324 = (NZ*NX*NY)
  integer_tape(integer_tape_pointer) = OpenAD_Symbol_324
  integer_tape_pointer = integer_tape_pointer+1
  OpenAD_Symbol_325 = (NZ*NX*NY)
  integer_tape(integer_tape_pointer) = OpenAD_Symbol_325
  integer_tape_pointer = integer_tape_pointer+1
  OpenAD_Symbol_302 = 0_w2f__i8
  do while (.not. CONVERGED)
    DT = (ST/(2**IT))
    DTX(1:NZ*NX*NY) = (DT/(POR(:)*VOL))
    OAD_CTMP0 = 0.0D00
    CALL MYMAX_1_0_DOUBLE(Q,OAD_CTMP0,FI)
!!! requested inline of 'oad_AllocateMatching' has no defn
    CALL oad_AllocateMatching(OpenAD_lin_8,DTX(1:NZ*NX*NY))
    OpenAD_lin_8 = DTX(1:NZ*NX*NY)
    FI(1:NZ*NX*NY)%v = (DTX(1:NZ*NX*NY)*FI(1:NZ*NX*NY)%v)
    OpenAD_Symbol_326 = (NZ*NX*NY)
    integer_tape(integer_tape_pointer) = OpenAD_Symbol_326
    integer_tape_pointer = integer_tape_pointer+1
    OpenAD_Symbol_327 = SIZE(OpenAD_lin_8,1_w2f__i8)
    integer_tape(integer_tape_pointer) = OpenAD_Symbol_327
    integer_tape_pointer = integer_tape_pointer+1
    double_tape(double_tape_pointer:double_tape_pointer+size(OpenAD_lin_8,1)-1) &
     &= OpenAD_lin_8(:)

    double_tape_pointer = double_tape_pointer+size(OpenAD_lin_8,1)
    OpenAD_Symbol_329 = (NZ*NX*NY)
    integer_tape(integer_tape_pointer) = OpenAD_Symbol_329
    integer_tape_pointer = integer_tape_pointer+1
!!! requested inline of 'oad_AllocateMatching' has no defn
    CALL oad_AllocateMatching(OpenAD_tyc_0,DTX)
!!! requested inline of 'oad_convert' has no defn
    CALL oad_convert(OpenAD_tyc_0,DTX)
    CALL SPMAT_MULTIPLY_DIAGONAL(N,ANNZ,AROW_INDEX,AROW_COMPRESSED,ACOL_INDEX,AV&
     &ALUES,OpenAD_tyc_0,BNNZ,BROW_INDEX,BROW_COMPRESSED,BCOL_INDEX,BVALUES,'POS&
     &')

!!! requested inline of 'oad_ShapeTest' has no defn
    CALL oad_ShapeTest(OpenAD_tyc_0,DTX)
!!! requested inline of 'oad_convert' has no defn
    CALL oad_convert(DTX,OpenAD_tyc_0)
    integer_tape(integer_tape_pointer) = N
    integer_tape_pointer = integer_tape_pointer+1
    I = 0
    OpenAD_Symbol_303 = 0_w2f__i8
    do while (I.LT.(2**IT))
      J = 0
      I = (I+1)
      DSN = 1.0D00
      S_ITER_COPY(1:NZ*NX*NY)%v = S(1:NZ*NX*NY)%v
      OpenAD_Symbol_330 = (NZ*NX*NY)
      integer_tape(integer_tape_pointer) = OpenAD_Symbol_330
      integer_tape_pointer = integer_tape_pointer+1
      OpenAD_Symbol_331 = (NZ*NX*NY)
      integer_tape(integer_tape_pointer) = OpenAD_Symbol_331
      integer_tape_pointer = integer_tape_pointer+1
      OpenAD_Symbol_304 = 0_w2f__i8
      do while ((J.LT.10).AND.(DSN.GT.1.00000000000000002082D-03))
        CALL RELPERM_VECTOR(NX,NY,NZ,S,MW,MO,DMW,DMO)
        integer_tape(integer_tape_pointer) = NX
        integer_tape_pointer = integer_tape_pointer+1
        integer_tape(integer_tape_pointer) = NY
        integer_tape_pointer = integer_tape_pointer+1
        integer_tape(integer_tape_pointer) = NZ
        integer_tape_pointer = integer_tape_pointer+1
!!! requested inline of 'oad_AllocateMatching' has no defn
        CALL oad_AllocateMatching(OpenAD_aux_0,MW(1:NZ*NX*NY))
        OpenAD_aux_0 = (MO(1:NZ*NX*NY)%v+MW(1:NZ*NX*NY)%v)
!!! requested inline of 'oad_AllocateMatching' has no defn
        CALL oad_AllocateMatching(OpenAD_aux_4,MW(1:NZ*NX*NY))
        OpenAD_aux_4 = (MO(1:NZ*NX*NY)%v+MW(1:NZ*NX*NY)%v)
!!! requested inline of 'oad_AllocateMatching' has no defn
        CALL oad_AllocateMatching(OpenAD_aux_3,MW(1:NZ*NX*NY))
        OpenAD_aux_3 = (OpenAD_aux_4**2)
!!! requested inline of 'oad_AllocateMatching' has no defn
        CALL oad_AllocateMatching(OpenAD_aux_1,MW(1:NZ*NX*NY))
        OpenAD_aux_1 = (MW(1:NZ*NX*NY)%v/OpenAD_aux_3)
!!! requested inline of 'oad_AllocateMatching' has no defn
        CALL oad_AllocateMatching(OpenAD_aux_2,DMW(1:NZ*NX*NY))
        OpenAD_aux_2 = (DMO(1:NZ*NX*NY)%v+DMW(1:NZ*NX*NY)%v)
!!! requested inline of 'oad_AllocateMatching' has no defn
        CALL oad_AllocateMatching(OpenAD_lin_9,OpenAD_aux_0)
        OpenAD_lin_9 = (INT(1_w2f__i8)/OpenAD_aux_0)
!!! requested inline of 'oad_AllocateMatching' has no defn
        CALL oad_AllocateMatching(OpenAD_lin_10,OpenAD_aux_0)
        OpenAD_lin_10 = (-(DMW(1:NZ*NX*NY)%v/(OpenAD_aux_0*OpenAD_aux_0)))
!!! requested inline of 'oad_AllocateMatching' has no defn
        CALL oad_AllocateMatching(OpenAD_lin_13,OpenAD_aux_3)
        OpenAD_lin_13 = (INT(1_w2f__i8)/OpenAD_aux_3)
!!! requested inline of 'oad_AllocateMatching' has no defn
        CALL oad_AllocateMatching(OpenAD_lin_15,OpenAD_aux_4)
        OpenAD_lin_15 = (2*(OpenAD_aux_4**(2-INT(1_w2f__i8))))
!!! requested inline of 'oad_AllocateMatching' has no defn
        CALL oad_AllocateMatching(OpenAD_lin_14,OpenAD_aux_3)
        OpenAD_lin_14 = (-(MW(1:NZ*NX*NY)%v/(OpenAD_aux_3*OpenAD_aux_3)))
!!! requested inline of 'oad_AllocateMatching' has no defn
        CALL oad_AllocateMatching(OpenAD_lin_11,OpenAD_aux_2)
        OpenAD_lin_11 = OpenAD_aux_2
!!! requested inline of 'oad_AllocateMatching' has no defn
        CALL oad_AllocateMatching(OpenAD_lin_12,OpenAD_aux_1)
        OpenAD_lin_12 = OpenAD_aux_1
        DF(1:NZ*NX*NY)%v = ((DMW(1:NZ*NX*NY)%v/OpenAD_aux_0)-OpenAD_aux_1*OpenAD&
     &_aux_2)

!!! requested inline of 'oad_AllocateMatching' has no defn
        CALL oad_AllocateMatching(OpenAD_acc_0,OpenAD_lin_12)
!!! requested inline of 'oad_AllocateMatching' has no defn
        CALL oad_AllocateMatching(OpenAD_acc_1,OpenAD_lin_11)
!!! requested inline of 'oad_AllocateMatching' has no defn
        CALL oad_AllocateMatching(OpenAD_acc_2,OpenAD_lin_11)
        OpenAD_acc_0 = (OpenAD_lin_12*INT((-1_w2f__i8)))
        OpenAD_acc_1 = (OpenAD_lin_13*OpenAD_lin_11*INT((-1_w2f__i8)))
        OpenAD_acc_2 = (OpenAD_lin_15*OpenAD_lin_14*OpenAD_lin_11*INT((-1_w2f__i&
     &8)))

        OpenAD_Symbol_332 = (NZ*NX*NY)
        integer_tape(integer_tape_pointer) = OpenAD_Symbol_332
        integer_tape_pointer = integer_tape_pointer+1
        OpenAD_Symbol_333 = (NZ*NX*NY)
        integer_tape(integer_tape_pointer) = OpenAD_Symbol_333
        integer_tape_pointer = integer_tape_pointer+1
        OpenAD_Symbol_334 = (NZ*NX*NY)
        integer_tape(integer_tape_pointer) = OpenAD_Symbol_334
        integer_tape_pointer = integer_tape_pointer+1
        OpenAD_Symbol_335 = (NZ*NX*NY)
        integer_tape(integer_tape_pointer) = OpenAD_Symbol_335
        integer_tape_pointer = integer_tape_pointer+1
        OpenAD_Symbol_336 = (NZ*NX*NY)
        integer_tape(integer_tape_pointer) = OpenAD_Symbol_336
        integer_tape_pointer = integer_tape_pointer+1
        OpenAD_Symbol_337 = (NZ*NX*NY)
        integer_tape(integer_tape_pointer) = OpenAD_Symbol_337
        integer_tape_pointer = integer_tape_pointer+1
        OpenAD_Symbol_338 = SIZE(OpenAD_lin_9,1_w2f__i8)
        integer_tape(integer_tape_pointer) = OpenAD_Symbol_338
        integer_tape_pointer = integer_tape_pointer+1
        double_tape(double_tape_pointer:double_tape_pointer+size(OpenAD_lin_9,1)&
     &-1) = OpenAD_lin_9(:)

        double_tape_pointer = double_tape_pointer+size(OpenAD_lin_9,1)
        OpenAD_Symbol_340 = (NZ*NX*NY)
        integer_tape(integer_tape_pointer) = OpenAD_Symbol_340
        integer_tape_pointer = integer_tape_pointer+1
        OpenAD_Symbol_341 = (NZ*NX*NY)
        integer_tape(integer_tape_pointer) = OpenAD_Symbol_341
        integer_tape_pointer = integer_tape_pointer+1
        OpenAD_Symbol_342 = SIZE(OpenAD_lin_10,1_w2f__i8)
        integer_tape(integer_tape_pointer) = OpenAD_Symbol_342
        integer_tape_pointer = integer_tape_pointer+1
        double_tape(double_tape_pointer:double_tape_pointer+size(OpenAD_lin_10,1&
     &)-1) = OpenAD_lin_10(:)

        double_tape_pointer = double_tape_pointer+size(OpenAD_lin_10,1)
        OpenAD_Symbol_344 = (NZ*NX*NY)
        integer_tape(integer_tape_pointer) = OpenAD_Symbol_344
        integer_tape_pointer = integer_tape_pointer+1
        OpenAD_Symbol_345 = SIZE(OpenAD_acc_0,1_w2f__i8)
        integer_tape(integer_tape_pointer) = OpenAD_Symbol_345
        integer_tape_pointer = integer_tape_pointer+1
        double_tape(double_tape_pointer:double_tape_pointer+size(OpenAD_acc_0,1)&
     &-1) = OpenAD_acc_0(:)

        double_tape_pointer = double_tape_pointer+size(OpenAD_acc_0,1)
        OpenAD_Symbol_347 = (NZ*NX*NY)
        integer_tape(integer_tape_pointer) = OpenAD_Symbol_347
        integer_tape_pointer = integer_tape_pointer+1
        OpenAD_Symbol_348 = SIZE(OpenAD_acc_1,1_w2f__i8)
        integer_tape(integer_tape_pointer) = OpenAD_Symbol_348
        integer_tape_pointer = integer_tape_pointer+1
        double_tape(double_tape_pointer:double_tape_pointer+size(OpenAD_acc_1,1)&
     &-1) = OpenAD_acc_1(:)

        double_tape_pointer = double_tape_pointer+size(OpenAD_acc_1,1)
        OpenAD_Symbol_350 = (NZ*NX*NY)
        integer_tape(integer_tape_pointer) = OpenAD_Symbol_350
        integer_tape_pointer = integer_tape_pointer+1
        OpenAD_Symbol_351 = (NZ*NX*NY)
        integer_tape(integer_tape_pointer) = OpenAD_Symbol_351
        integer_tape_pointer = integer_tape_pointer+1
        OpenAD_Symbol_352 = SIZE(OpenAD_acc_2,1_w2f__i8)
        integer_tape(integer_tape_pointer) = OpenAD_Symbol_352
        integer_tape_pointer = integer_tape_pointer+1
        double_tape(double_tape_pointer:double_tape_pointer+size(OpenAD_acc_2,1)&
     &-1) = OpenAD_acc_2(:)

        double_tape_pointer = double_tape_pointer+size(OpenAD_acc_2,1)
        OpenAD_Symbol_354 = (NZ*NX*NY)
        integer_tape(integer_tape_pointer) = OpenAD_Symbol_354
        integer_tape_pointer = integer_tape_pointer+1
        CALL SPMAT_MULTIPLY_DIAGONAL(N,BNNZ,BROW_INDEX,BROW_COMPRESSED,BCOL_INDE&
     &X,BVALUES,DF,DGNNZ,DGROW_INDEX,DGROW_COMPRESSED,DGCOL_INDEX,DGVALUES,'PRE'&
     &)

        integer_tape(integer_tape_pointer) = N
        integer_tape_pointer = integer_tape_pointer+1
        OAD_CTMP1 = (-1.0D00)
        OAD_CTMP2 = 0
        CALL ADDX_DIAGONAL(N,DGNNZ,DGROW_INDEX,DGROW_COMPRESSED,DGCOL_INDEX,DGVA&
     &LUES,OAD_CTMP1,OAD_CTMP2)

        integer_tape(integer_tape_pointer) = N
        integer_tape_pointer = integer_tape_pointer+1
!!! requested inline of 'oad_AllocateMatching' has no defn
        CALL oad_AllocateMatching(OpenAD_aux_5,MW(1:NZ*NX*NY))
        OpenAD_aux_5 = (MO(1:NZ*NX*NY)%v+MW(1:NZ*NX*NY)%v)
!!! requested inline of 'oad_AllocateMatching' has no defn
        CALL oad_AllocateMatching(OpenAD_lin_16,OpenAD_aux_5)
        OpenAD_lin_16 = (INT(1_w2f__i8)/OpenAD_aux_5)
!!! requested inline of 'oad_AllocateMatching' has no defn
        CALL oad_AllocateMatching(OpenAD_lin_17,OpenAD_aux_5)
        OpenAD_lin_17 = (-(MW(1:NZ*NX*NY)%v/(OpenAD_aux_5*OpenAD_aux_5)))
        FW(1:NZ*NX*NY)%v = (MW(1:NZ*NX*NY)%v/OpenAD_aux_5)
        OpenAD_Symbol_355 = (NZ*NX*NY)
        integer_tape(integer_tape_pointer) = OpenAD_Symbol_355
        integer_tape_pointer = integer_tape_pointer+1
        OpenAD_Symbol_356 = (NZ*NX*NY)
        integer_tape(integer_tape_pointer) = OpenAD_Symbol_356
        integer_tape_pointer = integer_tape_pointer+1
        OpenAD_Symbol_357 = SIZE(OpenAD_lin_16,1_w2f__i8)
        integer_tape(integer_tape_pointer) = OpenAD_Symbol_357
        integer_tape_pointer = integer_tape_pointer+1
        double_tape(double_tape_pointer:double_tape_pointer+size(OpenAD_lin_16,1&
     &)-1) = OpenAD_lin_16(:)

        double_tape_pointer = double_tape_pointer+size(OpenAD_lin_16,1)
        OpenAD_Symbol_359 = (NZ*NX*NY)
        integer_tape(integer_tape_pointer) = OpenAD_Symbol_359
        integer_tape_pointer = integer_tape_pointer+1
        OpenAD_Symbol_360 = (NZ*NX*NY)
        integer_tape(integer_tape_pointer) = OpenAD_Symbol_360
        integer_tape_pointer = integer_tape_pointer+1
        OpenAD_Symbol_361 = SIZE(OpenAD_lin_17,1_w2f__i8)
        integer_tape(integer_tape_pointer) = OpenAD_Symbol_361
        integer_tape_pointer = integer_tape_pointer+1
        double_tape(double_tape_pointer:double_tape_pointer+size(OpenAD_lin_17,1&
     &)-1) = OpenAD_lin_17(:)

        double_tape_pointer = double_tape_pointer+size(OpenAD_lin_17,1)
        OpenAD_Symbol_363 = (NZ*NX*NY)
        integer_tape(integer_tape_pointer) = OpenAD_Symbol_363
        integer_tape_pointer = integer_tape_pointer+1
        CALL SPMAT_MULTIPLY_VECTOR(N,BNNZ,BROW_INDEX,BROW_COMPRESSED,BCOL_INDEX,&
     &BVALUES,FW,BFW,'PRE')

        integer_tape(integer_tape_pointer) = N
        integer_tape_pointer = integer_tape_pointer+1
        G(1:NZ*NX*NY)%v = (S(1:NZ*NX*NY)%v-S_ITER_COPY(1:NZ*NX*NY)%v-BFW(1:NZ*NX&
     &*NY)%v-FI(1:NZ*NX*NY)%v)

        OpenAD_Symbol_364 = (NZ*NX*NY)
        integer_tape(integer_tape_pointer) = OpenAD_Symbol_364
        integer_tape_pointer = integer_tape_pointer+1
        OpenAD_Symbol_365 = (NZ*NX*NY)
        integer_tape(integer_tape_pointer) = OpenAD_Symbol_365
        integer_tape_pointer = integer_tape_pointer+1
        OpenAD_Symbol_366 = (NZ*NX*NY)
        integer_tape(integer_tape_pointer) = OpenAD_Symbol_366
        integer_tape_pointer = integer_tape_pointer+1
        OpenAD_Symbol_367 = (NZ*NX*NY)
        integer_tape(integer_tape_pointer) = OpenAD_Symbol_367
        integer_tape_pointer = integer_tape_pointer+1
        OpenAD_Symbol_368 = (NZ*NX*NY)
        integer_tape(integer_tape_pointer) = OpenAD_Symbol_368
        integer_tape_pointer = integer_tape_pointer+1
        OpenAD_Symbol_369 = (NZ*NX*NY)
        integer_tape(integer_tape_pointer) = OpenAD_Symbol_369
        integer_tape_pointer = integer_tape_pointer+1
        OpenAD_Symbol_370 = (NZ*NX*NY)
        integer_tape(integer_tape_pointer) = OpenAD_Symbol_370
        integer_tape_pointer = integer_tape_pointer+1
        OpenAD_Symbol_371 = (NZ*NX*NY)
        integer_tape(integer_tape_pointer) = OpenAD_Symbol_371
        integer_tape_pointer = integer_tape_pointer+1
        CALL SPARSE_SOLVE(N,DGNNZ,DGROW_INDEX,DGROW_COMPRESSED,DGCOL_INDEX,DGVAL&
     &UES,G,DS)

        integer_tape(integer_tape_pointer) = N
        integer_tape_pointer = integer_tape_pointer+1
        S(1:NZ*NX*NY)%v = (S(1:NZ*NX*NY)%v+DS(1:NZ*NX*NY)%v)
        OpenAD_Symbol_372 = (NZ*NX*NY)
        integer_tape(integer_tape_pointer) = OpenAD_Symbol_372
        integer_tape_pointer = integer_tape_pointer+1
        OpenAD_Symbol_373 = (NZ*NX*NY)
        integer_tape(integer_tape_pointer) = OpenAD_Symbol_373
        integer_tape_pointer = integer_tape_pointer+1
        OpenAD_Symbol_374 = (NZ*NX*NY)
        integer_tape(integer_tape_pointer) = OpenAD_Symbol_374
        integer_tape_pointer = integer_tape_pointer+1
        OpenAD_Symbol_375 = (NZ*NX*NY)
        integer_tape(integer_tape_pointer) = OpenAD_Symbol_375
        integer_tape_pointer = integer_tape_pointer+1
!!! requested inline of 'oad_AllocateMatching' has no defn
        CALL oad_AllocateMatching(OpenAD_tyc_1,DS)
!!! requested inline of 'oad_convert' has no defn
        CALL oad_convert(OpenAD_tyc_1,DS)
        CALL DNRM2(OpenAD_tyc_1,N,DSN)
!!! requested inline of 'oad_ShapeTest' has no defn
        CALL oad_ShapeTest(OpenAD_tyc_1,DS)
!!! requested inline of 'oad_convert' has no defn
        CALL oad_convert(DS,OpenAD_tyc_1)
        integer_tape(integer_tape_pointer) = N
        integer_tape_pointer = integer_tape_pointer+1
        J = (J+1)
        OpenAD_Symbol_304 = (INT(OpenAD_Symbol_304)+INT(1_w2f__i8))
      END DO
      integer_tape(integer_tape_pointer) = OpenAD_Symbol_304
      integer_tape_pointer = integer_tape_pointer+1
      IF (DSN.GT.1.00000000000000002082D-03) THEN
        I = (2**IT)
        S(1:NZ*NX*NY)%v = S_COPY(1:NZ*NX*NY)%v
        OpenAD_Symbol_376 = (NZ*NX*NY)
        integer_tape(integer_tape_pointer) = OpenAD_Symbol_376
        integer_tape_pointer = integer_tape_pointer+1
        OpenAD_Symbol_377 = (NZ*NX*NY)
        integer_tape(integer_tape_pointer) = OpenAD_Symbol_377
        integer_tape_pointer = integer_tape_pointer+1
        OpenAD_Symbol_305 = 1_w2f__i8
        integer_tape(integer_tape_pointer) = OpenAD_Symbol_305
        integer_tape_pointer = integer_tape_pointer+1
      ELSE
        OpenAD_Symbol_306 = 0_w2f__i8
        integer_tape(integer_tape_pointer) = OpenAD_Symbol_306
        integer_tape_pointer = integer_tape_pointer+1
      ENDIF
      OpenAD_Symbol_303 = (INT(OpenAD_Symbol_303)+INT(1_w2f__i8))
    END DO
    integer_tape(integer_tape_pointer) = OpenAD_Symbol_303
    integer_tape_pointer = integer_tape_pointer+1
    IF (DSN.LT.1.00000000000000002082D-03) THEN
      CONVERGED = .TRUE.
      OpenAD_Symbol_307 = 1_w2f__i8
      integer_tape(integer_tape_pointer) = OpenAD_Symbol_307
      integer_tape_pointer = integer_tape_pointer+1
    ELSE
      IT = (IT+1)
      OpenAD_Symbol_308 = 0_w2f__i8
      integer_tape(integer_tape_pointer) = OpenAD_Symbol_308
      integer_tape_pointer = integer_tape_pointer+1
    ENDIF
    OpenAD_Symbol_302 = (INT(OpenAD_Symbol_302)+INT(1_w2f__i8))
  END DO
  integer_tape(integer_tape_pointer) = OpenAD_Symbol_302
  integer_tape_pointer = integer_tape_pointer+1
    end if
    if (our_rev_mode%adjoint) then
! adjoint
  integer_tape_pointer = integer_tape_pointer-1
  OpenAD_Symbol_294 = integer_tape(integer_tape_pointer)
  OpenAD_Symbol_295 = 1
  do while (INT(OpenAD_Symbol_295).LE.INT(OpenAD_Symbol_294))
    integer_tape_pointer = integer_tape_pointer-1
    OpenAD_Symbol_296 = integer_tape(integer_tape_pointer)
    IF (OpenAD_Symbol_296.ne.0) THEN
    ENDIF
    integer_tape_pointer = integer_tape_pointer-1
    OpenAD_Symbol_297 = integer_tape(integer_tape_pointer)
    OpenAD_Symbol_298 = 1
    do while (INT(OpenAD_Symbol_298).LE.INT(OpenAD_Symbol_297))
      integer_tape_pointer = integer_tape_pointer-1
      OpenAD_Symbol_299 = integer_tape(integer_tape_pointer)
      IF (OpenAD_Symbol_299.ne.0) THEN
        integer_tape_pointer = integer_tape_pointer-1
        OpenAD_Symbol_1003 = integer_tape(integer_tape_pointer)
        integer_tape_pointer = integer_tape_pointer-1
        OpenAD_Symbol_1004 = integer_tape(integer_tape_pointer)
        S_COPY(1:OpenAD_Symbol_1004)%d = S_COPY(1:OpenAD_Symbol_1004)%d+S(1:Open&
     &AD_Symbol_1003)%d

        S(1:OpenAD_Symbol_1003)%d = 0.0d0
      ENDIF
      integer_tape_pointer = integer_tape_pointer-1
      OpenAD_Symbol_300 = integer_tape(integer_tape_pointer)
      OpenAD_Symbol_301 = 1
      do while (INT(OpenAD_Symbol_301).LE.INT(OpenAD_Symbol_300))
        integer_tape_pointer = integer_tape_pointer-1
        N = integer_tape(integer_tape_pointer)
!!! requested inline of 'oad_AllocateMatching' has no defn
        CALL oad_AllocateMatching(OpenAD_tyc_7,DS)
        CALL DNRM2(OpenAD_tyc_7,N,DSN)
!!! requested inline of 'oad_AllocateMatching' has no defn
        CALL oad_AllocateMatching(OpenAD_prp_10,S(1:NZ*NX*NY))
        integer_tape_pointer = integer_tape_pointer-1
        OpenAD_Symbol_952 = integer_tape(integer_tape_pointer)
        integer_tape_pointer = integer_tape_pointer-1
        OpenAD_Symbol_953 = integer_tape(integer_tape_pointer)
        DS(1:OpenAD_Symbol_953)%d = DS(1:OpenAD_Symbol_953)%d+S(1:OpenAD_Symbol_&
     &952)%d

        integer_tape_pointer = integer_tape_pointer-1
        OpenAD_Symbol_954 = integer_tape(integer_tape_pointer)
        OpenAD_prp_10%d = OpenAD_prp_10%d+S(1:OpenAD_Symbol_954)%d
        S(1:OpenAD_Symbol_954)%d = 0.0d0
        integer_tape_pointer = integer_tape_pointer-1
        OpenAD_Symbol_955 = integer_tape(integer_tape_pointer)
        S(1:OpenAD_Symbol_955)%d = S(1:OpenAD_Symbol_955)%d+OpenAD_prp_10%d
        OpenAD_prp_10%d = 0.0d0
        integer_tape_pointer = integer_tape_pointer-1
        N = integer_tape(integer_tape_pointer)
        CALL SPARSE_SOLVE(N,DGNNZ,DGROW_INDEX,DGROW_COMPRESSED,DGCOL_INDEX,DGVAL&
     &UES,G,DS)

        integer_tape_pointer = integer_tape_pointer-1
        OpenAD_Symbol_956 = integer_tape(integer_tape_pointer)
        integer_tape_pointer = integer_tape_pointer-1
        OpenAD_Symbol_957 = integer_tape(integer_tape_pointer)
        S_ITER_COPY(1:OpenAD_Symbol_957)%d = S_ITER_COPY(1:OpenAD_Symbol_957)%d-&
     &G(1:OpenAD_Symbol_956)%d

        integer_tape_pointer = integer_tape_pointer-1
        OpenAD_Symbol_958 = integer_tape(integer_tape_pointer)
        integer_tape_pointer = integer_tape_pointer-1
        OpenAD_Symbol_959 = integer_tape(integer_tape_pointer)
        BFW(1:OpenAD_Symbol_959)%d = BFW(1:OpenAD_Symbol_959)%d-G(1:OpenAD_Symbo&
     &l_958)%d

        integer_tape_pointer = integer_tape_pointer-1
        OpenAD_Symbol_960 = integer_tape(integer_tape_pointer)
        integer_tape_pointer = integer_tape_pointer-1
        OpenAD_Symbol_961 = integer_tape(integer_tape_pointer)
        FI(1:OpenAD_Symbol_961)%d = FI(1:OpenAD_Symbol_961)%d-G(1:OpenAD_Symbol_&
     &960)%d

        integer_tape_pointer = integer_tape_pointer-1
        OpenAD_Symbol_962 = integer_tape(integer_tape_pointer)
        integer_tape_pointer = integer_tape_pointer-1
        OpenAD_Symbol_963 = integer_tape(integer_tape_pointer)
        S(1:OpenAD_Symbol_963)%d = S(1:OpenAD_Symbol_963)%d+G(1:OpenAD_Symbol_96&
     &2)%d

        G(1:OpenAD_Symbol_962)%d = 0.0d0
        integer_tape_pointer = integer_tape_pointer-1
        N = integer_tape(integer_tape_pointer)
        CALL SPMAT_MULTIPLY_VECTOR(N,BNNZ,BROW_INDEX,BROW_COMPRESSED,BCOL_INDEX,&
     &BVALUES,FW,BFW,'PRE')

        integer_tape_pointer = integer_tape_pointer-1
        OpenAD_Symbol_965 = integer_tape(integer_tape_pointer)
!!! requested inline of 'oad_AllocateShape' has no defn
        CALL oad_AllocateShape(OpenAD_Symbol_964,OpenAD_Symbol_965)
        double_tape_pointer = double_tape_pointer-size(OpenAD_Symbol_964,1)
        OpenAD_Symbol_964(:) = double_tape(double_tape_pointer:double_tape_point&
     &er+size(OpenAD_Symbol_964,1)-1)

        integer_tape_pointer = integer_tape_pointer-1
        OpenAD_Symbol_968 = integer_tape(integer_tape_pointer)
!!! requested inline of 'oad_AllocateShape' has no defn
        CALL oad_AllocateShape(OpenAD_Symbol_967,OpenAD_Symbol_968)
        double_tape_pointer = double_tape_pointer-size(OpenAD_Symbol_967,1)
        OpenAD_Symbol_967(:) = double_tape(double_tape_pointer:double_tape_point&
     &er+size(OpenAD_Symbol_967,1)-1)

!!! requested inline of 'oad_AllocateMatching' has no defn
        CALL oad_AllocateMatching(OpenAD_prp_9,MO(1:NZ*NX*NY))
        integer_tape_pointer = integer_tape_pointer-1
        OpenAD_Symbol_970 = integer_tape(integer_tape_pointer)
        OpenAD_prp_9%d = OpenAD_prp_9%d+FW(1:OpenAD_Symbol_970)%d*(OpenAD_Symbol&
     &_964)

        integer_tape_pointer = integer_tape_pointer-1
        OpenAD_Symbol_971 = integer_tape(integer_tape_pointer)
        integer_tape_pointer = integer_tape_pointer-1
        OpenAD_Symbol_972 = integer_tape(integer_tape_pointer)
        MW(1:OpenAD_Symbol_972)%d = MW(1:OpenAD_Symbol_972)%d+FW(1:OpenAD_Symbol&
     &_971)%d*(OpenAD_Symbol_967)

        FW(1:OpenAD_Symbol_971)%d = 0.0d0
        integer_tape_pointer = integer_tape_pointer-1
        OpenAD_Symbol_973 = integer_tape(integer_tape_pointer)
        MW(1:OpenAD_Symbol_973)%d = MW(1:OpenAD_Symbol_973)%d+OpenAD_prp_9%d
        integer_tape_pointer = integer_tape_pointer-1
        OpenAD_Symbol_974 = integer_tape(integer_tape_pointer)
        MO(1:OpenAD_Symbol_974)%d = MO(1:OpenAD_Symbol_974)%d+OpenAD_prp_9%d
        OpenAD_prp_9%d = 0.0d0
        integer_tape_pointer = integer_tape_pointer-1
        N = integer_tape(integer_tape_pointer)
        CALL ADDX_DIAGONAL(N,DGNNZ,DGROW_INDEX,DGROW_COMPRESSED,DGCOL_INDEX,DGVA&
     &LUES,OAD_CTMP1,OAD_CTMP2)

        integer_tape_pointer = integer_tape_pointer-1
        N = integer_tape(integer_tape_pointer)
        CALL SPMAT_MULTIPLY_DIAGONAL(N,BNNZ,BROW_INDEX,BROW_COMPRESSED,BCOL_INDE&
     &X,BVALUES,DF,DGNNZ,DGROW_INDEX,DGROW_COMPRESSED,DGCOL_INDEX,DGVALUES,'PRE'&
     &)

        integer_tape_pointer = integer_tape_pointer-1
        OpenAD_Symbol_976 = integer_tape(integer_tape_pointer)
!!! requested inline of 'oad_AllocateShape' has no defn
        CALL oad_AllocateShape(OpenAD_Symbol_975,OpenAD_Symbol_976)
        double_tape_pointer = double_tape_pointer-size(OpenAD_Symbol_975,1)
        OpenAD_Symbol_975(:) = double_tape(double_tape_pointer:double_tape_point&
     &er+size(OpenAD_Symbol_975,1)-1)

        integer_tape_pointer = integer_tape_pointer-1
        OpenAD_Symbol_979 = integer_tape(integer_tape_pointer)
!!! requested inline of 'oad_AllocateShape' has no defn
        CALL oad_AllocateShape(OpenAD_Symbol_978,OpenAD_Symbol_979)
        double_tape_pointer = double_tape_pointer-size(OpenAD_Symbol_978,1)
        OpenAD_Symbol_978(:) = double_tape(double_tape_pointer:double_tape_point&
     &er+size(OpenAD_Symbol_978,1)-1)

        integer_tape_pointer = integer_tape_pointer-1
        OpenAD_Symbol_982 = integer_tape(integer_tape_pointer)
!!! requested inline of 'oad_AllocateShape' has no defn
        CALL oad_AllocateShape(OpenAD_Symbol_981,OpenAD_Symbol_982)
        double_tape_pointer = double_tape_pointer-size(OpenAD_Symbol_981,1)
        OpenAD_Symbol_981(:) = double_tape(double_tape_pointer:double_tape_point&
     &er+size(OpenAD_Symbol_981,1)-1)

        integer_tape_pointer = integer_tape_pointer-1
        OpenAD_Symbol_985 = integer_tape(integer_tape_pointer)
!!! requested inline of 'oad_AllocateShape' has no defn
        CALL oad_AllocateShape(OpenAD_Symbol_984,OpenAD_Symbol_985)
        double_tape_pointer = double_tape_pointer-size(OpenAD_Symbol_984,1)
        OpenAD_Symbol_984(:) = double_tape(double_tape_pointer:double_tape_point&
     &er+size(OpenAD_Symbol_984,1)-1)

        integer_tape_pointer = integer_tape_pointer-1
        OpenAD_Symbol_988 = integer_tape(integer_tape_pointer)
!!! requested inline of 'oad_AllocateShape' has no defn
        CALL oad_AllocateShape(OpenAD_Symbol_987,OpenAD_Symbol_988)
        double_tape_pointer = double_tape_pointer-size(OpenAD_Symbol_987,1)
        OpenAD_Symbol_987(:) = double_tape(double_tape_pointer:double_tape_point&
     &er+size(OpenAD_Symbol_987,1)-1)

!!! requested inline of 'oad_AllocateMatching' has no defn
        CALL oad_AllocateMatching(OpenAD_prp_6,MO(1:NZ*NX*NY))
!!! requested inline of 'oad_AllocateMatching' has no defn
        CALL oad_AllocateMatching(OpenAD_prp_7,MO(1:NZ*NX*NY))
!!! requested inline of 'oad_AllocateMatching' has no defn
        CALL oad_AllocateMatching(OpenAD_prp_8,DMO(1:NZ*NX*NY))
        integer_tape_pointer = integer_tape_pointer-1
        OpenAD_Symbol_990 = integer_tape(integer_tape_pointer)
        OpenAD_prp_7%d = OpenAD_prp_7%d+DF(1:OpenAD_Symbol_990)%d*(OpenAD_Symbol&
     &_975)

        integer_tape_pointer = integer_tape_pointer-1
        OpenAD_Symbol_991 = integer_tape(integer_tape_pointer)
        integer_tape_pointer = integer_tape_pointer-1
        OpenAD_Symbol_992 = integer_tape(integer_tape_pointer)
        MW(1:OpenAD_Symbol_992)%d = MW(1:OpenAD_Symbol_992)%d+DF(1:OpenAD_Symbol&
     &_991)%d*(OpenAD_Symbol_978)

        integer_tape_pointer = integer_tape_pointer-1
        OpenAD_Symbol_993 = integer_tape(integer_tape_pointer)
        OpenAD_prp_8%d = OpenAD_prp_8%d+DF(1:OpenAD_Symbol_993)%d*(OpenAD_Symbol&
     &_981)

        integer_tape_pointer = integer_tape_pointer-1
        OpenAD_Symbol_994 = integer_tape(integer_tape_pointer)
        OpenAD_prp_6%d = OpenAD_prp_6%d+DF(1:OpenAD_Symbol_994)%d*(OpenAD_Symbol&
     &_984)

        integer_tape_pointer = integer_tape_pointer-1
        OpenAD_Symbol_995 = integer_tape(integer_tape_pointer)
        integer_tape_pointer = integer_tape_pointer-1
        OpenAD_Symbol_996 = integer_tape(integer_tape_pointer)
        DMW(1:OpenAD_Symbol_996)%d = DMW(1:OpenAD_Symbol_996)%d+DF(1:OpenAD_Symb&
     &ol_995)%d*(OpenAD_Symbol_987)

        DF(1:OpenAD_Symbol_995)%d = 0.0d0
        integer_tape_pointer = integer_tape_pointer-1
        OpenAD_Symbol_997 = integer_tape(integer_tape_pointer)
        DMW(1:OpenAD_Symbol_997)%d = DMW(1:OpenAD_Symbol_997)%d+OpenAD_prp_8%d
        integer_tape_pointer = integer_tape_pointer-1
        OpenAD_Symbol_998 = integer_tape(integer_tape_pointer)
        DMO(1:OpenAD_Symbol_998)%d = DMO(1:OpenAD_Symbol_998)%d+OpenAD_prp_8%d
        OpenAD_prp_8%d = 0.0d0
        integer_tape_pointer = integer_tape_pointer-1
        OpenAD_Symbol_999 = integer_tape(integer_tape_pointer)
        MW(1:OpenAD_Symbol_999)%d = MW(1:OpenAD_Symbol_999)%d+OpenAD_prp_7%d
        integer_tape_pointer = integer_tape_pointer-1
        OpenAD_Symbol_1000 = integer_tape(integer_tape_pointer)
        MO(1:OpenAD_Symbol_1000)%d = MO(1:OpenAD_Symbol_1000)%d+OpenAD_prp_7%d
        OpenAD_prp_7%d = 0.0d0
        integer_tape_pointer = integer_tape_pointer-1
        OpenAD_Symbol_1001 = integer_tape(integer_tape_pointer)
        MW(1:OpenAD_Symbol_1001)%d = MW(1:OpenAD_Symbol_1001)%d+OpenAD_prp_6%d
        integer_tape_pointer = integer_tape_pointer-1
        OpenAD_Symbol_1002 = integer_tape(integer_tape_pointer)
        MO(1:OpenAD_Symbol_1002)%d = MO(1:OpenAD_Symbol_1002)%d+OpenAD_prp_6%d
        OpenAD_prp_6%d = 0.0d0
        integer_tape_pointer = integer_tape_pointer-1
        NZ = integer_tape(integer_tape_pointer)
        integer_tape_pointer = integer_tape_pointer-1
        NY = integer_tape(integer_tape_pointer)
        integer_tape_pointer = integer_tape_pointer-1
        NX = integer_tape(integer_tape_pointer)
        CALL RELPERM_VECTOR(NX,NY,NZ,S,MW,MO,DMW,DMO)
        OpenAD_Symbol_301 = INT(OpenAD_Symbol_301)+1
      END DO
      integer_tape_pointer = integer_tape_pointer-1
      OpenAD_Symbol_950 = integer_tape(integer_tape_pointer)
      integer_tape_pointer = integer_tape_pointer-1
      OpenAD_Symbol_951 = integer_tape(integer_tape_pointer)
      S(1:OpenAD_Symbol_951)%d = S(1:OpenAD_Symbol_951)%d+S_ITER_COPY(1:OpenAD_S&
     &ymbol_950)%d

      S_ITER_COPY(1:OpenAD_Symbol_950)%d = 0.0d0
      OpenAD_Symbol_298 = INT(OpenAD_Symbol_298)+1
    END DO
    integer_tape_pointer = integer_tape_pointer-1
    N = integer_tape(integer_tape_pointer)
!!! requested inline of 'oad_AllocateMatching' has no defn
    CALL oad_AllocateMatching(OpenAD_tyc_5,DTX)
    CALL SPMAT_MULTIPLY_DIAGONAL(N,ANNZ,AROW_INDEX,AROW_COMPRESSED,ACOL_INDEX,AV&
     &ALUES,OpenAD_tyc_5,BNNZ,BROW_INDEX,BROW_COMPRESSED,BCOL_INDEX,BVALUES,'POS&
     &')

    integer_tape_pointer = integer_tape_pointer-1
    OpenAD_Symbol_946 = integer_tape(integer_tape_pointer)
!!! requested inline of 'oad_AllocateShape' has no defn
    CALL oad_AllocateShape(OpenAD_Symbol_945,OpenAD_Symbol_946)
    double_tape_pointer = double_tape_pointer-size(OpenAD_Symbol_945,1)
    OpenAD_Symbol_945(:) = double_tape(double_tape_pointer:double_tape_pointer+s&
     &ize(OpenAD_Symbol_945,1)-1)

!!! requested inline of 'oad_AllocateMatching' has no defn
    CALL oad_AllocateMatching(OpenAD_prp_5,FI(1:NZ*NX*NY))
    integer_tape_pointer = integer_tape_pointer-1
    OpenAD_Symbol_948 = integer_tape(integer_tape_pointer)
    OpenAD_prp_5%d = OpenAD_prp_5%d+FI(1:OpenAD_Symbol_948)%d*(OpenAD_Symbol_945&
     &)

    FI(1:OpenAD_Symbol_948)%d = 0.0d0
    integer_tape_pointer = integer_tape_pointer-1
    OpenAD_Symbol_949 = integer_tape(integer_tape_pointer)
    FI(1:OpenAD_Symbol_949)%d = FI(1:OpenAD_Symbol_949)%d+OpenAD_prp_5%d
    OpenAD_prp_5%d = 0.0d0
    CALL MYMAX_1_0_DOUBLE(Q,OAD_CTMP0,FI)
    OpenAD_Symbol_295 = INT(OpenAD_Symbol_295)+1
  END DO
  integer_tape_pointer = integer_tape_pointer-1
  OpenAD_Symbol_943 = integer_tape(integer_tape_pointer)
  integer_tape_pointer = integer_tape_pointer-1
  OpenAD_Symbol_944 = integer_tape(integer_tape_pointer)
  S(1:OpenAD_Symbol_944)%d = S(1:OpenAD_Symbol_944)%d+S_COPY(1:OpenAD_Symbol_943&
     &)%d

  S_COPY(1:OpenAD_Symbol_943)%d = 0.0d0
  integer_tape_pointer = integer_tape_pointer-1
  NZ = integer_tape(integer_tape_pointer)
  integer_tape_pointer = integer_tape_pointer-1
  NY = integer_tape(integer_tape_pointer)
  integer_tape_pointer = integer_tape_pointer-1
  NX = integer_tape(integer_tape_pointer)
  CALL GENA(NX,NY,NZ,V,Q,ANNZ,AROW_INDEX,AROW_COMPRESSED,ACOL_INDEX,AVALUES)
    end if
  end subroutine NEWTRAPH
!#########################################################
! This file is part of OpenAD released under the LGPL.   #
! The full COPYRIGHT notice can be found in the top      #
! level directory of the OpenAD distribution             #
!#########################################################

  SUBROUTINE PRES(NX, NY, NZ, Q, S, P, V)
    use OAD_tape
    use OAD_rev

! original arguments get inserted before version
!         ! and declared here together with all local variables
!         ! generated by xaifBooster

  use w2f__types
  use parameters
  use parameters
  use parameters
  IMPLICIT NONE
!
!       **** Global Variables & Derived Type Definitions ****
!
  INTEGER(w2f__i8) OpenAD_Symbol_447
  INTEGER(w2f__i8) OpenAD_Symbol_448
  INTEGER(w2f__i8) OpenAD_Symbol_449
  INTEGER(w2f__i8) OpenAD_Symbol_450
  INTEGER(w2f__i8) OpenAD_Symbol_451
  INTEGER(w2f__i8) OpenAD_Symbol_452
  INTEGER(w2f__i8) OpenAD_Symbol_453
  INTEGER(w2f__i8) OpenAD_Symbol_454
  INTEGER(w2f__i8) OpenAD_Symbol_455
  INTEGER(w2f__i8) OpenAD_Symbol_456
  INTEGER(w2f__i8) OpenAD_Symbol_457
  INTEGER(w2f__i8) OpenAD_Symbol_458
  INTEGER(w2f__i8) OpenAD_Symbol_459
  INTEGER(w2f__i8) OpenAD_Symbol_460
  INTEGER(w2f__i8) OpenAD_Symbol_461
  INTEGER(w2f__i8) OpenAD_Symbol_462
  INTEGER(w2f__i8) OpenAD_Symbol_463
  INTEGER(w2f__i8) OpenAD_Symbol_464
  INTEGER(w2f__i8) OpenAD_Symbol_465
  INTEGER(w2f__i8) OpenAD_Symbol_466
  INTEGER(w2f__i8) OpenAD_Symbol_467
  INTEGER(w2f__i8) OpenAD_Symbol_468
  INTEGER(w2f__i8) OpenAD_Symbol_469
  INTEGER(w2f__i8) OpenAD_Symbol_470
  INTEGER(w2f__i8) OpenAD_Symbol_471
  INTEGER(w2f__i8) OpenAD_Symbol_472
  INTEGER(w2f__i8) OpenAD_Symbol_473
  INTEGER(w2f__i8) OpenAD_Symbol_474
  INTEGER(w2f__i8) OpenAD_Symbol_475
  INTEGER(w2f__i8) OpenAD_Symbol_476
!
!       **** Parameters and Result ****
!
  INTEGER(w2f__i4) NX
  INTEGER(w2f__i4) NY
  INTEGER(w2f__i4) NZ
  type(active) :: Q(1:INT((NZ*NX*NY)))
  type(active) :: S(1:INT((NZ*NX*NY)))
  type(active) :: P(1:NX,1:NY,1:NZ)
  type(active) :: V(1:3,1:INT((NX+1)),1:INT((NY+1)),1:INT((NZ+1)))
!
!       **** Local Variables and Functions ****
!
  INTEGER(w2f__i4) H
  INTEGER(w2f__i4) I
  INTEGER(w2f__i4) J
  type(active) :: KM(1:3,1:NX,1:NY,1:NZ)
  type(active) :: M(1:INT((NZ*NX*NY*3)))
  type(active) :: MO(1:INT((NZ*NX*NY)))
  type(active) :: MW(1:INT((NZ*NX*NY)))
  INTEGER(w2f__i4) N
  INTEGER(w2f__i4) OpenAD_Symbol_1079
  INTEGER(w2f__i4) OpenAD_Symbol_1080
  INTEGER(w2f__i4) OpenAD_Symbol_1081
  INTEGER(w2f__i4) OpenAD_Symbol_1082
  INTEGER(w2f__i4) OpenAD_Symbol_1083
  INTEGER(w2f__i4) OpenAD_Symbol_1084
  INTEGER(w2f__i4) OpenAD_Symbol_1085
  INTEGER(w2f__i4) OpenAD_Symbol_1086
  INTEGER(w2f__i4) OpenAD_Symbol_1087
  INTEGER(w2f__i4) OpenAD_Symbol_1088
  INTEGER(w2f__i4) OpenAD_Symbol_1089
  REAL(w2f__8) OpenAD_Symbol_1090
  INTEGER(w2f__i4) OpenAD_Symbol_477
  INTEGER(w2f__i4) OpenAD_Symbol_478
  INTEGER(w2f__i4) OpenAD_Symbol_479
  INTEGER(w2f__i4) OpenAD_Symbol_480
  INTEGER(w2f__i4) OpenAD_Symbol_481
  INTEGER(w2f__i4) OpenAD_Symbol_482
  REAL(w2f__8) OpenAD_lin_27
  type(active) :: OpenAD_prp_17
  type(active) :: OpenAD_prp_18
  type(active) :: OpenAD_prp_19


    integer iaddr
    external iaddr
!
!       **** Statements ****
!

   if (our_rev_mode%plain) then
! original function
  CALL RELPERM_VECTOR(NX,NY,NZ,S,MW,MO)
  DO I = 1,(NZ*NX*NY),1
    M(I*3+(-2))%v = (MO(I)%v+MW(I)%v)
    M(I*3+(-1))%v = M(I*3+(-2))%v
    M(I*3)%v = M(I*3+(-2))%v
  END DO
  CALL MYRESHAPE_1_4(M,KM)
  DO H = 1,3,1
    DO I = 1,NX,1
      DO J = 1,NY,1
        DO N = 1,NZ,1
          KM(INT(H),INT(I),INT(J),INT(N))%v = (KM(H,I,J,N)%v*PERM(H,I,J,N))
        END DO
      END DO
    END DO
  END DO
  CALL TPFA(NX,NY,NZ,KM,Q,P,V)
    end if
    if (our_rev_mode%tape) then
! taping
  CALL RELPERM_VECTOR(NX,NY,NZ,S,MW,MO)
  integer_tape(integer_tape_pointer) = NX
  integer_tape_pointer = integer_tape_pointer+1
  integer_tape(integer_tape_pointer) = NY
  integer_tape_pointer = integer_tape_pointer+1
  integer_tape(integer_tape_pointer) = NZ
  integer_tape_pointer = integer_tape_pointer+1
  OpenAD_Symbol_457 = 0_w2f__i8
  DO I = 1,(NZ*NX*NY),1
    M(I*3+(-2))%v = (MO(I)%v+MW(I)%v)
    OpenAD_Symbol_477 = (I*3+(-2))
    integer_tape(integer_tape_pointer) = OpenAD_Symbol_477
    integer_tape_pointer = integer_tape_pointer+1
    OpenAD_Symbol_478 = (I*3+(-2))
    integer_tape(integer_tape_pointer) = OpenAD_Symbol_478
    integer_tape_pointer = integer_tape_pointer+1
    integer_tape(integer_tape_pointer) = I
    integer_tape_pointer = integer_tape_pointer+1
    M(I*3+(-1))%v = M(I*3+(-2))%v
    OpenAD_Symbol_479 = (I*3+(-2))
    integer_tape(integer_tape_pointer) = OpenAD_Symbol_479
    integer_tape_pointer = integer_tape_pointer+1
    OpenAD_Symbol_480 = (I*3+(-1))
    integer_tape(integer_tape_pointer) = OpenAD_Symbol_480
    integer_tape_pointer = integer_tape_pointer+1
    M(I*3)%v = M(I*3+(-2))%v
    OpenAD_Symbol_481 = (I*3+(-2))
    integer_tape(integer_tape_pointer) = OpenAD_Symbol_481
    integer_tape_pointer = integer_tape_pointer+1
    OpenAD_Symbol_482 = (I*3)
    integer_tape(integer_tape_pointer) = OpenAD_Symbol_482
    integer_tape_pointer = integer_tape_pointer+1
    OpenAD_Symbol_457 = (INT(OpenAD_Symbol_457)+INT(1_w2f__i8))
  END DO
  integer_tape(integer_tape_pointer) = OpenAD_Symbol_457
  integer_tape_pointer = integer_tape_pointer+1
  CALL MYRESHAPE_1_4(M,KM)
  OpenAD_Symbol_458 = 0_w2f__i8
  DO H = 1,3,1
    OpenAD_Symbol_459 = 0_w2f__i8
    DO I = 1,NX,1
      OpenAD_Symbol_460 = 0_w2f__i8
      DO J = 1,NY,1
        OpenAD_Symbol_461 = 0_w2f__i8
        DO N = 1,NZ,1
          OpenAD_lin_27 = PERM(H,I,J,N)
          KM(INT(H),INT(I),INT(J),INT(N))%v = (KM(H,I,J,N)%v*PERM(H,I,J,N))
          double_tape(double_tape_pointer) = OpenAD_lin_27
          double_tape_pointer = double_tape_pointer+1
          integer_tape(integer_tape_pointer) = H
          integer_tape_pointer = integer_tape_pointer+1
          integer_tape(integer_tape_pointer) = I
          integer_tape_pointer = integer_tape_pointer+1
          integer_tape(integer_tape_pointer) = J
          integer_tape_pointer = integer_tape_pointer+1
          integer_tape(integer_tape_pointer) = N
          integer_tape_pointer = integer_tape_pointer+1
          OpenAD_Symbol_461 = (INT(OpenAD_Symbol_461)+INT(1_w2f__i8))
        END DO
        integer_tape(integer_tape_pointer) = OpenAD_Symbol_461
        integer_tape_pointer = integer_tape_pointer+1
        OpenAD_Symbol_460 = (INT(OpenAD_Symbol_460)+INT(1_w2f__i8))
      END DO
      integer_tape(integer_tape_pointer) = OpenAD_Symbol_460
      integer_tape_pointer = integer_tape_pointer+1
      OpenAD_Symbol_459 = (INT(OpenAD_Symbol_459)+INT(1_w2f__i8))
    END DO
    integer_tape(integer_tape_pointer) = OpenAD_Symbol_459
    integer_tape_pointer = integer_tape_pointer+1
    OpenAD_Symbol_458 = (INT(OpenAD_Symbol_458)+INT(1_w2f__i8))
  END DO
  integer_tape(integer_tape_pointer) = OpenAD_Symbol_458
  integer_tape_pointer = integer_tape_pointer+1
  CALL TPFA(NX,NY,NZ,KM,Q,P,V)
  integer_tape(integer_tape_pointer) = NX
  integer_tape_pointer = integer_tape_pointer+1
  integer_tape(integer_tape_pointer) = NY
  integer_tape_pointer = integer_tape_pointer+1
  integer_tape(integer_tape_pointer) = NZ
  integer_tape_pointer = integer_tape_pointer+1
    end if
    if (our_rev_mode%adjoint) then
! adjoint
  integer_tape_pointer = integer_tape_pointer-1
  NZ = integer_tape(integer_tape_pointer)
  integer_tape_pointer = integer_tape_pointer-1
  NY = integer_tape(integer_tape_pointer)
  integer_tape_pointer = integer_tape_pointer-1
  NX = integer_tape(integer_tape_pointer)
  CALL TPFA(NX,NY,NZ,KM,Q,P,V)
  integer_tape_pointer = integer_tape_pointer-1
  OpenAD_Symbol_447 = integer_tape(integer_tape_pointer)
  OpenAD_Symbol_448 = 1
  do while (INT(OpenAD_Symbol_448).LE.INT(OpenAD_Symbol_447))
    integer_tape_pointer = integer_tape_pointer-1
    OpenAD_Symbol_449 = integer_tape(integer_tape_pointer)
    OpenAD_Symbol_450 = 1
    do while (INT(OpenAD_Symbol_450).LE.INT(OpenAD_Symbol_449))
      integer_tape_pointer = integer_tape_pointer-1
      OpenAD_Symbol_451 = integer_tape(integer_tape_pointer)
      OpenAD_Symbol_452 = 1
      do while (INT(OpenAD_Symbol_452).LE.INT(OpenAD_Symbol_451))
        integer_tape_pointer = integer_tape_pointer-1
        OpenAD_Symbol_453 = integer_tape(integer_tape_pointer)
        OpenAD_Symbol_454 = 1
        do while (INT(OpenAD_Symbol_454).LE.INT(OpenAD_Symbol_453))
          integer_tape_pointer = integer_tape_pointer-1
          OpenAD_Symbol_1086 = integer_tape(integer_tape_pointer)
          integer_tape_pointer = integer_tape_pointer-1
          OpenAD_Symbol_1087 = integer_tape(integer_tape_pointer)
          integer_tape_pointer = integer_tape_pointer-1
          OpenAD_Symbol_1088 = integer_tape(integer_tape_pointer)
          integer_tape_pointer = integer_tape_pointer-1
          OpenAD_Symbol_1089 = integer_tape(integer_tape_pointer)
          double_tape_pointer = double_tape_pointer-1
          OpenAD_Symbol_1090 = double_tape(double_tape_pointer)
          OpenAD_prp_19%d = OpenAD_prp_19%d+KM(OpenAD_Symbol_1089,OpenAD_Symbol_&
     &1088,OpenAD_Symbol_1087,OpenAD_Symbol_1086)%d*(OpenAD_Symbol_1090)

          KM(OpenAD_Symbol_1089,OpenAD_Symbol_1088,OpenAD_Symbol_1087,OpenAD_Sym&
     &bol_1086)%d = 0.0d0

          KM(OpenAD_Symbol_1089,OpenAD_Symbol_1088,OpenAD_Symbol_1087,OpenAD_Sym&
     &bol_1086)%d = KM(OpenAD_Symbol_1089,OpenAD_Symbol_1088,OpenAD_Symbol_1087,&
     &OpenAD_Symbol_1086)%d+OpenAD_prp_19%d

          OpenAD_prp_19%d = 0.0d0
          OpenAD_Symbol_454 = INT(OpenAD_Symbol_454)+1
        END DO
        OpenAD_Symbol_452 = INT(OpenAD_Symbol_452)+1
      END DO
      OpenAD_Symbol_450 = INT(OpenAD_Symbol_450)+1
    END DO
    OpenAD_Symbol_448 = INT(OpenAD_Symbol_448)+1
  END DO
  CALL MYRESHAPE_1_4(M,KM)
  integer_tape_pointer = integer_tape_pointer-1
  OpenAD_Symbol_455 = integer_tape(integer_tape_pointer)
  OpenAD_Symbol_456 = 1
  do while (INT(OpenAD_Symbol_456).LE.INT(OpenAD_Symbol_455))
    integer_tape_pointer = integer_tape_pointer-1
    OpenAD_Symbol_1079 = integer_tape(integer_tape_pointer)
    OpenAD_prp_18%d = OpenAD_prp_18%d+M(OpenAD_Symbol_1079)%d
    M(OpenAD_Symbol_1079)%d = 0.0d0
    integer_tape_pointer = integer_tape_pointer-1
    OpenAD_Symbol_1080 = integer_tape(integer_tape_pointer)
    M(OpenAD_Symbol_1080)%d = M(OpenAD_Symbol_1080)%d+OpenAD_prp_18%d
    OpenAD_prp_18%d = 0.0d0
    integer_tape_pointer = integer_tape_pointer-1
    OpenAD_Symbol_1081 = integer_tape(integer_tape_pointer)
    OpenAD_prp_17%d = OpenAD_prp_17%d+M(OpenAD_Symbol_1081)%d
    M(OpenAD_Symbol_1081)%d = 0.0d0
    integer_tape_pointer = integer_tape_pointer-1
    OpenAD_Symbol_1082 = integer_tape(integer_tape_pointer)
    M(OpenAD_Symbol_1082)%d = M(OpenAD_Symbol_1082)%d+OpenAD_prp_17%d
    OpenAD_prp_17%d = 0.0d0
    integer_tape_pointer = integer_tape_pointer-1
    OpenAD_Symbol_1083 = integer_tape(integer_tape_pointer)
    integer_tape_pointer = integer_tape_pointer-1
    OpenAD_Symbol_1084 = integer_tape(integer_tape_pointer)
    MW(OpenAD_Symbol_1083)%d = MW(OpenAD_Symbol_1083)%d+M(OpenAD_Symbol_1084)%d
    integer_tape_pointer = integer_tape_pointer-1
    OpenAD_Symbol_1085 = integer_tape(integer_tape_pointer)
    MO(OpenAD_Symbol_1083)%d = MO(OpenAD_Symbol_1083)%d+M(OpenAD_Symbol_1085)%d
    M(OpenAD_Symbol_1085)%d = 0.0d0
    OpenAD_Symbol_456 = INT(OpenAD_Symbol_456)+1
  END DO
  integer_tape_pointer = integer_tape_pointer-1
  NZ = integer_tape(integer_tape_pointer)
  integer_tape_pointer = integer_tape_pointer-1
  NY = integer_tape(integer_tape_pointer)
  integer_tape_pointer = integer_tape_pointer-1
  NX = integer_tape(integer_tape_pointer)
  CALL RELPERM_VECTOR(NX,NY,NZ,S,MW,MO)
    end if
  end subroutine PRES
!#########################################################
! This file is part of OpenAD released under the LGPL.   #
! The full COPYRIGHT notice can be found in the top      #
! level directory of the OpenAD distribution             #
!#########################################################

  SUBROUTINE RELPERM_VECTOR(NX, NY, NZ, S, MW, MO, DMW, DMO)
    use OAD_tape
    use OAD_rev

! original arguments get inserted before version
!         ! and declared here together with all local variables
!         ! generated by xaifBooster

  use w2f__types
  IMPLICIT NONE
!
!       **** Global Variables & Derived Type Definitions ****
!
  INTEGER(w2f__i8) OpenAD_Symbol_415
  INTEGER(w2f__i8) OpenAD_Symbol_416
  INTEGER(w2f__i8) OpenAD_Symbol_417
  INTEGER(w2f__i8) OpenAD_Symbol_418
  INTEGER(w2f__i8) OpenAD_Symbol_419
  INTEGER(w2f__i8) OpenAD_Symbol_420
  INTEGER(w2f__i8) OpenAD_Symbol_421
  INTEGER(w2f__i8) OpenAD_Symbol_422
  INTEGER(w2f__i8) OpenAD_Symbol_423
  INTEGER(w2f__i8) OpenAD_Symbol_424
  INTEGER(w2f__i8) OpenAD_Symbol_425
  INTEGER(w2f__i8) OpenAD_Symbol_426
  INTEGER(w2f__i8) OpenAD_Symbol_427
  INTEGER(w2f__i8) OpenAD_Symbol_428
  INTEGER(w2f__i8) OpenAD_Symbol_429
  INTEGER(w2f__i8) OpenAD_Symbol_430
  INTEGER(w2f__i8) OpenAD_Symbol_431
  INTEGER(w2f__i8) OpenAD_Symbol_432
!
!       **** Parameters and Result ****
!
  INTEGER(w2f__i4) NX
  INTEGER(w2f__i4) NY
  INTEGER(w2f__i4) NZ
  type(active) :: S(1:INT((NZ*NX*NY)))
  type(active) :: MW(1:INT((NZ*NX*NY)))
  type(active) :: MO(1:INT((NZ*NX*NY)))
  type(active) :: DMW(1:INT((NZ*NX*NY)))
  OPTIONAL DMW
  type(active) :: DMO(1:INT((NZ*NX*NY)))
  OPTIONAL DMO
!
!       **** Local Variables and Functions ****
!
  type(active) :: S_TEMP(1:INT((NZ*NX*NY)))
  LOGICAL(w2f__i4) t__196
  REAL(w2f__8) OpenAD_Symbol_1060(:)
  ALLOCATABLE OpenAD_Symbol_1060
  INTEGER(w2f__i8) OpenAD_Symbol_1061
  REAL(w2f__8) OpenAD_Symbol_1063(:)
  ALLOCATABLE OpenAD_Symbol_1063
  INTEGER(w2f__i8) OpenAD_Symbol_1064
  INTEGER(w2f__i4) OpenAD_Symbol_1066
  INTEGER(w2f__i4) OpenAD_Symbol_1067
  INTEGER(w2f__i4) OpenAD_Symbol_1068
  INTEGER(w2f__i4) OpenAD_Symbol_1069
  REAL(w2f__8) OpenAD_Symbol_1070
  INTEGER(w2f__i4) OpenAD_Symbol_1071
  INTEGER(w2f__i4) OpenAD_Symbol_1072
  REAL(w2f__8) OpenAD_Symbol_1073
  REAL(w2f__8) OpenAD_Symbol_1074
  INTEGER(w2f__i4) OpenAD_Symbol_1075
  INTEGER(w2f__i4) OpenAD_Symbol_1076
  INTEGER(w2f__i4) OpenAD_Symbol_1077
  INTEGER(w2f__i4) OpenAD_Symbol_1078
  INTEGER(w2f__i4) OpenAD_Symbol_433
  INTEGER(w2f__i4) OpenAD_Symbol_434
  INTEGER(w2f__i8) OpenAD_Symbol_435
  INTEGER(w2f__i4) OpenAD_Symbol_437
  INTEGER(w2f__i4) OpenAD_Symbol_438
  INTEGER(w2f__i8) OpenAD_Symbol_439
  INTEGER(w2f__i4) OpenAD_Symbol_441
  INTEGER(w2f__i4) OpenAD_Symbol_442
  INTEGER(w2f__i4) OpenAD_Symbol_443
  INTEGER(w2f__i4) OpenAD_Symbol_444
  INTEGER(w2f__i4) OpenAD_Symbol_445
  INTEGER(w2f__i4) OpenAD_Symbol_446
  REAL(w2f__8) OpenAD_acc_3(:)
  ALLOCATABLE OpenAD_acc_3
  REAL(w2f__8) OpenAD_acc_4(:)
  ALLOCATABLE OpenAD_acc_4
  REAL(w2f__8) OpenAD_acc_5
  REAL(w2f__8) OpenAD_acc_6
  REAL(w2f__8) OpenAD_aux_10(:)
  ALLOCATABLE OpenAD_aux_10
  REAL(w2f__8) OpenAD_aux_11(:)
  ALLOCATABLE OpenAD_aux_11
  REAL(w2f__8) OpenAD_aux_12
  REAL(w2f__8) OpenAD_aux_13(:)
  ALLOCATABLE OpenAD_aux_13
  REAL(w2f__8) OpenAD_aux_14(:)
  ALLOCATABLE OpenAD_aux_14
  REAL(w2f__8) OpenAD_aux_15
  REAL(w2f__8) OpenAD_aux_16(:)
  ALLOCATABLE OpenAD_aux_16
  REAL(w2f__8) OpenAD_aux_17(:)
  ALLOCATABLE OpenAD_aux_17
  REAL(w2f__8) OpenAD_aux_6(:)
  ALLOCATABLE OpenAD_aux_6
  REAL(w2f__8) OpenAD_aux_7
  REAL(w2f__8) OpenAD_aux_8(:)
  ALLOCATABLE OpenAD_aux_8
  REAL(w2f__8) OpenAD_aux_9(:)
  ALLOCATABLE OpenAD_aux_9
  REAL(w2f__8) OpenAD_lin_18
  REAL(w2f__8) OpenAD_lin_19
  REAL(w2f__8) OpenAD_lin_20(:)
  ALLOCATABLE OpenAD_lin_20
  REAL(w2f__8) OpenAD_lin_21
  REAL(w2f__8) OpenAD_lin_22(:)
  ALLOCATABLE OpenAD_lin_22
  REAL(w2f__8) OpenAD_lin_23
  REAL(w2f__8) OpenAD_lin_24
  REAL(w2f__8) OpenAD_lin_25
  REAL(w2f__8) OpenAD_lin_26
!
!       **** Statements ****
!


    integer iaddr
    external iaddr

   if (our_rev_mode%plain) then
! original function
  S_TEMP(1:NZ*NX*NY)%v = ((S(1:NZ*NX*NY)%v-SWC)/(1.0D00-SWC-SOR))
  MW(1:NZ*NX*NY)%v = ((S_TEMP(1:NZ*NX*NY)%v**2)/VW)
  MO(1:NZ*NX*NY)%v = (((1.0D00-S_TEMP(1:NZ*NX*NY)%v)**2)/VO)
  t__196 = .TRUE.
  IF (.not. PRESENT(DMO)) THEN
    t__196 = .FALSE.
  ELSE
    IF (.not. PRESENT(DMW)) THEN
      t__196 = .FALSE.
    ENDIF
  ENDIF
  IF(t__196) THEN
    DMW(1:NZ*NX*NY)%v = (((S_TEMP(1:NZ*NX*NY)%v*2.0D00)/VW)/(1.0D00-SWC-SOR))
    DMO(1:NZ*NX*NY)%v = (-((((1.0D00-S_TEMP(1:NZ*NX*NY)%v)*2.0D00)/VO)/(1.0D00-S&
     &WC-SOR)))

  ENDIF
    end if
    if (our_rev_mode%tape) then
! taping
!!! requested inline of 'oad_AllocateMatching' has no defn
  CALL oad_AllocateMatching(OpenAD_aux_6,S(1:NZ*NX*NY))
  OpenAD_aux_6 = (S(1:NZ*NX*NY)%v-SWC)
  OpenAD_aux_7 = (1.0D00-SWC-SOR)
  OpenAD_lin_18 = (INT(1_w2f__i8)/OpenAD_aux_7)
  S_TEMP(1:NZ*NX*NY)%v = (OpenAD_aux_6/OpenAD_aux_7)
  double_tape(double_tape_pointer) = OpenAD_lin_18
  double_tape_pointer = double_tape_pointer+1
  OpenAD_Symbol_433 = (NZ*NX*NY)
  integer_tape(integer_tape_pointer) = OpenAD_Symbol_433
  integer_tape_pointer = integer_tape_pointer+1
  OpenAD_Symbol_434 = (NZ*NX*NY)
  integer_tape(integer_tape_pointer) = OpenAD_Symbol_434
  integer_tape_pointer = integer_tape_pointer+1
!!! requested inline of 'oad_AllocateMatching' has no defn
  CALL oad_AllocateMatching(OpenAD_aux_8,S_TEMP(1:NZ*NX*NY))
  OpenAD_aux_8 = (S_TEMP(1:NZ*NX*NY)%v**2)
!!! requested inline of 'oad_AllocateMatching' has no defn
  CALL oad_AllocateMatching(OpenAD_lin_20,S_TEMP(1:NZ*NX*NY))
  OpenAD_lin_20 = (2*(S_TEMP(1:NZ*NX*NY)%v**(2-INT(1_w2f__i8))))
  OpenAD_lin_19 = (INT(1_w2f__i8)/VW)
  MW(1:NZ*NX*NY)%v = (OpenAD_aux_8/VW)
!!! requested inline of 'oad_AllocateMatching' has no defn
  CALL oad_AllocateMatching(OpenAD_aux_10,S_TEMP(1:NZ*NX*NY))
  OpenAD_aux_10 = (1.0D00-S_TEMP(1:NZ*NX*NY)%v)
!!! requested inline of 'oad_AllocateMatching' has no defn
  CALL oad_AllocateMatching(OpenAD_aux_9,S_TEMP(1:NZ*NX*NY))
  OpenAD_aux_9 = (OpenAD_aux_10**2)
!!! requested inline of 'oad_AllocateMatching' has no defn
  CALL oad_AllocateMatching(OpenAD_lin_22,OpenAD_aux_10)
  OpenAD_lin_22 = (2*(OpenAD_aux_10**(2-INT(1_w2f__i8))))
  OpenAD_lin_21 = (INT(1_w2f__i8)/VO)
  MO(1:NZ*NX*NY)%v = (OpenAD_aux_9/VO)
!!! requested inline of 'oad_AllocateMatching' has no defn
  CALL oad_AllocateMatching(OpenAD_acc_3,OpenAD_lin_20)
!!! requested inline of 'oad_AllocateMatching' has no defn
  CALL oad_AllocateMatching(OpenAD_acc_4,OpenAD_lin_22)
  OpenAD_acc_3 = (OpenAD_lin_20*OpenAD_lin_19)
  OpenAD_acc_4 = (INT((-1_w2f__i8))*OpenAD_lin_22*OpenAD_lin_21)
  OpenAD_Symbol_435 = SIZE(OpenAD_acc_3,1_w2f__i8)
  integer_tape(integer_tape_pointer) = OpenAD_Symbol_435
  integer_tape_pointer = integer_tape_pointer+1
  double_tape(double_tape_pointer:double_tape_pointer+size(OpenAD_acc_3,1)-1) = &
     &OpenAD_acc_3(:)

  double_tape_pointer = double_tape_pointer+size(OpenAD_acc_3,1)
  OpenAD_Symbol_437 = (NZ*NX*NY)
  integer_tape(integer_tape_pointer) = OpenAD_Symbol_437
  integer_tape_pointer = integer_tape_pointer+1
  OpenAD_Symbol_438 = (NZ*NX*NY)
  integer_tape(integer_tape_pointer) = OpenAD_Symbol_438
  integer_tape_pointer = integer_tape_pointer+1
  OpenAD_Symbol_439 = SIZE(OpenAD_acc_4,1_w2f__i8)
  integer_tape(integer_tape_pointer) = OpenAD_Symbol_439
  integer_tape_pointer = integer_tape_pointer+1
  double_tape(double_tape_pointer:double_tape_pointer+size(OpenAD_acc_4,1)-1) = &
     &OpenAD_acc_4(:)

  double_tape_pointer = double_tape_pointer+size(OpenAD_acc_4,1)
  OpenAD_Symbol_441 = (NZ*NX*NY)
  integer_tape(integer_tape_pointer) = OpenAD_Symbol_441
  integer_tape_pointer = integer_tape_pointer+1
  OpenAD_Symbol_442 = (NZ*NX*NY)
  integer_tape(integer_tape_pointer) = OpenAD_Symbol_442
  integer_tape_pointer = integer_tape_pointer+1
  t__196 = .TRUE.
  IF (.not. PRESENT(DMO)) THEN
    t__196 = .FALSE.
    OpenAD_Symbol_420 = 1_w2f__i8
    integer_tape(integer_tape_pointer) = OpenAD_Symbol_420
    integer_tape_pointer = integer_tape_pointer+1
  ELSE
    IF (.not. PRESENT(DMW)) THEN
      t__196 = .FALSE.
      OpenAD_Symbol_418 = 1_w2f__i8
      integer_tape(integer_tape_pointer) = OpenAD_Symbol_418
      integer_tape_pointer = integer_tape_pointer+1
    ELSE
      OpenAD_Symbol_419 = 0_w2f__i8
      integer_tape(integer_tape_pointer) = OpenAD_Symbol_419
      integer_tape_pointer = integer_tape_pointer+1
    ENDIF
    OpenAD_Symbol_421 = 0_w2f__i8
    integer_tape(integer_tape_pointer) = OpenAD_Symbol_421
    integer_tape_pointer = integer_tape_pointer+1
  ENDIF
  IF(t__196) THEN
!!! requested inline of 'oad_AllocateMatching' has no defn
    CALL oad_AllocateMatching(OpenAD_aux_13,S_TEMP(1:NZ*NX*NY))
    OpenAD_aux_13 = (S_TEMP(1:NZ*NX*NY)%v*2.0D00)
!!! requested inline of 'oad_AllocateMatching' has no defn
    CALL oad_AllocateMatching(OpenAD_aux_11,S_TEMP(1:NZ*NX*NY))
    OpenAD_aux_11 = (OpenAD_aux_13/VW)
    OpenAD_aux_12 = (1.0D00-SWC-SOR)
    OpenAD_lin_24 = (INT(1_w2f__i8)/VW)
    OpenAD_lin_23 = (INT(1_w2f__i8)/OpenAD_aux_12)
    DMW(1:NZ*NX*NY)%v = (OpenAD_aux_11/OpenAD_aux_12)
!!! requested inline of 'oad_AllocateMatching' has no defn
    CALL oad_AllocateMatching(OpenAD_aux_17,S_TEMP(1:NZ*NX*NY))
    OpenAD_aux_17 = (1.0D00-S_TEMP(1:NZ*NX*NY)%v)
!!! requested inline of 'oad_AllocateMatching' has no defn
    CALL oad_AllocateMatching(OpenAD_aux_16,S_TEMP(1:NZ*NX*NY))
    OpenAD_aux_16 = (OpenAD_aux_17*2.0D00)
!!! requested inline of 'oad_AllocateMatching' has no defn
    CALL oad_AllocateMatching(OpenAD_aux_14,S_TEMP(1:NZ*NX*NY))
    OpenAD_aux_14 = (OpenAD_aux_16/VO)
    OpenAD_aux_15 = (1.0D00-SWC-SOR)
    OpenAD_lin_26 = (INT(1_w2f__i8)/VO)
    OpenAD_lin_25 = (INT(1_w2f__i8)/OpenAD_aux_15)
    DMO(1:NZ*NX*NY)%v = (-(OpenAD_aux_14/OpenAD_aux_15))
    OpenAD_acc_5 = (2.0D00*OpenAD_lin_24*OpenAD_lin_23)
    OpenAD_acc_6 = (INT((-1_w2f__i8))*2.0D00*OpenAD_lin_26*OpenAD_lin_25*INT((-1&
     &_w2f__i8)))

    double_tape(double_tape_pointer) = OpenAD_acc_5
    double_tape_pointer = double_tape_pointer+1
    OpenAD_Symbol_443 = (NZ*NX*NY)
    integer_tape(integer_tape_pointer) = OpenAD_Symbol_443
    integer_tape_pointer = integer_tape_pointer+1
    OpenAD_Symbol_444 = (NZ*NX*NY)
    integer_tape(integer_tape_pointer) = OpenAD_Symbol_444
    integer_tape_pointer = integer_tape_pointer+1
    double_tape(double_tape_pointer) = OpenAD_acc_6
    double_tape_pointer = double_tape_pointer+1
    OpenAD_Symbol_445 = (NZ*NX*NY)
    integer_tape(integer_tape_pointer) = OpenAD_Symbol_445
    integer_tape_pointer = integer_tape_pointer+1
    OpenAD_Symbol_446 = (NZ*NX*NY)
    integer_tape(integer_tape_pointer) = OpenAD_Symbol_446
    integer_tape_pointer = integer_tape_pointer+1
    OpenAD_Symbol_422 = 1_w2f__i8
    integer_tape(integer_tape_pointer) = OpenAD_Symbol_422
    integer_tape_pointer = integer_tape_pointer+1
  ELSE
    OpenAD_Symbol_423 = 0_w2f__i8
    integer_tape(integer_tape_pointer) = OpenAD_Symbol_423
    integer_tape_pointer = integer_tape_pointer+1
  ENDIF
    end if
    if (our_rev_mode%adjoint) then
! adjoint
  integer_tape_pointer = integer_tape_pointer-1
  OpenAD_Symbol_415 = integer_tape(integer_tape_pointer)
  IF (OpenAD_Symbol_415.ne.0) THEN
    double_tape_pointer = double_tape_pointer-1
    OpenAD_Symbol_1073 = double_tape(double_tape_pointer)
    double_tape_pointer = double_tape_pointer-1
    OpenAD_Symbol_1074 = double_tape(double_tape_pointer)
    integer_tape_pointer = integer_tape_pointer-1
    OpenAD_Symbol_1075 = integer_tape(integer_tape_pointer)
    integer_tape_pointer = integer_tape_pointer-1
    OpenAD_Symbol_1076 = integer_tape(integer_tape_pointer)
    S_TEMP(1:OpenAD_Symbol_1076)%d = S_TEMP(1:OpenAD_Symbol_1076)%d+DMO(1:OpenAD&
     &_Symbol_1075)%d*(OpenAD_Symbol_1073)

    DMO(1:OpenAD_Symbol_1075)%d = 0.0d0
    integer_tape_pointer = integer_tape_pointer-1
    OpenAD_Symbol_1077 = integer_tape(integer_tape_pointer)
    integer_tape_pointer = integer_tape_pointer-1
    OpenAD_Symbol_1078 = integer_tape(integer_tape_pointer)
    S_TEMP(1:OpenAD_Symbol_1078)%d = S_TEMP(1:OpenAD_Symbol_1078)%d+DMW(1:OpenAD&
     &_Symbol_1077)%d*(OpenAD_Symbol_1074)

    DMW(1:OpenAD_Symbol_1077)%d = 0.0d0
  ENDIF
  integer_tape_pointer = integer_tape_pointer-1
  OpenAD_Symbol_416 = integer_tape(integer_tape_pointer)
  IF (OpenAD_Symbol_416.ne.0) THEN
  ELSE
    integer_tape_pointer = integer_tape_pointer-1
    OpenAD_Symbol_417 = integer_tape(integer_tape_pointer)
    IF (OpenAD_Symbol_417.ne.0) THEN
    ENDIF
  ENDIF
  integer_tape_pointer = integer_tape_pointer-1
  OpenAD_Symbol_1061 = integer_tape(integer_tape_pointer)
!!! requested inline of 'oad_AllocateShape' has no defn
  CALL oad_AllocateShape(OpenAD_Symbol_1060,OpenAD_Symbol_1061)
  double_tape_pointer = double_tape_pointer-size(OpenAD_Symbol_1060,1)
  OpenAD_Symbol_1060(:) = double_tape(double_tape_pointer:double_tape_pointer+si&
     &ze(OpenAD_Symbol_1060,1)-1)

  integer_tape_pointer = integer_tape_pointer-1
  OpenAD_Symbol_1064 = integer_tape(integer_tape_pointer)
!!! requested inline of 'oad_AllocateShape' has no defn
  CALL oad_AllocateShape(OpenAD_Symbol_1063,OpenAD_Symbol_1064)
  double_tape_pointer = double_tape_pointer-size(OpenAD_Symbol_1063,1)
  OpenAD_Symbol_1063(:) = double_tape(double_tape_pointer:double_tape_pointer+si&
     &ze(OpenAD_Symbol_1063,1)-1)

  integer_tape_pointer = integer_tape_pointer-1
  OpenAD_Symbol_1066 = integer_tape(integer_tape_pointer)
  integer_tape_pointer = integer_tape_pointer-1
  OpenAD_Symbol_1067 = integer_tape(integer_tape_pointer)
  S_TEMP(1:OpenAD_Symbol_1067)%d = S_TEMP(1:OpenAD_Symbol_1067)%d+MO(1:OpenAD_Sy&
     &mbol_1066)%d*(OpenAD_Symbol_1060)

  MO(1:OpenAD_Symbol_1066)%d = 0.0d0
  integer_tape_pointer = integer_tape_pointer-1
  OpenAD_Symbol_1068 = integer_tape(integer_tape_pointer)
  integer_tape_pointer = integer_tape_pointer-1
  OpenAD_Symbol_1069 = integer_tape(integer_tape_pointer)
  S_TEMP(1:OpenAD_Symbol_1069)%d = S_TEMP(1:OpenAD_Symbol_1069)%d+MW(1:OpenAD_Sy&
     &mbol_1068)%d*(OpenAD_Symbol_1063)

  MW(1:OpenAD_Symbol_1068)%d = 0.0d0
  double_tape_pointer = double_tape_pointer-1
  OpenAD_Symbol_1070 = double_tape(double_tape_pointer)
  integer_tape_pointer = integer_tape_pointer-1
  OpenAD_Symbol_1071 = integer_tape(integer_tape_pointer)
  integer_tape_pointer = integer_tape_pointer-1
  OpenAD_Symbol_1072 = integer_tape(integer_tape_pointer)
  S(1:OpenAD_Symbol_1072)%d = S(1:OpenAD_Symbol_1072)%d+S_TEMP(1:OpenAD_Symbol_1&
     &071)%d*(OpenAD_Symbol_1070)

  S_TEMP(1:OpenAD_Symbol_1071)%d = 0.0d0
    end if
  end subroutine RELPERM_VECTOR
!#########################################################
! This file is part of OpenAD released under the LGPL.   #
! The full COPYRIGHT notice can be found in the top      #
! level directory of the OpenAD distribution             #
!#########################################################

  SUBROUTINE RELPERM_SCALAR(S, MW, MO, DMW, DMO)
    use OAD_tape
    use OAD_rev

! original arguments get inserted before version
!         ! and declared here together with all local variables
!         ! generated by xaifBooster

  use w2f__types
  IMPLICIT NONE
!
!       **** Global Variables & Derived Type Definitions ****
!
  INTEGER(w2f__i8) OpenAD_Symbol_766
  INTEGER(w2f__i8) OpenAD_Symbol_767
  INTEGER(w2f__i8) OpenAD_Symbol_768
  INTEGER(w2f__i8) OpenAD_Symbol_769
  INTEGER(w2f__i8) OpenAD_Symbol_770
  INTEGER(w2f__i8) OpenAD_Symbol_771
  INTEGER(w2f__i8) OpenAD_Symbol_772
  INTEGER(w2f__i8) OpenAD_Symbol_773
  INTEGER(w2f__i8) OpenAD_Symbol_774
  INTEGER(w2f__i8) OpenAD_Symbol_775
  INTEGER(w2f__i8) OpenAD_Symbol_776
  INTEGER(w2f__i8) OpenAD_Symbol_777
  INTEGER(w2f__i8) OpenAD_Symbol_778
  INTEGER(w2f__i8) OpenAD_Symbol_779
  INTEGER(w2f__i8) OpenAD_Symbol_780
  INTEGER(w2f__i8) OpenAD_Symbol_781
  INTEGER(w2f__i8) OpenAD_Symbol_782
  INTEGER(w2f__i8) OpenAD_Symbol_783
!
!       **** Parameters and Result ****
!
  type(active) :: S
  type(active) :: MW
  type(active) :: MO
  REAL(w2f__8) DMW
  OPTIONAL DMW
  REAL(w2f__8) DMO
  OPTIONAL DMO
!
!       **** Local Variables and Functions ****
!
  type(active) :: S_TEMP
  LOGICAL(w2f__i4) t__197
  REAL(w2f__8) OpenAD_Symbol_1171
  REAL(w2f__8) OpenAD_Symbol_1172
  REAL(w2f__8) OpenAD_Symbol_1173
  REAL(w2f__8) OpenAD_acc_7
  REAL(w2f__8) OpenAD_acc_8
  REAL(w2f__8) OpenAD_aux_24
  REAL(w2f__8) OpenAD_aux_25
  REAL(w2f__8) OpenAD_aux_26
  REAL(w2f__8) OpenAD_aux_27
  REAL(w2f__8) OpenAD_aux_28
  REAL(w2f__8) OpenAD_lin_38
  REAL(w2f__8) OpenAD_lin_39
  REAL(w2f__8) OpenAD_lin_40
  REAL(w2f__8) OpenAD_lin_41
  REAL(w2f__8) OpenAD_lin_42
!
!       **** Statements ****
!


    integer iaddr
    external iaddr

   if (our_rev_mode%plain) then
! original function
  S_TEMP%v = ((S%v-SWC)/(1.0D00-SWC-SOR))
  MW%v = ((S_TEMP%v**2)/VW)
  MO%v = (((1.0D00-S_TEMP%v)**2)/VO)
  t__197 = .TRUE.
  IF (.not. PRESENT(DMO)) THEN
    t__197 = .FALSE.
  ELSE
    IF (.not. PRESENT(DMW)) THEN
      t__197 = .FALSE.
    ENDIF
  ENDIF
  IF(t__197) THEN
    DMW = (((S_TEMP%v*2.0D00)/VW)/(1.0D00-SWC-SOR))
    DMO = (-((((1.0D00-S_TEMP%v)*2.0D00)/VO)/(1.0D00-SWC-SOR)))
  ENDIF
    end if
    if (our_rev_mode%tape) then
! taping
  OpenAD_aux_24 = (S%v-SWC)
  OpenAD_aux_25 = (1.0D00-SWC-SOR)
  OpenAD_lin_38 = (INT(1_w2f__i8)/OpenAD_aux_25)
  S_TEMP%v = (OpenAD_aux_24/OpenAD_aux_25)
  OpenAD_aux_26 = (S_TEMP%v**2)
  OpenAD_lin_40 = (2*(S_TEMP%v**(2-INT(1_w2f__i8))))
  OpenAD_lin_39 = (INT(1_w2f__i8)/VW)
  MW%v = (OpenAD_aux_26/VW)
  OpenAD_aux_28 = (1.0D00-S_TEMP%v)
  OpenAD_aux_27 = (OpenAD_aux_28**2)
  OpenAD_lin_42 = (2*(OpenAD_aux_28**(2-INT(1_w2f__i8))))
  OpenAD_lin_41 = (INT(1_w2f__i8)/VO)
  MO%v = (OpenAD_aux_27/VO)
  OpenAD_acc_7 = (OpenAD_lin_40*OpenAD_lin_39)
  OpenAD_acc_8 = (INT((-1_w2f__i8))*OpenAD_lin_42*OpenAD_lin_41)
  double_tape(double_tape_pointer) = OpenAD_lin_38
  double_tape_pointer = double_tape_pointer+1
  double_tape(double_tape_pointer) = OpenAD_acc_7
  double_tape_pointer = double_tape_pointer+1
  double_tape(double_tape_pointer) = OpenAD_acc_8
  double_tape_pointer = double_tape_pointer+1
  t__197 = .TRUE.
  IF (.not. PRESENT(DMO)) THEN
    t__197 = .FALSE.
    OpenAD_Symbol_771 = 1_w2f__i8
    integer_tape(integer_tape_pointer) = OpenAD_Symbol_771
    integer_tape_pointer = integer_tape_pointer+1
  ELSE
    IF (.not. PRESENT(DMW)) THEN
      t__197 = .FALSE.
      OpenAD_Symbol_769 = 1_w2f__i8
      integer_tape(integer_tape_pointer) = OpenAD_Symbol_769
      integer_tape_pointer = integer_tape_pointer+1
    ELSE
      OpenAD_Symbol_770 = 0_w2f__i8
      integer_tape(integer_tape_pointer) = OpenAD_Symbol_770
      integer_tape_pointer = integer_tape_pointer+1
    ENDIF
    OpenAD_Symbol_772 = 0_w2f__i8
    integer_tape(integer_tape_pointer) = OpenAD_Symbol_772
    integer_tape_pointer = integer_tape_pointer+1
  ENDIF
  IF(t__197) THEN
    DMW = (((S_TEMP%v*2.0D00)/VW)/(1.0D00-SWC-SOR))
    DMO = (-((((1.0D00-S_TEMP%v)*2.0D00)/VO)/(1.0D00-SWC-SOR)))
    OpenAD_Symbol_773 = 1_w2f__i8
    integer_tape(integer_tape_pointer) = OpenAD_Symbol_773
    integer_tape_pointer = integer_tape_pointer+1
  ELSE
    OpenAD_Symbol_774 = 0_w2f__i8
    integer_tape(integer_tape_pointer) = OpenAD_Symbol_774
    integer_tape_pointer = integer_tape_pointer+1
  ENDIF
    end if
    if (our_rev_mode%adjoint) then
! adjoint
  integer_tape_pointer = integer_tape_pointer-1
  OpenAD_Symbol_766 = integer_tape(integer_tape_pointer)
  IF (OpenAD_Symbol_766.ne.0) THEN
  ENDIF
  integer_tape_pointer = integer_tape_pointer-1
  OpenAD_Symbol_767 = integer_tape(integer_tape_pointer)
  IF (OpenAD_Symbol_767.ne.0) THEN
  ELSE
    integer_tape_pointer = integer_tape_pointer-1
    OpenAD_Symbol_768 = integer_tape(integer_tape_pointer)
    IF (OpenAD_Symbol_768.ne.0) THEN
    ENDIF
  ENDIF
  double_tape_pointer = double_tape_pointer-1
  OpenAD_Symbol_1171 = double_tape(double_tape_pointer)
  double_tape_pointer = double_tape_pointer-1
  OpenAD_Symbol_1172 = double_tape(double_tape_pointer)
  double_tape_pointer = double_tape_pointer-1
  OpenAD_Symbol_1173 = double_tape(double_tape_pointer)
  S_TEMP%d = S_TEMP%d+MO%d*(OpenAD_Symbol_1171)
  MO%d = 0.0d0
  S_TEMP%d = S_TEMP%d+MW%d*(OpenAD_Symbol_1172)
  MW%d = 0.0d0
  S%d = S%d+S_TEMP%d*(OpenAD_Symbol_1173)
  S_TEMP%d = 0.0d0
    end if
  end subroutine RELPERM_SCALAR
!#########################################################
! This file is part of OpenAD released under the LGPL.   #
! The full COPYRIGHT notice can be found in the top      #
! level directory of the OpenAD distribution             #
!#########################################################

  SUBROUTINE GENA(NX, NY, NZ, V, Q, ANNZ, AROW_INDEX, AROW_COMPRESSED, ACOL_INDE&
     &X, AVALUES)

    use OAD_tape
    use OAD_rev

! original arguments get inserted before version
!         ! and declared here together with all local variables
!         ! generated by xaifBooster

  use w2f__types
  IMPLICIT NONE
!
!       **** Parameters and Result ****
!
  INTEGER(w2f__i4) NX
  INTEGER(w2f__i4) NY
  INTEGER(w2f__i4) NZ
  type(active) :: V(1:3,1:INT((NX+1)),1:INT((NY+1)),1:INT((NZ+1)))
  type(active) :: Q(1:INT((NZ*NX*NY)))
  INTEGER(w2f__i4) ANNZ
  INTEGER(w2f__i4) AROW_INDEX(1 : INT((NZ * NX * NY * 7)))
  INTEGER(w2f__i4) AROW_COMPRESSED(1 : INT((NZ * NX * NY + 1)))
  INTEGER(w2f__i4) ACOL_INDEX(1 : INT((NZ * NX * NY * 7)))
  type(active) :: AVALUES(1:INT((NZ*NX*NY*7)))
!
!       **** Local Variables and Functions ****
!
  type(active) :: DIAGS(1:INT((NZ*NX*NY)),1:7)
  type(active) :: DIAG_TMP(1:INT((NZ*NX*NY)))
  REAL(w2f__8) OAD_CTMP0
  REAL(w2f__8) OAD_CTMP1
  REAL(w2f__8) OAD_CTMP2
  REAL(w2f__8) OAD_CTMP3
  REAL(w2f__8) OAD_CTMP4
  REAL(w2f__8) OAD_CTMP5
  REAL(w2f__8) OAD_CTMP6
  type(active) :: VXYZ(1:NX,1:NY,1:NZ)
  INTEGER(w2f__i4) OpenAD_Symbol_1005
  INTEGER(w2f__i4) OpenAD_Symbol_1006
  INTEGER(w2f__i4) OpenAD_Symbol_1007
  INTEGER(w2f__i4) OpenAD_Symbol_1008
  INTEGER(w2f__i4) OpenAD_Symbol_1009
  INTEGER(w2f__i4) OpenAD_Symbol_1010
  INTEGER(w2f__i4) OpenAD_Symbol_1011
  INTEGER(w2f__i4) OpenAD_Symbol_1012
  INTEGER(w2f__i4) OpenAD_Symbol_1013
  INTEGER(w2f__i4) OpenAD_Symbol_1014
  INTEGER(w2f__i4) OpenAD_Symbol_1015
  INTEGER(w2f__i4) OpenAD_Symbol_1016
  INTEGER(w2f__i4) OpenAD_Symbol_1017
  INTEGER(w2f__i4) OpenAD_Symbol_1018
  INTEGER(w2f__i4) OpenAD_Symbol_1019
  INTEGER(w2f__i4) OpenAD_Symbol_1020
  INTEGER(w2f__i4) OpenAD_Symbol_1021
  INTEGER(w2f__i4) OpenAD_Symbol_1022
  INTEGER(w2f__i4) OpenAD_Symbol_1023
  INTEGER(w2f__i4) OpenAD_Symbol_1024
  INTEGER(w2f__i4) OpenAD_Symbol_1025
  INTEGER(w2f__i4) OpenAD_Symbol_1026
  INTEGER(w2f__i4) OpenAD_Symbol_1027
  INTEGER(w2f__i4) OpenAD_Symbol_1028
  INTEGER(w2f__i4) OpenAD_Symbol_1029
  INTEGER(w2f__i4) OpenAD_Symbol_1030
  INTEGER(w2f__i4) OpenAD_Symbol_1031
  INTEGER(w2f__i4) OpenAD_Symbol_1032
  INTEGER(w2f__i4) OpenAD_Symbol_1033
  INTEGER(w2f__i4) OpenAD_Symbol_1034
  INTEGER(w2f__i4) OpenAD_Symbol_1035
  INTEGER(w2f__i4) OpenAD_Symbol_1036
  INTEGER(w2f__i4) OpenAD_Symbol_1037
  INTEGER(w2f__i4) OpenAD_Symbol_1038
  INTEGER(w2f__i4) OpenAD_Symbol_1039
  INTEGER(w2f__i4) OpenAD_Symbol_1040
  INTEGER(w2f__i4) OpenAD_Symbol_1041
  INTEGER(w2f__i4) OpenAD_Symbol_1042
  INTEGER(w2f__i4) OpenAD_Symbol_1043
  INTEGER(w2f__i4) OpenAD_Symbol_1044
  INTEGER(w2f__i4) OpenAD_Symbol_1045
  INTEGER(w2f__i4) OpenAD_Symbol_1046
  INTEGER(w2f__i4) OpenAD_Symbol_1047
  INTEGER(w2f__i4) OpenAD_Symbol_1048
  INTEGER(w2f__i4) OpenAD_Symbol_1049
  INTEGER(w2f__i4) OpenAD_Symbol_1050
  INTEGER(w2f__i4) OpenAD_Symbol_1051
  INTEGER(w2f__i4) OpenAD_Symbol_1052
  INTEGER(w2f__i4) OpenAD_Symbol_1053
  INTEGER(w2f__i4) OpenAD_Symbol_1054
  INTEGER(w2f__i4) OpenAD_Symbol_1055
  INTEGER(w2f__i4) OpenAD_Symbol_1056
  INTEGER(w2f__i4) OpenAD_Symbol_1057
  INTEGER(w2f__i4) OpenAD_Symbol_1058
  INTEGER(w2f__i4) OpenAD_Symbol_1059
  INTEGER(w2f__i4) OpenAD_Symbol_378
  INTEGER(w2f__i4) OpenAD_Symbol_379
  INTEGER(w2f__i4) OpenAD_Symbol_380
  INTEGER(w2f__i4) OpenAD_Symbol_381
  INTEGER(w2f__i4) OpenAD_Symbol_382
  INTEGER(w2f__i4) OpenAD_Symbol_383
  INTEGER(w2f__i4) OpenAD_Symbol_384
  INTEGER(w2f__i4) OpenAD_Symbol_385
  INTEGER(w2f__i4) OpenAD_Symbol_386
  INTEGER(w2f__i4) OpenAD_Symbol_387
  INTEGER(w2f__i4) OpenAD_Symbol_388
  INTEGER(w2f__i4) OpenAD_Symbol_389
  INTEGER(w2f__i4) OpenAD_Symbol_390
  INTEGER(w2f__i4) OpenAD_Symbol_391
  INTEGER(w2f__i4) OpenAD_Symbol_392
  INTEGER(w2f__i4) OpenAD_Symbol_393
  INTEGER(w2f__i4) OpenAD_Symbol_394
  INTEGER(w2f__i4) OpenAD_Symbol_395
  INTEGER(w2f__i4) OpenAD_Symbol_396
  INTEGER(w2f__i4) OpenAD_Symbol_397
  INTEGER(w2f__i4) OpenAD_Symbol_398
  INTEGER(w2f__i4) OpenAD_Symbol_399
  INTEGER(w2f__i4) OpenAD_Symbol_400
  INTEGER(w2f__i4) OpenAD_Symbol_401
  INTEGER(w2f__i4) OpenAD_Symbol_402
  INTEGER(w2f__i4) OpenAD_Symbol_403
  INTEGER(w2f__i4) OpenAD_Symbol_404
  INTEGER(w2f__i4) OpenAD_Symbol_405
  INTEGER(w2f__i4) OpenAD_Symbol_406
  INTEGER(w2f__i4) OpenAD_Symbol_407
  INTEGER(w2f__i4) OpenAD_Symbol_408
  INTEGER(w2f__i4) OpenAD_Symbol_409
  INTEGER(w2f__i4) OpenAD_Symbol_410
  INTEGER(w2f__i4) OpenAD_Symbol_411
  INTEGER(w2f__i4) OpenAD_Symbol_412
  INTEGER(w2f__i4) OpenAD_Symbol_413
  INTEGER(w2f__i4) OpenAD_Symbol_414
  type(active) :: OpenAD_prp_11(:)
  ALLOCATABLE OpenAD_prp_11
  type(active) :: OpenAD_prp_12(:)
  ALLOCATABLE OpenAD_prp_12
  type(active) :: OpenAD_prp_13(:)
  ALLOCATABLE OpenAD_prp_13
  type(active) :: OpenAD_prp_14(:)
  ALLOCATABLE OpenAD_prp_14
  type(active) :: OpenAD_prp_15(:)
  ALLOCATABLE OpenAD_prp_15
  type(active) :: OpenAD_prp_16(:)
  ALLOCATABLE OpenAD_prp_16
!
!       **** Statements ****
!


    integer iaddr
    external iaddr

   if (our_rev_mode%plain) then
! original function
  DIAGS(1:NZ*NX*NY,1:7)%v = 0.0D00
  VXYZ(1:INT(NX),1:INT(NY),1:INT(NZ))%v = V(3,1:NX,1:NY,2:NZ+1)%v
  CALL MYRESHAPE_3_1(VXYZ,DIAGS(1:NZ*NX*NY,1))
  VXYZ(1:INT(NX),1:INT(NY),1:INT(NZ))%v = V(2,1:NX,2:NY+1,1:NZ)%v
  CALL MYRESHAPE_3_1(VXYZ,DIAGS(1:NZ*NX*NY,2))
  VXYZ(1:INT(NX),1:INT(NY),1:INT(NZ))%v = V(1,2:NX+1,1:NY,1:NZ)%v
  CALL MYRESHAPE_3_1(VXYZ,DIAGS(1:NZ*NX*NY,3))
  VXYZ(1:INT(NX),1:INT(NY),1:INT(NZ))%v = V(1,1:NX,1:NY,1:NZ)%v
  CALL MYRESHAPE_3_1(VXYZ,DIAGS(1:NZ*NX*NY,5))
  VXYZ(1:INT(NX),1:INT(NY),1:INT(NZ))%v = V(2,1:NX,1:NY,1:NZ)%v
  CALL MYRESHAPE_3_1(VXYZ,DIAGS(1:NZ*NX*NY,6))
  VXYZ(1:INT(NX),1:INT(NY),1:INT(NZ))%v = V(3,1:NX,1:NY,1:NZ)%v
  CALL MYRESHAPE_3_1(VXYZ,DIAGS(1:NZ*NX*NY,7))
  DIAG_TMP(1:NZ*NX*NY)%v = 0.0D00
  OAD_CTMP0 = 0.0D00
  CALL MYMAX_1_0_DOUBLE(DIAGS(1:NZ*NX*NY,1),OAD_CTMP0,DIAG_TMP)
  DIAGS(1:NZ*NX*NY,1)%v = DIAG_TMP(1:NZ*NX*NY)%v
  DIAG_TMP(1:NZ*NX*NY)%v = 0.0D00
  OAD_CTMP1 = 0.0D00
  CALL MYMAX_1_0_DOUBLE(DIAGS(1:NZ*NX*NY,2),OAD_CTMP1,DIAG_TMP)
  DIAGS(1:NZ*NX*NY,2)%v = DIAG_TMP(1:NZ*NX*NY)%v
  DIAG_TMP(1:NZ*NX*NY)%v = 0.0D00
  OAD_CTMP2 = 0.0D00
  CALL MYMAX_1_0_DOUBLE(DIAGS(1:NZ*NX*NY,3),OAD_CTMP2,DIAG_TMP)
  DIAGS(1:NZ*NX*NY,3)%v = DIAG_TMP(1:NZ*NX*NY)%v
  DIAG_TMP(1:NZ*NX*NY)%v = 0.0D00
  OAD_CTMP3 = 0.0D00
  CALL MYMIN_1_0_DOUBLE(DIAGS(1:NZ*NX*NY,5),OAD_CTMP3,DIAG_TMP)
  DIAGS(1:NZ*NX*NY,5)%v = (-DIAG_TMP(1:NZ*NX*NY)%v)
  DIAG_TMP(1:NZ*NX*NY)%v = 0.0D00
  OAD_CTMP4 = 0.0D00
  CALL MYMIN_1_0_DOUBLE(DIAGS(1:NZ*NX*NY,6),OAD_CTMP4,DIAG_TMP)
  DIAGS(1:NZ*NX*NY,6)%v = (-DIAG_TMP(1:NZ*NX*NY)%v)
  DIAG_TMP(1:NZ*NX*NY)%v = 0.0D00
  OAD_CTMP5 = 0.0D00
  CALL MYMIN_1_0_DOUBLE(DIAGS(1:NZ*NX*NY,7),OAD_CTMP5,DIAG_TMP)
  DIAGS(1:NZ*NX*NY,7)%v = (-DIAG_TMP(1:NZ*NX*NY)%v)
  DIAG_TMP(1:NZ*NX*NY)%v = 0.0D00
  OAD_CTMP6 = 0.0D00
  CALL MYMIN_1_0_DOUBLE(Q,OAD_CTMP6,DIAG_TMP)
  DIAGS(1:NZ*NX*NY,4)%v = (DIAG_TMP(1:NZ*NX*NY)%v-DIAGS(1:NZ*NX*NY,5)%v-DIAGS(1:&
     &NZ*NX*NY,3)%v-DIAGS(1:NZ*NX*NY,6)%v-DIAGS(1:NZ*NX*NY,2)%v-DIAGS(1:NZ*NX*NY&
     &,7)%v-DIAGS(1:NZ*NX*NY,1)%v)

  CALL SPDIAGS_FVM_CSR(NX,NY,NZ,DIAGS,ANNZ,AROW_INDEX,AROW_COMPRESSED,ACOL_INDEX&
     &,AVALUES)

    end if
    if (our_rev_mode%tape) then
! taping
  DIAGS(1:NZ*NX*NY,1:7)%v = 0.0D00
  VXYZ(1:INT(NX),1:INT(NY),1:INT(NZ))%v = V(3,1:NX,1:NY,2:NZ+1)%v
  OpenAD_Symbol_378 = (NZ*NX*NY)
  integer_tape(integer_tape_pointer) = OpenAD_Symbol_378
  integer_tape_pointer = integer_tape_pointer+1
  OpenAD_Symbol_379 = (NZ+1)
  integer_tape(integer_tape_pointer) = OpenAD_Symbol_379
  integer_tape_pointer = integer_tape_pointer+1
  integer_tape(integer_tape_pointer) = NX
  integer_tape_pointer = integer_tape_pointer+1
  integer_tape(integer_tape_pointer) = NY
  integer_tape_pointer = integer_tape_pointer+1
  integer_tape(integer_tape_pointer) = NZ
  integer_tape_pointer = integer_tape_pointer+1
  CALL MYRESHAPE_3_1(VXYZ,DIAGS(1:NZ*NX*NY,1))
  integer_tape(integer_tape_pointer) = NZ
  integer_tape_pointer = integer_tape_pointer+1
  integer_tape(integer_tape_pointer) = NX
  integer_tape_pointer = integer_tape_pointer+1
  integer_tape(integer_tape_pointer) = NY
  integer_tape_pointer = integer_tape_pointer+1
  VXYZ(1:INT(NX),1:INT(NY),1:INT(NZ))%v = V(2,1:NX,2:NY+1,1:NZ)%v
  OpenAD_Symbol_380 = (NY+1)
  integer_tape(integer_tape_pointer) = OpenAD_Symbol_380
  integer_tape_pointer = integer_tape_pointer+1
  integer_tape(integer_tape_pointer) = NX
  integer_tape_pointer = integer_tape_pointer+1
  integer_tape(integer_tape_pointer) = NZ
  integer_tape_pointer = integer_tape_pointer+1
  integer_tape(integer_tape_pointer) = NY
  integer_tape_pointer = integer_tape_pointer+1
  CALL MYRESHAPE_3_1(VXYZ,DIAGS(1:NZ*NX*NY,2))
  integer_tape(integer_tape_pointer) = NZ
  integer_tape_pointer = integer_tape_pointer+1
  integer_tape(integer_tape_pointer) = NX
  integer_tape_pointer = integer_tape_pointer+1
  integer_tape(integer_tape_pointer) = NY
  integer_tape_pointer = integer_tape_pointer+1
  VXYZ(1:INT(NX),1:INT(NY),1:INT(NZ))%v = V(1,2:NX+1,1:NY,1:NZ)%v
  OpenAD_Symbol_381 = (NX+1)
  integer_tape(integer_tape_pointer) = OpenAD_Symbol_381
  integer_tape_pointer = integer_tape_pointer+1
  integer_tape(integer_tape_pointer) = NY
  integer_tape_pointer = integer_tape_pointer+1
  integer_tape(integer_tape_pointer) = NZ
  integer_tape_pointer = integer_tape_pointer+1
  integer_tape(integer_tape_pointer) = NX
  integer_tape_pointer = integer_tape_pointer+1
  CALL MYRESHAPE_3_1(VXYZ,DIAGS(1:NZ*NX*NY,3))
  integer_tape(integer_tape_pointer) = NZ
  integer_tape_pointer = integer_tape_pointer+1
  integer_tape(integer_tape_pointer) = NX
  integer_tape_pointer = integer_tape_pointer+1
  integer_tape(integer_tape_pointer) = NY
  integer_tape_pointer = integer_tape_pointer+1
  VXYZ(1:INT(NX),1:INT(NY),1:INT(NZ))%v = V(1,1:NX,1:NY,1:NZ)%v
  integer_tape(integer_tape_pointer) = NX
  integer_tape_pointer = integer_tape_pointer+1
  integer_tape(integer_tape_pointer) = NY
  integer_tape_pointer = integer_tape_pointer+1
  integer_tape(integer_tape_pointer) = NZ
  integer_tape_pointer = integer_tape_pointer+1
  CALL MYRESHAPE_3_1(VXYZ,DIAGS(1:NZ*NX*NY,5))
  integer_tape(integer_tape_pointer) = NZ
  integer_tape_pointer = integer_tape_pointer+1
  integer_tape(integer_tape_pointer) = NX
  integer_tape_pointer = integer_tape_pointer+1
  integer_tape(integer_tape_pointer) = NY
  integer_tape_pointer = integer_tape_pointer+1
  VXYZ(1:INT(NX),1:INT(NY),1:INT(NZ))%v = V(2,1:NX,1:NY,1:NZ)%v
  integer_tape(integer_tape_pointer) = NX
  integer_tape_pointer = integer_tape_pointer+1
  integer_tape(integer_tape_pointer) = NY
  integer_tape_pointer = integer_tape_pointer+1
  integer_tape(integer_tape_pointer) = NZ
  integer_tape_pointer = integer_tape_pointer+1
  CALL MYRESHAPE_3_1(VXYZ,DIAGS(1:NZ*NX*NY,6))
  integer_tape(integer_tape_pointer) = NZ
  integer_tape_pointer = integer_tape_pointer+1
  integer_tape(integer_tape_pointer) = NX
  integer_tape_pointer = integer_tape_pointer+1
  integer_tape(integer_tape_pointer) = NY
  integer_tape_pointer = integer_tape_pointer+1
  VXYZ(1:INT(NX),1:INT(NY),1:INT(NZ))%v = V(3,1:NX,1:NY,1:NZ)%v
  integer_tape(integer_tape_pointer) = NX
  integer_tape_pointer = integer_tape_pointer+1
  integer_tape(integer_tape_pointer) = NY
  integer_tape_pointer = integer_tape_pointer+1
  integer_tape(integer_tape_pointer) = NZ
  integer_tape_pointer = integer_tape_pointer+1
  CALL MYRESHAPE_3_1(VXYZ,DIAGS(1:NZ*NX*NY,7))
  integer_tape(integer_tape_pointer) = NZ
  integer_tape_pointer = integer_tape_pointer+1
  integer_tape(integer_tape_pointer) = NX
  integer_tape_pointer = integer_tape_pointer+1
  integer_tape(integer_tape_pointer) = NY
  integer_tape_pointer = integer_tape_pointer+1
  DIAG_TMP(1:NZ*NX*NY)%v = 0.0D00
  OAD_CTMP0 = 0.0D00
  OpenAD_Symbol_382 = (NZ*NX*NY)
  integer_tape(integer_tape_pointer) = OpenAD_Symbol_382
  integer_tape_pointer = integer_tape_pointer+1
  CALL MYMAX_1_0_DOUBLE(DIAGS(1:NZ*NX*NY,1),OAD_CTMP0,DIAG_TMP)
  integer_tape(integer_tape_pointer) = NZ
  integer_tape_pointer = integer_tape_pointer+1
  integer_tape(integer_tape_pointer) = NX
  integer_tape_pointer = integer_tape_pointer+1
  integer_tape(integer_tape_pointer) = NY
  integer_tape_pointer = integer_tape_pointer+1
  DIAGS(1:NZ*NX*NY,1)%v = DIAG_TMP(1:NZ*NX*NY)%v
  DIAG_TMP(1:NZ*NX*NY)%v = 0.0D00
  OAD_CTMP1 = 0.0D00
  OpenAD_Symbol_383 = (NZ*NX*NY)
  integer_tape(integer_tape_pointer) = OpenAD_Symbol_383
  integer_tape_pointer = integer_tape_pointer+1
  OpenAD_Symbol_384 = (NZ*NX*NY)
  integer_tape(integer_tape_pointer) = OpenAD_Symbol_384
  integer_tape_pointer = integer_tape_pointer+1
  OpenAD_Symbol_385 = (NZ*NX*NY)
  integer_tape(integer_tape_pointer) = OpenAD_Symbol_385
  integer_tape_pointer = integer_tape_pointer+1
  CALL MYMAX_1_0_DOUBLE(DIAGS(1:NZ*NX*NY,2),OAD_CTMP1,DIAG_TMP)
  integer_tape(integer_tape_pointer) = NZ
  integer_tape_pointer = integer_tape_pointer+1
  integer_tape(integer_tape_pointer) = NX
  integer_tape_pointer = integer_tape_pointer+1
  integer_tape(integer_tape_pointer) = NY
  integer_tape_pointer = integer_tape_pointer+1
  DIAGS(1:NZ*NX*NY,2)%v = DIAG_TMP(1:NZ*NX*NY)%v
  DIAG_TMP(1:NZ*NX*NY)%v = 0.0D00
  OAD_CTMP2 = 0.0D00
  OpenAD_Symbol_386 = (NZ*NX*NY)
  integer_tape(integer_tape_pointer) = OpenAD_Symbol_386
  integer_tape_pointer = integer_tape_pointer+1
  OpenAD_Symbol_387 = (NZ*NX*NY)
  integer_tape(integer_tape_pointer) = OpenAD_Symbol_387
  integer_tape_pointer = integer_tape_pointer+1
  OpenAD_Symbol_388 = (NZ*NX*NY)
  integer_tape(integer_tape_pointer) = OpenAD_Symbol_388
  integer_tape_pointer = integer_tape_pointer+1
  CALL MYMAX_1_0_DOUBLE(DIAGS(1:NZ*NX*NY,3),OAD_CTMP2,DIAG_TMP)
  integer_tape(integer_tape_pointer) = NZ
  integer_tape_pointer = integer_tape_pointer+1
  integer_tape(integer_tape_pointer) = NX
  integer_tape_pointer = integer_tape_pointer+1
  integer_tape(integer_tape_pointer) = NY
  integer_tape_pointer = integer_tape_pointer+1
  DIAGS(1:NZ*NX*NY,3)%v = DIAG_TMP(1:NZ*NX*NY)%v
  DIAG_TMP(1:NZ*NX*NY)%v = 0.0D00
  OAD_CTMP3 = 0.0D00
  OpenAD_Symbol_389 = (NZ*NX*NY)
  integer_tape(integer_tape_pointer) = OpenAD_Symbol_389
  integer_tape_pointer = integer_tape_pointer+1
  OpenAD_Symbol_390 = (NZ*NX*NY)
  integer_tape(integer_tape_pointer) = OpenAD_Symbol_390
  integer_tape_pointer = integer_tape_pointer+1
  OpenAD_Symbol_391 = (NZ*NX*NY)
  integer_tape(integer_tape_pointer) = OpenAD_Symbol_391
  integer_tape_pointer = integer_tape_pointer+1
  CALL MYMIN_1_0_DOUBLE(DIAGS(1:NZ*NX*NY,5),OAD_CTMP3,DIAG_TMP)
  integer_tape(integer_tape_pointer) = NZ
  integer_tape_pointer = integer_tape_pointer+1
  integer_tape(integer_tape_pointer) = NX
  integer_tape_pointer = integer_tape_pointer+1
  integer_tape(integer_tape_pointer) = NY
  integer_tape_pointer = integer_tape_pointer+1
  DIAGS(1:NZ*NX*NY,5)%v = (-DIAG_TMP(1:NZ*NX*NY)%v)
  DIAG_TMP(1:NZ*NX*NY)%v = 0.0D00
  OAD_CTMP4 = 0.0D00
  OpenAD_Symbol_392 = (NZ*NX*NY)
  integer_tape(integer_tape_pointer) = OpenAD_Symbol_392
  integer_tape_pointer = integer_tape_pointer+1
  OpenAD_Symbol_393 = (NZ*NX*NY)
  integer_tape(integer_tape_pointer) = OpenAD_Symbol_393
  integer_tape_pointer = integer_tape_pointer+1
  OpenAD_Symbol_394 = (NZ*NX*NY)
  integer_tape(integer_tape_pointer) = OpenAD_Symbol_394
  integer_tape_pointer = integer_tape_pointer+1
  CALL MYMIN_1_0_DOUBLE(DIAGS(1:NZ*NX*NY,6),OAD_CTMP4,DIAG_TMP)
  integer_tape(integer_tape_pointer) = NZ
  integer_tape_pointer = integer_tape_pointer+1
  integer_tape(integer_tape_pointer) = NX
  integer_tape_pointer = integer_tape_pointer+1
  integer_tape(integer_tape_pointer) = NY
  integer_tape_pointer = integer_tape_pointer+1
  DIAGS(1:NZ*NX*NY,6)%v = (-DIAG_TMP(1:NZ*NX*NY)%v)
  DIAG_TMP(1:NZ*NX*NY)%v = 0.0D00
  OAD_CTMP5 = 0.0D00
  OpenAD_Symbol_395 = (NZ*NX*NY)
  integer_tape(integer_tape_pointer) = OpenAD_Symbol_395
  integer_tape_pointer = integer_tape_pointer+1
  OpenAD_Symbol_396 = (NZ*NX*NY)
  integer_tape(integer_tape_pointer) = OpenAD_Symbol_396
  integer_tape_pointer = integer_tape_pointer+1
  OpenAD_Symbol_397 = (NZ*NX*NY)
  integer_tape(integer_tape_pointer) = OpenAD_Symbol_397
  integer_tape_pointer = integer_tape_pointer+1
  CALL MYMIN_1_0_DOUBLE(DIAGS(1:NZ*NX*NY,7),OAD_CTMP5,DIAG_TMP)
  integer_tape(integer_tape_pointer) = NZ
  integer_tape_pointer = integer_tape_pointer+1
  integer_tape(integer_tape_pointer) = NX
  integer_tape_pointer = integer_tape_pointer+1
  integer_tape(integer_tape_pointer) = NY
  integer_tape_pointer = integer_tape_pointer+1
  DIAGS(1:NZ*NX*NY,7)%v = (-DIAG_TMP(1:NZ*NX*NY)%v)
  DIAG_TMP(1:NZ*NX*NY)%v = 0.0D00
  OAD_CTMP6 = 0.0D00
  OpenAD_Symbol_398 = (NZ*NX*NY)
  integer_tape(integer_tape_pointer) = OpenAD_Symbol_398
  integer_tape_pointer = integer_tape_pointer+1
  OpenAD_Symbol_399 = (NZ*NX*NY)
  integer_tape(integer_tape_pointer) = OpenAD_Symbol_399
  integer_tape_pointer = integer_tape_pointer+1
  OpenAD_Symbol_400 = (NZ*NX*NY)
  integer_tape(integer_tape_pointer) = OpenAD_Symbol_400
  integer_tape_pointer = integer_tape_pointer+1
  CALL MYMIN_1_0_DOUBLE(Q,OAD_CTMP6,DIAG_TMP)
  DIAGS(1:NZ*NX*NY,4)%v = (DIAG_TMP(1:NZ*NX*NY)%v-DIAGS(1:NZ*NX*NY,5)%v-DIAGS(1:&
     &NZ*NX*NY,3)%v-DIAGS(1:NZ*NX*NY,6)%v-DIAGS(1:NZ*NX*NY,2)%v-DIAGS(1:NZ*NX*NY&
     &,7)%v-DIAGS(1:NZ*NX*NY,1)%v)

  OpenAD_Symbol_401 = (NZ*NX*NY)
  integer_tape(integer_tape_pointer) = OpenAD_Symbol_401
  integer_tape_pointer = integer_tape_pointer+1
  OpenAD_Symbol_402 = (NZ*NX*NY)
  integer_tape(integer_tape_pointer) = OpenAD_Symbol_402
  integer_tape_pointer = integer_tape_pointer+1
  OpenAD_Symbol_403 = (NZ*NX*NY)
  integer_tape(integer_tape_pointer) = OpenAD_Symbol_403
  integer_tape_pointer = integer_tape_pointer+1
  OpenAD_Symbol_404 = (NZ*NX*NY)
  integer_tape(integer_tape_pointer) = OpenAD_Symbol_404
  integer_tape_pointer = integer_tape_pointer+1
  OpenAD_Symbol_405 = (NZ*NX*NY)
  integer_tape(integer_tape_pointer) = OpenAD_Symbol_405
  integer_tape_pointer = integer_tape_pointer+1
  OpenAD_Symbol_406 = (NZ*NX*NY)
  integer_tape(integer_tape_pointer) = OpenAD_Symbol_406
  integer_tape_pointer = integer_tape_pointer+1
  OpenAD_Symbol_407 = (NZ*NX*NY)
  integer_tape(integer_tape_pointer) = OpenAD_Symbol_407
  integer_tape_pointer = integer_tape_pointer+1
  OpenAD_Symbol_408 = (NZ*NX*NY)
  integer_tape(integer_tape_pointer) = OpenAD_Symbol_408
  integer_tape_pointer = integer_tape_pointer+1
  OpenAD_Symbol_409 = (NZ*NX*NY)
  integer_tape(integer_tape_pointer) = OpenAD_Symbol_409
  integer_tape_pointer = integer_tape_pointer+1
  OpenAD_Symbol_410 = (NZ*NX*NY)
  integer_tape(integer_tape_pointer) = OpenAD_Symbol_410
  integer_tape_pointer = integer_tape_pointer+1
  OpenAD_Symbol_411 = (NZ*NX*NY)
  integer_tape(integer_tape_pointer) = OpenAD_Symbol_411
  integer_tape_pointer = integer_tape_pointer+1
  OpenAD_Symbol_412 = (NZ*NX*NY)
  integer_tape(integer_tape_pointer) = OpenAD_Symbol_412
  integer_tape_pointer = integer_tape_pointer+1
  OpenAD_Symbol_413 = (NZ*NX*NY)
  integer_tape(integer_tape_pointer) = OpenAD_Symbol_413
  integer_tape_pointer = integer_tape_pointer+1
  OpenAD_Symbol_414 = (NZ*NX*NY)
  integer_tape(integer_tape_pointer) = OpenAD_Symbol_414
  integer_tape_pointer = integer_tape_pointer+1
  CALL SPDIAGS_FVM_CSR(NX,NY,NZ,DIAGS,ANNZ,AROW_INDEX,AROW_COMPRESSED,ACOL_INDEX&
     &,AVALUES)

  integer_tape(integer_tape_pointer) = NX
  integer_tape_pointer = integer_tape_pointer+1
  integer_tape(integer_tape_pointer) = NY
  integer_tape_pointer = integer_tape_pointer+1
  integer_tape(integer_tape_pointer) = NZ
  integer_tape_pointer = integer_tape_pointer+1
    end if
    if (our_rev_mode%adjoint) then
! adjoint
  integer_tape_pointer = integer_tape_pointer-1
  NZ = integer_tape(integer_tape_pointer)
  integer_tape_pointer = integer_tape_pointer-1
  NY = integer_tape(integer_tape_pointer)
  integer_tape_pointer = integer_tape_pointer-1
  NX = integer_tape(integer_tape_pointer)
  CALL SPDIAGS_FVM_CSR(NX,NY,NZ,DIAGS,ANNZ,AROW_INDEX,AROW_COMPRESSED,ACOL_INDEX&
     &,AVALUES)

!!! requested inline of 'oad_AllocateMatching' has no defn
  CALL oad_AllocateMatching(OpenAD_prp_11,DIAGS(1:NZ*NX*NY,5))
!!! requested inline of 'oad_AllocateMatching' has no defn
  CALL oad_AllocateMatching(OpenAD_prp_12,DIAGS(1:NZ*NX*NY,3))
!!! requested inline of 'oad_AllocateMatching' has no defn
  CALL oad_AllocateMatching(OpenAD_prp_13,DIAGS(1:NZ*NX*NY,6))
!!! requested inline of 'oad_AllocateMatching' has no defn
  CALL oad_AllocateMatching(OpenAD_prp_14,DIAGS(1:NZ*NX*NY,2))
!!! requested inline of 'oad_AllocateMatching' has no defn
  CALL oad_AllocateMatching(OpenAD_prp_15,DIAGS(1:NZ*NX*NY,7))
!!! requested inline of 'oad_AllocateMatching' has no defn
  CALL oad_AllocateMatching(OpenAD_prp_16,DIAGS(1:NZ*NX*NY,1))
  integer_tape_pointer = integer_tape_pointer-1
  OpenAD_Symbol_1005 = integer_tape(integer_tape_pointer)
  OpenAD_prp_11%d = OpenAD_prp_11%d-DIAGS(1:OpenAD_Symbol_1005,4)%d
  integer_tape_pointer = integer_tape_pointer-1
  OpenAD_Symbol_1006 = integer_tape(integer_tape_pointer)
  OpenAD_prp_12%d = OpenAD_prp_12%d-DIAGS(1:OpenAD_Symbol_1006,4)%d
  integer_tape_pointer = integer_tape_pointer-1
  OpenAD_Symbol_1007 = integer_tape(integer_tape_pointer)
  OpenAD_prp_13%d = OpenAD_prp_13%d-DIAGS(1:OpenAD_Symbol_1007,4)%d
  integer_tape_pointer = integer_tape_pointer-1
  OpenAD_Symbol_1008 = integer_tape(integer_tape_pointer)
  OpenAD_prp_14%d = OpenAD_prp_14%d-DIAGS(1:OpenAD_Symbol_1008,4)%d
  integer_tape_pointer = integer_tape_pointer-1
  OpenAD_Symbol_1009 = integer_tape(integer_tape_pointer)
  OpenAD_prp_15%d = OpenAD_prp_15%d-DIAGS(1:OpenAD_Symbol_1009,4)%d
  integer_tape_pointer = integer_tape_pointer-1
  OpenAD_Symbol_1010 = integer_tape(integer_tape_pointer)
  OpenAD_prp_16%d = OpenAD_prp_16%d-DIAGS(1:OpenAD_Symbol_1010,4)%d
  integer_tape_pointer = integer_tape_pointer-1
  OpenAD_Symbol_1011 = integer_tape(integer_tape_pointer)
  integer_tape_pointer = integer_tape_pointer-1
  OpenAD_Symbol_1012 = integer_tape(integer_tape_pointer)
  DIAG_TMP(1:OpenAD_Symbol_1012)%d = DIAG_TMP(1:OpenAD_Symbol_1012)%d+DIAGS(1:Op&
     &enAD_Symbol_1011,4)%d

  DIAGS(1:OpenAD_Symbol_1011,4)%d = 0.0d0
  integer_tape_pointer = integer_tape_pointer-1
  OpenAD_Symbol_1013 = integer_tape(integer_tape_pointer)
  DIAGS(1:OpenAD_Symbol_1013,1)%d = DIAGS(1:OpenAD_Symbol_1013,1)%d+OpenAD_prp_1&
     &6%d

  OpenAD_prp_16%d = 0.0d0
  integer_tape_pointer = integer_tape_pointer-1
  OpenAD_Symbol_1014 = integer_tape(integer_tape_pointer)
  DIAGS(1:OpenAD_Symbol_1014,7)%d = DIAGS(1:OpenAD_Symbol_1014,7)%d+OpenAD_prp_1&
     &5%d

  OpenAD_prp_15%d = 0.0d0
  integer_tape_pointer = integer_tape_pointer-1
  OpenAD_Symbol_1015 = integer_tape(integer_tape_pointer)
  DIAGS(1:OpenAD_Symbol_1015,2)%d = DIAGS(1:OpenAD_Symbol_1015,2)%d+OpenAD_prp_1&
     &4%d

  OpenAD_prp_14%d = 0.0d0
  integer_tape_pointer = integer_tape_pointer-1
  OpenAD_Symbol_1016 = integer_tape(integer_tape_pointer)
  DIAGS(1:OpenAD_Symbol_1016,6)%d = DIAGS(1:OpenAD_Symbol_1016,6)%d+OpenAD_prp_1&
     &3%d

  OpenAD_prp_13%d = 0.0d0
  integer_tape_pointer = integer_tape_pointer-1
  OpenAD_Symbol_1017 = integer_tape(integer_tape_pointer)
  DIAGS(1:OpenAD_Symbol_1017,3)%d = DIAGS(1:OpenAD_Symbol_1017,3)%d+OpenAD_prp_1&
     &2%d

  OpenAD_prp_12%d = 0.0d0
  integer_tape_pointer = integer_tape_pointer-1
  OpenAD_Symbol_1018 = integer_tape(integer_tape_pointer)
  DIAGS(1:OpenAD_Symbol_1018,5)%d = DIAGS(1:OpenAD_Symbol_1018,5)%d+OpenAD_prp_1&
     &1%d

  OpenAD_prp_11%d = 0.0d0
  CALL MYMIN_1_0_DOUBLE(Q,OAD_CTMP6,DIAG_TMP)
  integer_tape_pointer = integer_tape_pointer-1
  OpenAD_Symbol_1019 = integer_tape(integer_tape_pointer)
  integer_tape_pointer = integer_tape_pointer-1
  OpenAD_Symbol_1020 = integer_tape(integer_tape_pointer)
  DIAG_TMP(1:OpenAD_Symbol_1020)%d = DIAG_TMP(1:OpenAD_Symbol_1020)%d-DIAGS(1:Op&
     &enAD_Symbol_1019,7)%d

  DIAGS(1:OpenAD_Symbol_1019,7)%d = 0.0d0
  integer_tape_pointer = integer_tape_pointer-1
  OpenAD_Symbol_1021 = integer_tape(integer_tape_pointer)
  DIAG_TMP(1:OpenAD_Symbol_1021)%d = 0.0d0
  integer_tape_pointer = integer_tape_pointer-1
  NY = integer_tape(integer_tape_pointer)
  integer_tape_pointer = integer_tape_pointer-1
  NX = integer_tape(integer_tape_pointer)
  integer_tape_pointer = integer_tape_pointer-1
  NZ = integer_tape(integer_tape_pointer)
  CALL MYMIN_1_0_DOUBLE(DIAGS(1:NZ*NX*NY,7),OAD_CTMP5,DIAG_TMP)
  integer_tape_pointer = integer_tape_pointer-1
  OpenAD_Symbol_1022 = integer_tape(integer_tape_pointer)
  integer_tape_pointer = integer_tape_pointer-1
  OpenAD_Symbol_1023 = integer_tape(integer_tape_pointer)
  DIAG_TMP(1:OpenAD_Symbol_1023)%d = DIAG_TMP(1:OpenAD_Symbol_1023)%d-DIAGS(1:Op&
     &enAD_Symbol_1022,6)%d

  DIAGS(1:OpenAD_Symbol_1022,6)%d = 0.0d0
  integer_tape_pointer = integer_tape_pointer-1
  OpenAD_Symbol_1024 = integer_tape(integer_tape_pointer)
  DIAG_TMP(1:OpenAD_Symbol_1024)%d = 0.0d0
  integer_tape_pointer = integer_tape_pointer-1
  NY = integer_tape(integer_tape_pointer)
  integer_tape_pointer = integer_tape_pointer-1
  NX = integer_tape(integer_tape_pointer)
  integer_tape_pointer = integer_tape_pointer-1
  NZ = integer_tape(integer_tape_pointer)
  CALL MYMIN_1_0_DOUBLE(DIAGS(1:NZ*NX*NY,6),OAD_CTMP4,DIAG_TMP)
  integer_tape_pointer = integer_tape_pointer-1
  OpenAD_Symbol_1025 = integer_tape(integer_tape_pointer)
  integer_tape_pointer = integer_tape_pointer-1
  OpenAD_Symbol_1026 = integer_tape(integer_tape_pointer)
  DIAG_TMP(1:OpenAD_Symbol_1026)%d = DIAG_TMP(1:OpenAD_Symbol_1026)%d-DIAGS(1:Op&
     &enAD_Symbol_1025,5)%d

  DIAGS(1:OpenAD_Symbol_1025,5)%d = 0.0d0
  integer_tape_pointer = integer_tape_pointer-1
  OpenAD_Symbol_1027 = integer_tape(integer_tape_pointer)
  DIAG_TMP(1:OpenAD_Symbol_1027)%d = 0.0d0
  integer_tape_pointer = integer_tape_pointer-1
  NY = integer_tape(integer_tape_pointer)
  integer_tape_pointer = integer_tape_pointer-1
  NX = integer_tape(integer_tape_pointer)
  integer_tape_pointer = integer_tape_pointer-1
  NZ = integer_tape(integer_tape_pointer)
  CALL MYMIN_1_0_DOUBLE(DIAGS(1:NZ*NX*NY,5),OAD_CTMP3,DIAG_TMP)
  integer_tape_pointer = integer_tape_pointer-1
  OpenAD_Symbol_1028 = integer_tape(integer_tape_pointer)
  integer_tape_pointer = integer_tape_pointer-1
  OpenAD_Symbol_1029 = integer_tape(integer_tape_pointer)
  DIAG_TMP(1:OpenAD_Symbol_1029)%d = DIAG_TMP(1:OpenAD_Symbol_1029)%d+DIAGS(1:Op&
     &enAD_Symbol_1028,3)%d

  DIAGS(1:OpenAD_Symbol_1028,3)%d = 0.0d0
  integer_tape_pointer = integer_tape_pointer-1
  OpenAD_Symbol_1030 = integer_tape(integer_tape_pointer)
  DIAG_TMP(1:OpenAD_Symbol_1030)%d = 0.0d0
  integer_tape_pointer = integer_tape_pointer-1
  NY = integer_tape(integer_tape_pointer)
  integer_tape_pointer = integer_tape_pointer-1
  NX = integer_tape(integer_tape_pointer)
  integer_tape_pointer = integer_tape_pointer-1
  NZ = integer_tape(integer_tape_pointer)
  CALL MYMAX_1_0_DOUBLE(DIAGS(1:NZ*NX*NY,3),OAD_CTMP2,DIAG_TMP)
  integer_tape_pointer = integer_tape_pointer-1
  OpenAD_Symbol_1031 = integer_tape(integer_tape_pointer)
  integer_tape_pointer = integer_tape_pointer-1
  OpenAD_Symbol_1032 = integer_tape(integer_tape_pointer)
  DIAG_TMP(1:OpenAD_Symbol_1032)%d = DIAG_TMP(1:OpenAD_Symbol_1032)%d+DIAGS(1:Op&
     &enAD_Symbol_1031,2)%d

  DIAGS(1:OpenAD_Symbol_1031,2)%d = 0.0d0
  integer_tape_pointer = integer_tape_pointer-1
  OpenAD_Symbol_1033 = integer_tape(integer_tape_pointer)
  DIAG_TMP(1:OpenAD_Symbol_1033)%d = 0.0d0
  integer_tape_pointer = integer_tape_pointer-1
  NY = integer_tape(integer_tape_pointer)
  integer_tape_pointer = integer_tape_pointer-1
  NX = integer_tape(integer_tape_pointer)
  integer_tape_pointer = integer_tape_pointer-1
  NZ = integer_tape(integer_tape_pointer)
  CALL MYMAX_1_0_DOUBLE(DIAGS(1:NZ*NX*NY,2),OAD_CTMP1,DIAG_TMP)
  integer_tape_pointer = integer_tape_pointer-1
  OpenAD_Symbol_1034 = integer_tape(integer_tape_pointer)
  integer_tape_pointer = integer_tape_pointer-1
  OpenAD_Symbol_1035 = integer_tape(integer_tape_pointer)
  DIAG_TMP(1:OpenAD_Symbol_1035)%d = DIAG_TMP(1:OpenAD_Symbol_1035)%d+DIAGS(1:Op&
     &enAD_Symbol_1034,1)%d

  DIAGS(1:OpenAD_Symbol_1034,1)%d = 0.0d0
  integer_tape_pointer = integer_tape_pointer-1
  OpenAD_Symbol_1036 = integer_tape(integer_tape_pointer)
  DIAG_TMP(1:OpenAD_Symbol_1036)%d = 0.0d0
  integer_tape_pointer = integer_tape_pointer-1
  NY = integer_tape(integer_tape_pointer)
  integer_tape_pointer = integer_tape_pointer-1
  NX = integer_tape(integer_tape_pointer)
  integer_tape_pointer = integer_tape_pointer-1
  NZ = integer_tape(integer_tape_pointer)
  CALL MYMAX_1_0_DOUBLE(DIAGS(1:NZ*NX*NY,1),OAD_CTMP0,DIAG_TMP)
  integer_tape_pointer = integer_tape_pointer-1
  OpenAD_Symbol_1037 = integer_tape(integer_tape_pointer)
  DIAG_TMP(1:OpenAD_Symbol_1037)%d = 0.0d0
  integer_tape_pointer = integer_tape_pointer-1
  NY = integer_tape(integer_tape_pointer)
  integer_tape_pointer = integer_tape_pointer-1
  NX = integer_tape(integer_tape_pointer)
  integer_tape_pointer = integer_tape_pointer-1
  NZ = integer_tape(integer_tape_pointer)
  CALL MYRESHAPE_3_1(VXYZ,DIAGS(1:NZ*NX*NY,7))
  integer_tape_pointer = integer_tape_pointer-1
  OpenAD_Symbol_1038 = integer_tape(integer_tape_pointer)
  integer_tape_pointer = integer_tape_pointer-1
  OpenAD_Symbol_1039 = integer_tape(integer_tape_pointer)
  integer_tape_pointer = integer_tape_pointer-1
  OpenAD_Symbol_1040 = integer_tape(integer_tape_pointer)
  V(3,1:OpenAD_Symbol_1040,1:OpenAD_Symbol_1039,1:OpenAD_Symbol_1038)%d = V(3,1:&
     &OpenAD_Symbol_1040,1:OpenAD_Symbol_1039,1:OpenAD_Symbol_1038)%d+VXYZ(1:Ope&
     &nAD_Symbol_1040,1:OpenAD_Symbol_1039,1:OpenAD_Symbol_1038)%d

  VXYZ(1:OpenAD_Symbol_1040,1:OpenAD_Symbol_1039,1:OpenAD_Symbol_1038)%d = 0.0d0
  integer_tape_pointer = integer_tape_pointer-1
  NY = integer_tape(integer_tape_pointer)
  integer_tape_pointer = integer_tape_pointer-1
  NX = integer_tape(integer_tape_pointer)
  integer_tape_pointer = integer_tape_pointer-1
  NZ = integer_tape(integer_tape_pointer)
  CALL MYRESHAPE_3_1(VXYZ,DIAGS(1:NZ*NX*NY,6))
  integer_tape_pointer = integer_tape_pointer-1
  OpenAD_Symbol_1041 = integer_tape(integer_tape_pointer)
  integer_tape_pointer = integer_tape_pointer-1
  OpenAD_Symbol_1042 = integer_tape(integer_tape_pointer)
  integer_tape_pointer = integer_tape_pointer-1
  OpenAD_Symbol_1043 = integer_tape(integer_tape_pointer)
  V(2,1:OpenAD_Symbol_1043,1:OpenAD_Symbol_1042,1:OpenAD_Symbol_1041)%d = V(2,1:&
     &OpenAD_Symbol_1043,1:OpenAD_Symbol_1042,1:OpenAD_Symbol_1041)%d+VXYZ(1:Ope&
     &nAD_Symbol_1043,1:OpenAD_Symbol_1042,1:OpenAD_Symbol_1041)%d

  VXYZ(1:OpenAD_Symbol_1043,1:OpenAD_Symbol_1042,1:OpenAD_Symbol_1041)%d = 0.0d0
  integer_tape_pointer = integer_tape_pointer-1
  NY = integer_tape(integer_tape_pointer)
  integer_tape_pointer = integer_tape_pointer-1
  NX = integer_tape(integer_tape_pointer)
  integer_tape_pointer = integer_tape_pointer-1
  NZ = integer_tape(integer_tape_pointer)
  CALL MYRESHAPE_3_1(VXYZ,DIAGS(1:NZ*NX*NY,5))
  integer_tape_pointer = integer_tape_pointer-1
  OpenAD_Symbol_1044 = integer_tape(integer_tape_pointer)
  integer_tape_pointer = integer_tape_pointer-1
  OpenAD_Symbol_1045 = integer_tape(integer_tape_pointer)
  integer_tape_pointer = integer_tape_pointer-1
  OpenAD_Symbol_1046 = integer_tape(integer_tape_pointer)
  V(1,1:OpenAD_Symbol_1046,1:OpenAD_Symbol_1045,1:OpenAD_Symbol_1044)%d = V(1,1:&
     &OpenAD_Symbol_1046,1:OpenAD_Symbol_1045,1:OpenAD_Symbol_1044)%d+VXYZ(1:Ope&
     &nAD_Symbol_1046,1:OpenAD_Symbol_1045,1:OpenAD_Symbol_1044)%d

  VXYZ(1:OpenAD_Symbol_1046,1:OpenAD_Symbol_1045,1:OpenAD_Symbol_1044)%d = 0.0d0
  integer_tape_pointer = integer_tape_pointer-1
  NY = integer_tape(integer_tape_pointer)
  integer_tape_pointer = integer_tape_pointer-1
  NX = integer_tape(integer_tape_pointer)
  integer_tape_pointer = integer_tape_pointer-1
  NZ = integer_tape(integer_tape_pointer)
  CALL MYRESHAPE_3_1(VXYZ,DIAGS(1:NZ*NX*NY,3))
  integer_tape_pointer = integer_tape_pointer-1
  OpenAD_Symbol_1047 = integer_tape(integer_tape_pointer)
  integer_tape_pointer = integer_tape_pointer-1
  OpenAD_Symbol_1048 = integer_tape(integer_tape_pointer)
  integer_tape_pointer = integer_tape_pointer-1
  OpenAD_Symbol_1049 = integer_tape(integer_tape_pointer)
  integer_tape_pointer = integer_tape_pointer-1
  OpenAD_Symbol_1050 = integer_tape(integer_tape_pointer)
  V(1,2:OpenAD_Symbol_1050,1:OpenAD_Symbol_1049,1:OpenAD_Symbol_1048)%d = V(1,2:&
     &OpenAD_Symbol_1050,1:OpenAD_Symbol_1049,1:OpenAD_Symbol_1048)%d+VXYZ(1:Ope&
     &nAD_Symbol_1047,1:OpenAD_Symbol_1049,1:OpenAD_Symbol_1048)%d

  VXYZ(1:OpenAD_Symbol_1047,1:OpenAD_Symbol_1049,1:OpenAD_Symbol_1048)%d = 0.0d0
  integer_tape_pointer = integer_tape_pointer-1
  NY = integer_tape(integer_tape_pointer)
  integer_tape_pointer = integer_tape_pointer-1
  NX = integer_tape(integer_tape_pointer)
  integer_tape_pointer = integer_tape_pointer-1
  NZ = integer_tape(integer_tape_pointer)
  CALL MYRESHAPE_3_1(VXYZ,DIAGS(1:NZ*NX*NY,2))
  integer_tape_pointer = integer_tape_pointer-1
  OpenAD_Symbol_1051 = integer_tape(integer_tape_pointer)
  integer_tape_pointer = integer_tape_pointer-1
  OpenAD_Symbol_1052 = integer_tape(integer_tape_pointer)
  integer_tape_pointer = integer_tape_pointer-1
  OpenAD_Symbol_1053 = integer_tape(integer_tape_pointer)
  integer_tape_pointer = integer_tape_pointer-1
  OpenAD_Symbol_1054 = integer_tape(integer_tape_pointer)
  V(2,1:OpenAD_Symbol_1053,2:OpenAD_Symbol_1054,1:OpenAD_Symbol_1052)%d = V(2,1:&
     &OpenAD_Symbol_1053,2:OpenAD_Symbol_1054,1:OpenAD_Symbol_1052)%d+VXYZ(1:Ope&
     &nAD_Symbol_1053,1:OpenAD_Symbol_1051,1:OpenAD_Symbol_1052)%d

  VXYZ(1:OpenAD_Symbol_1053,1:OpenAD_Symbol_1051,1:OpenAD_Symbol_1052)%d = 0.0d0
  integer_tape_pointer = integer_tape_pointer-1
  NY = integer_tape(integer_tape_pointer)
  integer_tape_pointer = integer_tape_pointer-1
  NX = integer_tape(integer_tape_pointer)
  integer_tape_pointer = integer_tape_pointer-1
  NZ = integer_tape(integer_tape_pointer)
  CALL MYRESHAPE_3_1(VXYZ,DIAGS(1:NZ*NX*NY,1))
  integer_tape_pointer = integer_tape_pointer-1
  OpenAD_Symbol_1055 = integer_tape(integer_tape_pointer)
  integer_tape_pointer = integer_tape_pointer-1
  OpenAD_Symbol_1056 = integer_tape(integer_tape_pointer)
  integer_tape_pointer = integer_tape_pointer-1
  OpenAD_Symbol_1057 = integer_tape(integer_tape_pointer)
  integer_tape_pointer = integer_tape_pointer-1
  OpenAD_Symbol_1058 = integer_tape(integer_tape_pointer)
  V(3,1:OpenAD_Symbol_1057,1:OpenAD_Symbol_1056,2:OpenAD_Symbol_1058)%d = V(3,1:&
     &OpenAD_Symbol_1057,1:OpenAD_Symbol_1056,2:OpenAD_Symbol_1058)%d+VXYZ(1:Ope&
     &nAD_Symbol_1057,1:OpenAD_Symbol_1056,1:OpenAD_Symbol_1055)%d

  VXYZ(1:OpenAD_Symbol_1057,1:OpenAD_Symbol_1056,1:OpenAD_Symbol_1055)%d = 0.0d0
  integer_tape_pointer = integer_tape_pointer-1
  OpenAD_Symbol_1059 = integer_tape(integer_tape_pointer)
  DIAGS(1:OpenAD_Symbol_1059,1:7)%d = 0.0d0
    end if
  end subroutine GENA
!#########################################################
! This file is part of OpenAD released under the LGPL.   #
! The full COPYRIGHT notice can be found in the top      #
! level directory of the OpenAD distribution             #
!#########################################################

  SUBROUTINE TPFA(NX, NY, NZ, K, Q, P, V)
    use OAD_tape
    use OAD_rev

! original arguments get inserted before version
!         ! and declared here together with all local variables
!         ! generated by xaifBooster

  use w2f__types
  IMPLICIT NONE
!
!       **** Global Variables & Derived Type Definitions ****
!
  INTEGER(w2f__i8) OpenAD_Symbol_483
  INTEGER(w2f__i8) OpenAD_Symbol_484
  INTEGER(w2f__i8) OpenAD_Symbol_485
  INTEGER(w2f__i8) OpenAD_Symbol_486
  INTEGER(w2f__i8) OpenAD_Symbol_487
  INTEGER(w2f__i8) OpenAD_Symbol_488
  INTEGER(w2f__i8) OpenAD_Symbol_489
  INTEGER(w2f__i8) OpenAD_Symbol_490
  INTEGER(w2f__i8) OpenAD_Symbol_491
  INTEGER(w2f__i8) OpenAD_Symbol_492
  INTEGER(w2f__i8) OpenAD_Symbol_493
  INTEGER(w2f__i8) OpenAD_Symbol_494
  INTEGER(w2f__i8) OpenAD_Symbol_495
  INTEGER(w2f__i8) OpenAD_Symbol_496
  INTEGER(w2f__i8) OpenAD_Symbol_497
  INTEGER(w2f__i8) OpenAD_Symbol_498
  INTEGER(w2f__i8) OpenAD_Symbol_499
  INTEGER(w2f__i8) OpenAD_Symbol_500
  INTEGER(w2f__i8) OpenAD_Symbol_501
  INTEGER(w2f__i8) OpenAD_Symbol_502
  INTEGER(w2f__i8) OpenAD_Symbol_503
  INTEGER(w2f__i8) OpenAD_Symbol_504
  INTEGER(w2f__i8) OpenAD_Symbol_505
  INTEGER(w2f__i8) OpenAD_Symbol_506
  INTEGER(w2f__i8) OpenAD_Symbol_507
  INTEGER(w2f__i8) OpenAD_Symbol_508
  INTEGER(w2f__i8) OpenAD_Symbol_509
  INTEGER(w2f__i8) OpenAD_Symbol_510
  INTEGER(w2f__i8) OpenAD_Symbol_511
  INTEGER(w2f__i8) OpenAD_Symbol_512
  INTEGER(w2f__i8) OpenAD_Symbol_513
  INTEGER(w2f__i8) OpenAD_Symbol_514
  INTEGER(w2f__i8) OpenAD_Symbol_515
  INTEGER(w2f__i8) OpenAD_Symbol_516
  INTEGER(w2f__i8) OpenAD_Symbol_517
  INTEGER(w2f__i8) OpenAD_Symbol_518
  INTEGER(w2f__i8) OpenAD_Symbol_519
  INTEGER(w2f__i8) OpenAD_Symbol_520
  INTEGER(w2f__i8) OpenAD_Symbol_521
  INTEGER(w2f__i8) OpenAD_Symbol_522
  INTEGER(w2f__i8) OpenAD_Symbol_523
  INTEGER(w2f__i8) OpenAD_Symbol_524
  INTEGER(w2f__i8) OpenAD_Symbol_525
  INTEGER(w2f__i8) OpenAD_Symbol_526
  INTEGER(w2f__i8) OpenAD_Symbol_527
  INTEGER(w2f__i8) OpenAD_Symbol_528
  INTEGER(w2f__i8) OpenAD_Symbol_529
  INTEGER(w2f__i8) OpenAD_Symbol_530
  INTEGER(w2f__i8) OpenAD_Symbol_531
  INTEGER(w2f__i8) OpenAD_Symbol_532
  INTEGER(w2f__i8) OpenAD_Symbol_533
  INTEGER(w2f__i8) OpenAD_Symbol_534
  INTEGER(w2f__i8) OpenAD_Symbol_535
  INTEGER(w2f__i8) OpenAD_Symbol_536
  INTEGER(w2f__i8) OpenAD_Symbol_537
  INTEGER(w2f__i8) OpenAD_Symbol_538
  INTEGER(w2f__i8) OpenAD_Symbol_539
  INTEGER(w2f__i8) OpenAD_Symbol_540
  INTEGER(w2f__i8) OpenAD_Symbol_541
  INTEGER(w2f__i8) OpenAD_Symbol_542
  INTEGER(w2f__i8) OpenAD_Symbol_543
  INTEGER(w2f__i8) OpenAD_Symbol_544
  INTEGER(w2f__i8) OpenAD_Symbol_545
  INTEGER(w2f__i8) OpenAD_Symbol_546
  INTEGER(w2f__i8) OpenAD_Symbol_547
  INTEGER(w2f__i8) OpenAD_Symbol_548
  INTEGER(w2f__i8) OpenAD_Symbol_549
  INTEGER(w2f__i8) OpenAD_Symbol_550
  INTEGER(w2f__i8) OpenAD_Symbol_551
  INTEGER(w2f__i8) OpenAD_Symbol_552
  INTEGER(w2f__i8) OpenAD_Symbol_553
  INTEGER(w2f__i8) OpenAD_Symbol_554
  INTEGER(w2f__i8) OpenAD_Symbol_555
  INTEGER(w2f__i8) OpenAD_Symbol_556
  INTEGER(w2f__i8) OpenAD_Symbol_557
  INTEGER(w2f__i8) OpenAD_Symbol_558
  INTEGER(w2f__i8) OpenAD_Symbol_559
  INTEGER(w2f__i8) OpenAD_Symbol_560
  INTEGER(w2f__i8) OpenAD_Symbol_561
  INTEGER(w2f__i8) OpenAD_Symbol_562
  INTEGER(w2f__i8) OpenAD_Symbol_563
  INTEGER(w2f__i8) OpenAD_Symbol_564
  INTEGER(w2f__i8) OpenAD_Symbol_565
  INTEGER(w2f__i8) OpenAD_Symbol_566
  INTEGER(w2f__i8) OpenAD_Symbol_567
  INTEGER(w2f__i8) OpenAD_Symbol_568
  INTEGER(w2f__i8) OpenAD_Symbol_569
  INTEGER(w2f__i8) OpenAD_Symbol_570
  INTEGER(w2f__i8) OpenAD_Symbol_571
  INTEGER(w2f__i8) OpenAD_Symbol_572
  INTEGER(w2f__i8) OpenAD_Symbol_573
  INTEGER(w2f__i8) OpenAD_Symbol_574
  INTEGER(w2f__i8) OpenAD_Symbol_575
  INTEGER(w2f__i8) OpenAD_Symbol_576
  INTEGER(w2f__i8) OpenAD_Symbol_577
  INTEGER(w2f__i8) OpenAD_Symbol_578
  INTEGER(w2f__i8) OpenAD_Symbol_579
  INTEGER(w2f__i8) OpenAD_Symbol_580
  INTEGER(w2f__i8) OpenAD_Symbol_581
  INTEGER(w2f__i8) OpenAD_Symbol_582
  INTEGER(w2f__i8) OpenAD_Symbol_583
  INTEGER(w2f__i8) OpenAD_Symbol_584
  INTEGER(w2f__i8) OpenAD_Symbol_585
  INTEGER(w2f__i8) OpenAD_Symbol_586
  INTEGER(w2f__i8) OpenAD_Symbol_587
  INTEGER(w2f__i8) OpenAD_Symbol_588
  INTEGER(w2f__i8) OpenAD_Symbol_589
  INTEGER(w2f__i8) OpenAD_Symbol_590
  INTEGER(w2f__i8) OpenAD_Symbol_591
  INTEGER(w2f__i8) OpenAD_Symbol_592
  INTEGER(w2f__i8) OpenAD_Symbol_593
  INTEGER(w2f__i8) OpenAD_Symbol_594
  INTEGER(w2f__i8) OpenAD_Symbol_595
  INTEGER(w2f__i8) OpenAD_Symbol_596
  INTEGER(w2f__i8) OpenAD_Symbol_597
  INTEGER(w2f__i8) OpenAD_Symbol_598
  INTEGER(w2f__i8) OpenAD_Symbol_599
  INTEGER(w2f__i8) OpenAD_Symbol_600
  INTEGER(w2f__i8) OpenAD_Symbol_601
  INTEGER(w2f__i8) OpenAD_Symbol_602
  INTEGER(w2f__i8) OpenAD_Symbol_603
  INTEGER(w2f__i8) OpenAD_Symbol_604
  INTEGER(w2f__i8) OpenAD_Symbol_605
  INTEGER(w2f__i8) OpenAD_Symbol_606
  INTEGER(w2f__i8) OpenAD_Symbol_607
  INTEGER(w2f__i8) OpenAD_Symbol_608
  INTEGER(w2f__i8) OpenAD_Symbol_609
  INTEGER(w2f__i8) OpenAD_Symbol_610
  INTEGER(w2f__i8) OpenAD_Symbol_611
  INTEGER(w2f__i8) OpenAD_Symbol_612
  INTEGER(w2f__i8) OpenAD_Symbol_613
  INTEGER(w2f__i8) OpenAD_Symbol_614
  INTEGER(w2f__i8) OpenAD_Symbol_615
  INTEGER(w2f__i8) OpenAD_Symbol_616
  INTEGER(w2f__i8) OpenAD_Symbol_617
  INTEGER(w2f__i8) OpenAD_Symbol_618
  INTEGER(w2f__i8) OpenAD_Symbol_619
  INTEGER(w2f__i8) OpenAD_Symbol_620
  INTEGER(w2f__i8) OpenAD_Symbol_621
  INTEGER(w2f__i8) OpenAD_Symbol_622
  INTEGER(w2f__i8) OpenAD_Symbol_623
  INTEGER(w2f__i8) OpenAD_Symbol_624
  INTEGER(w2f__i8) OpenAD_Symbol_625
  INTEGER(w2f__i8) OpenAD_Symbol_626
  INTEGER(w2f__i8) OpenAD_Symbol_627
  INTEGER(w2f__i8) OpenAD_Symbol_628
  INTEGER(w2f__i8) OpenAD_Symbol_629
  INTEGER(w2f__i8) OpenAD_Symbol_630
  INTEGER(w2f__i8) OpenAD_Symbol_631
  INTEGER(w2f__i8) OpenAD_Symbol_632
  INTEGER(w2f__i8) OpenAD_Symbol_633
  INTEGER(w2f__i8) OpenAD_Symbol_634
  INTEGER(w2f__i8) OpenAD_Symbol_635
  INTEGER(w2f__i8) OpenAD_Symbol_636
  INTEGER(w2f__i8) OpenAD_Symbol_637
  INTEGER(w2f__i8) OpenAD_Symbol_638
  INTEGER(w2f__i8) OpenAD_Symbol_639
  INTEGER(w2f__i8) OpenAD_Symbol_640
  INTEGER(w2f__i8) OpenAD_Symbol_641
  INTEGER(w2f__i8) OpenAD_Symbol_642
  INTEGER(w2f__i8) OpenAD_Symbol_643
  INTEGER(w2f__i8) OpenAD_Symbol_644
  INTEGER(w2f__i8) OpenAD_Symbol_645
  INTEGER(w2f__i8) OpenAD_Symbol_646
  INTEGER(w2f__i8) OpenAD_Symbol_647
  INTEGER(w2f__i8) OpenAD_Symbol_648
  INTEGER(w2f__i8) OpenAD_Symbol_649
  INTEGER(w2f__i8) OpenAD_Symbol_650
  INTEGER(w2f__i8) OpenAD_Symbol_651
  INTEGER(w2f__i8) OpenAD_Symbol_652
  INTEGER(w2f__i8) OpenAD_Symbol_653
  INTEGER(w2f__i8) OpenAD_Symbol_654
  INTEGER(w2f__i8) OpenAD_Symbol_655
  INTEGER(w2f__i8) OpenAD_Symbol_656
  INTEGER(w2f__i8) OpenAD_Symbol_657
  INTEGER(w2f__i8) OpenAD_Symbol_658
  INTEGER(w2f__i8) OpenAD_Symbol_659
  INTEGER(w2f__i8) OpenAD_Symbol_660
  INTEGER(w2f__i8) OpenAD_Symbol_661
  INTEGER(w2f__i8) OpenAD_Symbol_662
  INTEGER(w2f__i8) OpenAD_Symbol_663
  INTEGER(w2f__i8) OpenAD_Symbol_664
  INTEGER(w2f__i8) OpenAD_Symbol_665
  INTEGER(w2f__i8) OpenAD_Symbol_666
  INTEGER(w2f__i8) OpenAD_Symbol_667
  INTEGER(w2f__i8) OpenAD_Symbol_668
  INTEGER(w2f__i8) OpenAD_Symbol_669
  INTEGER(w2f__i8) OpenAD_Symbol_670
  INTEGER(w2f__i8) OpenAD_Symbol_671
  INTEGER(w2f__i8) OpenAD_Symbol_672
  INTEGER(w2f__i8) OpenAD_Symbol_673
  INTEGER(w2f__i8) OpenAD_Symbol_674
  INTEGER(w2f__i8) OpenAD_Symbol_675
  INTEGER(w2f__i8) OpenAD_Symbol_676
  INTEGER(w2f__i8) OpenAD_Symbol_677
  INTEGER(w2f__i8) OpenAD_Symbol_678
  INTEGER(w2f__i8) OpenAD_Symbol_679
  INTEGER(w2f__i8) OpenAD_Symbol_680
  INTEGER(w2f__i8) OpenAD_Symbol_681
  INTEGER(w2f__i8) OpenAD_Symbol_682
  INTEGER(w2f__i8) OpenAD_Symbol_683
  INTEGER(w2f__i8) OpenAD_Symbol_684
  INTEGER(w2f__i8) OpenAD_Symbol_685
  INTEGER(w2f__i8) OpenAD_Symbol_686
  INTEGER(w2f__i8) OpenAD_Symbol_687
  INTEGER(w2f__i8) OpenAD_Symbol_688
  INTEGER(w2f__i8) OpenAD_Symbol_689
  INTEGER(w2f__i8) OpenAD_Symbol_690
  INTEGER(w2f__i8) OpenAD_Symbol_691
  INTEGER(w2f__i8) OpenAD_Symbol_692
  INTEGER(w2f__i8) OpenAD_Symbol_693
  INTEGER(w2f__i8) OpenAD_Symbol_694
  INTEGER(w2f__i8) OpenAD_Symbol_695
  INTEGER(w2f__i8) OpenAD_Symbol_696
  INTEGER(w2f__i8) OpenAD_Symbol_697
  INTEGER(w2f__i8) OpenAD_Symbol_698
  INTEGER(w2f__i8) OpenAD_Symbol_699
  INTEGER(w2f__i8) OpenAD_Symbol_700
  INTEGER(w2f__i8) OpenAD_Symbol_701
  INTEGER(w2f__i8) OpenAD_Symbol_702
  INTEGER(w2f__i8) OpenAD_Symbol_703
  INTEGER(w2f__i8) OpenAD_Symbol_704
  INTEGER(w2f__i8) OpenAD_Symbol_705
  INTEGER(w2f__i8) OpenAD_Symbol_706
  INTEGER(w2f__i8) OpenAD_Symbol_707
  INTEGER(w2f__i8) OpenAD_Symbol_708
  INTEGER(w2f__i8) OpenAD_Symbol_709
  INTEGER(w2f__i8) OpenAD_Symbol_710
  INTEGER(w2f__i8) OpenAD_Symbol_711
  INTEGER(w2f__i8) OpenAD_Symbol_712
  INTEGER(w2f__i8) OpenAD_Symbol_713
  INTEGER(w2f__i8) OpenAD_Symbol_714
  INTEGER(w2f__i8) OpenAD_Symbol_715
  INTEGER(w2f__i8) OpenAD_Symbol_716
  INTEGER(w2f__i8) OpenAD_Symbol_717
  INTEGER(w2f__i8) OpenAD_Symbol_718
  INTEGER(w2f__i8) OpenAD_Symbol_719
  INTEGER(w2f__i8) OpenAD_Symbol_720
  INTEGER(w2f__i8) OpenAD_Symbol_721
  INTEGER(w2f__i8) OpenAD_Symbol_722
  INTEGER(w2f__i8) OpenAD_Symbol_723
  INTEGER(w2f__i8) OpenAD_Symbol_724
  INTEGER(w2f__i8) OpenAD_Symbol_725
  INTEGER(w2f__i8) OpenAD_Symbol_726
  INTEGER(w2f__i8) OpenAD_Symbol_727
  INTEGER(w2f__i8) OpenAD_Symbol_728
  INTEGER(w2f__i8) OpenAD_Symbol_729
  INTEGER(w2f__i8) OpenAD_Symbol_730
  INTEGER(w2f__i8) OpenAD_Symbol_731
  INTEGER(w2f__i8) OpenAD_Symbol_732
  INTEGER(w2f__i8) OpenAD_Symbol_733
  INTEGER(w2f__i8) OpenAD_Symbol_734
  INTEGER(w2f__i8) OpenAD_Symbol_735
  INTEGER(w2f__i8) OpenAD_Symbol_736
  INTEGER(w2f__i8) OpenAD_Symbol_737
  INTEGER(w2f__i8) OpenAD_Symbol_738
  INTEGER(w2f__i8) OpenAD_Symbol_739
  INTEGER(w2f__i8) OpenAD_Symbol_740
!
!       **** Parameters and Result ****
!
  INTEGER(w2f__i4) NX
  INTEGER(w2f__i4) NY
  INTEGER(w2f__i4) NZ
  type(active) :: K(1:3,1:NX,1:NY,1:NZ)
  type(active) :: Q(1:INT((NZ*NX*NY)))
  type(active) :: P(1:NX,1:NY,1:NZ)
  type(active) :: V(1:3,1:INT((NX+1)),1:INT((NY+1)),1:INT((NZ+1)))
!
!       **** Local Variables and Functions ****
!
  INTEGER(w2f__i4) ACOL_INDEX(1 : INT((NZ * NX * NY * 7)))
  INTEGER(w2f__i4) ANNZ
  INTEGER(w2f__i4) AROW_COMPRESSED(1 : INT((NZ * NX * NY + 1)))
  INTEGER(w2f__i4) AROW_INDEX(1 : INT((NZ * NX * NY * 7)))
  type(active) :: AVALUES(1:INT((NZ*NX*NY*7)))
  type(active) :: DIAGS(1:INT((NZ*NX*NY)),1:7)
  INTEGER(w2f__i4) H
  INTEGER(w2f__i4) I
  INTEGER(w2f__i4) J
  type(active) :: L(1:3,1:NX,1:NY,1:NZ)
  INTEGER(w2f__i4) M
  INTEGER(w2f__i4) N
  type(active) :: TX(1:INT((NX+1)),1:NY,1:NZ)
  type(active) :: TXYZ(1:NX,1:NY,1:NZ)
  REAL(w2f__8) TX_
  type(active) :: TY(1:NX,1:INT((NY+1)),1:NZ)
  REAL(w2f__8) TY_
  type(active) :: TZ(1:NX,1:NY,1:INT((NZ+1)))
  REAL(w2f__8) TZ_
  type(active) :: U(1:INT((NZ*NX*NY)))
  INTEGER(w2f__i4) OpenAD_Symbol_1091
  INTEGER(w2f__i4) OpenAD_Symbol_1092
  INTEGER(w2f__i4) OpenAD_Symbol_1093
  INTEGER(w2f__i4) OpenAD_Symbol_1094
  REAL(w2f__8) OpenAD_Symbol_1095
  INTEGER(w2f__i4) OpenAD_Symbol_1096
  INTEGER(w2f__i4) OpenAD_Symbol_1097
  INTEGER(w2f__i4) OpenAD_Symbol_1098
  INTEGER(w2f__i4) OpenAD_Symbol_1099
  INTEGER(w2f__i4) OpenAD_Symbol_1100
  INTEGER(w2f__i4) OpenAD_Symbol_1101
  INTEGER(w2f__i4) OpenAD_Symbol_1102
  INTEGER(w2f__i4) OpenAD_Symbol_1103
  INTEGER(w2f__i4) OpenAD_Symbol_1104
  REAL(w2f__8) OpenAD_Symbol_1105
  INTEGER(w2f__i4) OpenAD_Symbol_1106
  INTEGER(w2f__i4) OpenAD_Symbol_1107
  INTEGER(w2f__i4) OpenAD_Symbol_1108
  INTEGER(w2f__i4) OpenAD_Symbol_1109
  REAL(w2f__8) OpenAD_Symbol_1110
  INTEGER(w2f__i4) OpenAD_Symbol_1111
  INTEGER(w2f__i4) OpenAD_Symbol_1112
  INTEGER(w2f__i4) OpenAD_Symbol_1113
  INTEGER(w2f__i4) OpenAD_Symbol_1114
  REAL(w2f__8) OpenAD_Symbol_1115
  INTEGER(w2f__i4) OpenAD_Symbol_1116
  INTEGER(w2f__i4) OpenAD_Symbol_1117
  INTEGER(w2f__i4) OpenAD_Symbol_1118
  INTEGER(w2f__i4) OpenAD_Symbol_1119
  INTEGER(w2f__i4) OpenAD_Symbol_1120
  INTEGER(w2f__i4) OpenAD_Symbol_1121
  INTEGER(w2f__i4) OpenAD_Symbol_1122
  INTEGER(w2f__i4) OpenAD_Symbol_1123
  INTEGER(w2f__i4) OpenAD_Symbol_1124
  INTEGER(w2f__i4) OpenAD_Symbol_1125
  INTEGER(w2f__i4) OpenAD_Symbol_1126
  INTEGER(w2f__i4) OpenAD_Symbol_1127
  INTEGER(w2f__i4) OpenAD_Symbol_1128
  INTEGER(w2f__i4) OpenAD_Symbol_1129
  INTEGER(w2f__i4) OpenAD_Symbol_1130
  INTEGER(w2f__i4) OpenAD_Symbol_1131
  INTEGER(w2f__i4) OpenAD_Symbol_1132
  INTEGER(w2f__i4) OpenAD_Symbol_1133
  INTEGER(w2f__i4) OpenAD_Symbol_1134
  INTEGER(w2f__i4) OpenAD_Symbol_1135
  INTEGER(w2f__i4) OpenAD_Symbol_1136
  INTEGER(w2f__i4) OpenAD_Symbol_1137
  INTEGER(w2f__i4) OpenAD_Symbol_1138
  INTEGER(w2f__i4) OpenAD_Symbol_1139
  INTEGER(w2f__i4) OpenAD_Symbol_1140
  INTEGER(w2f__i4) OpenAD_Symbol_1141
  INTEGER(w2f__i4) OpenAD_Symbol_1142
  INTEGER(w2f__i4) OpenAD_Symbol_1143
  INTEGER(w2f__i4) OpenAD_Symbol_1144
  INTEGER(w2f__i4) OpenAD_Symbol_1145
  INTEGER(w2f__i4) OpenAD_Symbol_1146
  INTEGER(w2f__i4) OpenAD_Symbol_1147
  INTEGER(w2f__i4) OpenAD_Symbol_1148
  INTEGER(w2f__i4) OpenAD_Symbol_1149
  INTEGER(w2f__i4) OpenAD_Symbol_1150
  INTEGER(w2f__i4) OpenAD_Symbol_1151
  INTEGER(w2f__i4) OpenAD_Symbol_1152
  INTEGER(w2f__i4) OpenAD_Symbol_1153
  INTEGER(w2f__i4) OpenAD_Symbol_1154
  INTEGER(w2f__i4) OpenAD_Symbol_1155
  REAL(w2f__8) OpenAD_Symbol_1156
  REAL(w2f__8) OpenAD_Symbol_1157
  INTEGER(w2f__i4) OpenAD_Symbol_1158
  INTEGER(w2f__i4) OpenAD_Symbol_1159
  INTEGER(w2f__i4) OpenAD_Symbol_1160
  INTEGER(w2f__i4) OpenAD_Symbol_1161
  REAL(w2f__8) OpenAD_Symbol_1162
  REAL(w2f__8) OpenAD_Symbol_1163
  INTEGER(w2f__i4) OpenAD_Symbol_1164
  INTEGER(w2f__i4) OpenAD_Symbol_1165
  INTEGER(w2f__i4) OpenAD_Symbol_1166
  INTEGER(w2f__i4) OpenAD_Symbol_1167
  REAL(w2f__8) OpenAD_Symbol_1168
  REAL(w2f__8) OpenAD_Symbol_1169
  INTEGER(w2f__i4) OpenAD_Symbol_1170
  INTEGER(w2f__i4) OpenAD_Symbol_741
  INTEGER(w2f__i4) OpenAD_Symbol_742
  INTEGER(w2f__i4) OpenAD_Symbol_743
  INTEGER(w2f__i4) OpenAD_Symbol_744
  INTEGER(w2f__i4) OpenAD_Symbol_745
  INTEGER(w2f__i4) OpenAD_Symbol_746
  INTEGER(w2f__i4) OpenAD_Symbol_747
  INTEGER(w2f__i4) OpenAD_Symbol_748
  INTEGER(w2f__i4) OpenAD_Symbol_749
  INTEGER(w2f__i4) OpenAD_Symbol_750
  INTEGER(w2f__i4) OpenAD_Symbol_751
  INTEGER(w2f__i4) OpenAD_Symbol_752
  INTEGER(w2f__i4) OpenAD_Symbol_753
  INTEGER(w2f__i4) OpenAD_Symbol_754
  INTEGER(w2f__i4) OpenAD_Symbol_755
  INTEGER(w2f__i4) OpenAD_Symbol_756
  INTEGER(w2f__i4) OpenAD_Symbol_757
  INTEGER(w2f__i4) OpenAD_Symbol_758
  INTEGER(w2f__i4) OpenAD_Symbol_759
  INTEGER(w2f__i4) OpenAD_Symbol_760
  INTEGER(w2f__i4) OpenAD_Symbol_761
  INTEGER(w2f__i4) OpenAD_Symbol_762
  INTEGER(w2f__i4) OpenAD_Symbol_763
  INTEGER(w2f__i4) OpenAD_Symbol_764
  INTEGER(w2f__i4) OpenAD_Symbol_765
  REAL(w2f__8) OpenAD_aux_18
  REAL(w2f__8) OpenAD_aux_19
  REAL(w2f__8) OpenAD_aux_20
  REAL(w2f__8) OpenAD_aux_21
  REAL(w2f__8) OpenAD_aux_22
  REAL(w2f__8) OpenAD_aux_23
  REAL(w2f__8) OpenAD_lin_28
  REAL(w2f__8) OpenAD_lin_29
  REAL(w2f__8) OpenAD_lin_30
  REAL(w2f__8) OpenAD_lin_31
  REAL(w2f__8) OpenAD_lin_32
  REAL(w2f__8) OpenAD_lin_33
  REAL(w2f__8) OpenAD_lin_34
  REAL(w2f__8) OpenAD_lin_35
  REAL(w2f__8) OpenAD_lin_36
  REAL(w2f__8) OpenAD_lin_37
  type(active) :: OpenAD_prp_20
  type(active) :: OpenAD_prp_21
  type(active) :: OpenAD_prp_22
  type(active) :: OpenAD_prp_23(:)
  ALLOCATABLE OpenAD_prp_23
  type(active) :: OpenAD_prp_24(:)
  ALLOCATABLE OpenAD_prp_24
  type(active) :: OpenAD_prp_25(:)
  ALLOCATABLE OpenAD_prp_25
  type(active) :: OpenAD_prp_26(:)
  ALLOCATABLE OpenAD_prp_26
  type(active) :: OpenAD_prp_27(:)
  ALLOCATABLE OpenAD_prp_27
  type(active) :: OpenAD_prp_28(:)
  ALLOCATABLE OpenAD_prp_28
  type(active) :: OpenAD_prp_29
  type(active) :: OpenAD_prp_30
  type(active) :: OpenAD_prp_31


    integer iaddr
    external iaddr
!
!       **** Statements ****
!

   if (our_rev_mode%plain) then
! original function
  N = (NZ * NX * NY)
  DO H = 1, 3, 1
    DO I = 1, NX, 1
      DO J = 1, NY, 1
        DO M = 1, NZ, 1
          L(INT(H),INT(I),INT(J),INT(M))%v = (1.0D00/K(H,I,J,M)%v)
        END DO
      END DO
    END DO
  END DO
  TX_ = ((HZ*HY*2.0D00)/HX)
  TY_ = ((HZ*HX*2.0D00)/HY)
  TZ_ = ((HX*HY*2.0D00)/HZ)
  TX(1:NX+1,1:INT(NY),1:INT(NZ))%v = 0.0D00
  TY(1:INT(NX),1:NY+1,1:INT(NZ))%v = 0.0D00
  TZ(1:INT(NX),1:INT(NY),1:NZ+1)%v = 0.0D00
  DO I = 2,NX,1
    DO J = 1,NY,1
      DO M = 1,NZ,1
        TX(INT(I),INT(J),INT(M))%v = (TX_/(L(1,I,J,M)%v+L(1,I+(-1),J,M)%v))
      END DO
    END DO
  END DO
  DO I = 1,NX,1
    DO J = 2,NY,1
      DO M = 1,NZ,1
        TY(INT(I),INT(J),INT(M))%v = (TY_/(L(2,I,J,M)%v+L(2,I,J+(-1),M)%v))
      END DO
    END DO
  END DO
  DO I = 1,NX,1
    DO J = 1,NY,1
      DO M = 2,NZ,1
        TZ(INT(I),INT(J),INT(M))%v = (TZ_/(L(3,I,J,M)%v+L(3,I,J,M+(-1))%v))
      END DO
    END DO
  END DO
  DIAGS(1:NZ*NX*NY,1:7)%v = 0.0D00
  DO I = 1,NX,1
    DO J = 1,NY,1
      DO M = 1,NZ,1
        TXYZ(INT(I),INT(J),INT(M))%v = (-TX(I,J,M)%v)
      END DO
    END DO
  END DO
  CALL MYRESHAPE_3_1(TXYZ,DIAGS(1:NZ*NX*NY,5))
  DO I = 1,NX,1
    DO J = 1,NY,1
      DO M = 1,NZ,1
        TXYZ(INT(I),INT(J),INT(M))%v = (-TY(I,J,M)%v)
      END DO
    END DO
  END DO
  CALL MYRESHAPE_3_1(TXYZ,DIAGS(1:NZ*NX*NY,6))
  DO I = 1,NX,1
    DO J = 1,NY,1
      DO M = 1,NZ,1
        TXYZ(INT(I),INT(J),INT(M))%v = (-TZ(I,J,M)%v)
      END DO
    END DO
  END DO
  CALL MYRESHAPE_3_1(TXYZ,DIAGS(1:NZ*NX*NY,7))
  DO I = 2,(NX+1),1
    DO J = 1,NY,1
      DO M = 1,NZ,1
        TXYZ(I+(-1),INT(J),INT(M))%v = (-TX(I,J,M)%v)
      END DO
    END DO
  END DO
  CALL MYRESHAPE_3_1(TXYZ,DIAGS(1:NZ*NX*NY,3))
  DO I = 1,NX,1
    DO J = 2,(NY+1),1
      DO M = 1,NZ,1
        TXYZ(INT(I),J+(-1),INT(M))%v = (-TY(I,J,M)%v)
      END DO
    END DO
  END DO
  CALL MYRESHAPE_3_1(TXYZ,DIAGS(1:NZ*NX*NY,2))
  DO I = 1,NX,1
    DO J = 1,NY,1
      DO M = 2,(NZ+1),1
        TXYZ(INT(I),INT(J),M+(-1))%v = (-TZ(I,J,M)%v)
      END DO
    END DO
  END DO
  CALL MYRESHAPE_3_1(TXYZ,DIAGS(1:NZ*NX*NY,1))
  DIAGS(1:NZ*NX*NY,4)%v = (-(DIAGS(1:NZ*NX*NY,7)%v+DIAGS(1:NZ*NX*NY,6)%v+DIAGS(1&
     &:NZ*NX*NY,5)%v+DIAGS(1:NZ*NX*NY,3)%v+DIAGS(1:NZ*NX*NY,1)%v+DIAGS(1:NZ*NX*N&
     &Y,2)%v))

  CALL SPDIAGS_FVM_CSR(NX,NY,NZ,DIAGS,ANNZ,AROW_INDEX,AROW_COMPRESSED,ACOL_INDEX&
     &,AVALUES)

  DO I = 1,ANNZ,1
    IF ((MOD(AROW_INDEX(I),NY).eq.1).AND.(AROW_INDEX(I).LT.(NX*NY))) THEN
      IF (ACOL_INDEX(I).eq.AROW_INDEX(I)) THEN
        AVALUES(INT(I))%v = 1
      ELSE
        AVALUES(INT(I))%v = 0
      ENDIF
    ENDIF
  END DO
  CALL SPARSE_SOLVE(N,ANNZ,AROW_INDEX,AROW_COMPRESSED,ACOL_INDEX,AVALUES,Q,U)
  CALL MYRESHAPE_1_3(U,P)
  DO I = 2,NX,1
    DO J = 1,NY,1
      DO M = 1,NZ,1
        V(1,INT(I),INT(J),INT(M))%v = (TX(I,J,M)%v*(P(I+(-1),J,M)%v-P(I,J,M)%v))
      END DO
    END DO
  END DO
  DO I = 1,NX,1
    DO J = 2,NY,1
      DO M = 1,NZ,1
        V(2,INT(I),INT(J),INT(M))%v = (TY(I,J,M)%v*(P(I,J+(-1),M)%v-P(I,J,M)%v))
      END DO
    END DO
  END DO
  DO I = 1,NX,1
    DO J = 1,NY,1
      DO M = 2,NZ,1
        V(3,INT(I),INT(J),INT(M))%v = (TZ(I,J,M)%v*(P(I,J,M+(-1))%v-P(I,J,M)%v))
      END DO
    END DO
  END DO
    end if
    if (our_rev_mode%tape) then
! taping
  N = (NZ*NX*NY)
  OpenAD_Symbol_567 = 0_w2f__i8
  DO H = 1,3,1
    OpenAD_Symbol_568 = 0_w2f__i8
    DO I = 1,NX,1
      OpenAD_Symbol_569 = 0_w2f__i8
      DO J = 1,NY,1
        OpenAD_Symbol_570 = 0_w2f__i8
        DO M = 1,NZ,1
          OpenAD_lin_28 = (-(1.0D00/(K(H,I,J,M)%v*K(H,I,J,M)%v)))
          L(INT(H),INT(I),INT(J),INT(M))%v = (1.0D00/K(H,I,J,M)%v)
          double_tape(double_tape_pointer) = OpenAD_lin_28
          double_tape_pointer = double_tape_pointer+1
          integer_tape(integer_tape_pointer) = H
          integer_tape_pointer = integer_tape_pointer+1
          integer_tape(integer_tape_pointer) = I
          integer_tape_pointer = integer_tape_pointer+1
          integer_tape(integer_tape_pointer) = J
          integer_tape_pointer = integer_tape_pointer+1
          integer_tape(integer_tape_pointer) = M
          integer_tape_pointer = integer_tape_pointer+1
          OpenAD_Symbol_570 = (INT(OpenAD_Symbol_570)+INT(1_w2f__i8))
        END DO
        integer_tape(integer_tape_pointer) = OpenAD_Symbol_570
        integer_tape_pointer = integer_tape_pointer+1
        OpenAD_Symbol_569 = (INT(OpenAD_Symbol_569)+INT(1_w2f__i8))
      END DO
      integer_tape(integer_tape_pointer) = OpenAD_Symbol_569
      integer_tape_pointer = integer_tape_pointer+1
      OpenAD_Symbol_568 = (INT(OpenAD_Symbol_568)+INT(1_w2f__i8))
    END DO
    integer_tape(integer_tape_pointer) = OpenAD_Symbol_568
    integer_tape_pointer = integer_tape_pointer+1
    OpenAD_Symbol_567 = (INT(OpenAD_Symbol_567)+INT(1_w2f__i8))
  END DO
  integer_tape(integer_tape_pointer) = OpenAD_Symbol_567
  integer_tape_pointer = integer_tape_pointer+1
  TX_ = ((HZ*HY*2.0D00)/HX)
  TY_ = ((HZ*HX*2.0D00)/HY)
  TZ_ = ((HX*HY*2.0D00)/HZ)
  TX(1:NX+1,1:INT(NY),1:INT(NZ))%v = 0.0D00
  TY(1:INT(NX),1:NY+1,1:INT(NZ))%v = 0.0D00
  TZ(1:INT(NX),1:INT(NY),1:NZ+1)%v = 0.0D00
  OpenAD_Symbol_741 = (NX+1)
  integer_tape(integer_tape_pointer) = OpenAD_Symbol_741
  integer_tape_pointer = integer_tape_pointer+1
  OpenAD_Symbol_742 = (NY+1)
  integer_tape(integer_tape_pointer) = OpenAD_Symbol_742
  integer_tape_pointer = integer_tape_pointer+1
  OpenAD_Symbol_743 = (NZ+1)
  integer_tape(integer_tape_pointer) = OpenAD_Symbol_743
  integer_tape_pointer = integer_tape_pointer+1
  integer_tape(integer_tape_pointer) = NY
  integer_tape_pointer = integer_tape_pointer+1
  integer_tape(integer_tape_pointer) = NZ
  integer_tape_pointer = integer_tape_pointer+1
  integer_tape(integer_tape_pointer) = NX
  integer_tape_pointer = integer_tape_pointer+1
  OpenAD_Symbol_571 = 0_w2f__i8
  DO I = 2,NX,1
    OpenAD_Symbol_572 = 0_w2f__i8
    DO J = 1,NY,1
      OpenAD_Symbol_573 = 0_w2f__i8
      DO M = 1,NZ,1
        OpenAD_aux_18 = (L(1,I,J,M)%v+L(1,I+(-1),J,M)%v)
        OpenAD_lin_29 = (-(TX_/(OpenAD_aux_18*OpenAD_aux_18)))
        TX(INT(I),INT(J),INT(M))%v = (TX_/OpenAD_aux_18)
        OpenAD_Symbol_744 = (I+(-1))
        integer_tape(integer_tape_pointer) = OpenAD_Symbol_744
        integer_tape_pointer = integer_tape_pointer+1
        double_tape(double_tape_pointer) = OpenAD_lin_29
        double_tape_pointer = double_tape_pointer+1
        integer_tape(integer_tape_pointer) = I
        integer_tape_pointer = integer_tape_pointer+1
        integer_tape(integer_tape_pointer) = J
        integer_tape_pointer = integer_tape_pointer+1
        integer_tape(integer_tape_pointer) = M
        integer_tape_pointer = integer_tape_pointer+1
        OpenAD_Symbol_573 = (INT(OpenAD_Symbol_573)+INT(1_w2f__i8))
      END DO
      integer_tape(integer_tape_pointer) = OpenAD_Symbol_573
      integer_tape_pointer = integer_tape_pointer+1
      OpenAD_Symbol_572 = (INT(OpenAD_Symbol_572)+INT(1_w2f__i8))
    END DO
    integer_tape(integer_tape_pointer) = OpenAD_Symbol_572
    integer_tape_pointer = integer_tape_pointer+1
    OpenAD_Symbol_571 = (INT(OpenAD_Symbol_571)+INT(1_w2f__i8))
  END DO
  integer_tape(integer_tape_pointer) = OpenAD_Symbol_571
  integer_tape_pointer = integer_tape_pointer+1
  OpenAD_Symbol_574 = 0_w2f__i8
  DO I = 1,NX,1
    OpenAD_Symbol_575 = 0_w2f__i8
    DO J = 2,NY,1
      OpenAD_Symbol_576 = 0_w2f__i8
      DO M = 1,NZ,1
        OpenAD_aux_19 = (L(2,I,J,M)%v+L(2,I,J+(-1),M)%v)
        OpenAD_lin_30 = (-(TY_/(OpenAD_aux_19*OpenAD_aux_19)))
        TY(INT(I),INT(J),INT(M))%v = (TY_/OpenAD_aux_19)
        OpenAD_Symbol_745 = (J+(-1))
        integer_tape(integer_tape_pointer) = OpenAD_Symbol_745
        integer_tape_pointer = integer_tape_pointer+1
        double_tape(double_tape_pointer) = OpenAD_lin_30
        double_tape_pointer = double_tape_pointer+1
        integer_tape(integer_tape_pointer) = I
        integer_tape_pointer = integer_tape_pointer+1
        integer_tape(integer_tape_pointer) = J
        integer_tape_pointer = integer_tape_pointer+1
        integer_tape(integer_tape_pointer) = M
        integer_tape_pointer = integer_tape_pointer+1
        OpenAD_Symbol_576 = (INT(OpenAD_Symbol_576)+INT(1_w2f__i8))
      END DO
      integer_tape(integer_tape_pointer) = OpenAD_Symbol_576
      integer_tape_pointer = integer_tape_pointer+1
      OpenAD_Symbol_575 = (INT(OpenAD_Symbol_575)+INT(1_w2f__i8))
    END DO
    integer_tape(integer_tape_pointer) = OpenAD_Symbol_575
    integer_tape_pointer = integer_tape_pointer+1
    OpenAD_Symbol_574 = (INT(OpenAD_Symbol_574)+INT(1_w2f__i8))
  END DO
  integer_tape(integer_tape_pointer) = OpenAD_Symbol_574
  integer_tape_pointer = integer_tape_pointer+1
  OpenAD_Symbol_577 = 0_w2f__i8
  DO I = 1,NX,1
    OpenAD_Symbol_578 = 0_w2f__i8
    DO J = 1,NY,1
      OpenAD_Symbol_579 = 0_w2f__i8
      DO M = 2,NZ,1
        OpenAD_aux_20 = (L(3,I,J,M)%v+L(3,I,J,M+(-1))%v)
        OpenAD_lin_31 = (-(TZ_/(OpenAD_aux_20*OpenAD_aux_20)))
        TZ(INT(I),INT(J),INT(M))%v = (TZ_/OpenAD_aux_20)
        OpenAD_Symbol_746 = (M+(-1))
        integer_tape(integer_tape_pointer) = OpenAD_Symbol_746
        integer_tape_pointer = integer_tape_pointer+1
        double_tape(double_tape_pointer) = OpenAD_lin_31
        double_tape_pointer = double_tape_pointer+1
        integer_tape(integer_tape_pointer) = I
        integer_tape_pointer = integer_tape_pointer+1
        integer_tape(integer_tape_pointer) = J
        integer_tape_pointer = integer_tape_pointer+1
        integer_tape(integer_tape_pointer) = M
        integer_tape_pointer = integer_tape_pointer+1
        OpenAD_Symbol_579 = (INT(OpenAD_Symbol_579)+INT(1_w2f__i8))
      END DO
      integer_tape(integer_tape_pointer) = OpenAD_Symbol_579
      integer_tape_pointer = integer_tape_pointer+1
      OpenAD_Symbol_578 = (INT(OpenAD_Symbol_578)+INT(1_w2f__i8))
    END DO
    integer_tape(integer_tape_pointer) = OpenAD_Symbol_578
    integer_tape_pointer = integer_tape_pointer+1
    OpenAD_Symbol_577 = (INT(OpenAD_Symbol_577)+INT(1_w2f__i8))
  END DO
  integer_tape(integer_tape_pointer) = OpenAD_Symbol_577
  integer_tape_pointer = integer_tape_pointer+1
  DIAGS(1:NZ*NX*NY,1:7)%v = 0.0D00
  OpenAD_Symbol_747 = (NZ*NX*NY)
  integer_tape(integer_tape_pointer) = OpenAD_Symbol_747
  integer_tape_pointer = integer_tape_pointer+1
  OpenAD_Symbol_580 = 0_w2f__i8
  DO I = 1,NX,1
    OpenAD_Symbol_581 = 0_w2f__i8
    DO J = 1,NY,1
      OpenAD_Symbol_582 = 0_w2f__i8
      DO M = 1,NZ,1
        TXYZ(INT(I),INT(J),INT(M))%v = (-TX(I,J,M)%v)
        integer_tape(integer_tape_pointer) = I
        integer_tape_pointer = integer_tape_pointer+1
        integer_tape(integer_tape_pointer) = J
        integer_tape_pointer = integer_tape_pointer+1
        integer_tape(integer_tape_pointer) = M
        integer_tape_pointer = integer_tape_pointer+1
        OpenAD_Symbol_582 = (INT(OpenAD_Symbol_582)+INT(1_w2f__i8))
      END DO
      integer_tape(integer_tape_pointer) = OpenAD_Symbol_582
      integer_tape_pointer = integer_tape_pointer+1
      OpenAD_Symbol_581 = (INT(OpenAD_Symbol_581)+INT(1_w2f__i8))
    END DO
    integer_tape(integer_tape_pointer) = OpenAD_Symbol_581
    integer_tape_pointer = integer_tape_pointer+1
    OpenAD_Symbol_580 = (INT(OpenAD_Symbol_580)+INT(1_w2f__i8))
  END DO
  integer_tape(integer_tape_pointer) = OpenAD_Symbol_580
  integer_tape_pointer = integer_tape_pointer+1
  CALL MYRESHAPE_3_1(TXYZ,DIAGS(1:NZ*NX*NY,5))
  integer_tape(integer_tape_pointer) = NZ
  integer_tape_pointer = integer_tape_pointer+1
  integer_tape(integer_tape_pointer) = NX
  integer_tape_pointer = integer_tape_pointer+1
  integer_tape(integer_tape_pointer) = NY
  integer_tape_pointer = integer_tape_pointer+1
  OpenAD_Symbol_583 = 0_w2f__i8
  DO I = 1,NX,1
    OpenAD_Symbol_584 = 0_w2f__i8
    DO J = 1,NY,1
      OpenAD_Symbol_585 = 0_w2f__i8
      DO M = 1,NZ,1
        TXYZ(INT(I),INT(J),INT(M))%v = (-TY(I,J,M)%v)
        integer_tape(integer_tape_pointer) = I
        integer_tape_pointer = integer_tape_pointer+1
        integer_tape(integer_tape_pointer) = J
        integer_tape_pointer = integer_tape_pointer+1
        integer_tape(integer_tape_pointer) = M
        integer_tape_pointer = integer_tape_pointer+1
        OpenAD_Symbol_585 = (INT(OpenAD_Symbol_585)+INT(1_w2f__i8))
      END DO
      integer_tape(integer_tape_pointer) = OpenAD_Symbol_585
      integer_tape_pointer = integer_tape_pointer+1
      OpenAD_Symbol_584 = (INT(OpenAD_Symbol_584)+INT(1_w2f__i8))
    END DO
    integer_tape(integer_tape_pointer) = OpenAD_Symbol_584
    integer_tape_pointer = integer_tape_pointer+1
    OpenAD_Symbol_583 = (INT(OpenAD_Symbol_583)+INT(1_w2f__i8))
  END DO
  integer_tape(integer_tape_pointer) = OpenAD_Symbol_583
  integer_tape_pointer = integer_tape_pointer+1
  CALL MYRESHAPE_3_1(TXYZ,DIAGS(1:NZ*NX*NY,6))
  integer_tape(integer_tape_pointer) = NZ
  integer_tape_pointer = integer_tape_pointer+1
  integer_tape(integer_tape_pointer) = NX
  integer_tape_pointer = integer_tape_pointer+1
  integer_tape(integer_tape_pointer) = NY
  integer_tape_pointer = integer_tape_pointer+1
  OpenAD_Symbol_586 = 0_w2f__i8
  DO I = 1,NX,1
    OpenAD_Symbol_587 = 0_w2f__i8
    DO J = 1,NY,1
      OpenAD_Symbol_588 = 0_w2f__i8
      DO M = 1,NZ,1
        TXYZ(INT(I),INT(J),INT(M))%v = (-TZ(I,J,M)%v)
        integer_tape(integer_tape_pointer) = I
        integer_tape_pointer = integer_tape_pointer+1
        integer_tape(integer_tape_pointer) = J
        integer_tape_pointer = integer_tape_pointer+1
        integer_tape(integer_tape_pointer) = M
        integer_tape_pointer = integer_tape_pointer+1
        OpenAD_Symbol_588 = (INT(OpenAD_Symbol_588)+INT(1_w2f__i8))
      END DO
      integer_tape(integer_tape_pointer) = OpenAD_Symbol_588
      integer_tape_pointer = integer_tape_pointer+1
      OpenAD_Symbol_587 = (INT(OpenAD_Symbol_587)+INT(1_w2f__i8))
    END DO
    integer_tape(integer_tape_pointer) = OpenAD_Symbol_587
    integer_tape_pointer = integer_tape_pointer+1
    OpenAD_Symbol_586 = (INT(OpenAD_Symbol_586)+INT(1_w2f__i8))
  END DO
  integer_tape(integer_tape_pointer) = OpenAD_Symbol_586
  integer_tape_pointer = integer_tape_pointer+1
  CALL MYRESHAPE_3_1(TXYZ,DIAGS(1:NZ*NX*NY,7))
  integer_tape(integer_tape_pointer) = NZ
  integer_tape_pointer = integer_tape_pointer+1
  integer_tape(integer_tape_pointer) = NX
  integer_tape_pointer = integer_tape_pointer+1
  integer_tape(integer_tape_pointer) = NY
  integer_tape_pointer = integer_tape_pointer+1
  OpenAD_Symbol_589 = 0_w2f__i8
  DO I = 2,(NX+1),1
    OpenAD_Symbol_590 = 0_w2f__i8
    DO J = 1,NY,1
      OpenAD_Symbol_591 = 0_w2f__i8
      DO M = 1,NZ,1
        TXYZ(I+(-1),INT(J),INT(M))%v = (-TX(I,J,M)%v)
        OpenAD_Symbol_748 = (I+(-1))
        integer_tape(integer_tape_pointer) = OpenAD_Symbol_748
        integer_tape_pointer = integer_tape_pointer+1
        integer_tape(integer_tape_pointer) = I
        integer_tape_pointer = integer_tape_pointer+1
        integer_tape(integer_tape_pointer) = J
        integer_tape_pointer = integer_tape_pointer+1
        integer_tape(integer_tape_pointer) = M
        integer_tape_pointer = integer_tape_pointer+1
        OpenAD_Symbol_591 = (INT(OpenAD_Symbol_591)+INT(1_w2f__i8))
      END DO
      integer_tape(integer_tape_pointer) = OpenAD_Symbol_591
      integer_tape_pointer = integer_tape_pointer+1
      OpenAD_Symbol_590 = (INT(OpenAD_Symbol_590)+INT(1_w2f__i8))
    END DO
    integer_tape(integer_tape_pointer) = OpenAD_Symbol_590
    integer_tape_pointer = integer_tape_pointer+1
    OpenAD_Symbol_589 = (INT(OpenAD_Symbol_589)+INT(1_w2f__i8))
  END DO
  integer_tape(integer_tape_pointer) = OpenAD_Symbol_589
  integer_tape_pointer = integer_tape_pointer+1
  CALL MYRESHAPE_3_1(TXYZ,DIAGS(1:NZ*NX*NY,3))
  integer_tape(integer_tape_pointer) = NZ
  integer_tape_pointer = integer_tape_pointer+1
  integer_tape(integer_tape_pointer) = NX
  integer_tape_pointer = integer_tape_pointer+1
  integer_tape(integer_tape_pointer) = NY
  integer_tape_pointer = integer_tape_pointer+1
  OpenAD_Symbol_592 = 0_w2f__i8
  DO I = 1,NX,1
    OpenAD_Symbol_593 = 0_w2f__i8
    DO J = 2,(NY+1),1
      OpenAD_Symbol_594 = 0_w2f__i8
      DO M = 1,NZ,1
        TXYZ(INT(I),J+(-1),INT(M))%v = (-TY(I,J,M)%v)
        OpenAD_Symbol_749 = (J+(-1))
        integer_tape(integer_tape_pointer) = OpenAD_Symbol_749
        integer_tape_pointer = integer_tape_pointer+1
        integer_tape(integer_tape_pointer) = I
        integer_tape_pointer = integer_tape_pointer+1
        integer_tape(integer_tape_pointer) = J
        integer_tape_pointer = integer_tape_pointer+1
        integer_tape(integer_tape_pointer) = M
        integer_tape_pointer = integer_tape_pointer+1
        OpenAD_Symbol_594 = (INT(OpenAD_Symbol_594)+INT(1_w2f__i8))
      END DO
      integer_tape(integer_tape_pointer) = OpenAD_Symbol_594
      integer_tape_pointer = integer_tape_pointer+1
      OpenAD_Symbol_593 = (INT(OpenAD_Symbol_593)+INT(1_w2f__i8))
    END DO
    integer_tape(integer_tape_pointer) = OpenAD_Symbol_593
    integer_tape_pointer = integer_tape_pointer+1
    OpenAD_Symbol_592 = (INT(OpenAD_Symbol_592)+INT(1_w2f__i8))
  END DO
  integer_tape(integer_tape_pointer) = OpenAD_Symbol_592
  integer_tape_pointer = integer_tape_pointer+1
  CALL MYRESHAPE_3_1(TXYZ,DIAGS(1:NZ*NX*NY,2))
  integer_tape(integer_tape_pointer) = NZ
  integer_tape_pointer = integer_tape_pointer+1
  integer_tape(integer_tape_pointer) = NX
  integer_tape_pointer = integer_tape_pointer+1
  integer_tape(integer_tape_pointer) = NY
  integer_tape_pointer = integer_tape_pointer+1
  OpenAD_Symbol_595 = 0_w2f__i8
  DO I = 1,NX,1
    OpenAD_Symbol_596 = 0_w2f__i8
    DO J = 1,NY,1
      OpenAD_Symbol_597 = 0_w2f__i8
      DO M = 2,(NZ+1),1
        TXYZ(INT(I),INT(J),M+(-1))%v = (-TZ(I,J,M)%v)
        OpenAD_Symbol_750 = (M+(-1))
        integer_tape(integer_tape_pointer) = OpenAD_Symbol_750
        integer_tape_pointer = integer_tape_pointer+1
        integer_tape(integer_tape_pointer) = I
        integer_tape_pointer = integer_tape_pointer+1
        integer_tape(integer_tape_pointer) = J
        integer_tape_pointer = integer_tape_pointer+1
        integer_tape(integer_tape_pointer) = M
        integer_tape_pointer = integer_tape_pointer+1
        OpenAD_Symbol_597 = (INT(OpenAD_Symbol_597)+INT(1_w2f__i8))
      END DO
      integer_tape(integer_tape_pointer) = OpenAD_Symbol_597
      integer_tape_pointer = integer_tape_pointer+1
      OpenAD_Symbol_596 = (INT(OpenAD_Symbol_596)+INT(1_w2f__i8))
    END DO
    integer_tape(integer_tape_pointer) = OpenAD_Symbol_596
    integer_tape_pointer = integer_tape_pointer+1
    OpenAD_Symbol_595 = (INT(OpenAD_Symbol_595)+INT(1_w2f__i8))
  END DO
  integer_tape(integer_tape_pointer) = OpenAD_Symbol_595
  integer_tape_pointer = integer_tape_pointer+1
  CALL MYRESHAPE_3_1(TXYZ,DIAGS(1:NZ*NX*NY,1))
  integer_tape(integer_tape_pointer) = NZ
  integer_tape_pointer = integer_tape_pointer+1
  integer_tape(integer_tape_pointer) = NX
  integer_tape_pointer = integer_tape_pointer+1
  integer_tape(integer_tape_pointer) = NY
  integer_tape_pointer = integer_tape_pointer+1
  DIAGS(1:NZ*NX*NY,4)%v = (-(DIAGS(1:NZ*NX*NY,7)%v+DIAGS(1:NZ*NX*NY,6)%v+DIAGS(1&
     &:NZ*NX*NY,5)%v+DIAGS(1:NZ*NX*NY,3)%v+DIAGS(1:NZ*NX*NY,1)%v+DIAGS(1:NZ*NX*N&
     &Y,2)%v))

  OpenAD_Symbol_751 = (NZ*NX*NY)
  integer_tape(integer_tape_pointer) = OpenAD_Symbol_751
  integer_tape_pointer = integer_tape_pointer+1
  OpenAD_Symbol_752 = (NZ*NX*NY)
  integer_tape(integer_tape_pointer) = OpenAD_Symbol_752
  integer_tape_pointer = integer_tape_pointer+1
  OpenAD_Symbol_753 = (NZ*NX*NY)
  integer_tape(integer_tape_pointer) = OpenAD_Symbol_753
  integer_tape_pointer = integer_tape_pointer+1
  OpenAD_Symbol_754 = (NZ*NX*NY)
  integer_tape(integer_tape_pointer) = OpenAD_Symbol_754
  integer_tape_pointer = integer_tape_pointer+1
  OpenAD_Symbol_755 = (NZ*NX*NY)
  integer_tape(integer_tape_pointer) = OpenAD_Symbol_755
  integer_tape_pointer = integer_tape_pointer+1
  OpenAD_Symbol_756 = (NZ*NX*NY)
  integer_tape(integer_tape_pointer) = OpenAD_Symbol_756
  integer_tape_pointer = integer_tape_pointer+1
  OpenAD_Symbol_757 = (NZ*NX*NY)
  integer_tape(integer_tape_pointer) = OpenAD_Symbol_757
  integer_tape_pointer = integer_tape_pointer+1
  OpenAD_Symbol_758 = (NZ*NX*NY)
  integer_tape(integer_tape_pointer) = OpenAD_Symbol_758
  integer_tape_pointer = integer_tape_pointer+1
  OpenAD_Symbol_759 = (NZ*NX*NY)
  integer_tape(integer_tape_pointer) = OpenAD_Symbol_759
  integer_tape_pointer = integer_tape_pointer+1
  OpenAD_Symbol_760 = (NZ*NX*NY)
  integer_tape(integer_tape_pointer) = OpenAD_Symbol_760
  integer_tape_pointer = integer_tape_pointer+1
  OpenAD_Symbol_761 = (NZ*NX*NY)
  integer_tape(integer_tape_pointer) = OpenAD_Symbol_761
  integer_tape_pointer = integer_tape_pointer+1
  OpenAD_Symbol_762 = (NZ*NX*NY)
  integer_tape(integer_tape_pointer) = OpenAD_Symbol_762
  integer_tape_pointer = integer_tape_pointer+1
  CALL SPDIAGS_FVM_CSR(NX,NY,NZ,DIAGS,ANNZ,AROW_INDEX,AROW_COMPRESSED,ACOL_INDEX&
     &,AVALUES)

  integer_tape(integer_tape_pointer) = NX
  integer_tape_pointer = integer_tape_pointer+1
  integer_tape(integer_tape_pointer) = NY
  integer_tape_pointer = integer_tape_pointer+1
  integer_tape(integer_tape_pointer) = NZ
  integer_tape_pointer = integer_tape_pointer+1
  OpenAD_Symbol_598 = 0_w2f__i8
  DO I = 1,ANNZ,1
    IF ((MOD(AROW_INDEX(I),NY).eq.1).AND.(AROW_INDEX(I).LT.(NX*NY))) THEN
      IF (ACOL_INDEX(I).eq.AROW_INDEX(I)) THEN
        AVALUES(INT(I))%v = 1
        integer_tape(integer_tape_pointer) = I
        integer_tape_pointer = integer_tape_pointer+1
        OpenAD_Symbol_599 = 1_w2f__i8
        integer_tape(integer_tape_pointer) = OpenAD_Symbol_599
        integer_tape_pointer = integer_tape_pointer+1
      ELSE
        AVALUES(INT(I))%v = 0
        integer_tape(integer_tape_pointer) = I
        integer_tape_pointer = integer_tape_pointer+1
        OpenAD_Symbol_600 = 0_w2f__i8
        integer_tape(integer_tape_pointer) = OpenAD_Symbol_600
        integer_tape_pointer = integer_tape_pointer+1
      ENDIF
      OpenAD_Symbol_602 = 1_w2f__i8
      integer_tape(integer_tape_pointer) = OpenAD_Symbol_602
      integer_tape_pointer = integer_tape_pointer+1
    ELSE
      OpenAD_Symbol_601 = 0_w2f__i8
      integer_tape(integer_tape_pointer) = OpenAD_Symbol_601
      integer_tape_pointer = integer_tape_pointer+1
    ENDIF
    OpenAD_Symbol_598 = (INT(OpenAD_Symbol_598)+INT(1_w2f__i8))
  END DO
  integer_tape(integer_tape_pointer) = OpenAD_Symbol_598
  integer_tape_pointer = integer_tape_pointer+1
  CALL SPARSE_SOLVE(N,ANNZ,AROW_INDEX,AROW_COMPRESSED,ACOL_INDEX,AVALUES,Q,U)
  integer_tape(integer_tape_pointer) = N
  integer_tape_pointer = integer_tape_pointer+1
  CALL MYRESHAPE_1_3(U,P)
  OpenAD_Symbol_603 = 0_w2f__i8
  DO I = 2,NX,1
    OpenAD_Symbol_604 = 0_w2f__i8
    DO J = 1,NY,1
      OpenAD_Symbol_605 = 0_w2f__i8
      DO M = 1,NZ,1
        OpenAD_aux_21 = (P(I+(-1),J,M)%v-P(I,J,M)%v)
        OpenAD_lin_32 = OpenAD_aux_21
        OpenAD_lin_33 = TX(I,J,M)%v
        V(1,INT(I),INT(J),INT(M))%v = (TX(I,J,M)%v*OpenAD_aux_21)
        OpenAD_Symbol_763 = (I+(-1))
        integer_tape(integer_tape_pointer) = OpenAD_Symbol_763
        integer_tape_pointer = integer_tape_pointer+1
        double_tape(double_tape_pointer) = OpenAD_lin_32
        double_tape_pointer = double_tape_pointer+1
        double_tape(double_tape_pointer) = OpenAD_lin_33
        double_tape_pointer = double_tape_pointer+1
        integer_tape(integer_tape_pointer) = J
        integer_tape_pointer = integer_tape_pointer+1
        integer_tape(integer_tape_pointer) = M
        integer_tape_pointer = integer_tape_pointer+1
        integer_tape(integer_tape_pointer) = I
        integer_tape_pointer = integer_tape_pointer+1
        OpenAD_Symbol_605 = (INT(OpenAD_Symbol_605)+INT(1_w2f__i8))
      END DO
      integer_tape(integer_tape_pointer) = OpenAD_Symbol_605
      integer_tape_pointer = integer_tape_pointer+1
      OpenAD_Symbol_604 = (INT(OpenAD_Symbol_604)+INT(1_w2f__i8))
    END DO
    integer_tape(integer_tape_pointer) = OpenAD_Symbol_604
    integer_tape_pointer = integer_tape_pointer+1
    OpenAD_Symbol_603 = (INT(OpenAD_Symbol_603)+INT(1_w2f__i8))
  END DO
  integer_tape(integer_tape_pointer) = OpenAD_Symbol_603
  integer_tape_pointer = integer_tape_pointer+1
  OpenAD_Symbol_606 = 0_w2f__i8
  DO I = 1,NX,1
    OpenAD_Symbol_607 = 0_w2f__i8
    DO J = 2,NY,1
      OpenAD_Symbol_608 = 0_w2f__i8
      DO M = 1,NZ,1
        OpenAD_aux_22 = (P(I,J+(-1),M)%v-P(I,J,M)%v)
        OpenAD_lin_34 = OpenAD_aux_22
        OpenAD_lin_35 = TY(I,J,M)%v
        V(2,INT(I),INT(J),INT(M))%v = (TY(I,J,M)%v*OpenAD_aux_22)
        OpenAD_Symbol_764 = (J+(-1))
        integer_tape(integer_tape_pointer) = OpenAD_Symbol_764
        integer_tape_pointer = integer_tape_pointer+1
        double_tape(double_tape_pointer) = OpenAD_lin_34
        double_tape_pointer = double_tape_pointer+1
        double_tape(double_tape_pointer) = OpenAD_lin_35
        double_tape_pointer = double_tape_pointer+1
        integer_tape(integer_tape_pointer) = I
        integer_tape_pointer = integer_tape_pointer+1
        integer_tape(integer_tape_pointer) = M
        integer_tape_pointer = integer_tape_pointer+1
        integer_tape(integer_tape_pointer) = J
        integer_tape_pointer = integer_tape_pointer+1
        OpenAD_Symbol_608 = (INT(OpenAD_Symbol_608)+INT(1_w2f__i8))
      END DO
      integer_tape(integer_tape_pointer) = OpenAD_Symbol_608
      integer_tape_pointer = integer_tape_pointer+1
      OpenAD_Symbol_607 = (INT(OpenAD_Symbol_607)+INT(1_w2f__i8))
    END DO
    integer_tape(integer_tape_pointer) = OpenAD_Symbol_607
    integer_tape_pointer = integer_tape_pointer+1
    OpenAD_Symbol_606 = (INT(OpenAD_Symbol_606)+INT(1_w2f__i8))
  END DO
  integer_tape(integer_tape_pointer) = OpenAD_Symbol_606
  integer_tape_pointer = integer_tape_pointer+1
  OpenAD_Symbol_609 = 0_w2f__i8
  DO I = 1,NX,1
    OpenAD_Symbol_610 = 0_w2f__i8
    DO J = 1,NY,1
      OpenAD_Symbol_611 = 0_w2f__i8
      DO M = 2,NZ,1
        OpenAD_aux_23 = (P(I,J,M+(-1))%v-P(I,J,M)%v)
        OpenAD_lin_36 = OpenAD_aux_23
        OpenAD_lin_37 = TZ(I,J,M)%v
        V(3,INT(I),INT(J),INT(M))%v = (TZ(I,J,M)%v*OpenAD_aux_23)
        OpenAD_Symbol_765 = (M+(-1))
        integer_tape(integer_tape_pointer) = OpenAD_Symbol_765
        integer_tape_pointer = integer_tape_pointer+1
        double_tape(double_tape_pointer) = OpenAD_lin_36
        double_tape_pointer = double_tape_pointer+1
        double_tape(double_tape_pointer) = OpenAD_lin_37
        double_tape_pointer = double_tape_pointer+1
        integer_tape(integer_tape_pointer) = I
        integer_tape_pointer = integer_tape_pointer+1
        integer_tape(integer_tape_pointer) = J
        integer_tape_pointer = integer_tape_pointer+1
        integer_tape(integer_tape_pointer) = M
        integer_tape_pointer = integer_tape_pointer+1
        OpenAD_Symbol_611 = (INT(OpenAD_Symbol_611)+INT(1_w2f__i8))
      END DO
      integer_tape(integer_tape_pointer) = OpenAD_Symbol_611
      integer_tape_pointer = integer_tape_pointer+1
      OpenAD_Symbol_610 = (INT(OpenAD_Symbol_610)+INT(1_w2f__i8))
    END DO
    integer_tape(integer_tape_pointer) = OpenAD_Symbol_610
    integer_tape_pointer = integer_tape_pointer+1
    OpenAD_Symbol_609 = (INT(OpenAD_Symbol_609)+INT(1_w2f__i8))
  END DO
  integer_tape(integer_tape_pointer) = OpenAD_Symbol_609
  integer_tape_pointer = integer_tape_pointer+1
    end if
    if (our_rev_mode%adjoint) then
! adjoint
  integer_tape_pointer = integer_tape_pointer-1
  OpenAD_Symbol_483 = integer_tape(integer_tape_pointer)
  OpenAD_Symbol_484 = 1
  do while (INT(OpenAD_Symbol_484).LE.INT(OpenAD_Symbol_483))
    integer_tape_pointer = integer_tape_pointer-1
    OpenAD_Symbol_485 = integer_tape(integer_tape_pointer)
    OpenAD_Symbol_486 = 1
    do while (INT(OpenAD_Symbol_486).LE.INT(OpenAD_Symbol_485))
      integer_tape_pointer = integer_tape_pointer-1
      OpenAD_Symbol_487 = integer_tape(integer_tape_pointer)
      OpenAD_Symbol_488 = 1
      do while (INT(OpenAD_Symbol_488).LE.INT(OpenAD_Symbol_487))
        integer_tape_pointer = integer_tape_pointer-1
        OpenAD_Symbol_1165 = integer_tape(integer_tape_pointer)
        integer_tape_pointer = integer_tape_pointer-1
        OpenAD_Symbol_1166 = integer_tape(integer_tape_pointer)
        integer_tape_pointer = integer_tape_pointer-1
        OpenAD_Symbol_1167 = integer_tape(integer_tape_pointer)
        double_tape_pointer = double_tape_pointer-1
        OpenAD_Symbol_1168 = double_tape(double_tape_pointer)
        double_tape_pointer = double_tape_pointer-1
        OpenAD_Symbol_1169 = double_tape(double_tape_pointer)
        OpenAD_prp_31%d = OpenAD_prp_31%d+V(3,OpenAD_Symbol_1167,OpenAD_Symbol_1&
     &166,OpenAD_Symbol_1165)%d*(OpenAD_Symbol_1168)

        TZ(OpenAD_Symbol_1167,OpenAD_Symbol_1166,OpenAD_Symbol_1165)%d = TZ(Open&
     &AD_Symbol_1167,OpenAD_Symbol_1166,OpenAD_Symbol_1165)%d+V(3,OpenAD_Symbol_&
     &1167,OpenAD_Symbol_1166,OpenAD_Symbol_1165)%d*(OpenAD_Symbol_1169)

        V(3,OpenAD_Symbol_1167,OpenAD_Symbol_1166,OpenAD_Symbol_1165)%d = 0.0d0
        P(OpenAD_Symbol_1167,OpenAD_Symbol_1166,OpenAD_Symbol_1165)%d = P(OpenAD&
     &_Symbol_1167,OpenAD_Symbol_1166,OpenAD_Symbol_1165)%d-OpenAD_prp_31%d

        integer_tape_pointer = integer_tape_pointer-1
        OpenAD_Symbol_1170 = integer_tape(integer_tape_pointer)
        P(OpenAD_Symbol_1167,OpenAD_Symbol_1166,OpenAD_Symbol_1170)%d = P(OpenAD&
     &_Symbol_1167,OpenAD_Symbol_1166,OpenAD_Symbol_1170)%d+OpenAD_prp_31%d

        OpenAD_prp_31%d = 0.0d0
        OpenAD_Symbol_488 = INT(OpenAD_Symbol_488)+1
      END DO
      OpenAD_Symbol_486 = INT(OpenAD_Symbol_486)+1
    END DO
    OpenAD_Symbol_484 = INT(OpenAD_Symbol_484)+1
  END DO
  integer_tape_pointer = integer_tape_pointer-1
  OpenAD_Symbol_489 = integer_tape(integer_tape_pointer)
  OpenAD_Symbol_490 = 1
  do while (INT(OpenAD_Symbol_490).LE.INT(OpenAD_Symbol_489))
    integer_tape_pointer = integer_tape_pointer-1
    OpenAD_Symbol_491 = integer_tape(integer_tape_pointer)
    OpenAD_Symbol_492 = 1
    do while (INT(OpenAD_Symbol_492).LE.INT(OpenAD_Symbol_491))
      integer_tape_pointer = integer_tape_pointer-1
      OpenAD_Symbol_493 = integer_tape(integer_tape_pointer)
      OpenAD_Symbol_494 = 1
      do while (INT(OpenAD_Symbol_494).LE.INT(OpenAD_Symbol_493))
        integer_tape_pointer = integer_tape_pointer-1
        OpenAD_Symbol_1159 = integer_tape(integer_tape_pointer)
        integer_tape_pointer = integer_tape_pointer-1
        OpenAD_Symbol_1160 = integer_tape(integer_tape_pointer)
        integer_tape_pointer = integer_tape_pointer-1
        OpenAD_Symbol_1161 = integer_tape(integer_tape_pointer)
        double_tape_pointer = double_tape_pointer-1
        OpenAD_Symbol_1162 = double_tape(double_tape_pointer)
        double_tape_pointer = double_tape_pointer-1
        OpenAD_Symbol_1163 = double_tape(double_tape_pointer)
        OpenAD_prp_30%d = OpenAD_prp_30%d+V(2,OpenAD_Symbol_1161,OpenAD_Symbol_1&
     &159,OpenAD_Symbol_1160)%d*(OpenAD_Symbol_1162)

        TY(OpenAD_Symbol_1161,OpenAD_Symbol_1159,OpenAD_Symbol_1160)%d = TY(Open&
     &AD_Symbol_1161,OpenAD_Symbol_1159,OpenAD_Symbol_1160)%d+V(2,OpenAD_Symbol_&
     &1161,OpenAD_Symbol_1159,OpenAD_Symbol_1160)%d*(OpenAD_Symbol_1163)

        V(2,OpenAD_Symbol_1161,OpenAD_Symbol_1159,OpenAD_Symbol_1160)%d = 0.0d0
        P(OpenAD_Symbol_1161,OpenAD_Symbol_1159,OpenAD_Symbol_1160)%d = P(OpenAD&
     &_Symbol_1161,OpenAD_Symbol_1159,OpenAD_Symbol_1160)%d-OpenAD_prp_30%d

        integer_tape_pointer = integer_tape_pointer-1
        OpenAD_Symbol_1164 = integer_tape(integer_tape_pointer)
        P(OpenAD_Symbol_1161,OpenAD_Symbol_1164,OpenAD_Symbol_1160)%d = P(OpenAD&
     &_Symbol_1161,OpenAD_Symbol_1164,OpenAD_Symbol_1160)%d+OpenAD_prp_30%d

        OpenAD_prp_30%d = 0.0d0
        OpenAD_Symbol_494 = INT(OpenAD_Symbol_494)+1
      END DO
      OpenAD_Symbol_492 = INT(OpenAD_Symbol_492)+1
    END DO
    OpenAD_Symbol_490 = INT(OpenAD_Symbol_490)+1
  END DO
  integer_tape_pointer = integer_tape_pointer-1
  OpenAD_Symbol_495 = integer_tape(integer_tape_pointer)
  OpenAD_Symbol_496 = 1
  do while (INT(OpenAD_Symbol_496).LE.INT(OpenAD_Symbol_495))
    integer_tape_pointer = integer_tape_pointer-1
    OpenAD_Symbol_497 = integer_tape(integer_tape_pointer)
    OpenAD_Symbol_498 = 1
    do while (INT(OpenAD_Symbol_498).LE.INT(OpenAD_Symbol_497))
      integer_tape_pointer = integer_tape_pointer-1
      OpenAD_Symbol_499 = integer_tape(integer_tape_pointer)
      OpenAD_Symbol_500 = 1
      do while (INT(OpenAD_Symbol_500).LE.INT(OpenAD_Symbol_499))
        integer_tape_pointer = integer_tape_pointer-1
        OpenAD_Symbol_1153 = integer_tape(integer_tape_pointer)
        integer_tape_pointer = integer_tape_pointer-1
        OpenAD_Symbol_1154 = integer_tape(integer_tape_pointer)
        integer_tape_pointer = integer_tape_pointer-1
        OpenAD_Symbol_1155 = integer_tape(integer_tape_pointer)
        double_tape_pointer = double_tape_pointer-1
        OpenAD_Symbol_1156 = double_tape(double_tape_pointer)
        double_tape_pointer = double_tape_pointer-1
        OpenAD_Symbol_1157 = double_tape(double_tape_pointer)
        OpenAD_prp_29%d = OpenAD_prp_29%d+V(1,OpenAD_Symbol_1153,OpenAD_Symbol_1&
     &155,OpenAD_Symbol_1154)%d*(OpenAD_Symbol_1156)

        TX(OpenAD_Symbol_1153,OpenAD_Symbol_1155,OpenAD_Symbol_1154)%d = TX(Open&
     &AD_Symbol_1153,OpenAD_Symbol_1155,OpenAD_Symbol_1154)%d+V(1,OpenAD_Symbol_&
     &1153,OpenAD_Symbol_1155,OpenAD_Symbol_1154)%d*(OpenAD_Symbol_1157)

        V(1,OpenAD_Symbol_1153,OpenAD_Symbol_1155,OpenAD_Symbol_1154)%d = 0.0d0
        P(OpenAD_Symbol_1153,OpenAD_Symbol_1155,OpenAD_Symbol_1154)%d = P(OpenAD&
     &_Symbol_1153,OpenAD_Symbol_1155,OpenAD_Symbol_1154)%d-OpenAD_prp_29%d

        integer_tape_pointer = integer_tape_pointer-1
        OpenAD_Symbol_1158 = integer_tape(integer_tape_pointer)
        P(OpenAD_Symbol_1158,OpenAD_Symbol_1155,OpenAD_Symbol_1154)%d = P(OpenAD&
     &_Symbol_1158,OpenAD_Symbol_1155,OpenAD_Symbol_1154)%d+OpenAD_prp_29%d

        OpenAD_prp_29%d = 0.0d0
        OpenAD_Symbol_500 = INT(OpenAD_Symbol_500)+1
      END DO
      OpenAD_Symbol_498 = INT(OpenAD_Symbol_498)+1
    END DO
    OpenAD_Symbol_496 = INT(OpenAD_Symbol_496)+1
  END DO
  CALL MYRESHAPE_1_3(U,P)
  integer_tape_pointer = integer_tape_pointer-1
  N = integer_tape(integer_tape_pointer)
  CALL SPARSE_SOLVE(N,ANNZ,AROW_INDEX,AROW_COMPRESSED,ACOL_INDEX,AVALUES,Q,U)
  integer_tape_pointer = integer_tape_pointer-1
  OpenAD_Symbol_501 = integer_tape(integer_tape_pointer)
  OpenAD_Symbol_502 = 1
  do while (INT(OpenAD_Symbol_502).LE.INT(OpenAD_Symbol_501))
    integer_tape_pointer = integer_tape_pointer-1
    OpenAD_Symbol_503 = integer_tape(integer_tape_pointer)
    IF (OpenAD_Symbol_503.ne.0) THEN
      integer_tape_pointer = integer_tape_pointer-1
      OpenAD_Symbol_504 = integer_tape(integer_tape_pointer)
      IF (OpenAD_Symbol_504.ne.0) THEN
        integer_tape_pointer = integer_tape_pointer-1
        OpenAD_Symbol_1151 = integer_tape(integer_tape_pointer)
        AVALUES(OpenAD_Symbol_1151)%d = 0.0d0
      ELSE
        integer_tape_pointer = integer_tape_pointer-1
        OpenAD_Symbol_1152 = integer_tape(integer_tape_pointer)
        AVALUES(OpenAD_Symbol_1152)%d = 0.0d0
      ENDIF
    ENDIF
    OpenAD_Symbol_502 = INT(OpenAD_Symbol_502)+1
  END DO
  integer_tape_pointer = integer_tape_pointer-1
  NZ = integer_tape(integer_tape_pointer)
  integer_tape_pointer = integer_tape_pointer-1
  NY = integer_tape(integer_tape_pointer)
  integer_tape_pointer = integer_tape_pointer-1
  NX = integer_tape(integer_tape_pointer)
  CALL SPDIAGS_FVM_CSR(NX,NY,NZ,DIAGS,ANNZ,AROW_INDEX,AROW_COMPRESSED,ACOL_INDEX&
     &,AVALUES)

!!! requested inline of 'oad_AllocateMatching' has no defn
  CALL oad_AllocateMatching(OpenAD_prp_23,DIAGS(1:NZ*NX*NY,7))
!!! requested inline of 'oad_AllocateMatching' has no defn
  CALL oad_AllocateMatching(OpenAD_prp_24,DIAGS(1:NZ*NX*NY,6))
!!! requested inline of 'oad_AllocateMatching' has no defn
  CALL oad_AllocateMatching(OpenAD_prp_25,DIAGS(1:NZ*NX*NY,5))
!!! requested inline of 'oad_AllocateMatching' has no defn
  CALL oad_AllocateMatching(OpenAD_prp_26,DIAGS(1:NZ*NX*NY,3))
!!! requested inline of 'oad_AllocateMatching' has no defn
  CALL oad_AllocateMatching(OpenAD_prp_27,DIAGS(1:NZ*NX*NY,1))
!!! requested inline of 'oad_AllocateMatching' has no defn
  CALL oad_AllocateMatching(OpenAD_prp_28,DIAGS(1:NZ*NX*NY,2))
  integer_tape_pointer = integer_tape_pointer-1
  OpenAD_Symbol_1139 = integer_tape(integer_tape_pointer)
  OpenAD_prp_28%d = OpenAD_prp_28%d-DIAGS(1:OpenAD_Symbol_1139,4)%d
  integer_tape_pointer = integer_tape_pointer-1
  OpenAD_Symbol_1140 = integer_tape(integer_tape_pointer)
  OpenAD_prp_27%d = OpenAD_prp_27%d-DIAGS(1:OpenAD_Symbol_1140,4)%d
  integer_tape_pointer = integer_tape_pointer-1
  OpenAD_Symbol_1141 = integer_tape(integer_tape_pointer)
  OpenAD_prp_26%d = OpenAD_prp_26%d-DIAGS(1:OpenAD_Symbol_1141,4)%d
  integer_tape_pointer = integer_tape_pointer-1
  OpenAD_Symbol_1142 = integer_tape(integer_tape_pointer)
  OpenAD_prp_25%d = OpenAD_prp_25%d-DIAGS(1:OpenAD_Symbol_1142,4)%d
  integer_tape_pointer = integer_tape_pointer-1
  OpenAD_Symbol_1143 = integer_tape(integer_tape_pointer)
  OpenAD_prp_24%d = OpenAD_prp_24%d-DIAGS(1:OpenAD_Symbol_1143,4)%d
  integer_tape_pointer = integer_tape_pointer-1
  OpenAD_Symbol_1144 = integer_tape(integer_tape_pointer)
  OpenAD_prp_23%d = OpenAD_prp_23%d-DIAGS(1:OpenAD_Symbol_1144,4)%d
  DIAGS(1:OpenAD_Symbol_1144,4)%d = 0.0d0
  integer_tape_pointer = integer_tape_pointer-1
  OpenAD_Symbol_1145 = integer_tape(integer_tape_pointer)
  DIAGS(1:OpenAD_Symbol_1145,2)%d = DIAGS(1:OpenAD_Symbol_1145,2)%d+OpenAD_prp_2&
     &8%d

  OpenAD_prp_28%d = 0.0d0
  integer_tape_pointer = integer_tape_pointer-1
  OpenAD_Symbol_1146 = integer_tape(integer_tape_pointer)
  DIAGS(1:OpenAD_Symbol_1146,1)%d = DIAGS(1:OpenAD_Symbol_1146,1)%d+OpenAD_prp_2&
     &7%d

  OpenAD_prp_27%d = 0.0d0
  integer_tape_pointer = integer_tape_pointer-1
  OpenAD_Symbol_1147 = integer_tape(integer_tape_pointer)
  DIAGS(1:OpenAD_Symbol_1147,3)%d = DIAGS(1:OpenAD_Symbol_1147,3)%d+OpenAD_prp_2&
     &6%d

  OpenAD_prp_26%d = 0.0d0
  integer_tape_pointer = integer_tape_pointer-1
  OpenAD_Symbol_1148 = integer_tape(integer_tape_pointer)
  DIAGS(1:OpenAD_Symbol_1148,5)%d = DIAGS(1:OpenAD_Symbol_1148,5)%d+OpenAD_prp_2&
     &5%d

  OpenAD_prp_25%d = 0.0d0
  integer_tape_pointer = integer_tape_pointer-1
  OpenAD_Symbol_1149 = integer_tape(integer_tape_pointer)
  DIAGS(1:OpenAD_Symbol_1149,6)%d = DIAGS(1:OpenAD_Symbol_1149,6)%d+OpenAD_prp_2&
     &4%d

  OpenAD_prp_24%d = 0.0d0
  integer_tape_pointer = integer_tape_pointer-1
  OpenAD_Symbol_1150 = integer_tape(integer_tape_pointer)
  DIAGS(1:OpenAD_Symbol_1150,7)%d = DIAGS(1:OpenAD_Symbol_1150,7)%d+OpenAD_prp_2&
     &3%d

  OpenAD_prp_23%d = 0.0d0
  integer_tape_pointer = integer_tape_pointer-1
  NY = integer_tape(integer_tape_pointer)
  integer_tape_pointer = integer_tape_pointer-1
  NX = integer_tape(integer_tape_pointer)
  integer_tape_pointer = integer_tape_pointer-1
  NZ = integer_tape(integer_tape_pointer)
  CALL MYRESHAPE_3_1(TXYZ,DIAGS(1:NZ*NX*NY,1))
  integer_tape_pointer = integer_tape_pointer-1
  OpenAD_Symbol_505 = integer_tape(integer_tape_pointer)
  OpenAD_Symbol_506 = 1
  do while (INT(OpenAD_Symbol_506).LE.INT(OpenAD_Symbol_505))
    integer_tape_pointer = integer_tape_pointer-1
    OpenAD_Symbol_507 = integer_tape(integer_tape_pointer)
    OpenAD_Symbol_508 = 1
    do while (INT(OpenAD_Symbol_508).LE.INT(OpenAD_Symbol_507))
      integer_tape_pointer = integer_tape_pointer-1
      OpenAD_Symbol_509 = integer_tape(integer_tape_pointer)
      OpenAD_Symbol_510 = 1
      do while (INT(OpenAD_Symbol_510).LE.INT(OpenAD_Symbol_509))
        integer_tape_pointer = integer_tape_pointer-1
        OpenAD_Symbol_1135 = integer_tape(integer_tape_pointer)
        integer_tape_pointer = integer_tape_pointer-1
        OpenAD_Symbol_1136 = integer_tape(integer_tape_pointer)
        integer_tape_pointer = integer_tape_pointer-1
        OpenAD_Symbol_1137 = integer_tape(integer_tape_pointer)
        integer_tape_pointer = integer_tape_pointer-1
        OpenAD_Symbol_1138 = integer_tape(integer_tape_pointer)
        TZ(OpenAD_Symbol_1137,OpenAD_Symbol_1136,OpenAD_Symbol_1135)%d = TZ(Open&
     &AD_Symbol_1137,OpenAD_Symbol_1136,OpenAD_Symbol_1135)%d-TXYZ(OpenAD_Symbol&
     &_1137,OpenAD_Symbol_1136,OpenAD_Symbol_1138)%d

        TXYZ(OpenAD_Symbol_1137,OpenAD_Symbol_1136,OpenAD_Symbol_1138)%d = 0.0d0
        OpenAD_Symbol_510 = INT(OpenAD_Symbol_510)+1
      END DO
      OpenAD_Symbol_508 = INT(OpenAD_Symbol_508)+1
    END DO
    OpenAD_Symbol_506 = INT(OpenAD_Symbol_506)+1
  END DO
  integer_tape_pointer = integer_tape_pointer-1
  NY = integer_tape(integer_tape_pointer)
  integer_tape_pointer = integer_tape_pointer-1
  NX = integer_tape(integer_tape_pointer)
  integer_tape_pointer = integer_tape_pointer-1
  NZ = integer_tape(integer_tape_pointer)
  CALL MYRESHAPE_3_1(TXYZ,DIAGS(1:NZ*NX*NY,2))
  integer_tape_pointer = integer_tape_pointer-1
  OpenAD_Symbol_511 = integer_tape(integer_tape_pointer)
  OpenAD_Symbol_512 = 1
  do while (INT(OpenAD_Symbol_512).LE.INT(OpenAD_Symbol_511))
    integer_tape_pointer = integer_tape_pointer-1
    OpenAD_Symbol_513 = integer_tape(integer_tape_pointer)
    OpenAD_Symbol_514 = 1
    do while (INT(OpenAD_Symbol_514).LE.INT(OpenAD_Symbol_513))
      integer_tape_pointer = integer_tape_pointer-1
      OpenAD_Symbol_515 = integer_tape(integer_tape_pointer)
      OpenAD_Symbol_516 = 1
      do while (INT(OpenAD_Symbol_516).LE.INT(OpenAD_Symbol_515))
        integer_tape_pointer = integer_tape_pointer-1
        OpenAD_Symbol_1131 = integer_tape(integer_tape_pointer)
        integer_tape_pointer = integer_tape_pointer-1
        OpenAD_Symbol_1132 = integer_tape(integer_tape_pointer)
        integer_tape_pointer = integer_tape_pointer-1
        OpenAD_Symbol_1133 = integer_tape(integer_tape_pointer)
        integer_tape_pointer = integer_tape_pointer-1
        OpenAD_Symbol_1134 = integer_tape(integer_tape_pointer)
        TY(OpenAD_Symbol_1133,OpenAD_Symbol_1132,OpenAD_Symbol_1131)%d = TY(Open&
     &AD_Symbol_1133,OpenAD_Symbol_1132,OpenAD_Symbol_1131)%d-TXYZ(OpenAD_Symbol&
     &_1133,OpenAD_Symbol_1134,OpenAD_Symbol_1131)%d

        TXYZ(OpenAD_Symbol_1133,OpenAD_Symbol_1134,OpenAD_Symbol_1131)%d = 0.0d0
        OpenAD_Symbol_516 = INT(OpenAD_Symbol_516)+1
      END DO
      OpenAD_Symbol_514 = INT(OpenAD_Symbol_514)+1
    END DO
    OpenAD_Symbol_512 = INT(OpenAD_Symbol_512)+1
  END DO
  integer_tape_pointer = integer_tape_pointer-1
  NY = integer_tape(integer_tape_pointer)
  integer_tape_pointer = integer_tape_pointer-1
  NX = integer_tape(integer_tape_pointer)
  integer_tape_pointer = integer_tape_pointer-1
  NZ = integer_tape(integer_tape_pointer)
  CALL MYRESHAPE_3_1(TXYZ,DIAGS(1:NZ*NX*NY,3))
  integer_tape_pointer = integer_tape_pointer-1
  OpenAD_Symbol_517 = integer_tape(integer_tape_pointer)
  OpenAD_Symbol_518 = 1
  do while (INT(OpenAD_Symbol_518).LE.INT(OpenAD_Symbol_517))
    integer_tape_pointer = integer_tape_pointer-1
    OpenAD_Symbol_519 = integer_tape(integer_tape_pointer)
    OpenAD_Symbol_520 = 1
    do while (INT(OpenAD_Symbol_520).LE.INT(OpenAD_Symbol_519))
      integer_tape_pointer = integer_tape_pointer-1
      OpenAD_Symbol_521 = integer_tape(integer_tape_pointer)
      OpenAD_Symbol_522 = 1
      do while (INT(OpenAD_Symbol_522).LE.INT(OpenAD_Symbol_521))
        integer_tape_pointer = integer_tape_pointer-1
        OpenAD_Symbol_1127 = integer_tape(integer_tape_pointer)
        integer_tape_pointer = integer_tape_pointer-1
        OpenAD_Symbol_1128 = integer_tape(integer_tape_pointer)
        integer_tape_pointer = integer_tape_pointer-1
        OpenAD_Symbol_1129 = integer_tape(integer_tape_pointer)
        integer_tape_pointer = integer_tape_pointer-1
        OpenAD_Symbol_1130 = integer_tape(integer_tape_pointer)
        TX(OpenAD_Symbol_1129,OpenAD_Symbol_1128,OpenAD_Symbol_1127)%d = TX(Open&
     &AD_Symbol_1129,OpenAD_Symbol_1128,OpenAD_Symbol_1127)%d-TXYZ(OpenAD_Symbol&
     &_1130,OpenAD_Symbol_1128,OpenAD_Symbol_1127)%d

        TXYZ(OpenAD_Symbol_1130,OpenAD_Symbol_1128,OpenAD_Symbol_1127)%d = 0.0d0
        OpenAD_Symbol_522 = INT(OpenAD_Symbol_522)+1
      END DO
      OpenAD_Symbol_520 = INT(OpenAD_Symbol_520)+1
    END DO
    OpenAD_Symbol_518 = INT(OpenAD_Symbol_518)+1
  END DO
  integer_tape_pointer = integer_tape_pointer-1
  NY = integer_tape(integer_tape_pointer)
  integer_tape_pointer = integer_tape_pointer-1
  NX = integer_tape(integer_tape_pointer)
  integer_tape_pointer = integer_tape_pointer-1
  NZ = integer_tape(integer_tape_pointer)
  CALL MYRESHAPE_3_1(TXYZ,DIAGS(1:NZ*NX*NY,7))
  integer_tape_pointer = integer_tape_pointer-1
  OpenAD_Symbol_523 = integer_tape(integer_tape_pointer)
  OpenAD_Symbol_524 = 1
  do while (INT(OpenAD_Symbol_524).LE.INT(OpenAD_Symbol_523))
    integer_tape_pointer = integer_tape_pointer-1
    OpenAD_Symbol_525 = integer_tape(integer_tape_pointer)
    OpenAD_Symbol_526 = 1
    do while (INT(OpenAD_Symbol_526).LE.INT(OpenAD_Symbol_525))
      integer_tape_pointer = integer_tape_pointer-1
      OpenAD_Symbol_527 = integer_tape(integer_tape_pointer)
      OpenAD_Symbol_528 = 1
      do while (INT(OpenAD_Symbol_528).LE.INT(OpenAD_Symbol_527))
        integer_tape_pointer = integer_tape_pointer-1
        OpenAD_Symbol_1124 = integer_tape(integer_tape_pointer)
        integer_tape_pointer = integer_tape_pointer-1
        OpenAD_Symbol_1125 = integer_tape(integer_tape_pointer)
        integer_tape_pointer = integer_tape_pointer-1
        OpenAD_Symbol_1126 = integer_tape(integer_tape_pointer)
        TZ(OpenAD_Symbol_1126,OpenAD_Symbol_1125,OpenAD_Symbol_1124)%d = TZ(Open&
     &AD_Symbol_1126,OpenAD_Symbol_1125,OpenAD_Symbol_1124)%d-TXYZ(OpenAD_Symbol&
     &_1126,OpenAD_Symbol_1125,OpenAD_Symbol_1124)%d

        TXYZ(OpenAD_Symbol_1126,OpenAD_Symbol_1125,OpenAD_Symbol_1124)%d = 0.0d0
        OpenAD_Symbol_528 = INT(OpenAD_Symbol_528)+1
      END DO
      OpenAD_Symbol_526 = INT(OpenAD_Symbol_526)+1
    END DO
    OpenAD_Symbol_524 = INT(OpenAD_Symbol_524)+1
  END DO
  integer_tape_pointer = integer_tape_pointer-1
  NY = integer_tape(integer_tape_pointer)
  integer_tape_pointer = integer_tape_pointer-1
  NX = integer_tape(integer_tape_pointer)
  integer_tape_pointer = integer_tape_pointer-1
  NZ = integer_tape(integer_tape_pointer)
  CALL MYRESHAPE_3_1(TXYZ,DIAGS(1:NZ*NX*NY,6))
  integer_tape_pointer = integer_tape_pointer-1
  OpenAD_Symbol_529 = integer_tape(integer_tape_pointer)
  OpenAD_Symbol_530 = 1
  do while (INT(OpenAD_Symbol_530).LE.INT(OpenAD_Symbol_529))
    integer_tape_pointer = integer_tape_pointer-1
    OpenAD_Symbol_531 = integer_tape(integer_tape_pointer)
    OpenAD_Symbol_532 = 1
    do while (INT(OpenAD_Symbol_532).LE.INT(OpenAD_Symbol_531))
      integer_tape_pointer = integer_tape_pointer-1
      OpenAD_Symbol_533 = integer_tape(integer_tape_pointer)
      OpenAD_Symbol_534 = 1
      do while (INT(OpenAD_Symbol_534).LE.INT(OpenAD_Symbol_533))
        integer_tape_pointer = integer_tape_pointer-1
        OpenAD_Symbol_1121 = integer_tape(integer_tape_pointer)
        integer_tape_pointer = integer_tape_pointer-1
        OpenAD_Symbol_1122 = integer_tape(integer_tape_pointer)
        integer_tape_pointer = integer_tape_pointer-1
        OpenAD_Symbol_1123 = integer_tape(integer_tape_pointer)
        TY(OpenAD_Symbol_1123,OpenAD_Symbol_1122,OpenAD_Symbol_1121)%d = TY(Open&
     &AD_Symbol_1123,OpenAD_Symbol_1122,OpenAD_Symbol_1121)%d-TXYZ(OpenAD_Symbol&
     &_1123,OpenAD_Symbol_1122,OpenAD_Symbol_1121)%d

        TXYZ(OpenAD_Symbol_1123,OpenAD_Symbol_1122,OpenAD_Symbol_1121)%d = 0.0d0
        OpenAD_Symbol_534 = INT(OpenAD_Symbol_534)+1
      END DO
      OpenAD_Symbol_532 = INT(OpenAD_Symbol_532)+1
    END DO
    OpenAD_Symbol_530 = INT(OpenAD_Symbol_530)+1
  END DO
  integer_tape_pointer = integer_tape_pointer-1
  NY = integer_tape(integer_tape_pointer)
  integer_tape_pointer = integer_tape_pointer-1
  NX = integer_tape(integer_tape_pointer)
  integer_tape_pointer = integer_tape_pointer-1
  NZ = integer_tape(integer_tape_pointer)
  CALL MYRESHAPE_3_1(TXYZ,DIAGS(1:NZ*NX*NY,5))
  integer_tape_pointer = integer_tape_pointer-1
  OpenAD_Symbol_535 = integer_tape(integer_tape_pointer)
  OpenAD_Symbol_536 = 1
  do while (INT(OpenAD_Symbol_536).LE.INT(OpenAD_Symbol_535))
    integer_tape_pointer = integer_tape_pointer-1
    OpenAD_Symbol_537 = integer_tape(integer_tape_pointer)
    OpenAD_Symbol_538 = 1
    do while (INT(OpenAD_Symbol_538).LE.INT(OpenAD_Symbol_537))
      integer_tape_pointer = integer_tape_pointer-1
      OpenAD_Symbol_539 = integer_tape(integer_tape_pointer)
      OpenAD_Symbol_540 = 1
      do while (INT(OpenAD_Symbol_540).LE.INT(OpenAD_Symbol_539))
        integer_tape_pointer = integer_tape_pointer-1
        OpenAD_Symbol_1118 = integer_tape(integer_tape_pointer)
        integer_tape_pointer = integer_tape_pointer-1
        OpenAD_Symbol_1119 = integer_tape(integer_tape_pointer)
        integer_tape_pointer = integer_tape_pointer-1
        OpenAD_Symbol_1120 = integer_tape(integer_tape_pointer)
        TX(OpenAD_Symbol_1120,OpenAD_Symbol_1119,OpenAD_Symbol_1118)%d = TX(Open&
     &AD_Symbol_1120,OpenAD_Symbol_1119,OpenAD_Symbol_1118)%d-TXYZ(OpenAD_Symbol&
     &_1120,OpenAD_Symbol_1119,OpenAD_Symbol_1118)%d

        TXYZ(OpenAD_Symbol_1120,OpenAD_Symbol_1119,OpenAD_Symbol_1118)%d = 0.0d0
        OpenAD_Symbol_540 = INT(OpenAD_Symbol_540)+1
      END DO
      OpenAD_Symbol_538 = INT(OpenAD_Symbol_538)+1
    END DO
    OpenAD_Symbol_536 = INT(OpenAD_Symbol_536)+1
  END DO
  integer_tape_pointer = integer_tape_pointer-1
  OpenAD_Symbol_1117 = integer_tape(integer_tape_pointer)
  DIAGS(1:OpenAD_Symbol_1117,1:7)%d = 0.0d0
  integer_tape_pointer = integer_tape_pointer-1
  OpenAD_Symbol_541 = integer_tape(integer_tape_pointer)
  OpenAD_Symbol_542 = 1
  do while (INT(OpenAD_Symbol_542).LE.INT(OpenAD_Symbol_541))
    integer_tape_pointer = integer_tape_pointer-1
    OpenAD_Symbol_543 = integer_tape(integer_tape_pointer)
    OpenAD_Symbol_544 = 1
    do while (INT(OpenAD_Symbol_544).LE.INT(OpenAD_Symbol_543))
      integer_tape_pointer = integer_tape_pointer-1
      OpenAD_Symbol_545 = integer_tape(integer_tape_pointer)
      OpenAD_Symbol_546 = 1
      do while (INT(OpenAD_Symbol_546).LE.INT(OpenAD_Symbol_545))
        integer_tape_pointer = integer_tape_pointer-1
        OpenAD_Symbol_1112 = integer_tape(integer_tape_pointer)
        integer_tape_pointer = integer_tape_pointer-1
        OpenAD_Symbol_1113 = integer_tape(integer_tape_pointer)
        integer_tape_pointer = integer_tape_pointer-1
        OpenAD_Symbol_1114 = integer_tape(integer_tape_pointer)
        double_tape_pointer = double_tape_pointer-1
        OpenAD_Symbol_1115 = double_tape(double_tape_pointer)
        OpenAD_prp_22%d = OpenAD_prp_22%d+TZ(OpenAD_Symbol_1114,OpenAD_Symbol_11&
     &13,OpenAD_Symbol_1112)%d*(OpenAD_Symbol_1115)

        TZ(OpenAD_Symbol_1114,OpenAD_Symbol_1113,OpenAD_Symbol_1112)%d = 0.0d0
        integer_tape_pointer = integer_tape_pointer-1
        OpenAD_Symbol_1116 = integer_tape(integer_tape_pointer)
        L(3,OpenAD_Symbol_1114,OpenAD_Symbol_1113,OpenAD_Symbol_1116)%d = L(3,Op&
     &enAD_Symbol_1114,OpenAD_Symbol_1113,OpenAD_Symbol_1116)%d+OpenAD_prp_22%d

        L(3,OpenAD_Symbol_1114,OpenAD_Symbol_1113,OpenAD_Symbol_1112)%d = L(3,Op&
     &enAD_Symbol_1114,OpenAD_Symbol_1113,OpenAD_Symbol_1112)%d+OpenAD_prp_22%d

        OpenAD_prp_22%d = 0.0d0
        OpenAD_Symbol_546 = INT(OpenAD_Symbol_546)+1
      END DO
      OpenAD_Symbol_544 = INT(OpenAD_Symbol_544)+1
    END DO
    OpenAD_Symbol_542 = INT(OpenAD_Symbol_542)+1
  END DO
  integer_tape_pointer = integer_tape_pointer-1
  OpenAD_Symbol_547 = integer_tape(integer_tape_pointer)
  OpenAD_Symbol_548 = 1
  do while (INT(OpenAD_Symbol_548).LE.INT(OpenAD_Symbol_547))
    integer_tape_pointer = integer_tape_pointer-1
    OpenAD_Symbol_549 = integer_tape(integer_tape_pointer)
    OpenAD_Symbol_550 = 1
    do while (INT(OpenAD_Symbol_550).LE.INT(OpenAD_Symbol_549))
      integer_tape_pointer = integer_tape_pointer-1
      OpenAD_Symbol_551 = integer_tape(integer_tape_pointer)
      OpenAD_Symbol_552 = 1
      do while (INT(OpenAD_Symbol_552).LE.INT(OpenAD_Symbol_551))
        integer_tape_pointer = integer_tape_pointer-1
        OpenAD_Symbol_1107 = integer_tape(integer_tape_pointer)
        integer_tape_pointer = integer_tape_pointer-1
        OpenAD_Symbol_1108 = integer_tape(integer_tape_pointer)
        integer_tape_pointer = integer_tape_pointer-1
        OpenAD_Symbol_1109 = integer_tape(integer_tape_pointer)
        double_tape_pointer = double_tape_pointer-1
        OpenAD_Symbol_1110 = double_tape(double_tape_pointer)
        OpenAD_prp_21%d = OpenAD_prp_21%d+TY(OpenAD_Symbol_1109,OpenAD_Symbol_11&
     &08,OpenAD_Symbol_1107)%d*(OpenAD_Symbol_1110)

        TY(OpenAD_Symbol_1109,OpenAD_Symbol_1108,OpenAD_Symbol_1107)%d = 0.0d0
        integer_tape_pointer = integer_tape_pointer-1
        OpenAD_Symbol_1111 = integer_tape(integer_tape_pointer)
        L(2,OpenAD_Symbol_1109,OpenAD_Symbol_1111,OpenAD_Symbol_1107)%d = L(2,Op&
     &enAD_Symbol_1109,OpenAD_Symbol_1111,OpenAD_Symbol_1107)%d+OpenAD_prp_21%d

        L(2,OpenAD_Symbol_1109,OpenAD_Symbol_1108,OpenAD_Symbol_1107)%d = L(2,Op&
     &enAD_Symbol_1109,OpenAD_Symbol_1108,OpenAD_Symbol_1107)%d+OpenAD_prp_21%d

        OpenAD_prp_21%d = 0.0d0
        OpenAD_Symbol_552 = INT(OpenAD_Symbol_552)+1
      END DO
      OpenAD_Symbol_550 = INT(OpenAD_Symbol_550)+1
    END DO
    OpenAD_Symbol_548 = INT(OpenAD_Symbol_548)+1
  END DO
  integer_tape_pointer = integer_tape_pointer-1
  OpenAD_Symbol_553 = integer_tape(integer_tape_pointer)
  OpenAD_Symbol_554 = 1
  do while (INT(OpenAD_Symbol_554).LE.INT(OpenAD_Symbol_553))
    integer_tape_pointer = integer_tape_pointer-1
    OpenAD_Symbol_555 = integer_tape(integer_tape_pointer)
    OpenAD_Symbol_556 = 1
    do while (INT(OpenAD_Symbol_556).LE.INT(OpenAD_Symbol_555))
      integer_tape_pointer = integer_tape_pointer-1
      OpenAD_Symbol_557 = integer_tape(integer_tape_pointer)
      OpenAD_Symbol_558 = 1
      do while (INT(OpenAD_Symbol_558).LE.INT(OpenAD_Symbol_557))
        integer_tape_pointer = integer_tape_pointer-1
        OpenAD_Symbol_1102 = integer_tape(integer_tape_pointer)
        integer_tape_pointer = integer_tape_pointer-1
        OpenAD_Symbol_1103 = integer_tape(integer_tape_pointer)
        integer_tape_pointer = integer_tape_pointer-1
        OpenAD_Symbol_1104 = integer_tape(integer_tape_pointer)
        double_tape_pointer = double_tape_pointer-1
        OpenAD_Symbol_1105 = double_tape(double_tape_pointer)
        OpenAD_prp_20%d = OpenAD_prp_20%d+TX(OpenAD_Symbol_1104,OpenAD_Symbol_11&
     &03,OpenAD_Symbol_1102)%d*(OpenAD_Symbol_1105)

        TX(OpenAD_Symbol_1104,OpenAD_Symbol_1103,OpenAD_Symbol_1102)%d = 0.0d0
        integer_tape_pointer = integer_tape_pointer-1
        OpenAD_Symbol_1106 = integer_tape(integer_tape_pointer)
        L(1,OpenAD_Symbol_1106,OpenAD_Symbol_1103,OpenAD_Symbol_1102)%d = L(1,Op&
     &enAD_Symbol_1106,OpenAD_Symbol_1103,OpenAD_Symbol_1102)%d+OpenAD_prp_20%d

        L(1,OpenAD_Symbol_1104,OpenAD_Symbol_1103,OpenAD_Symbol_1102)%d = L(1,Op&
     &enAD_Symbol_1104,OpenAD_Symbol_1103,OpenAD_Symbol_1102)%d+OpenAD_prp_20%d

        OpenAD_prp_20%d = 0.0d0
        OpenAD_Symbol_558 = INT(OpenAD_Symbol_558)+1
      END DO
      OpenAD_Symbol_556 = INT(OpenAD_Symbol_556)+1
    END DO
    OpenAD_Symbol_554 = INT(OpenAD_Symbol_554)+1
  END DO
  integer_tape_pointer = integer_tape_pointer-1
  OpenAD_Symbol_1096 = integer_tape(integer_tape_pointer)
  integer_tape_pointer = integer_tape_pointer-1
  OpenAD_Symbol_1097 = integer_tape(integer_tape_pointer)
  integer_tape_pointer = integer_tape_pointer-1
  OpenAD_Symbol_1098 = integer_tape(integer_tape_pointer)
  integer_tape_pointer = integer_tape_pointer-1
  OpenAD_Symbol_1099 = integer_tape(integer_tape_pointer)
  TZ(1:OpenAD_Symbol_1096,1:OpenAD_Symbol_1098,1:OpenAD_Symbol_1099)%d = 0.0d0
  integer_tape_pointer = integer_tape_pointer-1
  OpenAD_Symbol_1100 = integer_tape(integer_tape_pointer)
  TY(1:OpenAD_Symbol_1096,1:OpenAD_Symbol_1100,1:OpenAD_Symbol_1097)%d = 0.0d0
  integer_tape_pointer = integer_tape_pointer-1
  OpenAD_Symbol_1101 = integer_tape(integer_tape_pointer)
  TX(1:OpenAD_Symbol_1101,1:OpenAD_Symbol_1098,1:OpenAD_Symbol_1097)%d = 0.0d0
  integer_tape_pointer = integer_tape_pointer-1
  OpenAD_Symbol_559 = integer_tape(integer_tape_pointer)
  OpenAD_Symbol_560 = 1
  do while (INT(OpenAD_Symbol_560).LE.INT(OpenAD_Symbol_559))
    integer_tape_pointer = integer_tape_pointer-1
    OpenAD_Symbol_561 = integer_tape(integer_tape_pointer)
    OpenAD_Symbol_562 = 1
    do while (INT(OpenAD_Symbol_562).LE.INT(OpenAD_Symbol_561))
      integer_tape_pointer = integer_tape_pointer-1
      OpenAD_Symbol_563 = integer_tape(integer_tape_pointer)
      OpenAD_Symbol_564 = 1
      do while (INT(OpenAD_Symbol_564).LE.INT(OpenAD_Symbol_563))
        integer_tape_pointer = integer_tape_pointer-1
        OpenAD_Symbol_565 = integer_tape(integer_tape_pointer)
        OpenAD_Symbol_566 = 1
        do while (INT(OpenAD_Symbol_566).LE.INT(OpenAD_Symbol_565))
          integer_tape_pointer = integer_tape_pointer-1
          OpenAD_Symbol_1091 = integer_tape(integer_tape_pointer)
          integer_tape_pointer = integer_tape_pointer-1
          OpenAD_Symbol_1092 = integer_tape(integer_tape_pointer)
          integer_tape_pointer = integer_tape_pointer-1
          OpenAD_Symbol_1093 = integer_tape(integer_tape_pointer)
          integer_tape_pointer = integer_tape_pointer-1
          OpenAD_Symbol_1094 = integer_tape(integer_tape_pointer)
          double_tape_pointer = double_tape_pointer-1
          OpenAD_Symbol_1095 = double_tape(double_tape_pointer)
          K(OpenAD_Symbol_1094,OpenAD_Symbol_1093,OpenAD_Symbol_1092,OpenAD_Symb&
     &ol_1091)%d = K(OpenAD_Symbol_1094,OpenAD_Symbol_1093,OpenAD_Symbol_1092,Op&
     &enAD_Symbol_1091)%d+L(OpenAD_Symbol_1094,OpenAD_Symbol_1093,OpenAD_Symbol_&
     &1092,OpenAD_Symbol_1091)%d*(OpenAD_Symbol_1095)

          L(OpenAD_Symbol_1094,OpenAD_Symbol_1093,OpenAD_Symbol_1092,OpenAD_Symb&
     &ol_1091)%d = 0.0d0

          OpenAD_Symbol_566 = INT(OpenAD_Symbol_566)+1
        END DO
        OpenAD_Symbol_564 = INT(OpenAD_Symbol_564)+1
      END DO
      OpenAD_Symbol_562 = INT(OpenAD_Symbol_562)+1
    END DO
    OpenAD_Symbol_560 = INT(OpenAD_Symbol_560)+1
  END DO
    end if
  end subroutine TPFA
!#########################################################
! This file is part of OpenAD released under the LGPL.   #
! The full COPYRIGHT notice can be found in the top      #
! level directory of the OpenAD distribution             #
!#########################################################

  SUBROUTINE SPDIAGS_FVM(NX, NY, NZ, IMATRIX, ONNZ, OROW_INDEX, OROW_COMPRESSED,&
     & OCOL_INDEX, OVALUES)

    use OAD_tape
    use OAD_rev

! original arguments get inserted before version
!         ! and declared here together with all local variables
!         ! generated by xaifBooster

  use w2f__types
  IMPLICIT NONE
!
!       **** Global Variables & Derived Type Definitions ****
!
  INTEGER(w2f__i8) OpenAD_Symbol_826
  INTEGER(w2f__i8) OpenAD_Symbol_827
  INTEGER(w2f__i8) OpenAD_Symbol_828
  INTEGER(w2f__i8) OpenAD_Symbol_829
  INTEGER(w2f__i8) OpenAD_Symbol_830
  INTEGER(w2f__i8) OpenAD_Symbol_831
  INTEGER(w2f__i8) OpenAD_Symbol_832
  INTEGER(w2f__i8) OpenAD_Symbol_833
  INTEGER(w2f__i8) OpenAD_Symbol_834
  INTEGER(w2f__i8) OpenAD_Symbol_835
  INTEGER(w2f__i8) OpenAD_Symbol_836
  INTEGER(w2f__i8) OpenAD_Symbol_837
  INTEGER(w2f__i8) OpenAD_Symbol_838
  INTEGER(w2f__i8) OpenAD_Symbol_839
  INTEGER(w2f__i8) OpenAD_Symbol_840
  INTEGER(w2f__i8) OpenAD_Symbol_841
  INTEGER(w2f__i8) OpenAD_Symbol_842
  INTEGER(w2f__i8) OpenAD_Symbol_843
  INTEGER(w2f__i8) OpenAD_Symbol_844
  INTEGER(w2f__i8) OpenAD_Symbol_845
  INTEGER(w2f__i8) OpenAD_Symbol_846
  INTEGER(w2f__i8) OpenAD_Symbol_847
  INTEGER(w2f__i8) OpenAD_Symbol_848
  INTEGER(w2f__i8) OpenAD_Symbol_849
  INTEGER(w2f__i8) OpenAD_Symbol_850
  INTEGER(w2f__i8) OpenAD_Symbol_851
  INTEGER(w2f__i8) OpenAD_Symbol_852
  INTEGER(w2f__i8) OpenAD_Symbol_853
  INTEGER(w2f__i8) OpenAD_Symbol_854
  INTEGER(w2f__i8) OpenAD_Symbol_855
!
!       **** Parameters and Result ****
!
  INTEGER(w2f__i4) NX
  INTEGER(w2f__i4) NY
  INTEGER(w2f__i4) NZ
  REAL(w2f__8) IMATRIX(1 : INT((NZ * NX * NY)), 1 : 7)
  INTEGER(w2f__i4) ONNZ
  INTEGER(w2f__i4) OROW_INDEX(1 : INT((NZ * NX * NY * 7)))
  INTEGER(w2f__i4) OROW_COMPRESSED(1 : INT((NZ * NX * NY + 1)))
  INTEGER(w2f__i4) OCOL_INDEX(1 : INT((NZ * NX * NY * 7)))
  REAL(w2f__8) OVALUES(1 : INT((NZ * NX * NY * 7)))
!
!       **** Local Variables and Functions ****
!
  INTEGER(w2f__i4) COL
  INTEGER(w2f__i4) END_ROW_IMATRIX
  INTEGER(w2f__i4) I
  INTEGER(w2f__i4) IDIAGS(1 : 7)
  INTEGER(w2f__i4) J
  INTEGER(w2f__i4) ROW
  INTEGER(w2f__i4) START_ROW_IMATRIX


    integer iaddr
    external iaddr
!
!       **** Statements ****
!

   if (our_rev_mode%plain) then
! original function
  IDIAGS(1) = (-(NX * NY))
  IDIAGS(2) = (- NX)
  IDIAGS(3) = (-1)
  IDIAGS(4) = 0
  IDIAGS(5) = 1
  IDIAGS(6) = NX
  IDIAGS(7) = (NX * NY)
  ONNZ = 0
  OROW_COMPRESSED(1 : INT(NZ * NX * NY + 1)) = 0
  DO I = 1, 7, 1
    IF(IDIAGS(I) .GT. 0) THEN
      START_ROW_IMATRIX = (IDIAGS(I) + 1)
      END_ROW_IMATRIX = (NZ * NX * NY)
    ELSE
      IF(IDIAGS(I) .LE. 0) THEN
        START_ROW_IMATRIX = 1
        END_ROW_IMATRIX = (IDIAGS(I) + NZ * NX * NY)
      ENDIF
    ENDIF
    CALL FIRSTELM(IDIAGS(I),ROW,COL)
    DO J = START_ROW_IMATRIX, END_ROW_IMATRIX, 1
      IF((COL .eq. ROW) .OR.(IMATRIX(J, I) .ne. 0.0D00)) THEN
        ONNZ = (ONNZ + 1)
        OROW_INDEX(ONNZ) = ROW
        OCOL_INDEX(ONNZ) = COL
        OVALUES(INT(ONNZ)) = IMATRIX(J, I)
      ENDIF
      ROW = (ROW + 1)
      COL = (COL + 1)
    END DO
  END DO
    end if
    if (our_rev_mode%tape) then
! taping
  IDIAGS(1) = (-(NX * NY))
  IDIAGS(2) = (- NX)
  IDIAGS(3) = (-1)
  IDIAGS(4) = 0
  IDIAGS(5) = 1
  IDIAGS(6) = NX
  IDIAGS(7) = (NX * NY)
  ONNZ = 0
  OROW_COMPRESSED(1 : INT(NZ * NX * NY + 1)) = 0
  OpenAD_Symbol_833 = 0_w2f__i8
  DO I = 1, 7, 1
    IF(IDIAGS(I) .GT. 0) THEN
      START_ROW_IMATRIX = (IDIAGS(I) + 1)
      END_ROW_IMATRIX = (NZ * NX * NY)
      OpenAD_Symbol_836 = 1_w2f__i8
      integer_tape(integer_tape_pointer) = OpenAD_Symbol_836
      integer_tape_pointer = integer_tape_pointer+1
    ELSE
      IF(IDIAGS(I) .LE. 0) THEN
        START_ROW_IMATRIX = 1
        END_ROW_IMATRIX = (IDIAGS(I) + NZ * NX * NY)
        OpenAD_Symbol_834 = 1_w2f__i8
        integer_tape(integer_tape_pointer) = OpenAD_Symbol_834
        integer_tape_pointer = integer_tape_pointer+1
      ELSE
        OpenAD_Symbol_835 = 0_w2f__i8
        integer_tape(integer_tape_pointer) = OpenAD_Symbol_835
        integer_tape_pointer = integer_tape_pointer+1
      ENDIF
      OpenAD_Symbol_837 = 0_w2f__i8
      integer_tape(integer_tape_pointer) = OpenAD_Symbol_837
      integer_tape_pointer = integer_tape_pointer+1
    ENDIF
    CALL FIRSTELM(IDIAGS(I),ROW,COL)
    integer_tape(integer_tape_pointer) = I
    integer_tape_pointer = integer_tape_pointer+1
    OpenAD_Symbol_838 = 0_w2f__i8
    DO J = START_ROW_IMATRIX, END_ROW_IMATRIX, 1
      IF((COL .eq. ROW) .OR.(IMATRIX(J, I) .ne. 0.0D00)) THEN
        ONNZ = (ONNZ + 1)
        OVALUES(INT(ONNZ)) = IMATRIX(J, I)
        OROW_INDEX(ONNZ) = ROW
        OCOL_INDEX(ONNZ) = COL
        OpenAD_Symbol_839 = 1_w2f__i8
        integer_tape(integer_tape_pointer) = OpenAD_Symbol_839
        integer_tape_pointer = integer_tape_pointer+1
      ELSE
        OpenAD_Symbol_840 = 0_w2f__i8
        integer_tape(integer_tape_pointer) = OpenAD_Symbol_840
        integer_tape_pointer = integer_tape_pointer+1
      ENDIF
      ROW = (ROW + 1)
      COL = (COL + 1)
      OpenAD_Symbol_838 = (INT(OpenAD_Symbol_838) + INT(1_w2f__i8 ))
    END DO
    integer_tape(integer_tape_pointer) = OpenAD_Symbol_838
    integer_tape_pointer = integer_tape_pointer+1
    OpenAD_Symbol_833 = (INT(OpenAD_Symbol_833) + INT(1_w2f__i8))
  END DO
  integer_tape(integer_tape_pointer) = OpenAD_Symbol_833
  integer_tape_pointer = integer_tape_pointer+1
    end if
    if (our_rev_mode%adjoint) then
! adjoint
  integer_tape_pointer = integer_tape_pointer-1
  OpenAD_Symbol_826 = integer_tape(integer_tape_pointer)
  OpenAD_Symbol_827 = 1
  DO WHILE(INT(OpenAD_Symbol_827) .LE. INT(OpenAD_Symbol_826))
    integer_tape_pointer = integer_tape_pointer-1
    OpenAD_Symbol_828 = integer_tape(integer_tape_pointer)
    OpenAD_Symbol_829 = 1
    DO WHILE(INT(OpenAD_Symbol_829) .LE. INT(OpenAD_Symbol_828))
      integer_tape_pointer = integer_tape_pointer-1
      OpenAD_Symbol_830 = integer_tape(integer_tape_pointer)
      IF(OpenAD_Symbol_830 .ne. 0) THEN
      ENDIF
      OpenAD_Symbol_829 = INT(OpenAD_Symbol_829) + 1
    END DO
    integer_tape_pointer = integer_tape_pointer-1
    I = integer_tape(integer_tape_pointer)
    CALL FIRSTELM(IDIAGS(I),ROW,COL)
    integer_tape_pointer = integer_tape_pointer-1
    OpenAD_Symbol_831 = integer_tape(integer_tape_pointer)
    IF(OpenAD_Symbol_831 .ne. 0) THEN
    ELSE
      integer_tape_pointer = integer_tape_pointer-1
      OpenAD_Symbol_832 = integer_tape(integer_tape_pointer)
      IF(OpenAD_Symbol_832 .ne. 0) THEN
      ENDIF
    ENDIF
    OpenAD_Symbol_827 = INT(OpenAD_Symbol_827) + 1
  END DO
    end if
  end subroutine SPDIAGS_FVM
!#########################################################
! This file is part of OpenAD released under the LGPL.   #
! The full COPYRIGHT notice can be found in the top      #
! level directory of the OpenAD distribution             #
!#########################################################

  SUBROUTINE SPDIAGS_FVM_CSR(NX, NY, NZ, IMATRIX, ONNZ, OROW_INDEX, OROW_COMPRES&
     &SED, OCOL_INDEX, OVALUES)

    use OAD_tape
    use OAD_rev

! original arguments get inserted before version
!         ! and declared here together with all local variables
!         ! generated by xaifBooster

  use w2f__types
  IMPLICIT NONE
!
!       **** Global Variables & Derived Type Definitions ****
!
  INTEGER(w2f__i8) OpenAD_Symbol_784
  INTEGER(w2f__i8) OpenAD_Symbol_785
  INTEGER(w2f__i8) OpenAD_Symbol_786
  INTEGER(w2f__i8) OpenAD_Symbol_787
  INTEGER(w2f__i8) OpenAD_Symbol_788
  INTEGER(w2f__i8) OpenAD_Symbol_789
  INTEGER(w2f__i8) OpenAD_Symbol_790
  INTEGER(w2f__i8) OpenAD_Symbol_791
  INTEGER(w2f__i8) OpenAD_Symbol_792
  INTEGER(w2f__i8) OpenAD_Symbol_793
  INTEGER(w2f__i8) OpenAD_Symbol_794
  INTEGER(w2f__i8) OpenAD_Symbol_795
  INTEGER(w2f__i8) OpenAD_Symbol_796
  INTEGER(w2f__i8) OpenAD_Symbol_797
  INTEGER(w2f__i8) OpenAD_Symbol_798
  INTEGER(w2f__i8) OpenAD_Symbol_799
  INTEGER(w2f__i8) OpenAD_Symbol_800
  INTEGER(w2f__i8) OpenAD_Symbol_801
  INTEGER(w2f__i8) OpenAD_Symbol_802
  INTEGER(w2f__i8) OpenAD_Symbol_803
  INTEGER(w2f__i8) OpenAD_Symbol_804
  INTEGER(w2f__i8) OpenAD_Symbol_805
  INTEGER(w2f__i8) OpenAD_Symbol_806
  INTEGER(w2f__i8) OpenAD_Symbol_807
  INTEGER(w2f__i8) OpenAD_Symbol_808
  INTEGER(w2f__i8) OpenAD_Symbol_809
  INTEGER(w2f__i8) OpenAD_Symbol_810
  INTEGER(w2f__i8) OpenAD_Symbol_811
  INTEGER(w2f__i8) OpenAD_Symbol_812
  INTEGER(w2f__i8) OpenAD_Symbol_813
  INTEGER(w2f__i8) OpenAD_Symbol_814
  INTEGER(w2f__i8) OpenAD_Symbol_815
  INTEGER(w2f__i8) OpenAD_Symbol_816
  INTEGER(w2f__i8) OpenAD_Symbol_817
  INTEGER(w2f__i8) OpenAD_Symbol_818
  INTEGER(w2f__i8) OpenAD_Symbol_819
  INTEGER(w2f__i8) OpenAD_Symbol_820
  INTEGER(w2f__i8) OpenAD_Symbol_821
  INTEGER(w2f__i8) OpenAD_Symbol_822
  INTEGER(w2f__i8) OpenAD_Symbol_823
  INTEGER(w2f__i8) OpenAD_Symbol_824
  INTEGER(w2f__i8) OpenAD_Symbol_825
!
!       **** Parameters and Result ****
!
  INTEGER(w2f__i4) NX
  INTEGER(w2f__i4) NY
  INTEGER(w2f__i4) NZ
  type(active) :: IMATRIX(1:INT((NZ*NX*NY)),1:7)
  INTEGER(w2f__i4) ONNZ
  INTEGER(w2f__i4) OROW_INDEX(1 : INT((NZ * NX * NY * 7)))
  INTEGER(w2f__i4) OROW_COMPRESSED(1 : INT((NZ * NX * NY + 1)))
  INTEGER(w2f__i4) OCOL_INDEX(1 : INT((NZ * NX * NY * 7)))
  type(active) :: OVALUES(1:INT((NZ*NX*NY*7)))
!
!       **** Local Variables and Functions ****
!
  INTEGER(w2f__i4) COL_DIAG(1 : 7)
  INTEGER(w2f__i4) END_ROW_IMATRIX(1 : 7)
  INTEGER(w2f__i4) I
  INTEGER(w2f__i4) IDIAGS(1 : 7)
  INTEGER(w2f__i4) J
  INTEGER(w2f__i4) ROWNNZ
  INTEGER(w2f__i4) ROW_DIAG(1 : 7)
  INTEGER(w2f__i4) START_ROW_IMATRIX(1 : 7)
  INTEGER(w2f__i4) OpenAD_Symbol_1174
  INTEGER(w2f__i4) OpenAD_Symbol_1175
  INTEGER(w2f__i4) OpenAD_Symbol_1176


    integer iaddr
    external iaddr
!
!       **** Statements ****
!

   if (our_rev_mode%plain) then
! original function
  IDIAGS(1) = (-(NX * NY))
  IDIAGS(2) = (- NX)
  IDIAGS(3) = (-1)
  IDIAGS(4) = 0
  IDIAGS(5) = 1
  IDIAGS(6) = NX
  IDIAGS(7) = (NX * NY)
  ONNZ = 0
  OROW_COMPRESSED(1) = 1
  DO I = 1, 7, 1
    IF(IDIAGS(I) .GT. 0) THEN
      START_ROW_IMATRIX(I) = (IDIAGS(I) + 1)
      END_ROW_IMATRIX(I) = (NZ * NX * NY)
    ELSE
      IF(IDIAGS(I) .LE. 0) THEN
        START_ROW_IMATRIX(I) = 1
        END_ROW_IMATRIX(I) = (IDIAGS(I) + NZ * NX * NY)
      ENDIF
    ENDIF
    CALL FIRSTELM(IDIAGS(I),ROW_DIAG(I),COL_DIAG(I))
  END DO
  DO I = 1, (NZ * NX * NY), 1
    ROWNNZ = 0
    DO J = 1, 7, 1
      IF((END_ROW_IMATRIX(J) .GE. START_ROW_IMATRIX(J)) .AND.( ROW_DIAG(J) .LE. &
     &I)) THEN

        IF ((IDIAGS(J).eq.0).OR.(IMATRIX(START_ROW_IMATRIX(J),J)%v.ne.0.0D00)) T&
     &HEN

          ONNZ = (ONNZ+1)
          ROWNNZ = (ROWNNZ+1)
          OROW_INDEX(ONNZ) = I
          OCOL_INDEX(ONNZ) = COL_DIAG(J)
          OVALUES(INT(ONNZ))%v = IMATRIX(START_ROW_IMATRIX(J),J)%v
        ENDIF
        START_ROW_IMATRIX(J) = (START_ROW_IMATRIX(J)+1)
        COL_DIAG(J) = (COL_DIAG(J)+1)
      ENDIF
    END DO
    OROW_COMPRESSED(I+1) = (OROW_COMPRESSED(I)+ROWNNZ)
  END DO
    end if
    if (our_rev_mode%tape) then
! taping
  IDIAGS(1) = (-(NX*NY))
  IDIAGS(2) = (-NX)
  IDIAGS(3) = (-1)
  IDIAGS(4) = 0
  IDIAGS(5) = 1
  IDIAGS(6) = NX
  IDIAGS(7) = (NX*NY)
  ONNZ = 0
  OROW_COMPRESSED(1) = 1
  OpenAD_Symbol_794 = 0_w2f__i8
  DO I = 1,7,1
    IF (IDIAGS(I).GT.0) THEN
      START_ROW_IMATRIX(I) = (IDIAGS(I)+1)
      END_ROW_IMATRIX(I) = (NZ*NX*NY)
      OpenAD_Symbol_797 = 1_w2f__i8
      integer_tape(integer_tape_pointer) = OpenAD_Symbol_797
      integer_tape_pointer = integer_tape_pointer+1
    ELSE
      IF (IDIAGS(I).LE.0) THEN
        START_ROW_IMATRIX(I) = 1
        END_ROW_IMATRIX(I) = (IDIAGS(I)+NZ*NX*NY)
        OpenAD_Symbol_795 = 1_w2f__i8
        integer_tape(integer_tape_pointer) = OpenAD_Symbol_795
        integer_tape_pointer = integer_tape_pointer+1
      ELSE
        OpenAD_Symbol_796 = 0_w2f__i8
        integer_tape(integer_tape_pointer) = OpenAD_Symbol_796
        integer_tape_pointer = integer_tape_pointer+1
      ENDIF
      OpenAD_Symbol_798 = 0_w2f__i8
      integer_tape(integer_tape_pointer) = OpenAD_Symbol_798
      integer_tape_pointer = integer_tape_pointer+1
    ENDIF
    CALL FIRSTELM(IDIAGS(I),ROW_DIAG(I),COL_DIAG(I))
    integer_tape(integer_tape_pointer) = I
    integer_tape_pointer = integer_tape_pointer+1
    OpenAD_Symbol_794 = (INT(OpenAD_Symbol_794)+INT(1_w2f__i8))
  END DO
  integer_tape(integer_tape_pointer) = OpenAD_Symbol_794
  integer_tape_pointer = integer_tape_pointer+1
  OpenAD_Symbol_799 = 0_w2f__i8
  DO I = 1,(NZ*NX*NY),1
    ROWNNZ = 0
    OpenAD_Symbol_800 = 0_w2f__i8
    DO J = 1,7,1
      IF ((END_ROW_IMATRIX(J).GE.START_ROW_IMATRIX(J)).AND.(ROW_DIAG(J).LE.I)) T&
     &HEN

        IF ((IDIAGS(J).eq.0).OR.(IMATRIX(START_ROW_IMATRIX(J),J)%v.ne.0.0D00)) T&
     &HEN

          ONNZ = (ONNZ+1)
          ROWNNZ = (ROWNNZ+1)
          OVALUES(INT(ONNZ))%v = IMATRIX(START_ROW_IMATRIX(J),J)%v
          integer_tape(integer_tape_pointer) = START_ROW_IMATRIX(J)
          integer_tape_pointer = integer_tape_pointer+1
          integer_tape(integer_tape_pointer) = J
          integer_tape_pointer = integer_tape_pointer+1
          integer_tape(integer_tape_pointer) = ONNZ
          integer_tape_pointer = integer_tape_pointer+1
          OROW_INDEX(ONNZ) = I
          OCOL_INDEX(ONNZ) = COL_DIAG(J)
          OpenAD_Symbol_801 = 1_w2f__i8
          integer_tape(integer_tape_pointer) = OpenAD_Symbol_801
          integer_tape_pointer = integer_tape_pointer+1
        ELSE
          OpenAD_Symbol_802 = 0_w2f__i8
          integer_tape(integer_tape_pointer) = OpenAD_Symbol_802
          integer_tape_pointer = integer_tape_pointer+1
        ENDIF
        START_ROW_IMATRIX(J) = (START_ROW_IMATRIX(J)+1)
        COL_DIAG(J) = (COL_DIAG(J)+1)
        OpenAD_Symbol_804 = 1_w2f__i8
        integer_tape(integer_tape_pointer) = OpenAD_Symbol_804
        integer_tape_pointer = integer_tape_pointer+1
      ELSE
        OpenAD_Symbol_803 = 0_w2f__i8
        integer_tape(integer_tape_pointer) = OpenAD_Symbol_803
        integer_tape_pointer = integer_tape_pointer+1
      ENDIF
      OpenAD_Symbol_800 = (INT(OpenAD_Symbol_800)+INT(1_w2f__i8))
    END DO
    integer_tape(integer_tape_pointer) = OpenAD_Symbol_800
    integer_tape_pointer = integer_tape_pointer+1
    OROW_COMPRESSED(I+1) = (OROW_COMPRESSED(I)+ROWNNZ)
    OpenAD_Symbol_799 = (INT(OpenAD_Symbol_799)+INT(1_w2f__i8))
  END DO
  integer_tape(integer_tape_pointer) = OpenAD_Symbol_799
  integer_tape_pointer = integer_tape_pointer+1
    end if
    if (our_rev_mode%adjoint) then
! adjoint
  integer_tape_pointer = integer_tape_pointer-1
  OpenAD_Symbol_784 = integer_tape(integer_tape_pointer)
  OpenAD_Symbol_785 = 1
  do while (INT(OpenAD_Symbol_785).LE.INT(OpenAD_Symbol_784))
    integer_tape_pointer = integer_tape_pointer-1
    OpenAD_Symbol_786 = integer_tape(integer_tape_pointer)
    OpenAD_Symbol_787 = 1
    do while (INT(OpenAD_Symbol_787).LE.INT(OpenAD_Symbol_786))
      integer_tape_pointer = integer_tape_pointer-1
      OpenAD_Symbol_788 = integer_tape(integer_tape_pointer)
      IF (OpenAD_Symbol_788.ne.0) THEN
        integer_tape_pointer = integer_tape_pointer-1
        OpenAD_Symbol_789 = integer_tape(integer_tape_pointer)
        IF (OpenAD_Symbol_789.ne.0) THEN
          integer_tape_pointer = integer_tape_pointer-1
          OpenAD_Symbol_1174 = integer_tape(integer_tape_pointer)
          integer_tape_pointer = integer_tape_pointer-1
          OpenAD_Symbol_1175 = integer_tape(integer_tape_pointer)
          integer_tape_pointer = integer_tape_pointer-1
          OpenAD_Symbol_1176 = integer_tape(integer_tape_pointer)
          IMATRIX(OpenAD_Symbol_1176,OpenAD_Symbol_1175)%d = IMATRIX(OpenAD_Symb&
     &ol_1176,OpenAD_Symbol_1175)%d+OVALUES(OpenAD_Symbol_1174)%d

          OVALUES(OpenAD_Symbol_1174)%d = 0.0d0
        ENDIF
      ENDIF
      OpenAD_Symbol_787 = INT(OpenAD_Symbol_787)+1
    END DO
    OpenAD_Symbol_785 = INT(OpenAD_Symbol_785)+1
  END DO
  integer_tape_pointer = integer_tape_pointer-1
  OpenAD_Symbol_790 = integer_tape(integer_tape_pointer)
  OpenAD_Symbol_791 = 1
  do while (INT(OpenAD_Symbol_791).LE.INT(OpenAD_Symbol_790))
    integer_tape_pointer = integer_tape_pointer-1
    I = integer_tape(integer_tape_pointer)
    CALL FIRSTELM(IDIAGS(I),ROW_DIAG(I),COL_DIAG(I))
    integer_tape_pointer = integer_tape_pointer-1
    OpenAD_Symbol_792 = integer_tape(integer_tape_pointer)
    IF (OpenAD_Symbol_792.ne.0) THEN
    ELSE
      integer_tape_pointer = integer_tape_pointer-1
      OpenAD_Symbol_793 = integer_tape(integer_tape_pointer)
      IF (OpenAD_Symbol_793.ne.0) THEN
      ENDIF
    ENDIF
    OpenAD_Symbol_791 = INT(OpenAD_Symbol_791)+1
  END DO
    end if
  end subroutine SPDIAGS_FVM_CSR
END

MODULE simulation
use OAD_active
use w2f__types
use oad_intrinsics
use parameters
use matrix
use finitevolume
IMPLICIT NONE
SAVE
!
!     **** Statements ****
!
CONTAINS
!#########################################################
! This file is part of OpenAD released under the LGPL.   #
! The full COPYRIGHT notice can be found in the top      #
! level directory of the OpenAD distribution             #
!#########################################################

  SUBROUTINE INIT_FLW_TRNC_NORM_XIN_PT_OUT(NX, NY, NZ, MU, SIGMA, Q)
    use OAD_tape
    use OAD_rev

! original arguments get inserted before version
!         ! and declared here together with all local variables
!         ! generated by xaifBooster

  use w2f__types
  IMPLICIT NONE
!
!       **** Global Variables & Derived Type Definitions ****
!
  INTEGER(w2f__i8) OpenAD_Symbol_856
  INTEGER(w2f__i8) OpenAD_Symbol_857
  INTEGER(w2f__i8) OpenAD_Symbol_858
  INTEGER(w2f__i8) OpenAD_Symbol_859
  INTEGER(w2f__i8) OpenAD_Symbol_860
  INTEGER(w2f__i8) OpenAD_Symbol_861
  INTEGER(w2f__i8) OpenAD_Symbol_862
  INTEGER(w2f__i8) OpenAD_Symbol_863
  INTEGER(w2f__i8) OpenAD_Symbol_864
  INTEGER(w2f__i8) OpenAD_Symbol_865
  INTEGER(w2f__i8) OpenAD_Symbol_866
  INTEGER(w2f__i8) OpenAD_Symbol_867
  INTEGER(w2f__i8) OpenAD_Symbol_868
  INTEGER(w2f__i8) OpenAD_Symbol_869
  INTEGER(w2f__i8) OpenAD_Symbol_870
  INTEGER(w2f__i8) OpenAD_Symbol_871
  INTEGER(w2f__i8) OpenAD_Symbol_872
  INTEGER(w2f__i8) OpenAD_Symbol_873
!
!       **** Parameters and Result ****
!
  INTEGER(w2f__i4) NX
  INTEGER(w2f__i4) NY
  INTEGER(w2f__i4) NZ
  type(active) :: MU
  type(active) :: SIGMA
  type(active) :: Q(1:INT((NZ*NX*NY)))
!
!       **** Local Variables and Functions ****
!
  INTEGER(w2f__i4) I
  REAL(w2f__8) IDX(1 : NX)
  INTEGER(w2f__i4) J
  type(active) :: MASS
  type(active) :: PDF
  REAL(w2f__8) PI
  type(active) :: Q_X(1:NX)
  REAL(w2f__8) X
  INTEGER(w2f__i4) OpenAD_Symbol_1177
  INTEGER(w2f__i4) OpenAD_Symbol_1178
  REAL(w2f__8) OpenAD_Symbol_1179
  REAL(w2f__8) OpenAD_Symbol_1180
  REAL(w2f__8) OpenAD_Symbol_1181
  INTEGER(w2f__i4) OpenAD_Symbol_1182
  REAL(w2f__8) OpenAD_Symbol_1183
  REAL(w2f__8) OpenAD_Symbol_1184
  INTEGER(w2f__i4) OpenAD_Symbol_1185
  INTEGER(w2f__i4) OpenAD_Symbol_1186
  INTEGER(w2f__i4) OpenAD_Symbol_1187
  INTEGER(w2f__i4) OpenAD_Symbol_874
  REAL(w2f__8) OpenAD_acc_10
  REAL(w2f__8) OpenAD_acc_11
  REAL(w2f__8) OpenAD_acc_12
  REAL(w2f__8) OpenAD_acc_13
  REAL(w2f__8) OpenAD_acc_14
  REAL(w2f__8) OpenAD_acc_9
  REAL(w2f__8) OpenAD_aux_29
  REAL(w2f__8) OpenAD_aux_30
  REAL(w2f__8) OpenAD_aux_31
  REAL(w2f__8) OpenAD_aux_32
  REAL(w2f__8) OpenAD_aux_33
  REAL(w2f__8) OpenAD_aux_34
  REAL(w2f__8) OpenAD_aux_35
  REAL(w2f__8) OpenAD_aux_36
  REAL(w2f__8) OpenAD_lin_43
  REAL(w2f__8) OpenAD_lin_44
  REAL(w2f__8) OpenAD_lin_45
  REAL(w2f__8) OpenAD_lin_46
  REAL(w2f__8) OpenAD_lin_47
  REAL(w2f__8) OpenAD_lin_48
  REAL(w2f__8) OpenAD_lin_49
  REAL(w2f__8) OpenAD_lin_50
  REAL(w2f__8) OpenAD_lin_51
  REAL(w2f__8) OpenAD_lin_52
  REAL(w2f__8) OpenAD_lin_53
  type(active) :: OpenAD_prp_32
  type(active) :: OpenAD_prp_33


    integer iaddr
    external iaddr
!
!       **** Statements ****
!

   if (our_rev_mode%plain) then
! original function
  PI = 3.141592653589793116D00
  MASS%v = 0.0D00
  Q_X(1:INT(NX))%v = 0.0D00
  DO I = 1,NX,1
    X = ((((I+(-1))*3.0D00)/(NX+(-1)))+(-1.5D00))
    PDF%v = (EXP((((X-MU%v)/SIGMA%v)**2.0D00)*(-5.0D-01))*(1.0D00/(SIGMA%v*SQRT(&
     &PI*2.0D00))))

    Q_X(INT(I))%v = PDF%v
    MASS%v = (MASS%v+PDF%v)
    IDX(INT(I)) = I
  END DO
  DO I = 1,NX,1
    Q_X(INT(I))%v = (IR*(Q_X(I)%v/MASS%v))
  END DO
  J = 1
  DO I = 1,(NX*NY),NY
    Q(INT(I))%v = Q_X(J)%v
    J = (J+1)
  END DO
  Q(NZ*NX*NY)%v = (-IR)
    end if
    if (our_rev_mode%tape) then
! taping
  PI = 3.141592653589793116D00
  MASS%v = 0.0D00
  Q_X(1:INT(NX))%v = 0.0D00
  integer_tape(integer_tape_pointer) = NX
  integer_tape_pointer = integer_tape_pointer+1
  OpenAD_Symbol_862 = 0_w2f__i8
  DO I = 1,NX,1
    X = ((((I+(-1))*3.0D00)/(NX+(-1)))+(-1.5D00))
    OpenAD_aux_33 = (X-MU%v)
    OpenAD_aux_32 = (OpenAD_aux_33/SIGMA%v)
    OpenAD_aux_31 = (OpenAD_aux_32**2.0D00)
    OpenAD_aux_29 = EXP(OpenAD_aux_31*(-5.0D-01))
    OpenAD_aux_35 = SQRT(PI*2.0D00)
    OpenAD_aux_34 = (SIGMA%v*OpenAD_aux_35)
    OpenAD_aux_30 = (1.0D00/OpenAD_aux_34)
    OpenAD_lin_47 = (INT(1_w2f__i8)/SIGMA%v)
    OpenAD_lin_48 = (-(OpenAD_aux_33/(SIGMA%v*SIGMA%v)))
    OpenAD_lin_46 = (2.0D00*(OpenAD_aux_32**(2.0D00-INT(1_w2f__i8))))
    OpenAD_lin_45 = OpenAD_aux_29
    OpenAD_lin_43 = OpenAD_aux_30
    OpenAD_lin_50 = OpenAD_aux_35
    OpenAD_lin_49 = (-(1.0D00/(OpenAD_aux_34*OpenAD_aux_34)))
    OpenAD_lin_44 = OpenAD_aux_29
    PDF%v = (OpenAD_aux_29*OpenAD_aux_30)
    Q_X(INT(I))%v = PDF%v
    MASS%v = (MASS%v+PDF%v)
    IDX(INT(I)) = I
    OpenAD_acc_9 = (OpenAD_lin_46*(-5.0D-01)*OpenAD_lin_45*OpenAD_lin_43)
    OpenAD_acc_10 = (OpenAD_lin_50*OpenAD_lin_49*OpenAD_lin_44)
    OpenAD_acc_11 = (OpenAD_lin_48*OpenAD_acc_9)
    OpenAD_acc_12 = (INT((-1_w2f__i8))*OpenAD_lin_47*OpenAD_acc_9)
    double_tape(double_tape_pointer) = OpenAD_acc_10
    double_tape_pointer = double_tape_pointer+1
    double_tape(double_tape_pointer) = OpenAD_acc_11
    double_tape_pointer = double_tape_pointer+1
    double_tape(double_tape_pointer) = OpenAD_acc_12
    double_tape_pointer = double_tape_pointer+1
    integer_tape(integer_tape_pointer) = I
    integer_tape_pointer = integer_tape_pointer+1
    OpenAD_Symbol_862 = (INT(OpenAD_Symbol_862)+INT(1_w2f__i8))
  END DO
  integer_tape(integer_tape_pointer) = OpenAD_Symbol_862
  integer_tape_pointer = integer_tape_pointer+1
  OpenAD_Symbol_863 = 0_w2f__i8
  DO I = 1,NX,1
    OpenAD_aux_36 = (Q_X(I)%v/MASS%v)
    OpenAD_lin_52 = (INT(1_w2f__i8)/MASS%v)
    OpenAD_lin_53 = (-(Q_X(I)%v/(MASS%v*MASS%v)))
    OpenAD_lin_51 = IR
    Q_X(INT(I))%v = (IR*OpenAD_aux_36)
    OpenAD_acc_13 = (OpenAD_lin_52*OpenAD_lin_51)
    OpenAD_acc_14 = (OpenAD_lin_53*OpenAD_lin_51)
    double_tape(double_tape_pointer) = OpenAD_acc_13
    double_tape_pointer = double_tape_pointer+1
    double_tape(double_tape_pointer) = OpenAD_acc_14
    double_tape_pointer = double_tape_pointer+1
    integer_tape(integer_tape_pointer) = I
    integer_tape_pointer = integer_tape_pointer+1
    OpenAD_Symbol_863 = (INT(OpenAD_Symbol_863)+INT(1_w2f__i8))
  END DO
  integer_tape(integer_tape_pointer) = OpenAD_Symbol_863
  integer_tape_pointer = integer_tape_pointer+1
  J = 1
  OpenAD_Symbol_864 = 0_w2f__i8
  DO I = 1,(NX*NY),NY
    Q(INT(I))%v = Q_X(J)%v
    integer_tape(integer_tape_pointer) = J
    integer_tape_pointer = integer_tape_pointer+1
    integer_tape(integer_tape_pointer) = I
    integer_tape_pointer = integer_tape_pointer+1
    J = (J+1)
    OpenAD_Symbol_864 = (INT(OpenAD_Symbol_864)+INT(1_w2f__i8))
  END DO
  integer_tape(integer_tape_pointer) = OpenAD_Symbol_864
  integer_tape_pointer = integer_tape_pointer+1
  Q(NZ*NX*NY)%v = (-IR)
  OpenAD_Symbol_874 = (NZ*NX*NY)
  integer_tape(integer_tape_pointer) = OpenAD_Symbol_874
  integer_tape_pointer = integer_tape_pointer+1
    end if
    if (our_rev_mode%adjoint) then
! adjoint
  integer_tape_pointer = integer_tape_pointer-1
  OpenAD_Symbol_1187 = integer_tape(integer_tape_pointer)
  Q(OpenAD_Symbol_1187)%d = 0.0d0
  integer_tape_pointer = integer_tape_pointer-1
  OpenAD_Symbol_856 = integer_tape(integer_tape_pointer)
  OpenAD_Symbol_857 = 1
  do while (INT(OpenAD_Symbol_857).LE.INT(OpenAD_Symbol_856))
    integer_tape_pointer = integer_tape_pointer-1
    OpenAD_Symbol_1185 = integer_tape(integer_tape_pointer)
    integer_tape_pointer = integer_tape_pointer-1
    OpenAD_Symbol_1186 = integer_tape(integer_tape_pointer)
    Q_X(OpenAD_Symbol_1186)%d = Q_X(OpenAD_Symbol_1186)%d+Q(OpenAD_Symbol_1185)%&
     &d

    Q(OpenAD_Symbol_1185)%d = 0.0d0
    OpenAD_Symbol_857 = INT(OpenAD_Symbol_857)+1
  END DO
  integer_tape_pointer = integer_tape_pointer-1
  OpenAD_Symbol_858 = integer_tape(integer_tape_pointer)
  OpenAD_Symbol_859 = 1
  do while (INT(OpenAD_Symbol_859).LE.INT(OpenAD_Symbol_858))
    integer_tape_pointer = integer_tape_pointer-1
    OpenAD_Symbol_1182 = integer_tape(integer_tape_pointer)
    double_tape_pointer = double_tape_pointer-1
    OpenAD_Symbol_1183 = double_tape(double_tape_pointer)
    double_tape_pointer = double_tape_pointer-1
    OpenAD_Symbol_1184 = double_tape(double_tape_pointer)
    MASS%d = MASS%d+Q_X(OpenAD_Symbol_1182)%d*(OpenAD_Symbol_1183)
    OpenAD_prp_33%d = OpenAD_prp_33%d+Q_X(OpenAD_Symbol_1182)%d*(OpenAD_Symbol_1&
     &184)

    Q_X(OpenAD_Symbol_1182)%d = 0.0d0
    Q_X(OpenAD_Symbol_1182)%d = Q_X(OpenAD_Symbol_1182)%d+OpenAD_prp_33%d
    OpenAD_prp_33%d = 0.0d0
    OpenAD_Symbol_859 = INT(OpenAD_Symbol_859)+1
  END DO
  integer_tape_pointer = integer_tape_pointer-1
  OpenAD_Symbol_860 = integer_tape(integer_tape_pointer)
  OpenAD_Symbol_861 = 1
  do while (INT(OpenAD_Symbol_861).LE.INT(OpenAD_Symbol_860))
    integer_tape_pointer = integer_tape_pointer-1
    OpenAD_Symbol_1178 = integer_tape(integer_tape_pointer)
    double_tape_pointer = double_tape_pointer-1
    OpenAD_Symbol_1179 = double_tape(double_tape_pointer)
    double_tape_pointer = double_tape_pointer-1
    OpenAD_Symbol_1180 = double_tape(double_tape_pointer)
    double_tape_pointer = double_tape_pointer-1
    OpenAD_Symbol_1181 = double_tape(double_tape_pointer)
    PDF%d = PDF%d+MASS%d
    OpenAD_prp_32%d = OpenAD_prp_32%d+MASS%d
    MASS%d = 0.0d0
    PDF%d = PDF%d+Q_X(OpenAD_Symbol_1178)%d
    Q_X(OpenAD_Symbol_1178)%d = 0.0d0
    MU%d = MU%d+PDF%d*(OpenAD_Symbol_1179)
    SIGMA%d = SIGMA%d+PDF%d*(OpenAD_Symbol_1180)
    SIGMA%d = SIGMA%d+PDF%d*(OpenAD_Symbol_1181)
    PDF%d = 0.0d0
    MASS%d = MASS%d+OpenAD_prp_32%d
    OpenAD_prp_32%d = 0.0d0
    OpenAD_Symbol_861 = INT(OpenAD_Symbol_861)+1
  END DO
  integer_tape_pointer = integer_tape_pointer-1
  OpenAD_Symbol_1177 = integer_tape(integer_tape_pointer)
  Q_X(1:OpenAD_Symbol_1177)%d = 0.0d0
  MASS%d = 0.0d0
    end if
  end subroutine INIT_FLW_TRNC_NORM_XIN_PT_OUT
!#########################################################
! This file is part of OpenAD released under the LGPL.   #
! The full COPYRIGHT notice can be found in the top      #
! level directory of the OpenAD distribution             #
!#########################################################

  SUBROUTINE SIMULATE_RESERVOIR(NX, NY, NZ, ND, PT, ST, Q, S, P, V, TT, PC, OIL)
    use OAD_tape
    use OAD_rev

! original arguments get inserted before version
!         ! and declared here together with all local variables
!         ! generated by xaifBooster

  use w2f__types
  use parameters
  use parameters
  use parameters
  IMPLICIT NONE
!
!       **** Global Variables & Derived Type Definitions ****
!
  INTEGER(w2f__i8) OpenAD_Symbol_875
  INTEGER(w2f__i8) OpenAD_Symbol_876
  INTEGER(w2f__i8) OpenAD_Symbol_877
  INTEGER(w2f__i8) OpenAD_Symbol_878
  INTEGER(w2f__i8) OpenAD_Symbol_879
  INTEGER(w2f__i8) OpenAD_Symbol_880
  INTEGER(w2f__i8) OpenAD_Symbol_881
  INTEGER(w2f__i8) OpenAD_Symbol_882
  INTEGER(w2f__i8) OpenAD_Symbol_883
  INTEGER(w2f__i8) OpenAD_Symbol_884
  INTEGER(w2f__i8) OpenAD_Symbol_885
  INTEGER(w2f__i8) OpenAD_Symbol_886
  INTEGER(w2f__i8) OpenAD_Symbol_887
  INTEGER(w2f__i8) OpenAD_Symbol_888
  INTEGER(w2f__i8) OpenAD_Symbol_889
  INTEGER(w2f__i8) OpenAD_Symbol_890
  INTEGER(w2f__i8) OpenAD_Symbol_891
  INTEGER(w2f__i8) OpenAD_Symbol_892
!
!       **** Parameters and Result ****
!
  INTEGER(w2f__i4) NX
  INTEGER(w2f__i4) NY
  INTEGER(w2f__i4) NZ
  INTEGER(w2f__i4) ND
  INTEGER(w2f__i4) PT
  INTEGER(w2f__i4) ST
  type(active) :: Q(1:INT((NZ*NX*NY)))
  type(active) :: S(1:INT((NZ*NX*NY)))
  type(active) :: P(1:NX,1:NY,1:NZ)
  type(active) :: V(1:3,1:INT((NX+1)),1:INT((NY+1)),1:INT((NZ+1)))
  REAL(w2f__8) TT(1 : INT(((ND / ST) + 1)))
  type(active) :: PC(1:2,1:INT(((ND/ST)+1)))
  type(active) :: OIL
!
!       **** Local Variables and Functions ****
!
  INTEGER(w2f__i4) I
  INTEGER(w2f__i4) J
  INTEGER(w2f__i4) K
  type(active) :: MO
  type(active) :: MT
  type(active) :: MW
  INTEGER(w2f__i4) OAD_CTMP0
  INTEGER(w2f__i4) OAD_CTMP1
  type(active) :: TEMPOIL1
  type(active) :: TEMPOIL2
  INTEGER(w2f__i4) OpenAD_Symbol_1188
  INTEGER(w2f__i4) OpenAD_Symbol_1189
  REAL(w2f__8) OpenAD_Symbol_1190
  REAL(w2f__8) OpenAD_Symbol_1191
  INTEGER(w2f__i4) OpenAD_Symbol_1192
  REAL(w2f__8) OpenAD_Symbol_1193
  REAL(w2f__8) OpenAD_Symbol_1194
  INTEGER(w2f__i4) OpenAD_Symbol_893
  REAL(w2f__8) OpenAD_lin_54
  REAL(w2f__8) OpenAD_lin_55
  REAL(w2f__8) OpenAD_lin_56
  REAL(w2f__8) OpenAD_lin_57
!
!       **** Statements ****
!


    integer iaddr
    external iaddr

   if (our_rev_mode%plain) then
! original function
  S(1:NZ*NX*NY)%v = SWC
  PC(1,1)%v = 0.0D00
  PC(2,1)%v = 1.0D00
  TT(1) = 0.0D00
  TEMPOIL1%v = 0.0D00
  TEMPOIL2%v = 0.0D00
  K = 1
  DO I = 1,(ND/PT),1
    DO J = 1,(PT/ST),1
      K = (K+1)
      IF (J.eq.1) THEN
        OAD_CTMP0 = 1
        CALL STEPFORWARD(NX,NY,NZ,ND,PT,ST,OAD_CTMP0,Q,S,P,V,MW,MO)
      ELSE
        OAD_CTMP1 = 0
        CALL STEPFORWARD(NX,NY,NZ,ND,PT,ST,OAD_CTMP1,Q,S,P,V,MW,MO)
      ENDIF
      MT%v = (MO%v+MW%v)
      TT(INT(K)) = (ST*K)
      PC(1,INT(K))%v = (MW%v/MT%v)
      PC(2,INT(K))%v = (MO%v/MT%v)
      CALL UPDATE_OIL(ND,PT,ST,PC,K,TEMPOIL1,TEMPOIL2)
      TEMPOIL1%v = TEMPOIL2%v
    END DO
  END DO
  OIL%v = TEMPOIL2%v
    end if
    if (our_rev_mode%tape) then
! taping
  S(1:NZ*NX*NY)%v = SWC
  PC(1,1)%v = 0.0D00
  PC(2,1)%v = 1.0D00
  TT(1) = 0.0D00
  TEMPOIL1%v = 0.0D00
  TEMPOIL2%v = 0.0D00
  K = 1
  OpenAD_Symbol_893 = (NZ*NX*NY)
  integer_tape(integer_tape_pointer) = OpenAD_Symbol_893
  integer_tape_pointer = integer_tape_pointer+1
  OpenAD_Symbol_880 = 0_w2f__i8
  DO I = 1,(ND/PT),1
    OpenAD_Symbol_881 = 0_w2f__i8
    DO J = 1,(PT/ST),1
      K = (K+1)
      IF (J.eq.1) THEN
        OAD_CTMP0 = 1
        CALL STEPFORWARD(NX,NY,NZ,ND,PT,ST,OAD_CTMP0,Q,S,P,V,MW,MO)
        integer_tape(integer_tape_pointer) = NX
        integer_tape_pointer = integer_tape_pointer+1
        integer_tape(integer_tape_pointer) = NY
        integer_tape_pointer = integer_tape_pointer+1
        integer_tape(integer_tape_pointer) = NZ
        integer_tape_pointer = integer_tape_pointer+1
        OpenAD_Symbol_882 = 1_w2f__i8
        integer_tape(integer_tape_pointer) = OpenAD_Symbol_882
        integer_tape_pointer = integer_tape_pointer+1
      ELSE
        OAD_CTMP1 = 0
        CALL STEPFORWARD(NX,NY,NZ,ND,PT,ST,OAD_CTMP1,Q,S,P,V,MW,MO)
        integer_tape(integer_tape_pointer) = NX
        integer_tape_pointer = integer_tape_pointer+1
        integer_tape(integer_tape_pointer) = NY
        integer_tape_pointer = integer_tape_pointer+1
        integer_tape(integer_tape_pointer) = NZ
        integer_tape_pointer = integer_tape_pointer+1
        OpenAD_Symbol_883 = 0_w2f__i8
        integer_tape(integer_tape_pointer) = OpenAD_Symbol_883
        integer_tape_pointer = integer_tape_pointer+1
      ENDIF
      MT%v = (MO%v+MW%v)
      TT(INT(K)) = (ST*K)
      OpenAD_lin_54 = (INT(1_w2f__i8)/MT%v)
      OpenAD_lin_55 = (-(MW%v/(MT%v*MT%v)))
      PC(1,INT(K))%v = (MW%v/MT%v)
      double_tape(double_tape_pointer) = OpenAD_lin_54
      double_tape_pointer = double_tape_pointer+1
      double_tape(double_tape_pointer) = OpenAD_lin_55
      double_tape_pointer = double_tape_pointer+1
      integer_tape(integer_tape_pointer) = K
      integer_tape_pointer = integer_tape_pointer+1
      OpenAD_lin_56 = (INT(1_w2f__i8)/MT%v)
      OpenAD_lin_57 = (-(MO%v/(MT%v*MT%v)))
      PC(2,INT(K))%v = (MO%v/MT%v)
      double_tape(double_tape_pointer) = OpenAD_lin_56
      double_tape_pointer = double_tape_pointer+1
      double_tape(double_tape_pointer) = OpenAD_lin_57
      double_tape_pointer = double_tape_pointer+1
      integer_tape(integer_tape_pointer) = K
      integer_tape_pointer = integer_tape_pointer+1
      CALL UPDATE_OIL(ND,PT,ST,PC,K,TEMPOIL1,TEMPOIL2)
      integer_tape(integer_tape_pointer) = ND
      integer_tape_pointer = integer_tape_pointer+1
      integer_tape(integer_tape_pointer) = ST
      integer_tape_pointer = integer_tape_pointer+1
      TEMPOIL1%v = TEMPOIL2%v
      OpenAD_Symbol_881 = (INT(OpenAD_Symbol_881)+INT(1_w2f__i8))
    END DO
    integer_tape(integer_tape_pointer) = OpenAD_Symbol_881
    integer_tape_pointer = integer_tape_pointer+1
    OpenAD_Symbol_880 = (INT(OpenAD_Symbol_880)+INT(1_w2f__i8))
  END DO
  integer_tape(integer_tape_pointer) = OpenAD_Symbol_880
  integer_tape_pointer = integer_tape_pointer+1
  OIL%v = TEMPOIL2%v
    end if
    if (our_rev_mode%adjoint) then
! adjoint
  TEMPOIL2%d = TEMPOIL2%d+OIL%d
  OIL%d = 0.0d0
  integer_tape_pointer = integer_tape_pointer-1
  OpenAD_Symbol_875 = integer_tape(integer_tape_pointer)
  OpenAD_Symbol_876 = 1
  do while (INT(OpenAD_Symbol_876).LE.INT(OpenAD_Symbol_875))
    integer_tape_pointer = integer_tape_pointer-1
    OpenAD_Symbol_877 = integer_tape(integer_tape_pointer)
    OpenAD_Symbol_878 = 1
    do while (INT(OpenAD_Symbol_878).LE.INT(OpenAD_Symbol_877))
      TEMPOIL2%d = TEMPOIL2%d+TEMPOIL1%d
      TEMPOIL1%d = 0.0d0
      integer_tape_pointer = integer_tape_pointer-1
      ST = integer_tape(integer_tape_pointer)
      integer_tape_pointer = integer_tape_pointer-1
      ND = integer_tape(integer_tape_pointer)
      CALL UPDATE_OIL(ND,PT,ST,PC,K,TEMPOIL1,TEMPOIL2)
      integer_tape_pointer = integer_tape_pointer-1
      OpenAD_Symbol_1189 = integer_tape(integer_tape_pointer)
      double_tape_pointer = double_tape_pointer-1
      OpenAD_Symbol_1190 = double_tape(double_tape_pointer)
      double_tape_pointer = double_tape_pointer-1
      OpenAD_Symbol_1191 = double_tape(double_tape_pointer)
      MT%d = MT%d+PC(2,OpenAD_Symbol_1189)%d*(OpenAD_Symbol_1190)
      MO%d = MO%d+PC(2,OpenAD_Symbol_1189)%d*(OpenAD_Symbol_1191)
      PC(2,OpenAD_Symbol_1189)%d = 0.0d0
      integer_tape_pointer = integer_tape_pointer-1
      OpenAD_Symbol_1192 = integer_tape(integer_tape_pointer)
      double_tape_pointer = double_tape_pointer-1
      OpenAD_Symbol_1193 = double_tape(double_tape_pointer)
      double_tape_pointer = double_tape_pointer-1
      OpenAD_Symbol_1194 = double_tape(double_tape_pointer)
      MT%d = MT%d+PC(1,OpenAD_Symbol_1192)%d*(OpenAD_Symbol_1193)
      MW%d = MW%d+PC(1,OpenAD_Symbol_1192)%d*(OpenAD_Symbol_1194)
      PC(1,OpenAD_Symbol_1192)%d = 0.0d0
      MW%d = MW%d+MT%d
      MO%d = MO%d+MT%d
      MT%d = 0.0d0
      integer_tape_pointer = integer_tape_pointer-1
      OpenAD_Symbol_879 = integer_tape(integer_tape_pointer)
      IF (OpenAD_Symbol_879.ne.0) THEN
        integer_tape_pointer = integer_tape_pointer-1
        NZ = integer_tape(integer_tape_pointer)
        integer_tape_pointer = integer_tape_pointer-1
        NY = integer_tape(integer_tape_pointer)
        integer_tape_pointer = integer_tape_pointer-1
        NX = integer_tape(integer_tape_pointer)
        CALL STEPFORWARD(NX,NY,NZ,ND,PT,ST,OAD_CTMP0,Q,S,P,V,MW,MO)
      ELSE
        integer_tape_pointer = integer_tape_pointer-1
        NZ = integer_tape(integer_tape_pointer)
        integer_tape_pointer = integer_tape_pointer-1
        NY = integer_tape(integer_tape_pointer)
        integer_tape_pointer = integer_tape_pointer-1
        NX = integer_tape(integer_tape_pointer)
        CALL STEPFORWARD(NX,NY,NZ,ND,PT,ST,OAD_CTMP1,Q,S,P,V,MW,MO)
      ENDIF
      OpenAD_Symbol_878 = INT(OpenAD_Symbol_878)+1
    END DO
    OpenAD_Symbol_876 = INT(OpenAD_Symbol_876)+1
  END DO
  TEMPOIL2%d = 0.0d0
  TEMPOIL1%d = 0.0d0
  PC(2,1)%d = 0.0d0
  PC(1,1)%d = 0.0d0
  integer_tape_pointer = integer_tape_pointer-1
  OpenAD_Symbol_1188 = integer_tape(integer_tape_pointer)
  S(1:OpenAD_Symbol_1188)%d = 0.0d0
    end if
  end subroutine SIMULATE_RESERVOIR
!#########################################################
! This file is part of OpenAD released under the LGPL.   #
! The full COPYRIGHT notice can be found in the top      #
! level directory of the OpenAD distribution             #
!#########################################################

  SUBROUTINE STEPFORWARD(NX, NY, NZ, ND, PT, ST, PRESSURE_STEP, Q , S, P, V, MW,&
     & MO)

    use OAD_tape
    use OAD_rev

! original arguments get inserted before version
!         ! and declared here together with all local variables
!         ! generated by xaifBooster

  use w2f__types
  IMPLICIT NONE
!
!       **** Global Variables & Derived Type Definitions ****
!
  INTEGER(w2f__i8) OpenAD_Symbol_894
  INTEGER(w2f__i8) OpenAD_Symbol_895
  INTEGER(w2f__i8) OpenAD_Symbol_896
  INTEGER(w2f__i8) OpenAD_Symbol_897
  INTEGER(w2f__i8) OpenAD_Symbol_898
  INTEGER(w2f__i8) OpenAD_Symbol_899
!
!       **** Parameters and Result ****
!
  INTEGER(w2f__i4) NX
  INTEGER(w2f__i4) NY
  INTEGER(w2f__i4) NZ
  INTEGER(w2f__i4) ND
  INTEGER(w2f__i4) PT
  INTEGER(w2f__i4) ST
  INTEGER(w2f__i4) PRESSURE_STEP
  type(active) :: Q(1:INT((NZ*NX*NY)))
  type(active) :: S(1:INT((NZ*NX*NY)))
  type(active) :: P(1:NX,1:NY,1:NZ)
  type(active) :: V(1:3,1:INT((NX+1)),1:INT((NY+1)),1:INT((NZ+1)))
  type(active) :: MW
  type(active) :: MO


    integer iaddr
    external iaddr
!
!       **** Statements ****
!

   if (our_rev_mode%plain) then
! original function
  IF(PRESSURE_STEP .eq. 1) THEN
    CALL PRES(NX,NY,NZ,Q,S,P,V)
  ENDIF
  CALL NEWTRAPH(NX,NY,NZ,ND,PT,ST,Q,V,S)
  CALL RELPERM_SCALAR(S(NZ*NX*NY),MW,MO)
    end if
    if (our_rev_mode%tape) then
! taping
  IF (PRESSURE_STEP.eq.1) THEN
    CALL PRES(NX,NY,NZ,Q,S,P,V)
    integer_tape(integer_tape_pointer) = NX
    integer_tape_pointer = integer_tape_pointer+1
    integer_tape(integer_tape_pointer) = NY
    integer_tape_pointer = integer_tape_pointer+1
    integer_tape(integer_tape_pointer) = NZ
    integer_tape_pointer = integer_tape_pointer+1
    OpenAD_Symbol_895 = 1_w2f__i8
    integer_tape(integer_tape_pointer) = OpenAD_Symbol_895
    integer_tape_pointer = integer_tape_pointer+1
  ELSE
    OpenAD_Symbol_896 = 0_w2f__i8
    integer_tape(integer_tape_pointer) = OpenAD_Symbol_896
    integer_tape_pointer = integer_tape_pointer+1
  ENDIF
  CALL NEWTRAPH(NX,NY,NZ,ND,PT,ST,Q,V,S)
  integer_tape(integer_tape_pointer) = NX
  integer_tape_pointer = integer_tape_pointer+1
  integer_tape(integer_tape_pointer) = NY
  integer_tape_pointer = integer_tape_pointer+1
  integer_tape(integer_tape_pointer) = NZ
  integer_tape_pointer = integer_tape_pointer+1
  CALL RELPERM_SCALAR(S(NZ*NX*NY),MW,MO)
  integer_tape(integer_tape_pointer) = NZ
  integer_tape_pointer = integer_tape_pointer+1
  integer_tape(integer_tape_pointer) = NX
  integer_tape_pointer = integer_tape_pointer+1
  integer_tape(integer_tape_pointer) = NY
  integer_tape_pointer = integer_tape_pointer+1
    end if
    if (our_rev_mode%adjoint) then
! adjoint
  integer_tape_pointer = integer_tape_pointer-1
  NY = integer_tape(integer_tape_pointer)
  integer_tape_pointer = integer_tape_pointer-1
  NX = integer_tape(integer_tape_pointer)
  integer_tape_pointer = integer_tape_pointer-1
  NZ = integer_tape(integer_tape_pointer)
  CALL RELPERM_SCALAR(S(NZ*NX*NY),MW,MO)
  integer_tape_pointer = integer_tape_pointer-1
  NZ = integer_tape(integer_tape_pointer)
  integer_tape_pointer = integer_tape_pointer-1
  NY = integer_tape(integer_tape_pointer)
  integer_tape_pointer = integer_tape_pointer-1
  NX = integer_tape(integer_tape_pointer)
  CALL NEWTRAPH(NX,NY,NZ,ND,PT,ST,Q,V,S)
  integer_tape_pointer = integer_tape_pointer-1
  OpenAD_Symbol_894 = integer_tape(integer_tape_pointer)
  IF (OpenAD_Symbol_894.ne.0) THEN
    integer_tape_pointer = integer_tape_pointer-1
    NZ = integer_tape(integer_tape_pointer)
    integer_tape_pointer = integer_tape_pointer-1
    NY = integer_tape(integer_tape_pointer)
    integer_tape_pointer = integer_tape_pointer-1
    NX = integer_tape(integer_tape_pointer)
    CALL PRES(NX,NY,NZ,Q,S,P,V)
  ENDIF
    end if
  end subroutine STEPFORWARD
!#########################################################
! This file is part of OpenAD released under the LGPL.   #
! The full COPYRIGHT notice can be found in the top      #
! level directory of the OpenAD distribution             #
!#########################################################

  SUBROUTINE UPDATE_OIL(ND, PT, ST, PC, K, OILIN, OILOUT)
    use OAD_tape
    use OAD_rev

! original arguments get inserted before version
!         ! and declared here together with all local variables
!         ! generated by xaifBooster

  use w2f__types
  IMPLICIT NONE
!
!       **** Parameters and Result ****
!
  INTEGER(w2f__i4) ND
  INTEGER(w2f__i4) PT
  INTEGER(w2f__i4) ST
  type(active) :: PC(1:2,1:INT(((ND/ST)+1)))
  INTEGER(w2f__i4) K
  type(active) :: OILIN
  type(active) :: OILOUT
!
!       **** Local Variables and Functions ****
!
  INTEGER(w2f__i4) OpenAD_Symbol_1195
  INTEGER(w2f__i4) OpenAD_Symbol_1196
  INTEGER(w2f__i4) OpenAD_lin_58
!
!       **** Statements ****
!


    integer iaddr
    external iaddr

   if (our_rev_mode%plain) then
! original function
  OILOUT%v = (OILIN%v+ST*PC(2,K)%v)
    end if
    if (our_rev_mode%tape) then
! taping
  OpenAD_lin_58 = ST
  OILOUT%v = (OILIN%v+ST*PC(2,K)%v)
  double_tape(double_tape_pointer) = OpenAD_lin_58
  double_tape_pointer = double_tape_pointer+1
  integer_tape(integer_tape_pointer) = K
  integer_tape_pointer = integer_tape_pointer+1
    end if
    if (our_rev_mode%adjoint) then
! adjoint
  integer_tape_pointer = integer_tape_pointer-1
  OpenAD_Symbol_1195 = integer_tape(integer_tape_pointer)
  double_tape_pointer = double_tape_pointer-1
  OpenAD_Symbol_1196 = double_tape(double_tape_pointer)
  PC(2,OpenAD_Symbol_1195)%d = PC(2,OpenAD_Symbol_1195)%d+OILOUT%d*(OpenAD_Symbo&
     &l_1196)

  OILIN%d = OILIN%d+OILOUT%d
  OILOUT%d = 0.0d0
    end if
  end subroutine UPDATE_OIL
!#########################################################
! This file is part of OpenAD released under the LGPL.   #
! The full COPYRIGHT notice can be found in the top      #
! level directory of the OpenAD distribution             #
!#########################################################

  SUBROUTINE WRAPPER(NX, NY, NZ, ND, PT, ST, MU, SIGMA, Q, S, P, V, TT, PC, OIL)
    use OAD_tape
    use OAD_rev

! original arguments get inserted before version
!         ! and declared here together with all local variables
!         ! generated by xaifBooster

  use w2f__types
  use parameters
  use parameters
  use parameters
  IMPLICIT NONE
!
!       **** Parameters and Result ****
!
  INTEGER(w2f__i4) NX
  INTEGER(w2f__i4) NY
  INTEGER(w2f__i4) NZ
  INTEGER(w2f__i4) ND
  INTEGER(w2f__i4) PT
  INTEGER(w2f__i4) ST
  type(active) :: MU
  type(active) :: SIGMA
  type(active) :: Q(1:INT((NZ*NX*NY)))
  type(active) :: S(1:INT((NZ*NX*NY)))
  REAL(w2f__8) P(1 : NX, 1 : NY, 1 : NZ)
  REAL(w2f__8) V(1 : 3, 1 : INT((NX + 1)), 1 : INT((NY + 1)), 1 : INT((NZ + 1)))
  REAL(w2f__8) TT(1 : INT(((ND / ST) + 1)))
  REAL(w2f__8) PC(1 : 2, 1 : INT(((ND / ST) + 1)))
  type(active) :: OIL
!
!       **** Local Variables and Functions ****
!
  type(active) :: OpenAD_tyc_10(:,:,:,:)
  ALLOCATABLE OpenAD_tyc_10
  type(active) :: OpenAD_tyc_11(:,:)
  ALLOCATABLE OpenAD_tyc_11
  type(active) :: OpenAD_tyc_2(:,:,:)
  ALLOCATABLE OpenAD_tyc_2
  type(active) :: OpenAD_tyc_3(:,:,:,:)
  ALLOCATABLE OpenAD_tyc_3
  type(active) :: OpenAD_tyc_4(:,:)
  ALLOCATABLE OpenAD_tyc_4
  type(active) :: OpenAD_tyc_9(:,:,:)
  ALLOCATABLE OpenAD_tyc_9


    integer iaddr
    external iaddr
!
!       **** Top Level Pragmas ****
!
!$OPENAD INDEPENDENT(MU)
!$OPENAD INDEPENDENT(SIGMA)
!$OPENAD DEPENDENT(OIL)
!
!       **** Statements ****
!

   if (our_rev_mode%plain) then
! original function
  CALL INIT_FLW_TRNC_NORM_XIN_PT_OUT(NX,NY,NZ,MU,SIGMA,Q)
!!! requested inline of 'oad_AllocateMatching' has no defn
  CALL oad_AllocateMatching(OpenAD_tyc_2,P)
!!! requested inline of 'oad_convert' has no defn
  CALL oad_convert(OpenAD_tyc_2,P)
!!! requested inline of 'oad_AllocateMatching' has no defn
  CALL oad_AllocateMatching(OpenAD_tyc_3,V)
!!! requested inline of 'oad_convert' has no defn
  CALL oad_convert(OpenAD_tyc_3,V)
!!! requested inline of 'oad_AllocateMatching' has no defn
  CALL oad_AllocateMatching(OpenAD_tyc_4,PC)
!!! requested inline of 'oad_convert' has no defn
  CALL oad_convert(OpenAD_tyc_4,PC)
  CALL SIMULATE_RESERVOIR(NX,NY,NZ,ND,PT,ST,Q,S,OpenAD_tyc_2,OpenAD_tyc_3,TT,Ope&
     &nAD_tyc_4,OIL)

!!! requested inline of 'oad_ShapeTest' has no defn
  CALL oad_ShapeTest(OpenAD_tyc_2,P)
!!! requested inline of 'oad_convert' has no defn
  CALL oad_convert(P,OpenAD_tyc_2)
!!! requested inline of 'oad_ShapeTest' has no defn
  CALL oad_ShapeTest(OpenAD_tyc_3,V)
!!! requested inline of 'oad_convert' has no defn
  CALL oad_convert(V,OpenAD_tyc_3)
!!! requested inline of 'oad_ShapeTest' has no defn
  CALL oad_ShapeTest(OpenAD_tyc_4,PC)
!!! requested inline of 'oad_convert' has no defn
  CALL oad_convert(PC,OpenAD_tyc_4)
    end if
    if (our_rev_mode%tape) then
! taping
  CALL INIT_FLW_TRNC_NORM_XIN_PT_OUT(NX,NY,NZ,MU,SIGMA,Q)
  integer_tape(integer_tape_pointer) = NX
  integer_tape_pointer = integer_tape_pointer+1
  integer_tape(integer_tape_pointer) = NY
  integer_tape_pointer = integer_tape_pointer+1
  integer_tape(integer_tape_pointer) = NZ
  integer_tape_pointer = integer_tape_pointer+1
!!! requested inline of 'oad_AllocateMatching' has no defn
  CALL oad_AllocateMatching(OpenAD_tyc_2,P)
!!! requested inline of 'oad_convert' has no defn
  CALL oad_convert(OpenAD_tyc_2,P)
!!! requested inline of 'oad_AllocateMatching' has no defn
  CALL oad_AllocateMatching(OpenAD_tyc_3,V)
!!! requested inline of 'oad_convert' has no defn
  CALL oad_convert(OpenAD_tyc_3,V)
!!! requested inline of 'oad_AllocateMatching' has no defn
  CALL oad_AllocateMatching(OpenAD_tyc_4,PC)
!!! requested inline of 'oad_convert' has no defn
  CALL oad_convert(OpenAD_tyc_4,PC)
  CALL SIMULATE_RESERVOIR(NX,NY,NZ,ND,PT,ST,Q,S,OpenAD_tyc_2,OpenAD_tyc_3,TT,Ope&
     &nAD_tyc_4,OIL)

!!! requested inline of 'oad_ShapeTest' has no defn
  CALL oad_ShapeTest(OpenAD_tyc_2,P)
!!! requested inline of 'oad_convert' has no defn
  CALL oad_convert(P,OpenAD_tyc_2)
!!! requested inline of 'oad_ShapeTest' has no defn
  CALL oad_ShapeTest(OpenAD_tyc_3,V)
!!! requested inline of 'oad_convert' has no defn
  CALL oad_convert(V,OpenAD_tyc_3)
!!! requested inline of 'oad_ShapeTest' has no defn
  CALL oad_ShapeTest(OpenAD_tyc_4,PC)
!!! requested inline of 'oad_convert' has no defn
  CALL oad_convert(PC,OpenAD_tyc_4)
  integer_tape(integer_tape_pointer) = NX
  integer_tape_pointer = integer_tape_pointer+1
  integer_tape(integer_tape_pointer) = NY
  integer_tape_pointer = integer_tape_pointer+1
  integer_tape(integer_tape_pointer) = NZ
  integer_tape_pointer = integer_tape_pointer+1
  integer_tape(integer_tape_pointer) = ND
  integer_tape_pointer = integer_tape_pointer+1
  integer_tape(integer_tape_pointer) = ST
  integer_tape_pointer = integer_tape_pointer+1
    end if
    if (our_rev_mode%adjoint) then
! adjoint
  integer_tape_pointer = integer_tape_pointer-1
  ST = integer_tape(integer_tape_pointer)
  integer_tape_pointer = integer_tape_pointer-1
  ND = integer_tape(integer_tape_pointer)
  integer_tape_pointer = integer_tape_pointer-1
  NZ = integer_tape(integer_tape_pointer)
  integer_tape_pointer = integer_tape_pointer-1
  NY = integer_tape(integer_tape_pointer)
  integer_tape_pointer = integer_tape_pointer-1
  NX = integer_tape(integer_tape_pointer)
!!! requested inline of 'oad_AllocateMatching' has no defn
  CALL oad_AllocateMatching(OpenAD_tyc_9,P)
!!! requested inline of 'oad_AllocateMatching' has no defn
  CALL oad_AllocateMatching(OpenAD_tyc_10,V)
!!! requested inline of 'oad_AllocateMatching' has no defn
  CALL oad_AllocateMatching(OpenAD_tyc_11,PC)
  CALL SIMULATE_RESERVOIR(NX,NY,NZ,ND,PT,ST,Q,S,OpenAD_tyc_9,OpenAD_tyc_10,TT,Op&
     &enAD_tyc_11,OIL)

  integer_tape_pointer = integer_tape_pointer-1
  NZ = integer_tape(integer_tape_pointer)
  integer_tape_pointer = integer_tape_pointer-1
  NY = integer_tape(integer_tape_pointer)
  integer_tape_pointer = integer_tape_pointer-1
  NX = integer_tape(integer_tape_pointer)
  CALL INIT_FLW_TRNC_NORM_XIN_PT_OUT(NX,NY,NZ,MU,SIGMA,Q)
    end if
  end subroutine WRAPPER
END
